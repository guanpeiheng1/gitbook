---
title: 黑苹果的安装与配置
categories: Mac
abbrlink: Hackintosh-Installation
date: 2019-11-26 14:24:16
tags:
---

![](https://tva1.sinaimg.cn/large/006y8mN6ly1g9bt5qlkq5j31lv0u0kii.jpg)

本文以macOS Mojave为例进行说明，包含内容较多，主要适合较新主板的安装。较为重要的文件下载将放于文末，否则放于文中。

<!-- more -->

# 虚拟机安装

安装Vmware Workstation Player后，打开任务管理器，切换到服务选项卡，停止所有与VM有关的服务。

通过以下链接下载Vmware虚拟机苹果破解补丁unlocker，解压后右键以管理员身份运行win-install，完成虚拟机对macOS系统限制的破解。

```
https://github.com/theJaxon/unlocker/releases
```

打开Vmware Workstation Player，创建新虚拟机，系统选择Mac OS X，安装光盘选择Mac OS X的iso或cdr镜像文件，注意不能是dmg格式。cdr格式的可用镜像示例如下。

```
链接 / https://pan.baidu.com/s/13rD1YbYwSKSDVhIxoUVxHw
提取码 / 4nii
```

创建并完成虚拟机内Mac的安装，注意用户密码不能为空。安装完成后，在虚拟机菜单上点击`安装Vmware Tools for Mac`，即可使Mac满屏显示。

点击虚拟机选项-共享文件夹，勾选`总是启用`并设置好共享文件夹，即可完成Windows和Mac的文件互通。

# 硬盘安装

## 记录硬件配置

在Windows下，右键点击此电脑，选择管理-设备管理器，得到设备清单。在某设备上点击属性-详细信息，在属性下拉栏选择硬件ID，记录下VID和PID。VID即Vendor ID，指供应商ID，在Windows下以`VID_`显示。PID即Device ID，指设备ID，在Windows下以`PID_`显示。

对于笔记本，主要记录显卡、声卡、网卡、键盘、触控板和蓝牙的型号。以本机为例，型号为华硕FL8000U，硬件基本信息如下。需要注意的是，BIOS类型应为UEFI。

|          | 型号                               | Device ID | Vendor ID |
| -------- | -------------------------------- | --------- | --------- |
| CPU      | Intel Core i7-8550U（Kaby-Lake）   | /         | /         |
| 核心显卡     | Intel UHD Graphics 620           | 5917      | 8086      |
| 独立显卡     | NVIDIA GeForce 940MX             | 134D      | 10DE      |
| 声卡       | Realtek ALC 294                  | 0294      | 10EC      |
| 有线网卡     | Realtek RTL8111                  | /         | /         |
| 无线网卡     | Atheros AR9565                   | 0036      | 168C      |
| 键盘       | PS2键盘                            | /         | /         |
| 触摸板      | I2C触摸板                           | /         | /         |
| 蓝牙       | Atheros Bluetooth 4.0            | 3018      | 04CA      |

## 安装包下载

在下载安装包前，需下载Clover。建议下载pkg和ISO版本，其中对于ISO版本，可用解压软件打开，提取Clover启动所需要的完整EFI文件夹，以便于后续安装。该文件夹的目录层级如下。

```
├── EFI
   ├── Boot
   └── CLOVER
        ├── ACPI
        ├── drivers
        ├── ...
        ├── CLOVERX64.efi
        └── config.plist
```

### 通过黑果小兵

可通过黑果小兵的博客下载，镜像带引导。

```
https://blog.daliansky.net/categories/%E4%B8%8B%E8%BD%BD/%E9%95%9C%E5%83%8F/
```

### 通过macrecovery

以Windows为例，下载OpenCore，链接如下。

```
https://github.com/acidanthera/OpenCorePkg
```

解压后打开命令提示符，路径个切换到解压文件夹内的Utilities/macrecovery，然后通过以下命令进行下载。

```
# Lion(10.7):
python macrecovery.py -b Mac-2E6FAB96566FE58C -m 00000000000F25Y00 download
python macrecovery.py -b Mac-C3EC7CD22292981F -m 00000000000F0HM00 download

# Mountain Lion(10.8):
python macrecovery.py -b Mac-7DF2A3B5E5D671ED -m 00000000000F65100 download

# Mavericks(10.9):
python macrecovery.py -b Mac-F60DEB81FF30ACF6 -m 00000000000FNN100 download

# Yosemite(10.10):
python macrecovery.py -b Mac-E43C1C25D4880AD6 -m 00000000000GDVW00 download

# El Capitan(10.11):
python macrecovery.py -b Mac-FFE5EF870D7BA81A -m 00000000000GQRX00 download

# Sierra(10.12):
python macrecovery.py -b Mac-77F17D7DA9285301 -m 00000000000J0DX00 download

# High Sierra(10.13)
python macrecovery.py -b Mac-7BA5B2D9E42DDD94 -m 00000000000J80300 download
python macrecovery.py -b Mac-BE088AF8C5EB4FA2 -m 00000000000J80300 download

# Mojave(10.14)
python macrecovery.py -b Mac-7BA5B2DFE22DDD8C -m 00000000000KXPG00 download

# Catalina(10.15)
python macrecovery.py -b Mac-00BE6ED71E35EB86 -m 00000000000000000 download

# Big Sur(11)
python macrecovery.py -b Mac-E43C1C25D4880AD6 -m 00000000000000000 download
```

### 通过GibMacOS

对于10.13及以上系统，可通过GibMacOS下载原版镜像，注意不带引导。运行gibMacOS.command即可，链接如下。

```
https://github.com/corpnewt/gibMacOS
```

对于Big Sur，下载后在Mac下打开installAssistant.pkg，安装到当前系统盘，即可在应用程序中找到安装包程序。对于Catalina及更早版本，则应当运行BuildmacOSInstallApp.command以得到安装包，然后将安装包拖入应用程序文件夹。

## 硬盘分区

由于macOS只能以EFI方式引导，因此需确保分区表为GPT格式。

可在Windows下打开DiskGenius，确认分区表为GUID格式，若不是，则在硬盘上单击右键，选择`转换分区表类型为GUID格式`。确保硬盘有一个200-300M的EFI分区，若没有则需要新建。并提前备份EFI内的文件至U盘，防止安装Mac时引导丢失。为Mac的安装划出50G以上的分区，格式化为APFS。

若用Mac进行格式化，则格式化为GUID分区表时会自动生成一个200MB的EFI分区。

## 安装盘制作

此处以Majove 10.14.3为例。插入容量大于8G的U盘，提前备份好U盘资料。

### 对于从黑果小兵下载

若为Windows，且下载的镜像为带引导的dmg格式，则以管理员身份打开TransMac，在插入的U盘上点击右键，选择Restore with Disk Image，点击Yes以抹掉资料，选择dmg镜像，等待写入完成。也可通过Etcher完成以上操作。

### 对于从macrecovery下载

下载完成后将获得BaseSystem或RecoveryImage文件。将USB格式化为FAT32，在根目录新建名为com.apple.recovery.boot的文件夹并复制下载内容至该文件夹，注意.dmg和.chunklist文件都要复制。然后复制从Clover提取的EFI文件夹到根目录，保持与com.apple.recovery.boot文件夹同级。

### 对于从GibMacOS下载

若为Mac，且获取的是不带引导的系统app安装包，则先将USB进行分区，分区表为GUID，创建一个大小为200-300MB的EFI分区，剩余空间则用于安装程序。

打开终端并输入以下命令，注意将MyVolume替换为USB磁盘名称。完成后复制从Clover提取的EFI文件夹到EFI磁盘。

```
// 以Mojave为例
sudo /Applications/Install\ macOS\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

若为Windows，则通过MakeInstall.bat进行制作，注意该脚本将默认创建MBR引导。

## BIOS设置

### 全局设置

有AHCI的均选`AHCI`，开启支持UEFI启动。

|                 选项                | 本机BIOS地址 | 设定值 |      设置      |                             说明                            |
|-------------------------------------|--------------|--------|----------------|-------------------------------------------------------------|
| Fast Boot                           | 0xF7A        | 0x0    | Disabled       | 快速启动                                                    |
| Secure Boot                         |              |        | Disabled       | 安全启动                                                    |
| CFG Lock                            | 0x527        | 0x0    | Disabled       | CFG锁（MSR 0xE2写入保护）                                   |
| Vt-d                                | 0x7EC        | 0x0    | Disabled       | 直接 I/O 访问的 VT虚拟化技术                                |
| CSM                                 | 0x1032       | 0x0    | Disabled       | 兼容性支持模块（如果看到乱码则启用）                        |
| Intel SGX                           | 0x5DC        | 0x0    | Disabled       | Intel架构新扩展                                             |
| IO Serial Port                      |              |        | Disabled       |                                                             |
| LAN/WLAN switching                  |              |        | Disabled       |                                                             |
| Extended Idle Power States          |              |        | Disabled       |                                                             |
| Wake on LAN/WLAN/WWAN               |              |        | Disabled       |                                                             |
| Wake on USB                         |              |        | Disabled       |                                                             |
| Firewire/IEEE 1394                  |              |        | Disabled       |                                                             |
| USB 3.0                             |              |        | Disabled       | 安装好系统后可以开启                                        |
| TMP/Security Chips/Security modules |              |        | Disabled       | 安全模块                                                    |
| VT-x                                | /            | /      | Enabled        | 英特尔虚拟化技术                                            |
| Above 4G decoding                   | 0x7ED        | 0x1    | Enabled        | 大于4G地址空间解码                                          |
| Hyper Threading                     | 0x4F0        | 0x1    | Enabled        | 处理器超线程                                                |
| Execute Disable Bit                 | 0x4E9        | 0x1    | Enabled        | 执行禁止位                                                  |
| EHCI Hand-off                       | 0x2          | 0x1    | Enabled        | 接手EHCI控制                                                |
| XHCI Hand-off                       | 0x1B         | 0x1    | Enabled        | 接手XHCI控制                                                |
| USB Hand-off                        |              |        | Enabled        | 接手USB控制（打开后则无需ReleaseUsbOwnership/Fixownership） |
| Launch Hotkeys without Fn keypress  |              |        | Enabled        | 对于Skylake和KabyLake平台                                   |
| USB Legacy support                  |              |        | Enable         |                                                             |
| OS type                             | /            | /      | Windows 8.1/10 | 操作系统类型Windows 8.1/10                                  |
| Controller Mode                     |              |        | AHCI mode      | 硬盘模式                                                    |

### 显卡设置

若有Nvidia/AMD的显卡，则主显示器应设置为PEG或PCIE，并禁用与Intel显卡有关的选项（Hybrid Graphics/Dual Graphics/DVMT size等）。

若有Intel的显卡，则将DVMT设置为64MB或更大。

## 正式安装

BIOS中启动顺序把UEFI启动的U盘设为第一，在弹出的Clover界面选择Boot OS X Install from Install macOS Majove，稍等片刻进入安装界面。

在macOS实用工具中选择`磁盘工具`，点击左侧按钮选择`显示所有设备`，选择之前分好的Mac安装盘，点击抹掉，并选择格式为APFS。返回安装界面，选择刚才格式化好的盘进行安装，等待安装完成。

重启时需继续从U盘启动，Clover界面中选择macOS的安装盘，进入欢迎界面后注意用户密码不能为空且跳过iCloud设置。正常进入黑苹果桌面后不要登录iCloud、iMessage、FaceTime。

若在跑代码的过程中发生错误，则根据常见问题进行排除。

## 本地引导

黑苹果需通过特殊的引导器才能正常启动。最为广泛使用的启动器为Clover。

### Clover安装

在Mac下打开Clover的pkg安装包，同意协议后点击自定，勾选安装在Clover到EFI分区、UEFI Drivers。

安装完成后使用Clover Configurator挂载EFI分区，并打开EFI/CLOVER/kexts，只留Others文件夹，其余删除。打开Others文件夹，只留VirtualSMC.kext、WhatEverGreen.kext和Lilu.kext。

然后打开EFI/CLOVER/DRIVER64UEFI，删除SMCHelper-64.efi并复制VirtualSMC.efi到此目录下。

目录层级如下。

```
├── ACPI
├── CLOVERX64.efi
├── config.plist
├── drivers
│   └── UEFI
│       ├── ApfsDriverLoader.efi
│       ├── AudioDxe.efi
│       ├── DataHubDxe.efi
│       ├── FSInject.efi
│       ├── HFSPlus.efi
│       ├── OpenRuntime.efi
│       └── VirtualSmc.efi
├── kexts
    └── Other
        ├── Lilu.kext
        ├── VirtualSMC.kext
        └── WhateverGreen.kext
```

### Clover配置

用Clover Configurator打开config.plist，按下列设置进行修改。

#### ACPI

将Fixs下所有选项取消勾选（1和2两个页面的选项都要取消），并添加以下更名补丁。

```
Comment: change _DSM to XDSM
Find: 5F44534D
Replace: 5844534D
```

#### Boot

Arguments下勾选Verbose（-v）、nv_disable=1、dart=0，其余不勾选。

#### Grpahics

取消勾选Inject Intel、Inject EDID。

#### Devices

在Audio的Inject下拉菜单选择No，把下方Arbitrary、Properties和Add Properties所有内容删掉。

### 进入系统

退出Clover Configurator，保存更改后拔出U盘并重启，在BIOS下应当多出一项UEFI OS，进入后选择macOS安装盘启动。此时已完成Clover引导器的安装，可以脱离U盘引导。

若Windows引导丢失，将备份好的EFI/BOOT中的Microsoft文件夹复制到EFI分区中的EFI/BOOT，与Clover文件夹同级即可。

## 驱动修补

Mac的驱动以Kernel Extensions（kexts）形式存在。系统的kexts存放于/System/Library/Extentions（SLE）或/Library/Extentions（LE），其中SLE为系统kexts的主要放置路径，LE为系统拓展kexts放置路径。kexts内部的dsYM是签名文件，仅用于调试目的。

一般不建议修改SLE或LE目录。若需将驱动装入SLE或LE，可通过Kext Utility（在Catalina下需先解锁系统分区）或Hackintool。以Hackintool为例，在Hackintool的`工具`选项卡下点击下方的小屋按钮即可。

### 显卡

VGA在Mac中不可使用。

#### 选择显卡

在DSDT的PCI0设备目录下，Intel显卡拥有关键字`Name (_ADR, 0x00010000)`。Mac原生支持Intel显卡，但需要进行缓冲帧修补。

对于笔记本而言，如果独显不与核显绑定，即独显本身可以独立工作，则不需要屏蔽独显，可从BIOS层面关闭核显，并寻找独显驱动。该情况能够存在的必要条件是MUX芯片存在，但大多数笔记本电脑都没有该芯片。包含该芯片的笔记本列表可参照以下表格。

|              设备             |          CPU          |                                                dGPU直通                                                |                                              iGPU直通                                              |                                eGPU直通                                |                               备注                               |
|-------------------------------|-----------------------|--------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|------------------------------------------------------------------|
| Razer Blade 15 (2018 Basic)   | Intel Core i7-8750H   | GTX 1060 Mobile with Max-Q design (6GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作 | Intel UHD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                  | GTX 970</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作 | 支持TB3 eGPU                                                     |
| Gigabyte P35X v4              | Intel Core i7-5700HQ  | GTX 980M (8GB)</br>Windows下工作；Linux下未知                                                          | Intel HD Graphics 5600</br>Windows下工作；Linux下未知                                              |                                                                        | 需要修改的UEFI/BIOS（禁用Secure Boot）                           |
| MSI GF72 8RE-032              | Intel Core i7-8750H   | GTX 1060 Mobile (6GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作                   | Intel UHD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                  |                                                                        |                                                                  |
| HP Pavilion G6-2348SG         | Intel Core i7 3632QM  | AMD Radeon HD 7670M</br>Windows下不可能；Linux下不可能                                                 | Intel HD Graphics 4000</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        |                                                                  |
| ASUS TUF Gaming FX505DY       | AMD Ryzen 5 3550H     | AMD Radeon RX 560X (4GB)</br>Windows下工作，但AMD驱动会遇到43错误；Linux下能工作                       | AMD Radeon Vega 8</br>Windows下大概能工作；Linux下大概能工作                                       |                                                                        |                                                                  |
| ASUS ROG G751JY               | Intel Core i7-4710HQ  | GTX 980M (4GB)</br>Windows下不可能；Linux下不可能                                                      | Intel HD Graphics 4600</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        | iGPU被禁用，且没有UEFI选项开启                                   |
| ASUS G752VS-BA329T            | Intel Core i7-7700HQ  | GTX 1070 Mobile (8GB)</br>Windows下不可能；Linux下不可能                                               | Intel UHD Graphics 630</br>Windows下不可能；Linux下不可能                                          |                                                                        | iGPU被禁用，且没有UEFI选项开启                                   |
| ASUS ROG G551JW               | Intel Core i7-4720HQ  | GTX 960M (2GB/4GB DDR3)</br>Windows下工作；Linux下未知                                                 | Intel HD Graphics 4600</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        |                                                                  |
| ASUS G751JM                   | Intel Core i7-4710HQ  | GTX 860M (2GB)</br>Windows下工作；Linux下未知                                                          | Intel HD Graphics 4600</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        |                                                                  |
| ASUS X550VX                   | Intel Core i5-6300HQ  | GTX 950M (2GB)</br>Windows下工作；Linux下未知                                                          | Intel HD Graphics 530</br>Windows下未知；Linux下未知                                               |                                                                        |                                                                  |
| MSI GS63VR 7RF REV:1.0        | Intel Core i7-7700HQ  | GTX 1060 Mobile (6GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下能工作                       | Intel HD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                   |                                                                        |                                                                  |
| MSI GS60-040XFR               | Intel Core i7-4720HQ  | GTX 970M (3GB)</br>Windows下工作；Linux下未知                                                          | Intel HD Graphics 4600</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        |                                                                  |
| MSI GS60 2PC                  | Intel Core i7-4720HQ  | GTX 860M (2GB)</br>Windows下工作；Linux下未知                                                          | Intel HD Graphics 4600</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        |                                                                  |
| MSI GT70 2PE Dominator Pro    | Intel Core i7-4800MQ  | GTX 880M (GDDR5 8GB/4GB)</br>Windows下工作；Linux下大概能工作                                          | Intel HD Graphics 4600 </br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU |                                                                        | dGPU直通需要SeaBIOS而不是UEFI（OVMF）                            |
| Gigabyte Aero 14              | Intel Core™ i7-7700HQ | GTX 1050 Ti (4GB)</br>Windows下工作；Linux下未知                                                       | Intel HD Graphics 630</br>Windows下工作；Linux下未知                                               |                                                                        |                                                                  |
| Gigabyte Aero 15X v8          | Intel Core i7-8750H   | GTX 1070 with Max-Q design (8GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下能工作            | Intel UHD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                  |                                                                        |                                                                  |
| Lenovo ThinkPad P51           | Intel Core i7-7700HQ  | NVIDIA Quadro M1200 (4GB)</br>Windows下未知；Linux下能工作                                             | Intel UHD Graphics 630</br>Windows下未知；Linux下能工作                                            |                                                                        | 可使用Intel GVT-g以使两张卡同时通过，Bumblebee可在访客模式下使用 |
| Lenovo Legion Y7000           | Intel Core i7-8750H   | GTX 1060 Mobile (6GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作                   | Intel UHD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                  |                                                                        |                                                                  |
| Dell XPS 15 9550              | Intel Core i7-6700HQ  | GTX 960M (2GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作                          | Intel HD Graphics 530</br>Windows下大概能工作；Linux下大概能工作                                   |                                                                        |                                                                  |
| Dell XPS 15 9570              | Intel Core i7-8750H   | GTX 1050Ti (4GB)</br>Windows下工作；Linux下大概能工作                                                  | Intel UHD Graphics 630</br>Windows下工作；Linux下大概能工作                                        |                                                                        |                                                                  |
| Dell Precision 7510           | Intel Xeon E3-1200 v5 | Nvidia Quadro M2000M</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作                    | Intel HD Graphics P530</br>Windows下大概能工作；Linux下大概能工作                                  |                                                                        |                                                                  |
| OVERPOWERED Gaming Laptop 15+ | Intel Core i7-8750H   | GTX 1060 (6GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作                          | Intel UHD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                  |                                                                        |                                                                  |
| CLEVO P950ER                  | Intel Core i7-8750H   | GTX 1070 with Max-Q design (8GB)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作        | Intel UHD Graphics 630</br>Windows下大概能工作；Linux下大概能工作                                  |                                                                        |                                                                  |
| XMG P505 (Clevo P650SG)       | Intel Core i7-4720HQ  | GTX 970M (4GB)</br>Windows下工作，但某些应用只能在RDP下运行；Linux下大概能工作                         | Intel HD Graphics 4600</br>Windows下不支持4代及更早的Intel CPU；Linux下不支持4代及更早的Intel CPU  |                                                                        | 需要Nvidia驱动(353.82)以在Windows 10下运行                       |
| CLEVO N957TP6                 | Unknown (Intel)       | Unknown (Nvidia)</br>Windows下工作，但Nvidia驱动会遇到43错误；Linux下大概能工作                        | Unknown</br>Windows下大概能工作；Linux下大概能工作                                                 |                                                                        |                                                                  |

可使用以下脚本进行判断。

```
https://github.com/T-vK/MobilePassThrough
```

若没有该芯片，由于Mac不支持双显卡切换技术，为使显卡正常，需要屏蔽独显。大多数笔记本上的双显卡切换是让集显承担图像输出任务，所以不能屏蔽集显，屏蔽会导致黑屏。

可以通过外接显示器判断独显是否独立。外接显示器后在桌面右键，打开NVIDIA控制面板，然后看是否可以调节数字振动这类设置。如果可以，说明此独显可以被独立驱动。

对于本机而言，由于BIOS中有External Gfx Card Primary Display Configuration，理论上可以屏蔽核显以驱动独显。考虑到BIOS中的设置会影响其他系统，此处采用屏蔽Nvidia独显而驱动Intel核显的方案。

对于旧版Mac的独显，可尝试通过purge-wrangler驱动，链接如下。

```
https://github.com/mayankk2308/purge-wrangler
```

#### 查找设备路径

设备路径描述了设备在所有硬件中的具体位置，为类似`_SB.PCI0.PEG0.PEGP`的形式。

##### 通过gfxutil

下载`gfxutil`后打开终端，并切换到gfxutil所在路径，执行以下命令以输出显卡设备路径。

```
// 独显
gfxutil -f GFX0

// 核显
gfxutil -f IGPU
```

##### 通过Windows

打开Windows下的设备管理器，在独显设备上右键单击`属性`，在详细信息标签卡下拉菜单选择`BIOS设备名称`即可。

##### 通过ACPI表

在Clover引导界面按下`F4`，进入系统后打开EFI/CLOVER/ACPI/origin，可得到本机所有ACPI文件。复制到任一位置后打开终端，切换到复制到的位置并执行以下命令。

```
grep -l _OFF *.aml
grep -l _INI *.aml
```

检查输出并记录两个输出中均存在的文件。打开这些文件并查找\_OFF方法，如果这个方法在PowerShell宏中（即由PowerShell大括号括住），则舍弃。找到独立的\_OFF方法并记录其设备路径即可。

#### 驱动Nvidia显卡

Nvidia显卡一般免驱，部分显卡打开Inject Nvidia即可驱动成功。对于未受支持的显卡，则需要安装Nvidia WebDriver。此驱动最新版只适用于10.13，因此需要进行修补。

在终端输入以下命令以启动安装脚本。

```
curl -O https://raw.githubusercontent.com/Benjamin-Dobell/nvidia-update/master/nvidia-update.sh
chmod 755 nvidia-update.sh
./nvidia-update.sh -f
```

安装完成后重启，在系统设置中已经能够看到Nvidia控制面板。可安装WebDriver Manager获得更好的体验。若未驱动，则需要在Clover的System Parameters下勾选NvidiaWeb。

若为笔记本，独显通常不可驱动。若为台式机，在Catalina上独显无法开启硬件加速。若该显卡正常驱动，可安装CUDA Driver获得更好的功能。

#### 驱动Intel显卡

确保kexts文件夹内有Lilu.kext和WhateverGreen.kext。打开Hackintool，在缓冲帧菜单项选择macOS 10.14，在IntelGen菜单项选择显卡的次代。本机为Intel HD Graphics 620，选择Kaby Lake。然后选择PlatformID，本机选择0×59160000。具体对应架构和PlatformID参见附录。

点击应用补丁选项卡，进行以下设置。

```
// 通用
选择设备属性，勾选自动侦测变化、全部、接口、基本显存、EDID、图形卡、音频、PCI设备

// Advenced
勾选将DP映射到HDMI、使用英特尔HDMI、修复热插拔重启、HDMI无限循环修复、仿冒声卡ID、显存2048MB、启用HDMI20（4K）、缓冲帧接口数限制：3
勾选仿冒图形卡ID，选择对应显卡设备
```

点击Generate Patch生成显卡驱动补丁。点击File-Export-Clover config.plist，路径选择EFI/CLOVER并确认替换。注意，Hackintool会将原来的config.plist和生成的补丁进行合成，替换以后的config.plist为原有基础上添加了显卡补丁的配置文件，原有配置文件则被备份为config-backup.plist。

#### 屏蔽独显

##### 通过添加引导标志

保证Whatevergreen存在，在Clover引导标志中添加`-wegnoegpu`。此方法不能保证始终正常工作。

##### 通过添加独显设备并禁用

注意，进入该设备路径的其它设备也将获得这些属性，从而失效，即会禁用同一品牌的所有显卡，也会禁用开普勒GPU。其它PCIe驱动器也可用此法禁用。

查找到独显设备路径后，在Clover的Device-Add Properties下添加该独显路径，并填写以下内容。

对于Nvidia显卡采用以下内容。

| Device | Key        | Value            | Disabled | Value Type |
| ------ | ---------- | ---------------- | -------- | ---------- |
| NVidia | name       | 23646973706C6179 | False    | DATA       |
| NVidia | IOName     | \#display        | False    | STRING     |
| NVidia | class-code | FFFFFFFF         | False    | DATA       |

对于AMD显卡则采用以下内容。

| Device | Key        | Value            | Disabled | Value Type |
| ------ | ---------- | ---------------- | -------- | ---------- |
| ATI    | name       | 23646973706C6179 | False    | DATA       |
| ATI    | IOName     | \#display        | False    | STRING     |
| ATI    | class-code | FFFFFFFF         | False    | DATA       |
| ATI    | vendor-id  | FFFF0000         | False    | DATA       |
| ATI    | device-id  | FFFF0000         | False    | DATA       |

##### 通过SSDT

查找到独显设备路径后，打开MaciASL并新建文件，复制以下代码并将`_SB.PCI0.PEG0.PEGP`修改为所找到的设备路径，保存为aml文件并放到EFI/CLOVER/ACPI/hotpatch即可。

对于Nvidia显卡采用以下SSDT。

```
DefinitionBlock ("", "SSDT", 2, "hack", "spoof", 0)
{
    Method(_SB.PCI0.PEG0.PEGP._DSM, 4)
    {
        If (!Arg2) { Return (Buffer() { 0x03 } ) }
        Return (Package()
        {
            "name", Buffer() { "#display" },
            "IOName", "#display",
            "class-code", Buffer() { 0xFF, 0xFF, 0xFF, 0xFF },
        })
    }
}
```

对于AMD显卡采用以下SSDT。

```
DefinitionBlock ("", "SSDT", 2, "hack", "spoof", 0)
{
    Method(_SB.PCI0.PEG0.PEGP._DSM, 4)
    {
        If (!Arg2) { Return (Buffer() { 0x03 } ) }
        Return (Package()
        {
            "name", Buffer() { "#display" },
            "IOName", "#display",
            "class-code", Buffer() { 0xFF, 0xFF, 0xFF, 0xFF },
            "vendor-id", Buffer() { 0xFF, 0xFF, 0,  0 },
            "device-id", Buffer() { 0xFF, 0xFF, 0, 0 },
        })
    }
}
```

#### 屏幕亮度调节

打开Maciasl，新建文件并复制以下内容，保存为SSDT-PNLF.aml并放入Clover的ACPI/patched下。重启电脑后进入系统偏好设置-显示器，若出现亮度调节滑块则已成功。

```
DefinitionBlock ("", "SSDT", 2, "hack", "_PNLF", 0x00000000)
{
    External (_SB_.PCI0.IGPU, DeviceObj)
    External (RMCF.BKLT, IntObj)
    External (RMCF.FBTP, IntObj)
    External (RMCF.GRAN, IntObj)
    External (RMCF.LEVW, IntObj)
    External (RMCF.LMAX, IntObj)

    Scope (_SB.PCI0.IGPU)
    {
        OperationRegion (RMP3, PCI_Config, Zero, 0x14)
    }

    Device (_SB.PCI0.IGPU.PNLF)
    {
        Name (_ADR, Zero)
        Name (_HID, EisaId ("APP0002"))
        Name (_CID, "backlight")
        Name (_UID, Zero)
        Name (_STA, 0x0B)
        Field (^RMP3, AnyAcc, NoLock, Preserve)
        {
            Offset (0x02), 
            GDID,   16, 
            Offset (0x10), 
            BAR1,   32
        }

        OperationRegion (RMB1, SystemMemory, (BAR1 & 0xFFFFFFFFFFFFFFF0), 0x000E1184)
        Field (RMB1, AnyAcc, Lock, Preserve)
        {
            Offset (0x48250), 
            LEV2,   32, 
            LEVL,   32, 
            Offset (0x70040), 
            P0BL,   32, 
            Offset (0xC2000), 
            GRAN,   32, 
            Offset (0xC8250), 
            LEVW,   32, 
            LEVX,   32, 
            Offset (0xE1180), 
            PCHL,   32
        }

        Method (_INI, 0, NotSerialized)
        {
            Local4 = One
            If (CondRefOf (\RMCF.BKLT))
            {
                Local4 = \RMCF.BKLT
            }

            If ((Zero == (One & Local4)))
            {
                Return (Zero)
            }

            Local0 = ^GDID
            Local2 = Ones
            If (CondRefOf (\RMCF.LMAX))
            {
                Local2 = \RMCF.LMAX
            }

            Local3 = Zero
            If (CondRefOf (\RMCF.FBTP))
            {
                Local3 = \RMCF.FBTP
            }

            If ((Zero == Local3))
            {
                If ((Ones != Match (Package (0x10)
                                {
                                    0x010B, 
                                    0x0102, 
                                    0x0106, 
                                    0x1106, 
                                    0x1601, 
                                    0x0116, 
                                    0x0126, 
                                    0x0112, 
                                    0x0122, 
                                    0x0152, 
                                    0x0156, 
                                    0x0162, 
                                    0x0166, 
                                    0x016A, 
                                    0x46, 
                                    0x42
                                }, MEQ, Local0, MTR, Zero, Zero)))
                {
                    Local3 = One
                }
                Else
                {
                    Local3 = 0x02
                }
            }

            If ((One == Local3))
            {
                If ((Ones == Local2))
                {
                    Local2 = 0x0710
                }

                Local1 = (^LEVX >> 0x10)
                If (!Local1)
                {
                    Local1 = Local2
                }

                If ((Local2 != Local1))
                {
                    Local0 = ((^LEVL * Local2) / Local1)
                    Local3 = (Local2 << 0x10)
                    If ((Local2 > Local1))
                    {
                        ^LEVX = Local3
                        ^LEVL = Local0
                    }
                    Else
                    {
                        ^LEVL = Local0
                        ^LEVX = Local3
                    }
                }
            }
            ElseIf ((0x02 == Local3))
            {
                If ((Ones == Local2))
                {
                    If ((Ones != Match (Package (0x16)
                                    {
                                        0x0D26, 
                                        0x0A26, 
                                        0x0D22, 
                                        0x0412, 
                                        0x0416, 
                                        0x0A16, 
                                        0x0A1E, 
                                        0x0A1E, 
                                        0x0A2E, 
                                        0x041E, 
                                        0x041A, 
                                        0x0BD1, 
                                        0x0BD2, 
                                        0x0BD3, 
                                        0x1606, 
                                        0x160E, 
                                        0x1616, 
                                        0x161E, 
                                        0x1626, 
                                        0x1622, 
                                        0x1612, 
                                        0x162B
                                    }, MEQ, Local0, MTR, Zero, Zero)))
                    {
                        Local2 = 0x0AD9
                    }
                    ElseIf ((Ones != Match (Package (0x04)
                                    {
                                        0x3E9B, 
                                        0x3EA5, 
                                        0x3E92, 
                                        0x3E91
                                    }, MEQ, Local0, MTR, Zero, Zero)))
                    {
                        Local2 = 0xFFFF
                    }
                    Else
                    {
                        Local2 = 0x056C
                    }
                }

                If ((Zero == (0x02 & Local4)))
                {
                    Local5 = 0xC0000000
                    If (CondRefOf (\RMCF.LEVW))
                    {
                        If ((Ones != \RMCF.LEVW))
                        {
                            Local5 = \RMCF.LEVW
                        }
                    }

                    ^LEVW = Local5
                }

                If ((0x04 & Local4))
                {
                    If (CondRefOf (\RMCF.GRAN))
                    {
                        ^GRAN = \RMCF.GRAN
                    }
                    Else
                    {
                        ^GRAN = Zero
                    }
                }

                Local1 = (^LEVX >> 0x10)
                If (!Local1)
                {
                    Local1 = Local2
                }

                If ((Local2 != Local1))
                {
                    Local0 = ((((^LEVX & 0xFFFF) * Local2) / Local1) | 
                        (Local2 << 0x10))
                    ^LEVX = Local0
                }
            }

            If ((Local2 == 0x0710))
            {
                _UID = 0x0E
            }
            ElseIf ((Local2 == 0x0AD9))
            {
                _UID = 0x0F
            }
            ElseIf ((Local2 == 0x056C))
            {
                _UID = 0x10
            }
            ElseIf ((Local2 == 0x07A1))
            {
                _UID = 0x11
            }
            ElseIf ((Local2 == 0x1499))
            {
                _UID = 0x12
            }
            ElseIf ((Local2 == 0xFFFF))
            {
                _UID = 0x13
            }
            Else
            {
                _UID = 0x63
            }
        }
    }
}
```

#### 效果检验

重启后显卡正常情况下已经驱动，Dock栏变为半透明。

点击左上角苹果按钮，选择关于本机，若图形卡一栏显示2048MB而不是7MB，则核显驱动成功。在系统报告-图形卡中若不能看到所屏蔽的独显，则独显屏蔽成功。点击核显，若有`Metal:    支持，功能集macOS GPUFamily2 v1`字样，则metal支持打开成功。

显卡驱动后需检验显卡硬件加速（QE/CI）是否已经打开。如果能够运行象棋游戏、屏幕保护程序正常工作、Grapher能看到三维图像、截屏功能正常，则硬件加速已打开。

也可使用VDADecoderCheck或VideoProc检测。对于VideoProc，打开应用后进入`设置`，点击`硬件加速引擎`旁边的`选项`，查看检测结果即可。VideoProc下载链接如下。

```
https://www.videoproc.com/
```

#### 显示修复

##### 平滑字体

###### 开启

```
defaults write -g CGFontRenderingFontSmoothingDisabled -bool NO
```

###### 设置字体样式

3为最粗，1为最细。

```
defaults -currentHost write -globalDomain AppleFontSmoothing -int 3
// defaults -currentHost write -globalDomain AppleFontSmoothing -int 2
// defaults -currentHost write -globalDomain AppleFontSmoothing -int 1
```

###### 关闭

```
defaults write -g CGFontRenderingFontSmoothingDisabled -bool YES
```

##### Hidpi

HiDPI即High Dots Per Inch，用四个硬件像素渲染一个图像像素。开启Hidpi可使显示更清晰。

###### 通过脚本

在终端下输入以下命令打开一键HiDPI脚本，安装以获得原生屏幕缩放体验。

```
sh -c "$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi.sh)"
```

###### 通过RDM

打开DarwinDumper，只勾选EDID，点击左侧的Run，会在桌面生成EDID文件夹。下载链接如下。

```
https://mac.softpedia.com/get/Utilities/DarwinDumper.shtml
```

下载FixEDID，链接如下。

```
https://github.com/andyvand/FixEDID
```

打开并点击Open EDID binary file，选择桌面文件夹的EDID/EDID.bin。选择对应显示比例的显示器，此处为Apple MacBook Pro Display（16:10）。

在右侧输入想设置的分辨率，点击Add Resolutions添加分辨率，点击Make在桌面生成文件。参考分辨率如下。

```
3840×2160
3200×1800
2880×1620
2560×1600
2560×1440
1920×1080
1820×1200
1680×1050
1600×900
1440×810
1440×900
1440×810
1344×1008
1344×756
1280×960
1280×800
1280×720
1024×768
1024×576
960×600
960×540
840×525
840×524
800×600
800×450
720×450
640×480
```

将桌面的DisplayVendorID-xxx放到System/Library/Displays/Contents/Resources/Overrides。安装`RDM`并重启电脑，即可在RDM看到需要的分辨率，链接如下。

```
http://avi.alkalay.net/software/RDM/RDM-2.2.dmg
```

###### 通过手动设置

打开终端并输入以下命令。

```
sudo defaults write /Library/Preferences/com.apple.windowserver.plist DisplayResolutionEnabled -bool true
ioreg -lw0 | grep IODisplayPrefsKey
```

输出类似如下信息，其中所有外部监视器由AppleDisplay标识，内部监视器由AppleBacklightDisplay标识。在行末可识别出DisplayVendorID和DisplayProductID，此处为`10ac`和`d06e`。

```
"IODisplayPrefsKey" = "IOService:/AppleACPIPlatformExpert/PCI0@0/AppleACPIPCI/IGPU@2/AppleIntelFramebuffer@2/display0/AppleDisplay-10ac-d06e"
```

打开以下网页并输入刚才得到的DisplayVendorID和DisplayProductID，DisplayProductName可以随意。注意一个分辨率需填写两个Scale Resolutions，其中第一个是原分辨率，另一个是长宽均为两倍后的分辨率，如添加1920×1080，则需填入3840×2160和1920×1080。注意相近的分辨率将会被系统过滤。

```
https://comsysto.github.io/Display-Override-PropertyList-File-Parser-and-Generator-with-HiDPI-Support-For-Scaled-Resolutions/
```

调整完成后下载plist文件，去掉扩展名并放在DisplayVendorID-10ac文件夹，其中10ac更改为自己的VendorID。将文件夹复制到System/Library/Displays/Contents/Resources/Overrides并重启即可。

##### 注入EDID

注入EDID可修复笔记本显示器内屏黑屏或花屏的问题。若前面选择采用Hidpi一键脚本，则无需进行此步。

###### 通过patch-edid.rb

打开终端并输入以下命令以下载脚本。

```
curl -O https://gist.github.com/ejdyksen/8302862/raw/patch-edid.rb
```

打开脚本文件并查找`AppleDisplay`，其代表外接显示器，若为内接显示器则需修改为`AppleBacklightDisplay`。然后继续在终端输入以下命令以运行并生成配置文件。

```
sudo ruby patch-edid.rb
```

将生成的配置文件复制到System/Library/Displays/Contents/Resources/Overrides/DisplayVendorID-xxx（对于El Capitan及以前版本为/System/Library/Displays/Overrides/DisplayVendorID-xxx），若已存在配置文件，则将两个文件的内容合并，重启即可。

###### 通过Clover

在终端分别输入以下命令并记录其输出。其中第一个输出为EDID信息，另外两个分别为屏幕设备的VendorID和ProductID。

```
ioreg -lw0 | grep -i "IODisplayEDID" | sed -e 's/.*<//' -e 's/>//'
ioreg -l | grep "DisplayVendorID"
ioreg -l | grep "DisplayProductID"
```

打开Clover的config.plist，切换到Graphics，将三者分别粘贴到对应的位置，注意VendorID和ProductID需要转换为十六进制。勾选`Inject EDID`，保存并重启即可。

###### 通过Hackintool

打开Hackintool，进入显示器，选择要编辑的显示器，可添加或修复监视器范围，以及修改分辨率。

点击导出，将DisplayVendorID-x和Icons.plist复制到/System/Library/Displays/Contents/Resources/Overrides（对于El Capitan及以前版本为/System/Library/Displays/Overrides）即可。

也可将DisplayEDID-x-x.kext复制到Clover的kexts文件夹。

### 有线网卡

#### 对于有有线网卡

几乎所有的有线网卡都受支持。

对于Realtek RTL8111有线网卡，网络上寻找对应驱动的kext，并放入Clover的kexts/Others即可驱动。

驱动后进入系统偏好设置-网络，可看到有线网卡。或点击左上角苹果按钮，选择关于本机-系统报告…，在`以太网卡`中可以看到有线网卡。

其它类型网卡可参照以下链接。

```
https://dortania.github.io/Anti-Hackintosh-Buyers-Guide/Motherboard.html#ethernet
https://dortania.github.io/Anti-Hackintosh-Buyers-Guide/Networking.html
```

#### 对于无有线网卡

因为Mac App Store、iCloud、FaceTime和iMessage的正常工作要求在en0处具有内置以太网，因此，若无有线网卡，需将NullEthernet.kext放到Clover的kexts以模拟出一个有线网卡设备。

#### 网络端口重置

若以太网端口不在en0，则需进入网络偏好设置，删除所有接口并应用。

然后删除`/Library/Preferences/SystemConfiguration/NetworkInterfaces.plist`，重新启动后进入网络偏好设置，重新添加网络端口。

#### 有线网卡内建

在Clover的Devices选项卡中选择Properties，添加一个新设备，路径为通过Hackintool找到的有线网卡设备，并添加条目built-in，数值为01，类型为DATA，重启即可。

如果用的是NullEthernet.kext，则打开Maciasl，复制以下内容并保存为SSDT-RMNE.aml，然后放入Clover的ACPI/patched中即可。

```
DefinitionBlock ("", "SSDT", 2, "RehabM", "RMNE", 0x00001000)
{
    Device (RMNE)
    {
        Name (_ADR, Zero)
        Name (_HID, "NULE0000")
        Name (MAC, Buffer (0x06)
        {
             0x11, 0x22, 0x33, 0x44, 0x55, 0x66
        })
        Method (_DSM, 4, NotSerialized)
        {
            If ((Arg2 == Zero))
            {
                Return (Buffer (One)
                {
                     0x03
                })
            }

            Return (Package (0x0A)
            {
                "built-in", 
                Buffer (One)
                {
                     0x00
                }, 

                "IOName", 
                "ethernet", 
                "name", 
                Buffer (0x09)
                {
                    "ethernet"
                }, 

                "model", 
                Buffer (0x15)
                {
                    "RM-NullEthernet-1001"
                }, 

                "device_type", 
                Buffer (0x09)
                {
                    "ethernet"
                }
            })
        }
    }
}
```

### 无线网卡

#### Atheros

本机无线网卡为Atheros AR9565，可用驱动由corecapture.kext、CoreCaptureResponder.kext和IO80211Family.kext组成。

对于macOS 10.14，把它们放入Clover的kexts中，重启电脑后无线网卡可用。

<details>
<summary>【进阶】更高版本系统</summary>

上述kexts在Catalina中需要放到SLE才能正常工作，在Big Sur中已不适用。
</details>

对于AR946X(AR9462&AR9463)、AR9485、AR9565，也可尝试ATH9KFixup。

```
https://github.com/chunnann/ATH9KFixup
```

对于AR242x、AR542x、AR5416、AR5418、AR9280 - AR5BHB92、AR9285 - AR5B95、AR9287 -AR5B97、AR9380 - AR5BXB112，可尝试High Sierra的IO80211Family。

```
https://github.com/khronokernel/IO80211-Patches/blob/main/10.13.6-High-Sierra-Kexts/IO80211HighSierra.kext.zip
```

#### Intel

可尝试Itlwm。注意应当优先使用itlwm.kext，不可同时使用itlwm.kext和AirportItlwm.kext。

```
https://github.com/OpenIntelWireless/itlwm
```

安装指南如下。

```
https://openintelwireless.github.io/itlwm/Installation.html
```

#### Broadcom

可尝试AirportBrcmFixup，适用于10.10及更高版本，链接如下。

```
https://github.com/acidanthera/AirportBrcmFixup
```

也可尝试BrcmPatchRAM。

```
https://github.com/acidanthera/BrcmPatchRAM
```

<details>
<summary>【进阶】OC引导</summary>

对于OpenCore，kext注入顺序为Injector-Data-RAM。
</details>

对于DW1820A/BCM94350ZAE/BCM94356ZEPA50DX，教程如下。

```
https://blog.daliansky.net/DW1820A_BCM94350ZAE-driver-inserts-the-correct-posture.html
```

对于BCM94352z/DW1560，教程如下。

```
https://blog.daliansky.net/Broadcom-BCM94352z-DW1560-drive-new-posture.html
```

#### 替代方法

对于无解的网卡，可以更换网卡、购买黑苹果USB网卡或者将手机作为热点。USB网卡可尝试以下驱动。

```
https://github.com/chris1111/WirelessAdapterCloverBigSur
https://github.com/chris1111/Wireless-USB-OC-Big-Sur-Adapter
```

对于iPhone用户，将手机接入电脑，手机开启个人热点功能，即可使用手机热点。对于Android用户，可安装`hoRNDIS`，然后将手机连接到电脑，开启安卓手机的USB网络共享即可。下载链接如下。

```
https://github.com/jwise/HoRNDIS
```

### 声卡

#### 通过AppleALC

注意，该kext不能与VoodooHDA、RealtekALC、CloverALC、HDA Blocker、HDAEnabler1/2/3共用。

##### 寻找Layout ID

保证系统SLE下有AppleHDA.kext，在Clover的kexts文件夹中放入AppleALC.kext。打开Hackintool，切换到Audio，通过下拉列表可查看该硬件支持的Layout ID。也可通过以下链接查看。

```
https://github.com/acidanthera/AppleALC/wiki/Supported-codecs
```

在启动参数中添加以下参数，其中#为所查询到的Layout ID之一。

```
alcid=#
```

若为Windows/Linux与macOS双引导，则打开Clover的config.plist，在Devices选项卡勾选Audio项下的ResetHDA选项。

重启后检查声卡是否被驱动，可在终端运行以下命令。若三者都存在，则驱动成功。

```
kextstat | grep -E "AppleHDA|AppleALC|Lilu"
```

若无声，则可更换不同的Layout ID。本机使用的Layout ID为12。打开IORegistryExplorer并搜索HDEF，若存在该设备，其下有AppleHDAController，右侧属性中的alc-layout-id不是修补前默认的07000000，且包含AppleHDAInput设备，则AppleALC已成功修补。

如果睡眠后机器无法无声，则还需要在Clover的kexts中放入CodecCommander.kext。注意，尽管Hackintool提示该kexts已被合并到AppleALC中，但不放置时仍会出现问题。

##### 写入Layout ID

确保该Layout ID可用后，可将该配置写入Clover的配置文件中。打开Hackintool，切换到Audio，通过下拉列表选择Layout ID。切换到Intel-Patch，选择Devices/Properties，勾选Auto Detect Changes、Audio，点击Generate Patch生成声卡驱动补丁。完成后保存以替换。

也可手动生成设备信息。打开Clover的config.plist，在Devices选项卡下选择Properties。

先在左侧栏添加声卡的设备路径。可在Hackintool中查找，也可通过gfxutil，命令如下。

```
gfxutil -f HDEF
gfxutil -f HDAS
gfxutil -f HDAU
```


然后右侧栏添加以下条目即可。

| Properties Key | Properties Value | Value Type |
| -------------- | ---------------- | ---------- |
| alc-layout-id  | 21               | NUMBER     |
| hda-gfx        | onboard-1        | STRING     |
| AAPL,slot-name | Internal         | STRING     |

##### 实现顺序

对于AppleALC，指定Layout ID的优先级顺序为启动参数`alcid=#`->配置文件Device Properties中的alc-layout-id属性（仅适用Apple硬件）->配置文件Device Properties中的layout-id属性（适用Apple/非Apple硬件）。

##### 常见问题

<details>
<summary>【进阶】对于OC</summary>

###### 同一布局在Clover起作用而OpenCore不起作用

一般是由于IRQ冲突，可尝试使用SSDTTime中的SSDT-HPET热补丁，链接如下。

```
https://github.com/corpnewt/SSDTTime
```

###### 10.15中由于电源状态更改导致的kernel panic

在OpenCore的配置文件中设置Kernel-Quirks-PowerTimeoutKernelPanic为True。
</details>

#### 通过VoodooHDA

在AMD上运行AppleALC可能会不起作用，则可使用VoodooHDA。下载kext并放到Clover中即可，链接如下。

```
https://sourceforge.net/projects/voodoohda/
```

### 键盘

#### 驱动

对于一般的PS2键盘，在Clover的kexts放入`VoodooPS2Controller.kext`，重启即可驱动。

#### 键位映射

安装`Karabiner Elements`，链接如下。

```
https://github.com/pqrs-org/Karabiner-Elements
```

打开后选择Complex Modifications，点击Add rule-Import more rules from the Internet，在网页中搜索并安装`PC-Style Shortcuts`、`PC-Style Modifiers`、`Adobe Photoshop`，并在添加的类别上点击Enable All，完成键位映射调整。


### USB

#### 端口限制解除补丁

macOS规定USB端口的数量应少于15个。若端口数量大于15个，可能会导致系统无法启动，需用以下kexts补丁解除。

注意，完成以下端口定制后，应当及时取消该补丁。

##### Sierra

```
Comment: Port limit increase
Name: com.apple.driver.usb.AppleUSBXHCI
Find: 83BD74FF FFFF10
Replace: 83BD74FF FFFF1B
```

##### High Sierra

```
Comment: Port limit increase (RehabMan)
Name: com.apple.driver.usb.AppleUSBXHCI
Find: 837D880F 0F83A704 0000
Replace: 837D880F 90909090 9090
```

##### Mojave

```
Comment: Port limit increase (Ricky)
Name: com.apple.driver.usb.AppleUSBXHCI
Find: 83FB0F0F 838F0400 00
Replace: 83FB0F90 90909090 90
```

##### Catalina

```
Comment: USB port limit patch #1 10.15.x modify by DalianSky(credit ydeng)
Name: com.apple.iokit.IOUSBHostFamily
Find: 83FB0F0F
Replace: 83FB3F0F

Comment: USB Port limit patch #2 10.15.x modify by DalianSky
Name: com.apple.driver.usb.AppleUSBXHCI
Find: 83F90F0F
Replace: 83F93F0F
```

#### 端口定制

在Clover下放置USBInjectAll.kext，且确保cofig.pilst的ACPI更名中已应用EHC1->EH01、EHC2->EH02以及XHCI/XHC1->XHC_补丁。然后通过以下方法之一处理。

##### 通过Hackintool

打开Hackintool，点击USB，确保芯片组已被正确识别。把所有端口删除后刷新，然后分别取USB3与USB2的可移动设备对每一个接口进行插拔，每插拔一次设备将出现一个条目的改变，记录对应端口名称及USB类型，如下表所示。注意，TypeC接口需要正反各插拔一次。

|                设备类型                | 端口类型 |
|----------------------------------------|----------|
| 永久连接设备的USB端口（如蓝牙）        | Internal |
| 与USB3端口相连的HSxx端口（USB2）       | USB3     |
| 内部集线器（通常连接到端口PR11和PR21） | Internal |
| TypeC正反插端口一致                    | TypeC+Sw |
| TypeC正反插端口不一致                  | TypeC    |

完成后导出，将SSDT-EC.aml、SSDT-UIAC.aml和SSDT-USBX.aml放到Clover的ACPI/patched下。或将SSDT-EC.aml和USBPorts.kext分别放置到ACPI/patched和kexts/Other下。若放置的是SSDT，则需保留USBInjectAll.kext，若为SSDT+kext则需删除。

重启后若需检测是否成功，可插入USB3.0设备，通过系统报告查看速率是否为5G/s。或使用IOregistryExplorer，搜索XHC，可查看所有端口是否都已正常工作。

##### 通过USBMap

打开终端并运行以下命令以打开脚本。

```
git clone https://github.com/corpnewt/USBMap
cd USBMap
chmod +x USBMap.command
```

脚本打开后会核查USBInjectAll是否被正确加载、USB控制器是否被正确识别。脚本需要USBInjectAll的版本在0.70以上。若已完成放置但无法识别，则可能还需要XHCI_unsupported.kext。

若端口数量大于15个，则需要应用端口解除补丁或在脚本主菜单上选择`S. Exclude SSxx Ports`或`H. Exclude HSxx Ports`端口以禁用SSxx（一般为USB3.0）或HSxx（一般为USB2.0）端口，完成后重启。若需要取消禁用，则选择`C. Clear Exclusions`。

选择`D. Discover Ports`，脚本将读取默认USB列表。依次将每个端口用USB设备插拔，过程与使用Hackintool相同。每发现新的端口会有提示，直接忽略即可。完成后按`Q`并回车，返回主菜单。

选择`P. Edit Plist & Create SSDT/Kext`，可以看到刚才所识别的结果。需根据实际情况修改端口类型，数字代号与端口类型对应关系如下。设置要求与使用Hackintool一致。

| 数字   | 含义                                                   |
| ------ | ------------------------------------------------------ |
| 0      | （USB2.0）Type A connector                             |
| 1      | Mini-AB connector                                      |
| 2      | ExpressCard                                            |
| 3      | （USB3.0）USB 3 Standard-A connector                   |
| 4      | USB 3 Standard-B connector                             |
| 5      | USB 3 Micro-B connector                                |
| 6      | USB 3 Micro-AB connector                               |
| 7      | USB 3 Power-B connector                                |
| 8      | Type C connector - USB2-only                           |
| 9      | （TypeC+Sw）Type C connector - USB2 and SS with Switch |
| 10     | Type C connector - USB2 and SS without Switch          |
| 11-254 | Reserved                                               |
| 255    | （Internal）Proprietary connector                      |

若需要将编号为5和7的端口改为USB2.0接口，则输入以下命令并回车。

```
// T表示现在要更改端口的类型（Type），0表示端口类型
T:5,7:0
```

也可直接用plist编辑器打开脚本编辑，一般在用户目录/USBMap/Scripts中。

设置完成后可选择`K. Build USBMap.kext`或`S. Build SSDT-UIAC`，其中第一种需把生成的kext复制到Clover的kexts目录下且删除USBInjectAll，而第二种需把生成的SSDT复制到Clover的ACPI/patched下且保留USBInjectAll。推荐第二种。

注意，在按下创建SSDT之前，可以调节SSDT的形式，默认为三个SSDT，可设置为一个SSDT。生成的所有文件都在USBMap/Results中。

#### 修复唤醒断线

在Clover的kexts文件夹放入USBPower.kext。在kext上右键选择显示包内容，打开Contents/Info.plist，展开IOKitPersonalities_x86_64，将iMac19,1改成正在使用的机型，保存并重启即可。


### 蓝牙

#### Atheros

本机蓝牙为与无线网卡Atheros AR9565共建的Bluetooth 4.0。打开以下链接并下载，直接放到Clover的kexts文件夹即可。

```
https://github.com/zxystd/AthBluetoothFirmware
```

<details>
<summary>【进阶】OC引导</summary>

对于OpenCore，放置到Kexts文件夹后需要在config.plist中添加对应条目，注意Ath3kBTInjector必须加载在Ath3kBT后面。
</details>

#### Intel

可尝试IntelBluetoothFirmware。

```
https://github.com/OpenIntelWireless/IntelBluetoothFirmware
```

#### ~~启用蓝牙关闭按钮~~

已过时。

<details>
<summary></summary>

找到SLE下的IOBluetoothFamily.kext，复制到桌面后右键单击显示包内容，进入Contents/PlugIns，在BroadcomBluetoothHostControllerUSBTransport.kext上右键单击显示包内容，打开Contents/info.plist。用搜索功能搜索2652，修改idProduct和idVendor为自己的ID，注意需进行进制转换。从Windows上得到的是十六进制，需转换为十进制，可利用下面的进制转换工具。

```
http://tool.oschina.net/hexconvert/
```

将修改好的IOBluetoothFamily.kext用Kext Utility进行安装，重启即可。注意，此法可以实现蓝牙关闭，但需要从Windows重启进入Mac后才可用。
</details>

#### 冷启动与热启动

冷启动指从关机状态下进入系统，热启动指从一个系统重启至另一个系统。

少数蓝牙设备中嵌入了蓝牙所需的固件，因此它们开机即可直接使用。但是许多设备依靠固件上载器才能正常运行，此过程中，系统启动蓝牙设备的电源，固件上传器检测到该设备已打开电源，然后将固件发送（上传）到缓冲区中。

由于Mac无法加载相关蓝牙固件，即使设备被正确识别，也无法与任何其他外围设备配对。热启动时，Windows/Linux已完成固件上传，重启时缓冲区固件仍存在，因此蓝牙能够起作用。而冷启动时将重置蓝牙设备，导致上载固件的丢失。

#### 蓝牙无法驱动的替代方案

可通过Linux虚拟机完成蓝牙固件上传操作。

从Clover的kexts文件夹删除BrcmPatchRAM.kext和BTFirmwareUploader.kext。以Ubuntu为例，下载镜像后打开Vmware Fusion，新建虚拟机并选择Ubuntu系统，CD/DVD驱动器选择刚才的镜像，完成配置。

关闭虚拟机，切换到虚拟机设置页。选择`USB和蓝牙`首选项，取消选中`与Linux共享蓝牙设备`，列表中将出现一个蓝牙设备。返回主界面并点击`启动磁盘`，选择CD/DVD为启动项，退出设置并启动虚拟机。

镜像引导成功后，选择`试用Ubuntu`。待开机完成后，点击虚拟机的蓝牙选项以将蓝牙设备连接至Ubuntu。等待4-5秒钟后取消蓝牙连接，固件已由虚拟机上传完成，蓝牙将正常运行。关闭虚拟机，VMware将保存计算机状态，只要不让机器进入睡眠或重启状态，就可以使用蓝牙。

如果在睡眠/重新启动后失去了蓝牙功能，重新打开虚拟机，连接再断开蓝牙即可。

也可通过以下TinyCore虚拟机，使用方法同Ubuntu。

```
https://drive.google.com/file/d/1Ydm7Hd0d5XOKQkb02EMpm-6E-WQFiMkh/view
```

### 传感器

在Clover的kexts下放入VirtualSMC包内的`SMCLightSensor.kext`、`SMCProcessor.kext`和`SMCSuperIO.kext`即可。

### 电池

<details>
<summary>【进阶】对于Big Sur</summary>

Big Sur可能已经无须进行以下修补。
</details>

#### 环境配置

在Clover的kexts中放入VirtualSMC包的SMCBatteryManager.kext。打开Maciasl，若出现错误提示，则检查Clover的config.plist，Acpi-Fixs下所有选项都应取消勾选。若仍然不行，则换另一个版本的MaciASL。

#### 修改DSDT

##### 查找字段

打开MaciASL，正常情况下自动打开系统的DSDT。搜索`EmbeddedControl`。可能会有一到多个，注意包含EC字样的那一个，记住其名称，本机为`EC0R`。

搜索`Field ([EC名称]`，本机为`Field (EC0R`。查看Field里所有大于8的元素，全部进行记录后，逐个搜索它们的名字。若查找结果只有一处，表明此变量仅被定义但未被使用，因此可以将此字段从记录结果中删除，否则将此字段保留。记录时需注明每个字段的对应位数（16位/32位/大于32位）。

点击`Patch`，复制下列代码，确认下面Change(s)处的数字不为零后点击`Apply`-`Close`。

```
// 添加B1B2方法，用于16位字段拆分
into method label B1B2 remove_entry;
into definitionblock code_regex . insert
begin
Method (B1B2, 2, NotSerialized)\n
{\n
Return(Or(Arg0, ShiftLeft(Arg1, 8)))\n
}\n
end;

// 添加B1B4方法，用于32位字段拆分
into method label B1B4 remove_entry;
into definitionblock code_regex . insert
begin
Method (B1B4, 4, NotSerialized)\n
{\n
	Store(Arg3, Local0)\n
	Or(Arg2, ShiftLeft(Local0, 8), Local0)\n
	Or(Arg1, ShiftLeft(Local0, 8), Local0)\n
	Or(Arg0, ShiftLeft(Local0, 8), Local0)\n
	Return(Local0)\n
}\n
end;
```

16/32位的字段需要拆分成多个8位的字段，而大于32位的字段需要修改其偏移地址。

##### 对于16/32位的字段

对于16/32位的字段，需要拆分成2/4个8位字段。

以`HWAK, 16`为例。这是个16位的字段，可以拆分成两个8位的字段，分别命名为`AK00`和`AK01`。命名可以随意，但是要确保命名为4个字符，且这个命名没有出现过，如下。

```
// 拆分前
HWAK, 16

// 拆分后
AK00, 8
AK01, 8
```

然后需要写出以下类似正则表达式的代码，以替换DSDT里的字段。

```
into device label EC code_regex HWAK,\s+16, replace_matched begin AK00,8,AK01,8, end;
```

相关含义解释如下，内容均根据自己的DSDT代码替换。

|      内容      |                            含义                            |
|----------------|------------------------------------------------------------|
| EC             | 搜索EmbeddedControl，在其上方的Device（不是Field里的参数） |
| HWAK,\s+16,    | 拆分前的字段（`\s+`表示多个空格，故此句含义为搜索HWAK, 16,） |
| AK00,8,AK01,8, | 拆分后的字段                                               |

把写好的正则表达式复制到Patch里，在中间的Before/After和下面的Patch/Change两个地方都显示内容后，点击Apply-Close即完成一个变量的替换。

再以`SBCH, 32`为例。

```
// 拆分前
SBCH, 32

// 拆分后
CH00, 8
CH01, 8
CH02, 8
CH03, 8
```

正则表达式如下。

```
into device label EC code_regex SBCH,\s+32 replace_matched begin CH00,8,CH01,8,CH02,8,CH03,8 end;
```

注意，所替换的`AK00,8,AK01,8,`逗号前后均无空格。若所替换的字段为列表中的最后一个，则Patch时会提示0 change(s)，此时应该把正则表达式中的`XSN1,\s+16,`改为`XSN1,\s+16`，因最后一个字段没有逗号。

点击Compile，此时会出现报错，除Errors以外的不需要理会。对于报错内容为Object does not exist的情况，主要是替换字段名后，没有替换访问该字段的位置所导致。

双击报错信息以定位至错误位置，向上检索以找到该段代码包含在哪个method里。

对于16位的字段，使用下面的正则表达式。

```
into method label \_WAK code_regex \(HWAK, replaceall_matched begin (B1B2(AK00,AK01), end;
```

相关含义解释如下，内容均根据自己的DSDT代码替换。

|        内容       |                 含义                |
|-------------------|-------------------------------------|
| `\_WAK`             | 代码对应的method                    |
| `\(HWAK,`           | \只是起始符，(HWAK,才是替换前的字段 |
| (B1B2(AK00,AK01), | 替换后的字段                        |

对于32位的字段则使用下列表达式。

```
into method label GBIF code_regex \(SBCH, replaceall_matched begin (B1B4(CH00,CH01,CH02,CH03), end;
```

若出现`\_SB.PCI0.LPC.EC.HWAK`调用的特殊情况，修改替换字段即可。

```
into method label \_WAK code_regex \(\\\_SB.PCI0.LPC.EC.HWAK replaceall_matched begin \(\\_SB.B1B2(\\_SB.PCI0.LPC.EC.AK00, \\_SB.PCI0.LPC.EC.AK01) end;
```

##### 对于超过32位的字段

先Patch下面的两段代码，其中H_EC改成计算机的Device。

```
// 改的字段挨着左括号时所用代码
into method label RE1B parent_label H_EC remove_entry;
into method label RECB parent_label H_EC remove_entry;

into device label H_EC insert
begin
Method (RE1B, 1, NotSerialized)\n
{\n
	OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n
	Field(ERAM, ByteAcc, NoLock, Preserve) { BYTE, 8 }\n
	Return(BYTE)\n
}\n
Method (RECB, 2, Serialized)\n
// Arg0 - offset in bytes from zero-based EC\n
// Arg1 - size of buffer in bits\n
{\n
	ShiftRight(Arg1, 3, Arg1)\n
	Name(TEMP, Buffer(Arg1) { })\n
	Add(Arg0, Arg1, Arg1)\n
	Store(0, Local0)\n
	While (LLess(Arg0, Arg1))\n
	{\n
	Store(RE1B(Arg0), Index(TEMP, Local0))\n
	Increment(Arg0)\n
	Increment(Local0)\n
	}\n
	Return(TEMP)\n
}\n
end;

// 改的字段挨着右括号时所用代码
into method label WE1B parent_label H_EC remove_entry;
into method label WECB parent_label H_EC remove_entry;
into device label H_EC insert
begin
Method (WE1B, 2, NotSerialized)\n
{\n
	OperationRegion(ERAM, EmbeddedControl, Arg0, 1)\n
	Field(ERAM, ByteAcc, NoLock, Preserve) { BYTE, 8 }\n
	Store(Arg1, BYTE)\n
}\n
Method (WECB, 3, Serialized)\n
// Arg0 - offset in bytes from zero-based EC\n
// Arg1 - size of buffer in bits\n
// Arg2 - value to write\n
{\n
	ShiftRight(Add(Arg1,7), 3, Arg1)\n
	Name(TEMP, Buffer(Arg1) { })\n
	Store(Arg2, TEMP)\n
	Add(Arg0, Arg1, Arg1)\n
	Store(0, Local0)\n
	While (LLess(Arg0, Arg1))\n
	{\n
	WE1B(Arg0, DerefOf(Index(TEMP, Local0)))\n
	Increment(Arg0)\n
	Increment(Local0)\n
	}\n
}\n
end;
```

计算大于32位字段的偏移量，逢八进一，从起始值往下算。以下面的代码为例子。

```
Offset (0x04),
	CMCM,   8, // 0x04
	CMD1,   8, // 0x05=0x04+1（8位是1字节）
	CMD2,   8, // 0x06
	CMD3,   8, // 0x07
	Offset (0x18), // 这里空了一些，按开头所给出的偏移量计算
	Offset (0x19),
	SMST,   8, // 0x19
	MBMN,   80, // 0x1A
	MBPN,   96, // 0x25=0x1A（上一个的起始地址）+A（80/8=10，上一个占了10个字节，16进制表示即为A）+1
	GPB1,   8, // 0x32=0x25+C（96位占了12个字节，16进制表示即为C）+1
	GPB2,   8, // 0x33
	GPB3,   8, // 0x34
	GPB4,   8, // 0x35
```

搜索DSDT中该字段被调用的地方。不同于16/32位字段的处理，超过32位的字段只需用偏移量和该字段位数代替字段本身。

若所替换字段挨着左括号，以`Store(MBMN, XXXX) `改为`Store(RECB(0x1A, 80), XXXX)`为例，利用下列正则表达式进行替换，Patch即可。

```
into method label XXXX code_regex \(SBMN, replaceall_matched begin (RECB(0xA0,128), end;
```

相关含义解释如下，内容均根据自己的DSDT代码替换。

|        内容       |                 含义                |
|-------------------|-------------------------------------|
| XXXX            | 代码对应的method                    |
| `\(SBMN,`           | 替换前的字段 |
| (RECB(0xA0,128), | 替换后的字段，其中0xA0为所计算出来的偏移量，128为位数                        |

若所替换字段挨着右括号，以`Store (Arg3, \_SB.PCI0.LPCB.EC0.SMD0)`改为`Store (Arg3, \_SB.PCI0.LPCB.EC0.WECB(0x1C,264,Arg3)`为例，则利用下列正则表达式进行替换。

```
into method label SMRW code_regex Store\s\(Arg3,\s\\_SB.PCI0.LPCB.EC0.SMD0\) replaceall_matched begin \\_SB.PCI0.LPCB.EC0.WECB(0x1C,264,Arg3) end;
```

##### 应用修改

再次点击Compile，确认无Error后，点击菜单File-Save As，类型选ACPI Machine Language Binary，名称为DSDT.aml。保存后复制到CLOVER/ACPI/patched，重启即可。

#### 说明

##### 正则表达式写法

16位和32位的区别在于，16位会调用B1B2方法，而32位会调用B1B4方法。因此正则表达式的基本格式如下。

```
// 16位字段
into method label [代码对应method] code_regex [替换前的字段，需要包含逗号] replaceall_matched begin (B1B2[替换后的字段，需要包含逗号] end;

// 32位字段
into method label [代码对应method] code_regex [替换前的字段，需要包含逗号] replaceall_matched begin (B1B4[替换后的字段，需要包含逗号] end;

// 特殊字段的处理（把整个地址复制进去即可）
B1B2(特殊字段1，特殊字段2)
B1B4(特殊字段1，特殊字段2，特殊字段3，特殊字段4)
```

##### 补丁结构

将前面所有Patch过的代码放到一起，即称为本机的电量补丁，示例如下。

注意，前面所有通过正则表达式的操作，其实可以直接在原文件上修改，而不必通过Patch的方式。通过Patch方式主要是便于补丁整合与传播。

```
// 字段拆分
into device label EC0 code_regex B0C3,\s+16, replace_matched begin C3HG,8,C3HF,8, end;
into device label EC0 code_regex B0SN,\s+16, replace_matched begin BSVN,8,BSVM,8, end;
into device label EC0 code_regex B1SN,\s+16 replace_matched begin SBUY,8,SBUP,8 end;

// 替换调用方法
into method label _BIX code_regex \(B0C3, replaceall_matched begin (B1B2(C3HG,C3HF), end;
into method label BIFA code_regex \(B0SN, replaceall_matched begin (B1B2(BSVN,BSVM), end;
into method label BIFA code_regex \(B1SN, replaceall_matched begin (B1B2(SBUY,SBUP), end;

// 数据处理方法
into method label B1B2 remove_entry;
into definitionblock code_regex . insert
begin
Method (B1B2, 2, NotSerialized)\n
{\n
Return(Or(Arg0, ShiftLeft(Arg1, 8)))\n
}\n
end;
```

##### Fix Mutex with non-zero SyncLevel补丁

如果打过电量补丁后电池状态显示为0%，则需要打Fix Mutex with non-zero SyncLevel补丁。可一次性打好自己电脑的电量补丁和Fix Mutex with non-zero SyncLevel补丁。

打开MaciASL，点击Patch，在左侧资源树中选择`_RehabMan Laptop`-`[sys]Fix Mutex with non-zero SyncLevel`，点击Apply-Close即可。

### 触控板

以下的所有操作对软件版本均有要求。MaciASL需为RehabMan编译版，IORegistryExplorer需为2.1版本。

#### 判断触控板类型

在Windows下打开设备管理器，若在人体学输入设备下存在I2C HID设备，则一般为I2C HID触摸板。查看触摸板设备的属性，若显示位置是`在 I2C HID设备 上`，则得证。否则触控板一般为PS2类型。

#### PS2触控板

用VoodooPS2Controller.kext驱动即可。

#### I2C触控板

##### 记录IRQ

在Windows下打开设备管理器，在`I2C HID设备`上右键选择属性，点击详细信息，选择`位置路径`并记录。然后切换到资源选项卡，记录IRQ后面的数字，该数字代表的是APIC Pin。本机示例如下。

```
// IRQ
0x0000006D (109)

// 位置路径，其中ETPD为触控板BIOS名称
ACPI(_SB_)#ACPI(PCI0)#ACPI(I2C1)#ACPI(ETPD)
```

也可在Mac下查看APIC Pin。打开IORegistryExplorer，右上角搜索触控板BIOS名称，本机即为ETPD，在详细页中记录IOInterruptSpecifiers的值即可。

##### 确定工作原理

I2C触控板均用VoodooI2C驱动，支持轮询模式或中断模式。

轮询模式是Voodoo的安全模式，每隔一个特定的时间扫描一次触摸板的状态，然后改变鼠标指针坐标。中断模式是触摸板在Windows/Linux等其他系统的正常工作方式。

在DSDT中定义如下。

|   定义   |                                        含义                                        |                适用范围               | 效率 |          驱动难度          |
|----------|------------------------------------------------------------------------------------|---------------------------------------|------|----------------------------|
| APIC中断 | 使用APIC控制器                                                                     | 无IOInterruptSpecifier，或APIC Pin<2F | 最高 | 能否以该模式驱动由硬件决定 |
| GPIO中断 | DSDT在SBFG中存在有效GPIO Pin，CRS方法中返回(SBFB,SBFG)，并应用启用GPIO控制器的补丁 | 有IOInterruptSpecifier且APIC Pin>2F   | 较高 | 较难                       |
| 轮询     | CRS方法中只返回SBFB或者(SBFB,SBFI)                                                 | /                                     | 较低 | 较易                       |


也就是说，对于原始DSDT，以APIC Pin为判断依据，若小于2F则默认使用APIC中断，若大于2F则默认使用GPIO控制器。但由于GPIO控制器默认不工作，因此系统会采用轮询模式，如下图所示。

![](https://tva1.sinaimg.cn/large/006tNbRwly1g9j9syjzgdj30jg0m8jst.jpg)

<details>
<summary>【进阶】DSDT中的相关代码</summary>

找到触摸板的相关代码后，查看SBFI方法，该方法用于实现APIC中断。该方法中的数值即为APIC Pin，当APIC Pin大于2F时，可判断为轮询模式。

```
Name (SBFI, ResourceTemplate ()
{
    Interrupt (ResourceConsumer, Level, ActiveLow, ExclusiveAndWake, ,, _Y25)
    {
        0x00000000,
    }
})
```

查看SBFB方法，该方法可被轮询或中断调用。部分DSDT中不含SBFB而含I2CM，两者基本一致，I2CM相比SBFB具有更多的内容。

```
Name (SBFB, ResourceTemplate ()
{
    I2cSerialBusV2 (0x004C, ControllerInitiated, 0x00061A80,
        AddressingMode7Bit, "\\_SB.PCI0.I2C1",
        0x00, ResourceConsumer, _Y2A, Exclusive,
        )
})
```

查看SBFG方法，该方法中的数值即为GpioInt，用于中断处理。

```
Name (SBFG, ResourceTemplate ()
{
    GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,
        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
        )
        {   // Pin list
            0x0000
        }
})
```
</details>

##### 轮询模式驱动

###### 放置驱动

下载VoodooI2C，按照以下规则将驱动放入Clover的kexts中（一个核心驱动+一个目标驱动）并重启。

```
// 必放核心驱动
VoodooI2C.kext

// 根据情况选择目标驱动
VoodooI2CELAN.kext - ELAN触摸板
VoodooI2CHID.kext - I2C触摸板
VoodooI2CFTE.kext - FTE触摸板
VoodooI2CSynaptics.kext - Synaptics触摸板
VoodooI2CAtmelMXT.kext - MXT触摸屏
VoodooI2CUPDDEngine.kext - UPDD多点触控引擎
```

对于小部分机型（如华硕笔记本），触控板已被驱动。若未被驱动，则需要对DSDT应用`Windows补丁`，根据出厂时随附的操作系统应用对应的补丁，一般用Windows 10 Patch。

应用补丁可采取热补丁法或DSDT修改法。

###### 热补丁法应用补丁

将`SSDT-XOSI.aml`放置在Clover文件夹的ACPI/patched目录下，然后在config.plist下添加以下改名补丁即可。

```
Comment: change _OSI to XOSI
Find: 5F4F5349
Replace: 584F5349
```

###### DSDT修改法应用补丁

打开MaciASL，保证有VoodooI2C的补丁源。点击Patch，选择VoodooI2C下的`Windows 10 Patch`补丁，Apply-Close后保存DSDT，并将新的DSDT放入Clover文件夹的ACPI/patched下即可。

若MaciASL无法加载出补丁源，可直接在Patch界面复制以下代码内容。根据操作系统自行选择。

```
// Windows 10 DSDT Patch for VoodooI2C
into_all method code_regex If\s+\([\\]?_OSI\s+\(\"Windows\s2015\"\)\) replace_matched begin If(LOr(_OSI("Darwin"),_OSI("Windows 2015"))) end;

// Windows 8.1 DSDT Patch for VoodooI2C
into_all method code_regex If\s+\([\\]?_OSI\s+\(\"Windows\s2013\"\)\) replace_matched begin If(LOr(_OSI("Darwin"),_OSI("Windows 2013"))) end;

// Windows 8 DSDT Patch for VoodooI2C
into_all method code_regex If\s+\([\\]?_OSI\s+\(\"Windows\s2012\"\)\) replace_matched begin If(LOr(_OSI("Darwin"),_OSI("Windows 2012"))) end;

// Windows 7 DSDT Patch for VoodooI2C
into_all method code_regex If\s+\([\\]?_OSI\s+\(\"Windows\s2009\"\)\) replace_matched begin If(LOr(_OSI("Darwin"),_OSI("Windows 2009"))) end;
```

保证对DSDT不进行其他修改后，触控板在重启后应当已被驱动。

##### 中断模式驱动

###### 查看APIC Pin值

不放置VoodooI2C驱动，并应用Windows补丁。打开IORegistryExplorer，搜索前面保存的BIOS设备名称，然后定位到`IOInterruptSpecifiers`，最前面的两位数即为`APIC Pin`值。

若无IOInterruptSpecifiers项或APIC Pin值不大于`2F`，则直接跳到安装步骤，否则继续下列步骤。

###### 移除APIC中断控制器

用MaciASL打开设备的DSDT，搜索`BIOS设备名称`（此处为ETPD），定位到触控板设备的代码块下。注意，以下操作全部在触控板设备的代码块下进行，请勿跳到其他设备下的代码操作。

在触控板设备的代码块下寻找类似以下的代码。

```
Method (_CRS, 0, Serialized)  // _CRS: Current Resource Settings
{
    Name (SBFI, ResourceTemplate ()
    {
        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,
            AddressingMode7Bit, "\\_SB.PCI0.I2C1",
            0x00, ResourceConsumer, , Exclusive,
            )
        Interrupt (ResourceConsumer, Level, ActiveLow, Exclusive, ,, )
        {
            0x0000006D,
        }
    })
    Return (SBFI)
}
```

在此段代码中，需将`SBFI`改为`SBFB`，并删除以下内容。

```
Interrupt (ResourceConsumer, Level, ActiveLow, Exclusive, ,, )
{
    0x0000006D,
}
```

以上面代码为例，修改后变为如下。

```
Method (_CRS, 0, Serialized)  // _CRS: Current Resource Settings
{
    Name (SBFB, ResourceTemplate ()
    {
        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,
            AddressingMode7Bit, "\\_SB.PCI0.I2C1",
            0x00, ResourceConsumer, , Exclusive,
            )
        })
        Return (SBFB)
}
```

###### 确定触控板固定类型

在触控板的DSDT下寻找以下代码块。

```
Name (SBFG, ResourceTemplate ()
{
    GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,
        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
        )
        {   // Pin list
            0x0000
        }
})
```

若此段代码出现在设备的根目录，则称为触控板设备已经`root固定`。若出现在CRS方法中，则称为触控板设备已经`CRS固定`。如果Pin list对应非零值，称为`well-root固定`和`well-CRS固定`。若此段代码未出现，则称为触控板设备`未固定`。

若未固定，则先将以上代码段复制到设备根目录下，示例如下。复制完成后跳到GPIO固定步骤。

```
Scope (_SB.PCI0.I2C0)
{
       Device (ETPD)
       {
           Name (SBFG, ResourceTemplate ()
           {
                GpioInt (Level, ActiveLow, Exclusive, PullUp, 0x0000,
                        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
                        )
                        {   // Pin list
                            0x0000
                        }
           })
           ......
```

若为root固定或CRS固定，需在触控板代码块下查找`_CRS`方法，并确定以下代码是否存在。若存在，则证明设备已固定好，可直接跳到安装步骤，否则需继续GPIO固定步骤。

```
Return (ConcatenateResTemplate (SBFB, SBFG))
```

若为well-root固定或well-CRS固定，则直接跳到安装步骤。

###### GPIO固定



###### 确保DSDT通知系统设备已固定好GPIO

定位到代码块的_CRS方法，删除此方法的Return语句并用以下Return语句替换。

```
Return (ConcatenateResTemplate (SBFB, SBFG))
```

###### 驱动安装

驱动的安装包括驱动放置、禁用系统驱动、应用补丁，其中放置驱动操作与轮询模式完全一致。对于系统驱动，需禁用AppleIntelLpssI2C.kext和AppleIntelLpssI2CController.kext，方法见说明。应用补丁需应用Windows补丁和GPIO补丁。

Windows补丁的应用与轮询模式完全一致，GPIO补丁的应用提供以下两种形式。

###### 热补丁法应用GPIO补丁

在OC-little包中取`SSDT-GPIO.aml`并放置在Clover文件夹的ACPI/patched目录下，然后在config.plist下添加以下改名补丁即可。注意，在补丁无效时，可尝试删除`Tgtbridge`值。

```
Comment: change _STA to XSTA in GPI0 
Find: 5F535441
Replace: 58535441
TgtBridge: 47504930
```

###### DSDT修改法应用GPIO补丁

在MaciASL下点击Patch，选择VoodooI2C下的`GPIO Controller`和`SKL I2C Controller`补丁，Apply-Close后保存DSDT，并将新的DSDT放入Clover文件夹的ACPI/patched下即可。

若MaciASL无法加载出补丁源，可直接在Patch界面复制以下代码内容。

```
// GPI0 Controller
into method label _STA parent_label GPI0 replace_content begin
Return (0x0F)
end;


// Skylake controller patches for VoodooI2C
into_all device label I2C0 remove_entry;
into_all device label I2C1 remove_entry;
into_all device label I2C2 remove_entry;
into_all device label I2C3 remove_entry;
into_all device label I2C4 remove_entry;
into_all device label I2C5 remove_entry;

into scope label _SB.PCI0 insert begin

Device (I2C0)\n
{\n
    Name (LINK, "\\_SB.PCI0.I2C0")\n
    Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current\n
    {\n
        Return (GETD (SB10))\n
    }\n
\n
    Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0\n
    {\n
        LPD0 (SB10)\n
    }\n
\n
    Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3\n
    {\n
        LPD3 (SB10)\n
    }\n
}\n
\n\n
Device (I2C1)\n
{\n
    Name (LINK, "\\_SB.PCI0.I2C1")\n
    Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current\n
    {\n
        Return (GETD (SB11))\n
    }\n
\n
    Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0\n
    {\n
        LPD0 (SB11)\n
    }\n
\n
    Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3\n
    {\n
        LPD3 (SB11)\n
    }\n
}\n
\n\n
Device (I2C2)\n
{\n
    Name (LINK, "\\_SB.PCI0.I2C2")\n
    Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current\n
    {\n
        Return (GETD (SB12))\n
    }\n
\n
    Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0\n
    {\n
        LPD0 (SB12)\n
    }\n
\n
    Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3\n
    {\n
        LPD3 (SB12)\n
    }\n
}\n
\n\n
Device (I2C3)\n
{\n
    Name (LINK, "\\_SB.PCI0.I2C3")\n
    Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current\n
    {\n
        Return (GETD (SB13))\n
    }\n
\n
    Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0\n
    {\n
        LPD0 (SB13)\n
    }\n
\n
    Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3\n
    {\n
        LPD3 (SB13)\n
    }\n
}\n
\n
Device (I2C4)\n
{\n
    Name (LINK, "\\_SB.PCI0.I2C4")\n
    Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current\n
    {\n
        Return (GETD (SB14))\n
    }\n
\n
    Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0\n
    {\n
        LPD0 (SB14)\n
    }\n
\n
    Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3\n
    {\n
        LPD3 (SB14)\n
    }\n
}\n
\n
Device (I2C5)\n
{\n
    Name (LINK, "\\_SB.PCI0.I2C5")\n
    Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current\n
    {\n
        Return (GETD (SB15))\n
    }\n
\n
    Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0\n
    {\n
        LPD0 (SB15)\n
    }\n
\n
    Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3\n
    {\n
        LPD3 (SB15)\n
    }\n
}\n
\n
end;

into scope label _SB.PCI0.I2C0 replace_content begin

    Name (_HID, "INT3442")  // _HID: Hardware ID\n
    Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision\n
    {\n
        Return (LHRV (SB10))\n
    }\n
\n
    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n
    {\n
        Return (LCRS (SMD0, SB00, SIR0))\n
    }\n
\n
    Method (_STA, 0, NotSerialized)  // _STA: Status\n
    {\n
        Return (LSTA (SMD0))\n
    }\n
}\n
end;

into scope label _SB.PCI0.I2C1 replace_content begin

    Name (_HID, "INT3443")  // _HID: Hardware ID\n
    Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision\n
    {\n
        Return (LHRV (SB11))\n
    }\n
\n
    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n
    {\n
        Return (LCRS (SMD1, SB01, SIR1))\n
    }\n
\n
    Method (_STA, 0, NotSerialized)  // _STA: Status\n
    {\n
        Return (LSTA (SMD1))\n
    }\n
}\n
end;

into scope label _SB.PCI0.I2C2 replace_content begin

    Name (_HID, "INT3444")  // _HID: Hardware ID\n
    Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision\n
    {\n
        Return (LHRV (SB12))\n
    }\n
\n
    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n
    {\n
        Return (LCRS (SMD2, SB02, SIR2))\n
    }\n
\n
    Method (_STA, 0, NotSerialized)  // _STA: Status\n
    {\n
        Return (LSTA (SMD2))\n
    }\n
}\n
end;
into scope label _SB.PCI0.I2C3 replace_content begin

    Name (_HID, "INT3445")  // _HID: Hardware ID\n
    Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision\n
    {\n
        Return (LHRV (SB13))\n
    }\n
\n
    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n
    {\n
        Return (LCRS (SMD3, SB03, SIR3))\n
    }\n
\n
    Method (_STA, 0, NotSerialized)  // _STA: Status\n
    {\n
        Return (LSTA (SMD3))\n
    }\n
}\n
end;

into scope label _SB.PCI0.I2C4 replace_content begin

    Name (_HID, "INT3446")  // _HID: Hardware ID\n
    Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision\n
    {\n
        Return (LHRV (SB14))\n
    }\n
\n
    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n
    {\n
        Return (LCRS (SMD4, SB04, SIR4))\n
    }\n
\n
    Method (_STA, 0, NotSerialized)  // _STA: Status\n
    {\n
        Return (LSTA (SMD4))\n
    }\n
}\n
end;

into scope label _SB.PCI0.I2C5 replace_content begin

    Name (_HID, "INT3447")  // _HID: Hardware ID\n
    Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision\n
    {\n
        Return (LHRV (SB15))\n
    }\n
\n
    Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings\n
    {\n
        Return (LCRS (SMD5, SB05, SIR5))\n
    }\n
\n
    Method (_STA, 0, NotSerialized)  // _STA: Status\n
    {\n
        Return (LSTA (SMD5))\n
    }\n
}\n
end;
```

###### 确认驱动情况

所有步骤完成后重启。若触控板未驱动或开机卡Busy timeout，则考虑更换不同的Pin list值。

对于本机而言，APIC Pin值为0x6D。

##### 特殊处理

###### 华硕笔记本

华硕笔记本的DSDT会有一个TPD0设备，该设备具有GPIO中断的模板，但并不是真实的设备。应当修补ETPD设备。

###### 三星笔记本

使用轮询模式驱动时，需在应用补丁的同时在DSDT的以下代码中删除`If (_OSI ("Windows 2012")) {`及对应的`}`，如下。

```
If (_OSI ("Windows 2012"))
{
    Scope (_SB.PCI0.I2C0.SPTP)
    {
    }

    Scope (_GPE)
    {
        Method (_L04, 0, NotSerialized)  // _Lxx: Level-Triggered GPE
        {
            Notify (\_SB.PCI0.I2C0.SPTP, 0x02)
            Notify (\_SB.PWRB, 0x02)
        }
    }

    Scope (_SB.PCI0.I2C0.ATFU)
    {
        Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings
        {
            Name (SBFB, ResourceTemplate ()
            {
                I2cSerialBusV2 (0x0026, ControllerInitiated, 0x00061A80,
                    AddressingMode7Bit, "\\_SB.PCI0.I2C0",
                    0x00, ResourceConsumer, , Exclusive,
                    )
                I2cSerialBusV2 (0x0027, ControllerInitiated, 0x00061A80,
                    AddressingMode7Bit, "\\_SB.PCI0.I2C0",
                    0x00, ResourceConsumer, , Exclusive,
                    )
            })
            Return (SBFB)
        }
    }
}
```

若仍未解决，则在DSDT中进入设备SPTP的_INI方法，搜索以下代码并将其内容更改为`SHPO (Local0, One)`，如下。

```
If (LEqual (SDM0, Zero))
{
    SHPO (Local0, One)
}
```

### TouchID

笔记本的指纹传感器一般都无法被驱动。但由于SMBIOS设置的机型具有TouchID，因此在输入密码或进行认证时，系统会等待指纹的反馈，导致键盘输入卡顿。

在Clover的kexts文件夹下放置`NoTouchID.kext`，重启后即可修复。

## SMBIOS设置

正确设置SMBIOS并注入正确的三码，可开启HWP功能，并正常登录iCloud等苹果服务。

打开终端并输入以下命令以查询支持HWP的机型，在输出内容中选择台式机机型或笔记本机型。注意需挑选带HWP字样的机型，且尽可能选最新的机型，2017年及以后机型支持Sidebar功能。若机型为Unknown，可用搜索引擎搜索其代码以确认机型。

```
cd /tmp && curl -s https://raw.githubusercontent.com/Piker-Alpha/freqVectorsEdit.sh/master/freqVectorsEdit.sh > /tmp/freqVectorsEdit.sh && chmod +x freqVectorsEdit.sh && /tmp/freqVectorsEdit.sh && sudo rm -rf /tmp/freqVectorsEdit.sh && sudo rm -rf /tmp/Mac-*.bin
```

正常登录iCloud等苹果服务，需本机的NVRAM正常工作。部分主板需Clover的Drivers64UEFI文件夹中有`EmuVariableUefi-64.efi`才可使NVRAM正常工作。

打开Clover的config.plist，选择左侧SMBIOS，使用右侧上下箭头选择上面所确定的机型。也可通过GenSMBIOS生成SMBIOS。

```
https://github.com/corpnewt/GenSMBIOS
```

前往以下网站（需要翻墙环境），复制Clover中的Serial Number到文本框进行查询。若出现具体机型，则说明此序列号可用。若提示无效，则此序列码不可使用，需点击Generate New生成新的Serial Number。

```
https://everymac.com/ultimate-mac-lookup/ 
```

前往以下Apple官网查询序列号。如果显示有购买日期和机型等保修信息，则此序列码不可使用，需返回Clover生成新的Serial Number。直到出现提示`很抱歉，这个序列号无效。请检查您的信息并再试一次`，则可使用。

```
https://checkcoverage.apple.com/cn/zh
```

点击左侧System Parameters，生成一个UUID，系统生成或随机生成都可以，并勾选Inject System ID。复制生成的UUID到SMBIOS的SmUUID里，复制SMBIOS里的Board Serial Numbe到Rt VariablesMLB里。点击获取ROM，确保下方三码正常匹配，退出并重启。

重启后打开Hackintool，转到工具选项卡，点击Intel图标，在工具输出中查看enableHWP的值，若为1则已成功开启HWP。同时，iCloud、iMassage、FaceTime应已可正常登录。

若出现问题，可打开iMessageDebug提取Mac的三码，查看MLB和ROM是否正常显示。若为Failed，则应在Clover中加上EmuVariableUefi-64.efi。若正常显示，可把结果保存，重启电脑后再打开iMessageDebug，若两次结果一致，则黑苹果已成功洗白。

## CPU变频

在终端下输入以下命令以执行一键CPU变频脚本。

```
bash -c "$(curl -fsSL https://raw.githubusercontent.com/stevezhengshiqi/one-key-cpufriend/master/one-key-cpufriend_cn.sh)"
```

完成后把桌面的CPUFriend.kext和CPUFriendDataProvider.kext放到Clover的kexts中即可。

## SSD配置

### 开启TRIM

在终端输入以下命令以打开TRIM。

```
sudo trimforce enable
```

若执行后TRIM仍未开启，则需要通过Clover打kext补丁。打开Clover的config.plist，选择Kernel and Kext Pathches-Kext Pathches，添加以下补丁。

```
Name*: IOAHCIBlockStorage
Find*[HEX]: 4150504C452053534400 
Replace*[HEX]: 00000000000000000000 
```

## 休眠相关

### 打开休眠

在终端输入以下命令，可打开Clover为黑苹果修补的休眠功能。

```
sudo pmset -a hibernatemode 29（或21）
```

在Clover的kexts文件夹放置HibernationFixup.kext，并在启动参数中加`-hbfxbeta`，即可实现hibernatemode 3休眠，下载链接如下。

```
https://github.com/acidanthera/HibernationFixup
```

### 禁止休眠

#### 通过终端

在终端输入以下命令以禁止。

```
sudo pmset -a hibernatemode 0
sudo pmset -a autopoweroff 0
sudo pmset -a standby 0
sudo rm /var/vm/sleepimage
sudo mkdir /var/vm/sleepimage
```

如果合盖后遇到偶发性的随机唤醒，通过以下命令禁用proximitywake即可。以Thinkpad为例，合盖后随机唤醒指合盖后A面的红色指示灯开始闪烁，表示设备已经睡眠，但一会以后指示灯进入常亮，而开盖屏幕不会点亮的状态。

```
sudo pmset -a proximitywake 0
```

#### 通过Hackintool

在Hackintool里切换到`电源`选项卡，点击最下方的齿轮按钮即可。

## 系统时间调整

Windows把系统硬件时间当作本地时间，即操作系统中显示的时间跟BIOS中显示的时间一致。而Linux/Mac把硬件时间当作UTC，操作系统中显示的时间是硬件时间经过换算得来的，比如说北京时间是 GMT+8，则系统中显示时间是硬件时间+8。因此两个系统的时间会出现差异。

在Windows以管理员身份打开命令提示符，输入下列命令并重启以修复两个系统时间不一致的问题。

```
Reg add HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d 1
```

若仍不一致，则在Windows下修改时间为自动获取，在Mac下把时区改成北京并开启自动获取，重新启动即可。

## 完成度检查

对于笔记本，可通过以下选项进行完成度检查。

### 变频测试

使用CPU-S进行变频测试，二档可用，八档以上优秀。下载链接如下。

```
http://bbs.pcbeta.com/viewthread-1698338-1-1.html
```

### 显示

分辨率和显存显示正常，支持DP、HDMI外接显示，风扇不持续高速旋转，原生亮度调节正常。

### 声音

通过VoodooHDA能有声音则可用，通过AppleALC能有声音则优秀。

### 网络

以太网需位于en0，无线支持2.4G/5G双频。支持AirDrop和Handoff则优秀。

### USB

USB接口2.0/3.0/3.1均能识别，3.0及以上接口的识别速度应有5G/s。

### 电池

系统偏好设置正常识别电池电量状态。

### 睡眠

合盖睡眠，开盖唤醒后正常点亮不黑屏。

### 输入设备

自带键盘和触摸板都能正常使用。

### 固态硬盘

打开关于本机-系统报告，检查NVMExpress和SATA/SATA Express，均显示TRIM支持已开启则优秀。

# 常见问题

## 系统安装

系统安装过程中，可通过打开安装器日志查看当前进度和所遇到的问题。

### 安装时停在verifying installmacosx.pkg/installesd.dmg

等待一段时间后会重新启动，然后再去安装一次即可。

## 引导启动

### 内置kexts错误导致无法进入系统

进入恢复模式后点击常用工具-终端，输入以下命令以重建缓存。也可进入单用户模式操作。

```
// MAC为系统盘卷标，需根据情况替换
rm -rf [错误的kexts路径]
rm -rf /Volumes/MAC/System/Library/Caches/com.apple.kext.caches/Startup/kernelcache
rm -rf /Volumes/MAC/System/Library/PrelinkedKernels/prelinkedkernel
touch /Volumes/MAC/System/Library/Extensions/ && kextcache -u /Volumes/MAC
```

### 无法更改启动路径

在某些情况下，电脑的启动路径被硬编码为启动`EFI/Microsoft/Boot/bootmgfw.efi`而不是`EFI/BOOT/BOOTX64.EFI`，这将导致计算机启动系统的锁定。若遇到以上情况，则需将EFI分区里的EFI/Microsoft/Boot/bootmgfw.efi重命名为其他名称并将Clover的CLOVERX64.efi重命名为bootmgfw.efi，复制替换即可。注意，Windows的每次更新都会覆盖bootmgfw.efi，因此需要重新操作。

### 抹盘时提示MediaKit报告设备上的空间不足以执行请求的操作

根本原因是EFI分区小于200MB。

## 啰嗦模式

### 提示Panic

内核恐慌。可先尝试加-x参数后再次启动，若无效则应当根据错误提示选择以下的解决方案。

#### AppleIntelCPUPowerManagement/AppleRTC

Mac的CPU电源管理不起作用。

在Clover加入NullCPUPowerManagement.kext，或删除SLE下的AppleIntelCPUPowerManagement.kext和AppleIntelCPUPowerManagementClient.kext。

#### AppleTyMCEDriver

删除AppleTyMCEDriver.kext即可，可能在SLE或引导器目录。或SMBIOS不要设置MacPro4,1/MacPro5,1/Xserve3,1。

#### VoodooHDA

删除VoodooHDA.kext即可，可能在SLE或引导器目录。

#### ApplePolicyControl

删除AppleGraphicsControl.kext中的Contents/Plugins/ApplePolicyControl.kext即可。

#### Local APIC

可能是因为Mac不支持当前CPU。可尝试使用cpus=1启动标志。

#### Unable to find driver for this platform: \"ACPI\

在极少数情况下，这种恐慌只会在AppleACPIPlatform.kext损坏时发生。可尝试启动安全模式。

### 卡在PCI configuration begin

可尝试添加启动参数npci=0x2000或npci=0x3000。两者不要同时使用。

### Still waiting for root device并禁行

表示系统无法找到系统盘，一般分为USB引导和SATA硬盘引导两种情况。

如果是USB引导，代表系统无法识别到USB，可在引导器的kexts下放置USBInjectAll.kext，也可尝试在Clover的config.plist中勾选FixOwnership。也可尝试插入USB 2.0端口而非3.0端口。启动后应当通过USB端口定制解决该问题。

如果是SATA硬盘引导，代表Mac不支持该SATA控制器。由于Mac不能正确支持RAID、IDE和RST，因此需要在BIOS将SATA设置为AHCI模式。若不起作用，则可尝试在引导器的kexts部分放置以下kext，注意不要同时使用。

```
// SATA-unsupported.kext
https://github.com/khronokernel/Legacy-Kexts/blob/master/Injectors/Zip/SATA-unsupported.kext.zip

// AHCIPortInjector.kext
https://www.insanelymac.com/forum/files/file/436-ahciportinjectorkext/

// AppleAHCIPort.kext（从Catalina提取，主要用于Big Sur）
https://github.com/dortania/OpenCore-Install-Guide/blob/master/extra-files/CtlnaAHCIPort.kext.zip
```

<details>
<summary>【进阶】OC引导</summary>

可尝试打开RealeasUSBOwnership、XhciPortlimit。
</details>

### 卡在ApplelIntelLpssI2CController

在主机Windows下把SLE下的AppleInteLpssI2CController.kext删掉。若无效，再删AppleIntelLpssI2C.kext。

或者在Clover配置中禁用。打开Clover的config.plist，在KextsToPatch加入以下配置即可。

```
Name: com.apple.driver.AppleIntelLpssI2C
Find: 494F4B69 74
Replace: 494F4B69 73
Comments: Prevent Apple I2C kexts from attaching to I2C controllers, credit CoolStar
InfoPlistPatch: true

Name: com.apple.driver.AppleIntelLpssI2CController
Find: 494F4B69 74
Replace: 494F4B69 73
Comments: Prevent Apple I2C kexts from attaching to I2C controllers, credit CoolStar
InfoPlistPatch: true
```

### 卡在IOConsoleUsers:gIOScreenLockState 3或出现Busy Timeout

此错误是由于显卡驱动问题。如果为双显卡，需屏蔽独显，驱动集显。

在Clover主页面中选择Options，点击Graphics injector，取消勾选`InjectIntel`并把`platform-id`修改为`0×12345678`，然后启动系统。若无效，则将LE下所有kexts备份并删除，再次启动。

若仍无效，则找到SLE下AppleIntel/AMD/ATI/Ge/NVD开头的所有显卡kexts，并将除核显外的其它所有kexts备份后删除。假设为Intel核显，则删除除AppleIntel开头外的其余所有显卡kexts。

### 卡在IOBluetoothHCIController

真正的问题可能与蓝牙无关，而是在显卡。解决方法同上。

### 显示This version of Mac OS X is not supported on this platform!

Clover添加启动参数`-no_compat_check`，或更换SMBIOS。若不行，则换用其他版本的系统镜像。

### 卡在Service only ran for 0 seconds. Pushing respawn out by 10 second

使用SSDT而非DSDT进行独显屏蔽即可。

### 卡在Attempting system restart...MACH Reboot

在Clover的config.plist配置文件DropTables下添加以下内容。

| Signature | Type/key | String |
|-----------|----------|--------|
| MATS      |          |        |
| DMAR      |          |        |
| BGRT      |          |        |

### 卡在Welcome to Clover xxxx user settings

Clover的config.plist不适合该系统，替换即可。

### 显示DSMOS has arrived后重启

显卡问题，添加启动参数nv_disable=1禁用独显即可。

### 出现DSMOS错误

FakeSMC.kext与dsmos.kext同时使用导致。删除dsmos.kext并使用FakeSMC.kext。

### 出现ATIRadeonX2000/ATIRadeonX3000错误

删除SLE下ATI开头的显卡驱动。

### 出现CHUDKernLib错误

Xcode用于调试核心的驱动。删除SLE下的CHUDKernLib.kext即可。

### 出现FakeSMC错误

替换一个不同版本的FakeSMC.kext即可。

### 出现FakeSMCRadeon错误

替换一个不同版本的FakeSMC.kext，或删除FakeSMC.kext中的Contents/PlugIns/FakeSMCRadeon.kext即可。

### 出现ElliottForceLegacyRTC错误

删除ElliottForceLegacyRTC.kext并使用LegacyAppleRTC.kext。

### 出现AppleRTL8169Ethernet错误

删除IONetworkingFamily.kext，或IONetworkingFamily.kext下的Contents/PlugIns/AppleRTL8169Ethernet.kext。

### 出现AppleFWOHCI错误

删除SLE下的IOFireWireFamily.kext/Contents/PlugIns/AppleFWOHCI.kext即可。

### 出现SleepEnabler错误

删除SleepEnabler.kext。

### 出现Trying to change a collection in the registry的OScollection.cpp错误

在BIOS开启ACPI 2.0 Support及ACPI APIC support。


### failed to locate SMC driver

更新FakeSMC.kext即可。

### 出现ApplePolicyControl错误

删除SLE下的AppleGraphicsControl.kext/Contents/PlugIns/ApplePolicyControl.kext即可。

### 白屏且鼠标在屏幕左上角出现无限彩色风火轮

更新FakeSMC.kext即可。

### 出现IOMemoryDescriptor.cpp错误

内存读取错误。

### 出现can't perform kext scan: no kext summary错误

尝试不使用kexts缓存。

### 发生Should have 2 threads, but only found 3 for Die 0的cpu_threads.c错误

重新提取修改正确的DSDT.aml即可。

### 发生IOAPIC: Version 0x20 Vectors 64:87错误

使用启动参数cpus=1或cpus=2，或删掉DSDT.aml即可。

### 出现NVClockX错误

删除NVClockX.kext或FakeSMC.kext/Contents/PlugIns/NVClockX.kext。

### 出现AppleIntelGMA950错误

删除SLE下的AppleIntelGMA950.kext。

### 出现GeForce7xxx错误

删除SLE下的eForce7xxx.kext。

### 出现IntelCPUMonitor错误

删除IntelCPUMonitor.kext或FakeSMC.kext/Contents/PlugIns/IntelCPUMonitor.kext。

## 系统运行

### 内置SATA硬盘显示为橙色图标

打开Clover的config.plist，在Kernel and kext Patches选项卡中的KextsToPatch加入以下代码即可。

```
Name: AppleAHCIPort
Find: 45787465 726E616C
Replace: 496E7465 726E616C
Comment: Define external drivers as internal to fix yellow drive icons
```

# 附录

```
笔记本 最好安装 ElliottForceLegacyRTC.kext 或 LegacyAppleRTC.kext ， 以免BIOS被毁了，无法开机

最后，如果您真的想不出一种方法来使集成的图形工作，那么最后一个选择可能是蛮力方法：在真实的Mac或Windows上打开Unibeast USB驱动器（或一些类似的安装程序/恢复USB驱动器）。另一个Hackintosh，转到USB驱动器上的/ System / Library / Extensions，然后删除每个kext以“ AppleIntelSNB”，“ AppleIntelHD”和“ AppleIntelFrame”开头的文件。本质上，这会从USB驱动器中手动删除每个图形驱动程序，因此只能使用最基本的图形支持来强制启动。然后，您可以使用USB驱动器帮助Hackintosh临时启动进入Mac OSX。从那里，您将不得不寻找更长期的解决方案。
```

## FakeSMC与VirtualSMC

两者作用相同，均用于向macOS提供假信息，模拟白苹果启动环境。FakeSMC早于VirtualSMC，且已不再更新，因此推荐使用VirtualSMC替换FakeSMC。注意，使用VirtualSMC时Lilu需为最新版本，否则将无法进入系统。VirtualSMC包作用分别如下。

| Kext名称                               | 作用                                                         |
| -------------------------------------- | ------------------------------------------------------------ |
| VirtualSMC                             | 替换FakeSMC.kext，需在Clover的driver64UEFI中删除SMCHelper-64.efi并复制VirtualSMC.efi到此目录 |
| SMCProcessor/SMCSuperIO/SMCLightSensor | 传感器驱动，用于替换CPUSensors/GPUSensors/LPCSensors/ACPISensor |
| SMCBatteryManager                      | 电源管理驱动，用于替换ACPIBatteryManager                     |

VirtualSMC需要10.8或更高版本的系统，旧版本应当使用FakeSMC。

## Kext

### Lilu

Lilu为其它kext提供接口支持，许多kext需要依赖Lilu才能运行。需要10.8或更高版本的系统。

### WhateverGreen

WhateverGreen中已包含`FakePCIID`，`IntelGraphicsFixup`，`NvidiaGraphicsFixup`，`Shiki` 和 `CoreDisplayFixup`。

### BTFirmwareUploader

本kext已失效，现用`BrcmPatchRAM`。

### VoodooI2C

VoodooI2C具有记忆性，由中断模式切换到轮询模式、在中断模式下修改有关触控板的DSDT等均不生效，需将VoodooI2C的相关驱动在Clover的kexts下删除再重新复制才能恢复初始设置。

### IntelGraphicsDVMTFixup

macOS的启动需要DVMT大于`32MB`，否则将导致内核崩溃。DVMT的大小可在BIOS设置，若BIOS无相应选项，可通过grub中的`setup_var`修改。或者使用本kext，但仅用于macOS 10.13及以下，在macOS Mojave下不适用。

在Majove及更新系统，需在Clover的config.plist应用以下补丁以修复。或者使用Hackintool，应用补丁时勾选`DVMT 32MB 预分配`。

```
<key>Properties</key>
<dict>
	<key>PciRoot(0x0)/Pci(0x2,0x0)</key>
		<dict>
			<key>framebuffer-fbmem</key>
			<data>
			AACQAA==
			</data>
			<key>framebuffer-patch-enable</key>
			<data>
			AQAAAA==
			</data>
			<key>framebuffer-stolenmem</key>
			<data>
			AAAwAQ==
			</data>
		</dict>
</dict>
```

### CodecCommander

用于修复唤醒无声问题，已并入AppleALC。

## 驱动（.efi）

### EmuVariableUefi

用于模拟NVRAM，从而将黑苹果洗白。若主板有原生NVARM，则无需放置。

## SMBIOS表

|   SMBIOS ID    |  CPU Family  |     GPUs (S = Switchable)     |  Year and size  |
|----------------|--------------|-------------------------------|-----------------|
| MacBook1,1     | Yonah        | GMA 950                       | 13" 2006        |
| MacBook2,1     | Merom        | GMA 950                       | 13" 2006/07"    |
| MacBook3,1     | Merom        | GMA X3100                     | 13" 2007        |
| MacBook4,1     | Penryn       | GMA X3100                     | 13" 2008        |
| MacBook4,2     | Penryn       | GMA X3100                     | 13" 2008        |
| MacBook5,1     | Penryn       | GeForce 9400M                 | 13" 2008        |
| MacBook5,2     | Penryn       | GeForce 9400M                 | 13" 2009        |
| MacBook6,1     | Penryn       | GeForce 9400M                 | 13" 2009        |
| MacBook7,1     | Penryn       | GeForce 320M                  | 13" 2010        |
| MacBook8,1     | Broadwell m  | HD 5300                       | 12" 2015        |
| MacBook9,1     | Skylake m    | HD 515                        | 12" 2016        |
| MacBook10,1    | Kaby Lake m  | HD 615                        | 12" 2017        |
| —              | —            | —                             | —               |
| MacBookAir1,1  | Merom        | GMA X3100                     | 13" 2008        |
| MacBookAir2,1  | Penryn       | GeForce 9400M                 | 13" 2008/09"    |
| MacBookAir3,1  | Penryn       | GeForce 320M                  | 11" 2010        |
| MacBookAir3,2  | Penryn       | GeForce 320M                  | 13" 2010        |
| MacBookAir4,1  | Sandy Bridge | HD 3000                       | 11" 2011        |
| MacBookAir4,2  | Sandy Bridge | HD 3000                       | 13" 2011        |
| MacBookAir5,1  | Ivy Bridge   | HD 4000                       | 11" 2012        |
| MacBookAir5,2  | Ivy Bridge   | HD 4000                       | 13" 2012        |
| MacBookAir6,1  | Haswell      | HD 5000                       | 11" 2013        |
| MacBookAir6,2  | Haswell      | HD 5000                       | 13" 2013        |
| MacBookAir7,1  | Broadwell    | HD 6000                       | 11" 2015        |
| MacBookAir7,2  | Broadwell    | HD 6000                       | 13" 2015        |
| MacBookAir8,1  | Kaby Lake    | Intel UHD Graphics 617        | 13" 2018        |
| MacBookAir8,2  | Kaby Lake    | Intel UHD Graphics 617        | 13" 2019        |
| MacBookAir9,1  | Ice Lake     | Intel Iris Plus Graphics      | 13” 2020        |
| —              | —            | —                             | —               |
| MacBookPro1,1  | Yonah        | Radeon X1600                  | 15" 2006        |
| MacBookPro1,2  | Yonah        | Radeon X1600                  | 17" 2006        |
| MacBookPro2,1  | Merom        | Radeon X1600                  | 15" 2006        |
| MacBookPro2,2  | Merom        | Radeon X1600                  | 17" 2006        |
| MacBookPro3,1  | Merom        | GeForce 8600M GT              | 15"/17" 2007    |
| MacBookPro4,1  | Penryn       | GeForce 8600MG GT             | 17" 2008        |
| MacBookPro5,1  | Penryn       | GeForce 9400M/9600M GT        | S, 15" 2008/09" |
| MacBookPro5,2  | Penryn       | GeForce 9400M/9600M GT        | S, 17" 2009     |
| MacBookPro5,3  | Penryn       | GeForce 9400M/9600M GT        | S, 15" 2009     |
| MacBookPro5,4  | Penryn       | GeForce 9400M/9600M GT        | S, 15" 2009     |
| MacBookPro5,5  | Penryn       | GeForce 9400M/9600M GT        | S, 13" 2009     |
| MacBookPro7,1  | Penryn       | GeForce 320M                  | 13" 2010        |
| MacBookPro6,1  | Arrandale    | HD Graphics/GeForce GT 330M   | S, 17" 2010     |
| MacBookPro6,2  | Arrandale    | HD Graphics/GeForce GT 330M   | S, 15" 2010     |
| MacBookPro8,1  | Sandy Bridge | HD 3000                       | 13" 2011        |
| MacBookPro8,2  | Sandy Bridge | HD 3000/Radeon HD 6490M       | S, 15" 2011     |
| MacBookPro8,3  | Sandy Bridge | HD 3000/Radeon HD 6750M       | S, 17" 2011     |
| MacBookPro9,1  | Ivy Bridge   | HD 4000/GeForce GT 650M       | S, 15" 2012     |
| MacBookPro9,2  | Ivy Bridge   | HD 4000                       | 13" 2012        |
| MacBookPro10,1 | Ivy Bridge   | HD 4000/GeForce GT 650M       | S, 15" 2012/13" |
| MacBookPro10,2 | Ivy Bridge   | HD 4000                       | 13" 2012/13"    |
| MacBookPro11,1 | Haswell      | Iris 5100                     | 13" 2013/14"    |
| MacBookPro11,2 | Haswell      | Iris Pro 5200                 | 15" 2013/14"    |
| MacBookPro11,3 | Haswell      | Iris Pro 5200/GeForce GT 750M | S, 15" 2013/14" |
| MacBookPro11,4 | Haswell      | Iris Pro 5200                 | 15" 2015        |
| MacBookPro11,5 | Haswell      | Iris Pro 5200/Radeon R9 M370X | 15" 2015        |
| MacBookPro12,1 | Broadwell    | Iris 6100                     | 13" 2015        |
| MacBookPro13,1 | Skylake      | Iris 540                      | 13" 2016        |
| MacBookPro13,2 | Skylake      | Iris 550                      | 13" 2016        |
| MacBookPro13,3 | Skylake      | HD 530/Radeon Pro 450         | 15" 2016        |
| MacBookPro14,1 | Kaby Lake    | Iris Plus 640                 | 13" 2017        |
| MacBookPro14,2 | Kaby Lake    | Iris Plus 650                 | 13" 2017        |
| MacBookPro14,3 | Kaby Lake    | HDs 630/Radeon Pro 555        | 15" 2017        |
| MacBookPro15,1 | Caffee Lake  | Intel UHD Graphics 630        | 15" 2018        |
| MacBookPro15,2 | Caffee Lake  | Intel Iris Plus Graphics 655  | 13" 2018        |
| MacBookPro15,3 | Caffee Lake  | UHD630/                       |                 |
Radeon Pro555X/560X
Radeon Pro Vega 16/20|15" 2019|
|MacBookPro15,4|Caffee Lake|Intel Iris Plus Graphics 645|13" 2019|
|MacBookPro16,1|Caffee Lake|Intel UHD Graphics 630
AMD Radeon Pro 5300M/5500M|16" 2019|
| MacBookPro16,2 | Ice Lake     | Intel Iris Plus Graphics           | 13" 2020       |
| MacBookPro16,3 | Coffee Lake  | Intel Iris Plus Graphics 645       | 13" 2020       |
| MacBookPro16,4 | Coffee Lake  | AMD Radeon Pro 5600M               | 16" 2020       |
| —              | —            | —                                  | —              |
| iMac4,1        | Yonah        | Radeon X1600                       | 17"/20" 2006   |
| iMac4,2        | Yonah        | GMA 950                            | 17" 2006       |
| iMac5,1        | Merom        | Radeon X1600                       | 17"/20" 2006   |
| iMac5,2        | Merom        | GMA 950                            | 17" 2006       |
| iMac6,1        | Merom        | GeForce 7300GT                     | 24" 2006       |
| iMac7,1        | Merom        | Radeon HD 2400 XT                  | 20"/24" 2007   |
| iMac8,1        | Penryn       | Radeon HD 2400 XT                  | 20"/24" 2008   |
| iMac9,1        | Penryn       | GeForce 9400M                      | 20"/24" 2009   |
| iMac10,1       | Wolfdale     | GeForce 9400M                      | 21.5"/27" 2009 |
| iMac10,1       | Wolfdale     | Radeon HD 4670                     | 21.5"/27" 2009 |
| iMac11,1       | Lynnfield    | Radeon HD 4850                     | 27" 2009       |
| iMac11,2       | Clarkdale    | Radeon HD 4670                     | 21.5" 2010     |
| iMac11,3       | Clarkdale    | Radeon HD 5670                     | 27" 2010       |
| iMac12,1       | Sandy Bridge | Radeon HD 6750M                    | 21.5" 2011     |
| iMac12,2       | Sandy Bridge | Radeon HD 6770M                    | 27" 2011       |
| iMac13,1       | Ivy Bridge   | GeForce GT 640M                    | 21.5" 2012     |
| iMac13,2       | Ivy Bridge   | GeForce GTX 660M                   | 27" 2012       |
| iMac13,1       | Ivy Bridge   | HD 4000                            | 21.5" 2013     |
| iMac14,1       | Haswell      | Iris Pro 5200                      | 21.5" 2013     |
| iMac14,1       | Haswell      | GeForce GT 750M                    | 21.5" 2013     |
| iMac14,2       | Haswell      | GeForce GT 755M                    | 27" 2013       |
| iMac14,4       | Haswell      | HD 5000                            | 21.5" 2014     |
| iMac15,1       | Haswell      | Radeon R9 M290X                    | 27" 2014/15"   |
| iMac16,1       | Broadwell    | HD 6000 or Iris Pro 6200           | 21.5" 2015     |
| iMac16,2       | Broadwell    | Iris Pro 6200                      | 21.5" 2015     |
| iMac17,1       | Skylake      | Radeon R9 M380                     | 27" 2015       |
| iMac18,1       | Kaby Lake    | Iris Plus 640                      | 21.5" 2017     |
| iMac18,2       | Kaby Lake    | Radeon Pro 555                     | 21.5" 2017     |
| iMac18,3       | Kaby Lake    | Radeon Pro 570                     | 27" 2017       |
| iMac19,1       | Coffee Lake  | Radeon Pro 580                     | 2017           |
| iMac19,2       | Coffee Lake  | Radeon Pro 580X/Radeon Pro Vega 48 | 2019           |
| iMac20,1       | Comet Lake   | Radeon Pro 5300/5500 XT            | 2020           |
| iMac20,2       | Comet Lake   | Radeon Pro 5700/5700 XT            | 2020           |
| —              | —            | —                                  | —              |
| iMacPro1,1     |              | Radeon Pro Vega 56/64/64X          | 2017           |
| —              | —            | —                                  | —              |
| Macmini1,1     | Yonah        | GMA 950                            | 2006           |
| Macmini2,1     | Merom        | GMA 950                            | 2007           |
| Macmini3,1     | Penryn       | GeForce 9400M                      | 2009           |
| Macmini4,1     | Penryn       | GeForce 320M                       | 2010           |
| Macmini5,1     | Sandy Bridge | HD 3000                            | 2011           |
| Macmini5,2     | Sandy Bridge | Radeon HD 6630M                    | 2011           |
| Macmini5,3     | Sandy Bridge | HD 3000                            | 2011           |
| Macmini6,1     | Ivy Bridge   | HD 4000                            | 2012           |
| Macmini6,2     | Ivy Bridge   | HD 4000                            | 2012           |
| Macmini7,1     | Haswell      | HD 5000 or Iris 5100               | 2014           |
| Macmini8,1     | Coffee Lake  | UHD Graphics 630                   | 2018           |
| —              | —            | —                                  | —              |
| MacPro1,1      | Woodcrest    | GeForce 7300 GT                    | 2006           |
| MacPro2,1      | Clovertown   | GeForce 7300 GT                    | 2006           |
| MacPro3,1      | Harpertown   | Radeon HD 2600 XT                  | 2008           |
| MacPro4,1      | Nehalem      | GeForce GT 120                     | 2009           |
| MacPro5,1      | Nehalem      | Radeon HD 5770                     | 2010           |
| MacPro5,1      | Westmere     | Radeon HD 5770                     | 2012           |
| MacPro6,1      | Ivy BridgeEP | FirePro D300                       | 2013           |
| MacPro7,1      | Cascade Lake | Radeon Pro 580X/Radeon Pro Vega II | 2019           |
| —              | —            | —                                  | —              |
| Xserve1,1      | Woodcrest    | Radeon X1300                       | 2006           |
| Xserve2,1      | Harpertown   | Radeon X1300                       | 2008           |
| Xserve3,1      | Nehalem      | GeForce GT 120                     | 2009           |

# 相关下载

## Nvidia驱动相关

### WebDriver自动安装脚本项目

```
https://github.com/Benjamin-Dobell/nvidia-update
```

### WebDriver Manager

```
https://hackintosher.com/forums/attachments/webdrivermanager-2-9-4-zip.1289/
```

### CUDA Driver

```
https://www.nvidia.com/en-us/drivers/cuda/mac-driver-archive/
```


## Clover/OpenCore的config.plist示例

```
https://khronokernel-2.gitbook.io/opencore-vanilla-desktop-guide/
https://hackintosh.gitbook.io/-r-hackintosh-vanilla-desktop-guide/
```

## OC-little包

```
https://github.com/daliansky/OC-little

// 另附P-little包（较旧）
https://github.com/daliansky/P-little
```

## KEXT/SSDT/efi

大部分kexts可在以下网站找到。

```
https://dortania.github.io/builds/
https://kext.me/
https://bitbucket.org/RehabMan/
https://github.com/acidanthera
https://www.zdynb.cn/2020/hei-ping-guo-qu-dong.html
https://github.com/ClayMoreBoy/Hackintosh-Kext-Factory
```

### USBInjectAll.kext

```
https://bitbucket.org/RehabMan/os-x-usb-inject-all/downloads/
```

### USBPower.kext

```
https://blog.xjn819.com/wp-content/uploads/2019/10/USBPower.kext_.zip
```

### 有线网卡

#### Realtek RTL810X（RTL8101E/8102E/8103E/8401E/8105E/8402/8106E/8106EUS）

```
http://www.insanelymac.com/forum/topic/296190-driver-for-realteks-rtl810x-fast-ethernet-series
```

#### Realtek RTL8111X/8168X（X=无/B/C/D/E/F/G）

```
http://www.insanelymac.com/forum/topic/287161-new-driver-for-realtek-rtl8111
https://code.google.com/p/os-x-realtek-network/downloads/list
```

### VirtualSMC

#### VirtualSMC包（含传感器/电池驱动）

```
https://github.com/acidanthera/VirtualSMC
```

#### 替代驱动

##### ACPIBetteryManager.kext

```
https://bitbucket.org/RehabMan/os-x-acpi-battery-driver/downloads/
```

##### FakeSMC包（含传感器驱动）

```
https://bitbucket.org/RehabMan/os-x-fakesmc-kozlek/downloads/
```

### Lilu.kext

```
https://github.com/acidanthera/Lilu/releases
```

### WhateverGreen.kext

```
https://github.com/acidanthera/WhateverGreen/releases
```

### AppleALC.kext

```
https://github.com/acidanthera/AppleALC/releases
```

### VoodooI2C

```
https://github.com/alexandred/VoodooI2C/releases
```

### VoodooPS2Controller.kext

```
https://bitbucket.org/RehabMan/os-x-voodoo-ps2-controller/downloads/
```

### NullEthernet.kext

```
https://bitbucket.org/RehabMan/os-x-null-ethernet/downloads/
```

### NoTouchID.kext

```
https://github.com/al3xtjames/NoTouchID/releases
```


### SSDT-GPI0.aml

```
DefinitionBlock ("", "SSDT", 2, "hack", "I2C", 0)
{
    External (_SB.PCI0.GPI0, DeviceObj)
    Scope (_SB.PCI0.GPI0)
    {
        Method (_STA, 0)
        {
            Return (0x0F)
        }
    }
}
```



### SSDT-XOSI.dsl

```
https://raw.githubusercontent.com/RehabMan/OS-X-Clover-Laptop-Config/master/hotpatch/SSDT-XOSI.dsl
```

### ApfsDriverLoader.efi

```
https://github.com/acidanthera/ApfsSupportPkg
```

### AR9565驱动

```
http://www.mediafire.com/file/2rjm76vro8ha28l/9565.zip/file
```

## 工具

### Hackintool

```
http://headsoft.com.au/download/mac/Hackintool.zip
https://github.com/headkaze/Hackintool
```

### Kext Updater

```
https://bitbucket.org/profdrluigi/kextupdater/downloads/
```

### MaciASL

```
（RehabMan版）https://bitbucket.org/RehabMan/os-x-maciasl-patchmatic/downloads/
（最新版）https://github.com/acidanthera/MaciASL/releases
```

### IORegistryExplorer 2.1

```
https://github.com/vulgo/IORegistryExplorer
https://github.com/khronokernel/IORegistryClone
```

### gfxutil

```
https://github.com/acidanthera/gfxutil
```

### iMessageDebug

```
https://github.com/YCSuperM/ImessageDebug
```

### Clover

```
https://github.com/Dids/clover-builder/releases
https://sourceforge.net/projects/cloverefiboot/
```

### Clover Configurator

```
https://mackie100projects.altervista.org/download-clover-configurator/
```

### Kext Utility

```
https://en.freedownloadmanager.org/Mac-OS/Kext-Utility-FREE.html
```

### VDADecoderChecker

```
https://github.com/cylonbrain/VDADecoderCheck/releases
```

### 7z

```
http://www.7-zip.org/download.html
```

### AW EDID Editor

```
https://www.analogway.com/apac/products/software-tools/aw-edid-editor/
```

## 补丁源

### VoodooI2C

```
https://github.com/alexandred/VoodooI2C-Patches
```

### MaciASL

#### 常用补丁源

```
_RehabMan Laptop
http://raw.github.com/RehabMan/Laptop-DSDT-Patch/master

_OS-X-ACPI-Debug
http://raw.github.com/RehabMan/OS-X-ACPI-Debug/master

_VoodooI2C-Patches
http://raw.github.com/alexandred/VoodooI2C-Patches/master

Sourceforge
http://maciasl.sourceforge.net

Gigabyte
http://maciasl.sourceforge.net/pjalm/gigabyte

ASUS
http://maciasl.sourceforge.net/pjalm/asus
```

#### 其它补丁源

```
Audio HDMI 5 Series
https://raw.github.com/toleda/audio_hdmi_5series/master

Audio HDMI HD3000/Sandy Bridge/6 Series
https://raw.github.com/toleda/audio_hdmi_hd3000/master

Audio HDMI HD4000/Ivy Bridge/7 Series
https://raw.github.com/toleda/audio_hdmi_hd4000/master

Audio HDMI UEFI Audio dsdt edits - Desktop/Laptop/Intel NUC
https://raw.github.com/toleda/audio_hdmi_uefi/master

Audio Realtek ALC injection
https://raw.github.com/toleda/audio_ALCInjection/master

Airport PCIe Half Mini
https://raw.github.com/toleda/airport_pcie-hm/master

Audio HDMI HD4600/Haswell/8 Series
https://raw.github.com/toleda/audio_hdmi_8series/master

PJALM General
http://pjalm.info/repos/general/

PJALM Graphics
http://pjalm.info/repos/graphics/

PJALM Intel Series 6
http://pjalm.info/repos/intel6/

PJALM Intel Series 7
http://pjalm.info/repos/intel7/

PJALM ASUS
http://pjalm.info/repos/asus/

PJALM Gigabyte
http://pjalm.info/repos/gigabyte/

PJALM MSI
http://pjalm.info/repos/msi/

PJALM ASRock
http://pjalm.info/repos/asrock/

PJALM Zotac
http://pjalm.info/repos/zotac/

Gigabyte
http://www.tonymacx86.com/DSDT/

HP ProBook 4x30s
https://raw.githubusercontent.com/RehabMan/HP-ProBook-4x30s-DSDT-Patch/master
```

# 参考教程

## Windows下VMware Workstations Pro15.5.0安装dmg镜像

```
https://hestyle.blog.csdn.net/article/details/104672651
```

## 黑苹果必备：Intel核显platform ID整理及smbios速查表

```
https://blog.daliansky.net/Intel-core-display-platformID-finishing.html
```

## FIX BTFIRMWAREUPLOADER IN MACOS HIGH SIERRA

```
https://osxlatitude.com/forums/topic/10127-updated-nov-2017-fix-btfirmwareuploader-in-macos-high-sierra/
```

## alexandred/VoodooI2C-Gitter

```
https://gitter.im/alexandred/VoodooI2C/archives/2019/01/14
https://gitter.im/alexandred/VoodooI2C/archives/2018/08/30（搜索@Piero512）
```

## Hackintool深度教程

```
https://blog.daliansky.net/Intel-FB-Patcher-tutorial-and-insertion-pose.html
```

## 修改DSDT实现电量显示教程

```
https://www.geekcj.com/333.html
https://blog.gzxiaobai.cn/2020/05/16/%E4%B8%BA%E5%B0%8F%E7%99%BD%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%94%B5%E6%B1%A0%E6%95%99%E7%A8%8B%EF%BC%88DSDT%EF%BC%89/
```

## VoodooI2C驱动教程

```
https://www.penghubingzhou.cn/2019/01/06/VoodooI2C%20DSDT%20Edit/
https://www.penghubingzhou.cn/2019/07/24/VoodooI2C%20DSDT%20Edit%20FAQ/
https://voodooi2c.github.io/#GPIO%20Pinning/GPIO%20Pinning
```

## 英特尔®核芯显卡常见问答（WhateverGreen）

```
https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.cn.md
```

## 黑苹果精华必读：新手常见(五国)(-v图)错误解决

```
https://www.xmyy.com/article-254928.html
```

## Disabling discrete graphics in dual-GPU laptops

```
https://www.tonymacx86.com/threads/guide-disabling-discrete-graphics-in-dual-gpu-laptops.163772/
```

## /r/Hackintosh Vanilla Desktop Guide

```
https://hackintosh.gitbook.io/-r-hackintosh-vanilla-desktop-guide/
```

## SSDT GPU (Graphics Card) Injection

```
https://www.tonymacx86.com/threads/ssdt-gpu-graphics-card-injection.183354/
```

## stevezhengshiqi/one-key-cpufriend

```
https://github.com/stevezhengshiqi/one-key-cpufriend
```

## AR9565 MAC黑苹果Bluetooth蓝牙驱动教程

```
https://www.longzc.cn/index.php/archives/308
```

## SSDT-RMNE.aml

```
https://github.com/RehabMan/OS-X-Null-Ethernet/blob/master/ssdt-rmne.aml
```

## SSDT-PNLF.aml

```
https://bitbucket.org/RehabMan/applebacklightfixup/downloads/
```

## 使用HIDPI解决睡眠唤醒黑屏、花屏及连接外部显示器的正确姿势

```
https://blog.daliansky.net/Use-HIDPI-to-solve-sleep-wake-up-black-screen,-Huaping-and-connect-the-external-monitor-the-correct-posture.html
```

## 小米笔记本Pro安装10.13随手记及EFI分享

```
https://blog.daliansky.net/XiaoMiPro-notebook-Installation-10.13-readily-remember-and-share-EFI.html
```

## Notebook Compatibility List

```
https://gpu-passthrough.com/
```

## Hackintosh won't boot? How to use verbose mode to fix it

```
http://www.macbreaker.com/2015/01/read-verbose-mode-fix-hackintosh-errors.html
```

## 新手常见(五国)(-v图)错误解决(原版,破解kernel,补丁kext下载)

```
https://blog.csdn.net/ashuai81/article/details/8032952
```

## 

```

```

## 

```

```

## 

```

```
