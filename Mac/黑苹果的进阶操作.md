---
title: 黑苹果的进阶操作
categories: Mac
abbrlink: Hackintosh-Advanced-Configuration
date: 2019-12-02 01:55:29
tags:
---

![](https://tva1.sinaimg.cn/large/006tNbRwly1g9lvpyjs1dj31c00u07wo.jpg)

请保证在黑苹果已完全能够正常使用、并有足够能力理解相关术语后进行以下操作。

<!-- more -->

# 黑苹果发展

## 系统迭代与硬件兼容

### 支持列表

列表如下。其中EFI32/64指需要使用32/64位的引导器。32/64位内核空间支持需要32/64位的kexts。

|    系统名称   | 系统版本 |                                                                版本号                                                                 | 内核号 |  发布日期  | 最后更新日期 |                   兼容性                    | PowerPC支持 |   Intel架构支持    | ARM架构支持 | EFI32位支持 |     EFI64位支持    |    CPU32位支持   | CPU64位支持 | 32位内核空间支持 | 64位内核空间支持 |         最低指令集要求         | 系统盘格式 |                     备注                     |
|---------------|----------|---------------------------------------------------------------------------------------------------------------------------------------|--------|------------|--------------|---------------------------------------------|-------------|--------------------|-------------|-------------|--------------------|------------------|-------------|------------------|------------------|--------------------------------|------------|----------------------------------------------|
| Big Sur       | 11.0     | 11.1</br>11.0.1</br>11.0                                                                                                              |     20 | 2020-11-12 |              | 2013年上半年发布的MacBook Air               | -           | 支持               | 支持        | -           | 支持               | -                | 支持        | -                | 支持             | SSE4.2                         | APFS       | 11.0仅适用于M1 CPU                           |
| Catalina      | 10.15    | 10.15.7</br>10.15.6</br>10.15.5-19F96</br>10.15.4</br>10.15.3</br>10.15.2</br>10.15.1</br>10.15                                       |     19 | 2019-10-07 |              | 2010年的iMac Pro和2012年下半年发布的所有Mac | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSE4.2                         | APFS       |                                              |
| Mojave        | 10.14    | 10.14.6-18G84</br>10.14.5</br>10.14.4</br>10.14.3</br>10.14.2</br>10.14.1</br>10.14                                                   |     18 | 2018-09-24 | 2019-12-10   | 2010年的iMac Pro和2012年下半年发布的所有Mac | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSE4.2                         | APFS       |                                              |
| High Sierra   | 10.13    | 10.13.6-17G65</br>10.13.5</br>10.13.4</br>10.13.3</br>10.13.2</br>10.13.1</br>10.13                                                   |     17 | 2017-09-25 | 2019-12-10   | 2009年下半年发布的iMac和MacBook             | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSE4                           | HFS+       |                                              |
| Sierra        | 10.12    | 10.12.6-16G29</br>10.12.5</br>10.12.4</br>10.12.3</br>10.12.2</br>10.12.1</br>10.12                                                   |     16 | 2016-09-20 | 2019-09-26   | 2009年下半年发布的iMac和MacBook             | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSE4                           | HFS+       |                                              |
| El Capitan    | 10.11    | 10.11.6-15G31</br>10.11.5</br>10.11.4</br>10.11.3</br>10.11.2</br>10.11.1</br>10.11                                                   |     15 | 2015-09-30 | 2018-07-09   | 2007年及以后的iMac和MacBook Pro             | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSSE3                          | HFS        |                                              |
| Yosemite      | 10.10    | 10.10.5-14F27</br>10.10.4</br>10.10.3</br>10.10.2</br>10.10.1</br>10.10                                                               |     14 | 2014-10-16 | 2015-08-15   | 2007年及以后的iMac和MacBook Pro             | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSSE3                          | HFS        |                                              |
| Mavericks     | 10.9     | 10.9.5-13F34</br>10.9.4</br>10.9.3</br>10.9.2</br>10.9.1</br>10.9                                                                     |     13 | 2013-10-22 | 2014-09-17   |                                             | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSSE3                          | HFS        |                                              |
| Mountain Lion | 10.8     | 10.8.5-12F37</br>10.8.4</br>10.8.3</br>10.8.2</br>10.8.1</br>10.8                                                                     |     12 | 2012-07-25 | 2013-09-12   |                                             | -           | 支持               | -           | -           | 支持               | -                | 支持        | -                | 支持             | SSSE3                          | HFS        |                                              |
| Lion          | 10.7     | 10.7.5-11G56</br>10.7.4</br>10.7.3</br>10.7.2</br>10.7.1</br>10.7                                                                     |     11 | 2011-07-20 | 2012-09-19   |                                             | -           | 支持               | -           | 支持        | 支持               | 支持（至10.7.5） | 支持        | 支持             | 支持             | SSSE3                          | HFS        | 第一个支持SSD TRIM，且不再提供安装光盘的版本 |
| Snow Leopard  | 10.6     | 10.6.8-10K540</br>10.6.7</br>10.6.6</br>10.6.5</br>10.6.4</br>10.6.3</br>10.6.2</br>10.6.1</br>10.6                                   |     10 | 2009-08-28 | 2011-07-15   |                                             | -           | 支持               | -           | 支持        | 支持               | 支持             | 支持        | 支持             | 支持             | SSE3（32位）</br>SSSE3（64位） | HFS        |                                              |
| Leopard       | 10.5     | 10.5.8-9L30</br>10.5.7</br>10.5.6</br>10.5.5</br>10.5.4</br>10.5.3</br>10.5.2</br>10.5.1</br>10.5                                     |      9 | 2007-10-26 | 2009-08-12   |                                             | 支持        | 支持               | -           | 支持        | 支持               | 支持             | 支持        | 支持             | -                | SSE3（32位）</br>SSSE3（64位） | HFS        |                                              |
| Tiger         | 10.4     | 10.4.11-8S165</br>10.4.10</br>10.4.9</br>10.4.8</br>10.4.7</br>10.4.6</br>10.4.5</br>10.4.4</br>10.4.3</br>10.4.2</br>10.4.1</br>10.4 |      8 | 2005-04-29 | 2007-11-14   |                                             | 支持        | 支持（从10.4.4起） | -           | 支持        | 支持（从10.4.8起） | 支持             | 支持        | 支持             | -                | SSE3（32位）</br>SSSE3（64位） | HFS        |                                              |
| Panther       | 10.3     | 10.3.9</br>10.3.8</br>10.3.7</br>10.3.6</br>10.3.5</br>10.3.4</br>10.3.3</br>10.3.2</br>10.3.1</br>10.3                               |      7 | 2003-10-24 | 2005-04-15   |                                             | 支持        | -                  | -           |             |                    |                  |             |                  |                  |                                |            |                                              |
| Jaguar        | 10.2     | 10.2.8</br>10.2.7</br>10.2.6</br>10.2.5</br>10.2.4</br>10.2.3</br>10.2.2</br>10.2.1</br>10.2                                          |      6 | 2002-08-23 | 2003-10-03   |                                             | 支持        | -                  | -           |             |                    |                  |             |                  |                  |                                |            | 首次有普通版/服务器版之分</br>10.2.7仅用于G5s/G4s                         |
| Puma          | 10.1     | 10.1.5</br>10.1.4</br>10.1.3</br>10.1.2</br>10.1.1</br>10.1                                                                           |      5 | 2001-09-25 | 2002-06-05   |                                             | 支持        | -                  | -           |             |                    |                  |             |                  |                  |                                |            |                                              |
| Cheetah       | 10.0     | 10.0.4</br>10.0.3</br>10.0.2</br>10.0.1</br>10.0                                                                                      |      3 | 2000-03-24 | 2002-06-22   |                                             | 支持        | -                  | -           |             |                    |                  |             |                  |                  |                                |            |                                              |
| Public Beta   | 10.0β    |                                                                                                                                       |        | 2000-09-13 | 2000-09-13   |                                             | 支持        | -                  | -           |             |                    |                  |             |                  |                  |                                |            | Mac OS X Public Beta有四个不同的版本         |

### CPU

#### Intel支持列表

|             架构             | 最早支持版本 | 最后支持版本 |        备注        |               CPUID               |
|------------------------------|--------------|--------------|--------------------|-----------------------------------|
|                              |              |              |                    |                                   |
| Pentium 4                    | 10.4.1       | 10.5.8       | 仅在开发套件中使用 | 0x0F41                            |
| Yonah                        | 10.4.4       | 10.6.8       | 32位               | 0x0006E6                          |
| Conroe/Merom                 | 10.4.7       | 10.11.6      | 无SSE4             | 0x0006F2                          |
| Penryn                       | 10.4.10      | 10.13.6      | 无SSE4.2           | 0x010676                          |
| Nehalem                      | 10.5.6       | 至今         |                    | 0x0106A2                          |
| **Core i**                   |              |              |                    |                                   |
| Lynnfield/Clarksfield        | 10.6.3       | 至今         | 10.14+中无iGPU支持 | 0x0106E0                          |
| Westmere/Clarkdale/Arrandale | 10.6.4       | 至今         | 10.14+中无iGPU支持 | 0x0206C0                          |
| Sandy Bridge                 | 10.6.7       | 至今         | 10.14+中无iGPU支持 | 0x0206A0(M/H)                     |
| Ivy Bridge                   | 10.7.3       | 至今         | 11+中无iGPU支持    | 0x0306A0(M/H/G)                   |
| Ivy Bridge-E5                | 10.9.2       | 至今         |                    | 0x0306E0                          |
| Haswell                      | 10.8.5       | 至今         |                    | 0x0306C0(S)                       |
| Broadwell                    | 10.10.0      | 至今         |                    | 0x0306D4(U/Y)                     |
| Skylake                      | 10.11.0      | 至今         |                    | 0x0506E3(H/S)</br>0x0406E3(U/Y)   |
| Kaby Lake                    | 10.12.4      | 至今         |                    | 0x0906E9(H/S/G)</br>0x0806E9(U/Y) |
| Coffee Lake                  | 10.12.6      | 至今         |                    | 0x0906EA(S/H/E)</br>0x0806EA(U)   |
| Amber/Whiskey/Comet Lake     | 10.14.1      | 至今         |                    | 0x0806E0(U/Y)                     |
| Comet Lake                   | 10.15.4      | 至今         |                    | 0x0906E0(S/H)                     |
| Ice Lake                     |              | 至今         |                    | 0x0706E5(U)                       |
| Tiger Lake                   |              |              | 未测试             | 0x0806C0(U)                       |



#### SSE4.2仿真

可用telemetrap.kext在SSE4.1 CPU下运行要求为SSE 4.2的系统，下载链接如下。

```
https://forums.macrumors.com/threads/mp3-1-others-sse-4-2-emulation-to-enable-amd-metal-driver.2206682/page-4?post=28447707#post-28447707
```

对于其它架构，也可尝试使用macOS Patcher，链接如下。

```
https://github.com/rmc-team/macos-patcher
```

### GPU

各平台需要的kexts可见以下链接。

```
https://dortania.github.io/GPU-Buyers-Guide/modern-gpus/amd-gpu.html
```

#### Intel支持列表

Mac支持绝大多数的GT2 Intel GPU和少数的GT3e Intel GPU，不支持GT1 Intel GPU（Pentium/Celeron/Atoms）。

|           架构           | 最早支持版本 | 最后支持版本 |               备注               |
|--------------------------|--------------|--------------|----------------------------------|
| 第三代GMA                | 10.4.1       | 10.7.5       | 需要32位内核和补丁               |
| 第四代GMA                | 10.5.0       | 10.7.5       | 需要32位内核和补丁               |
| Arrendale（HD Graphics） | 10.6.4       | 10.13.6      | 仅支持LVDS，不支持eDP 和外部输出 |
| Sandy Bridge（HD 3000）  | 10.6.7       | 10.13.6      |                                  |
| Ivy Bridge（HD 4000）    | 10.7.3       | 10.15.7      |                                  |
| Haswell（HD 4XXX/5XXX）  | 10.8.5       | 至今         |                                  |
| Broadwell（5XXX/6XXX）   | 10.10.0      | 至今         |                                  |
| Skylake（HD 5XX）        | 10.11.0      | 至今         |                                  |
| Kaby Lake（HD 6XX）      | 10.12.4      | 至今         |                                  |
| Coffee Lake（UHD 6XX）   | 10.13.6      | 至今         |                                  |
| Comet Lake（UHD 6XX）    | 10.15.4      | 至今         |                                  |
| Ice Lake（Gx）           | 10.15.4      | 至今         | 需要启动参数-igfxcdc和-igfxdvmt  |
| Tiger Lake（Xe）         |              |              | 无可用驱动                       |

#### Intel核显platform ID表

某些SKL/KBL台式机驱动4K显示器时，可尝试`0x193b0005`这一ig-platform-id。

该表格内容可参照以下链接。

```
https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.cn.md
```

##### Sandy Bridge

|        显卡型号        | platform-id |                        机型                       | 接口 | LVDS | DP | HDMI |
|------------------------|-------------|---------------------------------------------------|------|------|----|------|
| Intel HD Graphics 3000 | 0x00010000  | MacBookPro8,1</br>MacBookPro8,2</br>MacBookPro8,3 |    4 |    1 |  3 |      |
| Intel HD Graphics 3000 | 0x00020000  |                                                   |    1 |    1 |    |      |
| Intel HD Graphics 3000 | 0x00030010  | Macmini5,1</br>Macmini5,3                         |    3 |      |  2 |    1 |
| Intel HD Graphics 3000 | 0x00030020  | Macmini5,1</br>Macmini5,3                         |    3 |      |  2 |    1 |
| Intel HD Graphics 3000 | 0x00030030  | Macmini5,2                                        |    0 |      |    |      |
| Intel HD Graphics 3000 | 0x00040000  | MacBookAir4,1</br>MacBookAir4,2                   |    3 |    1 |  2 |      |
| Intel HD Graphics 3000 | 0x00050000  | iMac12,1/iMac12,2                                 |    0 |      |    |      |

##### Ivy Bridge

|          型号          | platform-id |      机型      | 接口 | LVDS | DP | HDMI |
|------------------------|-------------|----------------|------|------|----|------|
| Intel HD Graphics 4000 | 0x01660000  |                |    4 |    1 |  3 |      |
| Intel HD Graphics 4000 | 0x01660001  | MacBookPro10,2 |    4 |    1 |  2 |    1 |
| Intel HD Graphics 4000 | 0x01660002  | MacBookPro10,1 |    1 |    1 |    |      |
| Intel HD Graphics 4000 | 0x01660003  | MacBookPro9,2  |    4 |    1 |  3 |      |
| Intel HD Graphics 4000 | 0x01660004  | MacBookPro9,1  |    1 |    1 |    |      |
| Intel HD Graphics 4000 | 0x01660005  |                |    3 |      |  3 |      |
| Intel HD Graphics 4000 | 0x01660006  | iMac13,1       |    0 |      |    |      |
| Intel HD Graphics 4000 | 0x01660007  | iMac13,2       |    0 |      |    |      |
| Intel HD Graphics 4000 | 0x01660008  | MacBookAir5,1  |    3 |    1 |  2 |      |
| Intel HD Graphics 4000 | 0x01660009  | MacBookAir5,2  |    3 |    1 |  2 |      |
| Intel HD Graphics 4000 | 0x0166000a  | Macmini6,1     |    3 |      |  2 |    1 |
| Intel HD Graphics 4000 | 0x0166000b  | Macmini6,2     |    3 |      |  2 |    1 |

##### Haswell

|           显卡型号           | platform-id |                      机型                      | 接口 | LVDS | DP | eDP | HDMI |
|------------------------------|-------------|------------------------------------------------|------|------|----|-----|------|
|                              | 0x04060000  |                                                |    3 |    1 |    |   1 |    1 |
|                              | 0x0c060000  |                                                |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 4600       | 0x04160000  |                                                |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 4400       | 0x0a160000  |                                                |    3 |    1 |    |   1 |    1 |
|                              | 0x0c160000  |                                                |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 5000       | 0x04260000  |                                                |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 5000       | 0x0a260000  |                                                |    3 |    1 |    |   1 |    1 |
|                              | 0x0c260000  |                                                |    3 |    1 |    |   1 |    1 |
| Intel Iris Pro Graphics 5200 | 0x0d260000  |                                                |    3 |    1 |    |   1 |    1 |
|                              | 0x0d220003  | iMac14,1</br>iMac14,4                          |    3 |    1 |  2 |     |      |
| Intel HD Graphics 4600       | 0x04120004  |                                                |      |      |    |     |      |
| Intel HD Graphics 5000       | 0x0a260005  |                                                |    3 |    1 |  2 |     |      |
| Intel HD Graphics 5000       | 0x0a260006  | MacBookAir6,1</br>MacBookAir6,2</br>Macmini7,1 |    3 |    1 |  2 |     |      |
| Intel Iris Pro Graphics 5200 | 0x0d260007  | MacBookPro11,2</br>MacBookPro11,3              |    4 |    1 |  2 |     |    1 |
| Intel Iris Graphics 5100     | 0x0a2e0008  | MacBookPro11,1                                 |    3 |    1 |  2 |     |      |
| Intel HD Graphics 4600       | 0x0412000b  | iMac15,1                                       |    0 |      |    |     |      |

##### Broadwell

|           显卡型号           | platform-id |                     机型                     | 接口 | LVDS | DP | eDP | HDMI |
|------------------------------|-------------|----------------------------------------------|------|------|----|-----|------|
|                              | 0x16060000  |                                              |    3 |    1 |    |   1 |    1 |
|                              | 0x160e0001  |                                              |    3 |    1 |  2 |     |      |
| Intel HD Graphics 5500       | 0x16160000  |                                              |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 5300       | 0x161e0000  |                                              |    3 |    1 |    |   1 |    1 |
| Intel Iris Pro Graphics 6200 | 0x16220000  |                                              |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 6000       | 0x16260000  |                                              |    3 |    1 |    |   1 |    1 |
| Intel Iris Graphics 6100     | 0x162b0000  |                                              |    3 |    1 |    |   1 |    1 |
| Intel HD Graphics 5300       | 0x161e0001  | MacBook8,1                                   |    3 |    1 |  2 |     |      |
|                              | 0x16060002  |                                              |    3 |    1 |  2 |     |      |
| Intel HD Graphics 5500       | 0x16160002  |                                              |    3 |    1 |  2 |     |      |
| Intel Iris Pro Graphics 6200 | 0x16220002  |                                              |    3 |    1 |  2 |     |      |
| Intel HD Graphics 6000       | 0x16260002  |                                              |    3 |    1 |  2 |     |      |
| Intel Iris Graphics 6100     | 0x162b0002  | MacBookPro12,1                               |    3 |    1 |  2 |     |      |
| Intel HD Graphics 5600       | 0x16120003  |                                              |    3 |    1 |  2 |     |      |
| Intel HD Graphics 6000       | 0x16260004  |                                              |    3 |    1 |  2 |     |      |
| Intel Iris Graphics 6100     | 0x162b0004  |                                              |    3 |    1 |  2 |     |      |
| Intel HD Graphics 6000       | 0x16260005  |                                              |    3 |    1 |  2 |     |      |
| Intel HD Graphics 6000       | 0x16260006  | iMac16,1</br>MacBookAir7,1</br>MacBookAir7,2 |    3 |    1 |  2 |     |      |
| Intel Iris Pro Graphics6200  | 0x16220007  | iMac16,2                                     |    3 |    1 |  2 |     |      |
| Intel HD Graphics 6000       | 0x16200008  |                                              |    2 |    1 |  1 |     |      |
| Intel Iris Graphics 6100     | 0x162b0008  |                                              |    3 |    1 |  2 |     |      |

##### Skylake

|           显卡型号          | platform-id |      机型      | 接口 | LVDS | DP | HDMI |
|-----------------------------|-------------|----------------|------|------|----|------|
| Intel HD Graphics 530       | 0x19120000  |                |    3 |      |  3 |      |
| Intel HD Graphics 520       | 0x19160000  |                |    3 |    1 |  2 |      |
| Intel Iris Graphics 540     | 0x19260000  |                |    3 |    1 |  2 |      |
| Intel Iris Graphics 550     | 0x19270000  |                |    3 |    1 |  2 |      |
| Intel HD Graphics 530       | 0x191b0000  | MacBookPro13,3 |    3 |    1 |  2 |      |
| Intel HD Graphics 515       | 0x191e0000  |                |    3 |    1 |  2 |      |
| Intel Iris Pro Graphics 580 | 0x193b0000  |                |    3 |    1 |  1 |    1 |
| Intel HD Graphics 530/4K*   | 0x193b0005  | MacBookPro13,1 |    4 |    1 |  3 |      |
| Intel HD Graphics 510       | 0x19020001  |                |    0 |      |    |      |
| Intel HD Graphics 530       | 0x19120001  |                |    0 |      |    |      |
|                             | 0x19170001  |                |    0 |      |    |      |
| Intel Iris Pro Graphics 580 | 0x19320001  |                |    0 |      |    |      |
| Intel HD Graphics 520       | 0x19160002  |                |    3 |    1 |  2 |      |
| Intel Iris Graphics 540     | 0x19260002  | MacBookPro13,1 |    3 |    1 |  2 |      |
| Intel HD Graphics 515       | 0x191e0003  | MacBook9,1     |    3 |    1 |  2 |      |
| Intel Iris Graphics 540     | 0x19260004  |                |    3 |    1 |  2 |      |
| Intel Iris Graphics 550     | 0x19270004  | MacBookPro13,2 |    3 |    1 |  2 |      |
| Intel HD Graphics 530       | 0x191b0006  |                |    1 |      |    |      |
| Intel Iris Graphics 540     | 0x19260007  |                |    3 |    1 |  2 |      |

##### Kaby Lake

|           显卡型号           | platform-id |             机型            | 接口 | LVDS | DP | HDMI |
|------------------------------|-------------|-----------------------------|------|------|----|------|
| Intel HD Graphics 630        | 0x59120000  | iMac18,2</br>iMac18,3       |    3 |      |  3 |      |
| Intel HD Graphics 630        | 0x59120003  | FCPX加速用                  |    0 |      |    |      |
| Intel HD Graphics 620        | 0x59160000  | MacBookPro14,2              |    3 |    1 |  2 |      |
| Intel HD Graphics 620        | 0x59160009  |                             |    3 |    1 |  2 |      |
|                              | 0x59180002  |                             |      |      |    |      |
| Intel HD Graphics 630        | 0x591b0000  | MacBookPro14,3              |    3 |    1 |  2 |      |
| Intel HD Graphics 630        | 0x591b0006  |                             |    1 |    1 |    |      |
|                              | 0x591c0005  |                             |    3 |    1 |  2 |      |
| Intel HD Graphics 615        | 0x591e0000  |                             |    3 |    1 |  2 |      |
| Intel HD Graphics 615        | 0x591e0001  | MacBook10,1                 |    3 |    1 |  2 |      |
| Intel HD Graphics 635        | 0x59230000  |                             |    3 |    1 |  2 |      |
| Intel Iris Plus Graphics 640 | 0x59260000  |                             |    3 |    1 |  2 |      |
| Intel Iris Plus Graphics 640 | 0x59260002  | MacBookPro14,1</br>iMac18,1 |    3 |    1 |  2 |      |
| Intel Iris Plus Graphics 640 | 0x59260007  |                             |    3 |    1 |  2 |      |
| Intel Iris Plus Graphics 650 | 0x59270000  |                             |    3 |    1 |  2 |      |
| Intel Iris Plus Graphics 650 | 0x59270004  | MacBookPro14,2              |    3 |    1 |  2 |      |
| Intel Iris Plus Graphics 650 | 0x59270009  |                             |    3 |    1 |  2 |      |
| Intel UHD Graphics 617       | 0x87c00000  |                             |    3 |    1 |  2 |      |
| Intel UHD Graphics 617       | 0x87c00005  | MacBookAir8,1               |    3 |    1 |  2 |      |

##### Coffee Lake

|           显卡型号           | platform-id |           机型          | 接口 | LVDS | DP | STOLEN |
|------------------------------|-------------|-------------------------|------|------|----|--------|
|                              | 0x3E000000  |                         |    3 |    1 |  2 | 57mb   |
| Intel UHD Graphics 630       | 3E910003    | FCPX加速用              |      |      |    |        |
| Intel UHD Graphics 630       | 3E920000    |                         |    3 |    1 |  2 | 57mb   |
| Intel UHD Graphics 630       | 3E920003    | FCPX加速用              |      |      |    |        |
| Intel UHD Graphics 630       | 3E920009    |                         |    1 |    1 |    | 57mb   |
| Intel UHD Graphics 630       | 3E980003    | iMac19,1</br>FCPX加速用 |      |      |    |        |
| Intel UHD Graphics 630       | 3E9B0000    |                         |    3 |    1 |  2 | 57mb   |
| Intel UHD Graphics 630       | 3E9B0006    | MacBookPro15,1          |    1 |    1 |    | 38mb   |
| Intel UHD Graphics 630       | 3E9B0007    | Macmini8,1</br>iMac19,2 |    3 |      |  3 | 57mb   |
| Intel UHD Graphics 630       | 3E9B0008    |                         |    1 |    1 |    |        |
| Intel UHD Graphics 630       | 3E9B0009    |                         |    3 |    1 |  2 | 57mb   |
| Intel UHD Graphics 630       | 3EC40003    |                         |      |      |    |        |
| Intel UHD Graphics 630       | 3EC50003    |                         |      |      |    |        |
| Intel UHD Graphics 630       | 3EC80003    |                         |      |      |    |        |
| Intel Iris Plus Graphics 655 | 3EA50000    |                         |    3 |    1 |  2 | 57mb   |
| Intel Iris Plus Graphics 655 | 3EA50004    | MacBookPro15,2          |    3 |    1 |  2 | 57mb   |
| Intel Iris Plus Graphics 655 | 3EA50005    |                         |    3 |    1 |  2 | 57mb   |
| Intel Iris Plus Graphics 655 | 3EA50009    |                         |    3 |    1 |  2 | 57mb   |
| Intel Iris Plus Graphics 655 | 3EA60005    |                         |    3 |    1 |  2 | 57mb   |

##### Ice Lake

从10.15.4开始提供支持。

|             显卡型号             | platform-id | 机型 | 接口 | LVDS | DP | STOLEN |
|----------------------------------|-------------|------|------|------|----|--------|
| Intel HD Graphics ICL SIM        | 0xFF050000  |      |    3 |    1 |  2 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A710000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A700000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A510000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A5C0000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A5D0000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A520000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A530000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A5A0000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP        | 0x8A5B0000  |      |    6 |    1 |  5 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A710001  |      |    5 |    1 |  4 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A700001  |      |    5 |    1 |  4 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A510001  |      |    3 |    1 |  2 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A5C0001  |      |    3 |    1 |  2 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A5D0001  |      |    3 |    1 |  2 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A520001  |      |    5 |    1 |  4 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A530001  |      |    5 |    1 |  4 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A5A0001  |      |    5 |    1 |  4 | 64 MB  |
| Intel HD Graphics ICL RVP BigSur | 0x8A5B0001  |      |    5 |    1 |  4 | 64 MB  |
| Intel Iris Plus Graphics         | 0x8A510002  |      |    3 |    1 |  2 | 64 MB  |
| Intel Iris Plus Graphics         | 0x8A5C0002  |      |    3 |    1 |  2 | 64 MB  |
| Intel Iris Plus Graphics         | 0x8A520002  |      |    5 |    1 |  4 | 64 MB  |
| Intel Iris Plus Graphics         | 0x8A530002  |      |    5 |    1 |  4 | 64 MB  |

#### AMD支持列表

一般而言，对于AMD，最新版本的Mac支持基于GCN的AMD CPU，但不支持AMD APU和基于Lexa内核的AMD CPU。

|      架构     | 最早支持版本 | 最后支持版本 |            备注            |
|---------------|--------------|--------------|----------------------------|
| X800          | 10.3.x       | 10.7.5       | 需要32位内核               |
| X1000         | 10.4.x       | 10.7.5       |                            |
| Terascale     | 10.4.x       | 10.13.6      |                            |
| Terascale 2/3 | 10.6.x       | 10.13.6      |                            |
| GCN 1         | 10.8.3       | 至今         |                            |
| GCN 2/3       | 10.10.x      | 至今         |                            |
| Polaris 10/20 | 10.12.1      | 至今         |                            |
| Vega 10       | 10.12.6      | 至今         |                            |
| Vega 20       | 10.14.5      | 至今         |                            |
| Navi 10       | 10.15.1      | 至今         | 需要启动参数agdpmod=pikera |
| Navi 20       | 11.2?        |              | 无可用驱动                 |

#### Nvidia支持列表

|         架构        | 最早支持版本 | 最后支持版本 |           备注          |
|---------------------|--------------|--------------|-------------------------|
| GeForce 6           | 10.2.x       | 10.7.5       | 需要32位内核和NVCAP修补 |
| GeForce 7           | 10.4.x       | 10.7.5       | 需要NVCAP修补           |
| Tesla               | 10.4.x       | 10.13.6      | 需要NVCAP修补           |
| Tesla V2            | 10.5.x       | 10.13.6      | 需要NVCAP修补           |
| Fermi               | 10.7.x       | 10.13.6      | 需要NVCAP修补           |
| Kepler（6XX/7XX）   | 10.7.x       | 至今         |                         |
| Kepler V2           | 10.8.x       | 至今         |                         |
| Maxwell（9XX）      | 10.10.x      | 10.13.6      | 需要webdriver           |
| Pascal（10XX）      | 10.12.4      | 10.13.6      | 需要webdriver           |
| Turing（20XX/16XX） |              |              | 无可用驱动              |
| Ampere（30XX）      |              |              | 无可用驱动              |

Webdriver下载链接如下。

```
https://www.nvidia.com/download/driverResults.aspx/149652/
```

### 声卡

#### AppleALC编码器支持

AppleALC支持的编码器如下。

|    生产商     |           型号           |                                                         Revision和layout                                                         | 最早支持版本 | 最后支持版本 |
|---------------|--------------------------|----------------------------------------------------------------------------------------------------------------------------------|--------------|--------------|
| AnalogDevices | AD1984                   | 0x100400, layout 11                                                                                                              | 10.9         | —            |
| AnalogDevices | AD1984A                  | 0x100400, layout 11, 13, 44                                                                                                      | 10.9         | —            |
| AnalogDevices | AD1988A                  | layout 12                                                                                                                        | 10.9         | —            |
| AnalogDevices | AD1988B                  | layout 5, 7, 12                                                                                                                  | 10.9         | —            |
| AnalogDevices | AD2000B                  | layout 5, 7                                                                                                                      | 10.9         | —            |
| Creative      | CA0132                   | 0x100918 layout 0, 1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 99                                                                        | 10.9         | —            |
| CirrusLogic   | CS4210                   | 0x100101 layout 13                                                                                                               | 10.9         | —            |
| CirrusLogic   | CS4213                   | 0x100100 layout 28                                                                                                               | 10.9         | —            |
| Conexant      | CX8050                   | layout 3, 13                                                                                                                     | 10.12        | —            |
| Conexant      | CX8070/CX11880           | layout 15                                                                                                                        | 10.9         | —            |
| Conexant      | CX8150                   | layout 21, 22                                                                                                                    | 10.9         | —            |
| Conexant      | CX8200                   | layout 3, 15, 21, 23, 80                                                                                                         | 10.12        | —            |
| Conexant      | CX8400                   | layout 12                                                                                                                        | 10.9         | —            |
| Conexant      | CX20561                  | 0x100000, layout 11                                                                                                              | 10.9         | —            |
| Conexant      | CX20583                  | layout 3                                                                                                                         | 10.9         | —            |
| Conexant      | CX20585                  | layout 3, 13                                                                                                                     | 10.9         | —            |
| Conexant      | CX20588                  | layout 3                                                                                                                         | 10.9         | —            |
| Conexant      | CX20590                  | 0x100000, 0x100002, 0x100003, layout 3, 12, 13, 14, 28                                                                           | 10.9         | —            |
| Conexant      | CX20632                  | layout 20, 23, 28                                                                                                                | 10.9         | —            |
| Conexant      | CX20641                  | layout 11, 13                                                                                                                    | 10.9         | —            |
| Conexant      | CX20642                  | layout 11, 13                                                                                                                    | 10.9         | —            |
| Conexant      | CX20722                  | layout 3                                                                                                                         | 10.12        | —            |
| Conexant      | CX20724                  | layout 3, 13                                                                                                                     | 10.9         | —            |
| Conexant      | CX20751/CX20752          | layout 3, 21, 28                                                                                                                 | 10.9         | —            |
| Conexant      | CX20753/CX20754          | layout 3, 14, 15, 21                                                                                                             | 10.12        | —            |
| Conexant      | CX20755                  | layout 3                                                                                                                         | 10.9         | —            |
| Conexant      | CX20756                  | layout 3, 13                                                                                                                     | 10.9         | —            |
| Conexant      | CX20757                  | layout 3, 28                                                                                                                     | 10.9         | —            |
| IDT           | IDT92HD66C3/65           | layout 3                                                                                                                         | 10.9         | —            |
| IDT           | IDT92HD71B7X             | layout 3                                                                                                                         | 10.9         | —            |
| IDT           | IDT92HD73C1X5            | layout 19, 21                                                                                                                    | 10.9         | —            |
| IDT           | IDT92HD73E1X5            | layout 15                                                                                                                        | 10.9         | —            |
| IDT           | IDT92HD75B2X5            | layout 3                                                                                                                         | 10.9         | —            |
| IDT           | IDT92HD75B3X5            | layout 3, 11                                                                                                                     | 10.9         | —            |
| IDT           | IDT92HD99BXX             | layout 3                                                                                                                         | 10.9         | —            |
| IDT           | IDT92HD87B1              | layout 3                                                                                                                         | 10.9         | —            |
| IDT           | IDT92HD81B1C5            | layout 3, 11                                                                                                                     | 10.9         | —            |
| IDT           | IDT92HD81B1X5            | layout 3, 11, 12, 20, 21, 28                                                                                                     | 10.9         | —            |
| IDT           | IDT92HD87B1              | layout 3                                                                                                                         | 10.9         | —            |
| IDT           | IDT92HD87B1/3            | layout 12, 13                                                                                                                    | 10.9         | —            |
| IDT           | IDT92HD87B2/4            | layout 13                                                                                                                        | 10.9         | —            |
| IDT           | IDT92HD90BXX             | layout 3, 12                                                                                                                     | 10.9         | —            |
| IDT           | IDT92HD91BXX             | 0x100102, 0x100303 layout 3, 12, 13, 33, 84                                                                                      | 10.9         | —            |
| IDT           | IDT92HD93BXX             | 0x100203, layout 12                                                                                                              | 10.9         | —            |
| IDT           | IDT92HD95                | layout 11, 12                                                                                                                        | 10.9         | —            |
| IDT           | IDT92HD99BXX             | layout 3                                                                                                              | 10.9         | —            |
| Realtek       | ALC215                   | layout 18                                                                                                                        | 10.9         | -            |
| Realtek       | ALC221                   | layout 11, 15, 88                                                                                                                | 10.8         | —            |
| Realtek       | ALC222                   | layout 11                                                                                                                        | 10.8         | -            |
| Realtek       | ALC225/ALC3253           | layout 28, 30, 33                                                                                                                | 10.9         | —            |
| Realtek       | ALC230                   | layout 13, 20                                                                                                                    | 10.9         | —            |
| Realtek       | ALC233/ALC3236           | layout 3, 4, 5, 13, 21, 27, 28, 29, 32, 33                                                                                       | 10.9         | —            |
| Realtek       | ALC235                   | layout 3, 11, 12, 14, 15, 16, 17, 21, 22, 24, 28, 35, 37, 99                                                                     | 10.9         | —            |
| Realtek       | ALC236                   | 0x100001, 0x100002 layout 3, 11, 12, 13, 14, 15, 16, 18, 54, 99                                                                  | 10.9         | —            |
| Realtek       | ALC245                   | layout 11, 12, 13                                                                                                                | 10.9         | -            |
| Realtek       | ALC255/ALC3234           | layout 3, 11, 13, 15, 17, 18, 20, 21, 27, 28, 29, 30, 31, 66, 71, 86, 99, 100                                                    | 10.9         | —            |
| Realtek       | ALC256/ALC3246           | layout 5, 11, 13, 14, 16, 17, 19, 21, 22, 23, 28, 56, 57, 66, 67, 69, 76, 97                                                     | 10.9         | —            |
| Realtek       | ALC257                   | layout 11, 18, 86, 99, 100                                                                                                       | 10.9         | —            |
| Realtek       | ALC260                   | layout 11, 12                                                                                                                    | 10.9         | —            |
| Realtek       | ALC262                   | 0x100202 layout 7, 11, 12, 13, 28, 66                                                                                            | 10.9         | —            |
| Realtek       | ALC268                   | layout 3                                                                                                                         | 10.9         | —            |
| Realtek       | ALC269/ALC271X           | 0x100004, 0x100100, 0x100202, 0x100203 layout 1-24, 27-33, 35, 40, 44, 45, 47, 55, 58, 66, 76, 77, 88, 91, 93, 99, 100, 127, 188 | 10.8         | —            |
| Realtek       | ALC270                   | 0x100100, layout 3, 4, 21, 27, 28                                                                                                | 10.9         | —            |
| Realtek       | ALC272                   | 0x100001, layout 3, 11, 12, 18, 21                                                                                               | 10.9         | —            |
| Realtek       | ALC274                   | 0x100004, layout 21                                                                                                              | 10.9         | —            |
| Realtek       | ALC275                   | 0x100005, 0x100008, layout 3, 13, 28                                                                                             | 10.9         | —            |
| Realtek       | ALC280                   | layout 3, 4, 11, 13, 15, 16, 17, 21                                                                                              | 10.9         | —            |
| Realtek       | ALC282                   | 0x100003, layout 3, 4, 13, 22, 27, 28, 29, 41, 43, 51, 76, 86, 127                                                               | 10.8         | —            |
| Realtek       | ALC283                   | layout 1, 3, 11, 13, 15, 44, 45, 66, 88                                                                                          | 10.9         | —            |
| Realtek       | ALC284                   | layout 3                                                                                                                         | 10.9         | —            |
| Realtek       | ALC285                   | layout 11, 21, 31, 52, 61, 71                                                                                                    | 10.9         | —            |
| Realtek       | ALC286                   | 0x100002, 0x100003 layout 3, 11                                                                                                  | 10.9         | —            |
| Realtek       | ALC287                   | layout 11                                                                                                                        | 10.9         | -            |
| Realtek       | ALC288                   | layout 3, 13, 23                                                                                                                 | 10.9         | —            |
| Realtek       | ALC289                   | layout 11, 23                                                                                                                    | 10.9         | —            |
| Realtek       | ALC290/ALC3241           | layout 3, 4, 10, 15, 28                                                                                                          | 10.9         | —            |
| Realtek       | ALC292                   | layout 12, 15, 18, 28, 32, 55                                                                                                    | 10.9         | —            |
| Realtek       | ALC293                   | layout 11, 28, 29                                                                                                                | 10.9         | —            |
| Realtek       | ALC294                   | layout 11, 12, 13, 21, 22, 28, 66                                                                                                | 10.9         | —            |
| Realtek       | ALC295                   | layout 1, 3, 13, 14, 15, 21, 22, 23, 24, 28, 77                                                                                  | 10.9         | —            |
| Realtek       | ALC298                   | 0x100101, 0x100103 layout 3, 11, 13, 16, 21, 22, 28, 29, 30, 32, 47, 66, 72, 99                                                  | 10.9         | —            |
| Realtek       | ALC299                   | 0x100002 layout 21, 22                                                                                                           | 10.9         | —            |
| Realtek       | ALC662                   | 0x100101, 0x100300 layout 5, 7, 11, 12, 13, 15, 16, 17, 18, 66                                                                   | 10.9         | —            |
| Realtek       | ALC663                   | 0x100001, 0x100002, layout 3, 4, 15, 28, 99                                                                                      | 10.9         | —            |
| Realtek       | ALC665                   | layout 12, 13                                                                                                                    | 10.9         | —            |
| Realtek       | ALC668                   | 0x100003, layout 3, 20, 27, 28, 29                                                                                               | 10.9         | —            |
| Realtek       | ALC670                   | 0x100002, layout 12                                                                                                              | 10.9         | —            |
| Realtek       | ALC671                   | layout 12, 15, 16, 88                                                                                                            | 10.9         | —            |
| Realtek       | ALC700                   | layout 11                                                                                                                        | 10.9         | —            |
| Realtek       | ALC882                   | 0x100101, layout 5, 7                                                                                                            | 10.9         | —            |
| Realtek       | ALC883                   | 0x100002, layout 7                                                                                                               | 10.9         | —            |
| Realtek       | ALC885                   | 0x100101, 0x100103 layout 1, 12, 15                                                                                              | 10.9         | —            |
| Realtek       | ALC887                   | 0x100202, 0x100302, layout 1, 2, 3, 5, 7, 11, 12, 13, 17, 18, 20, 33, 40, 50, 52, 53, 87, 99                                     | 10.9         | —            |
| Realtek       | ALC888/ALC1200           | 0x100101, 0x100001, 0x100202, 0x100302 layout 1, 2, 3, 4, 5, 7, 11, 27, 28, 29                                                   | 10.9         | —            |
| Realtek       | ALC889                   | 0x100004, layout 1, 2, 3, 11, 12                                                                                                 | 10.9         | —            |
| Realtek       | ALC891/ALC867            | 0x100002, layout 11, 13                                                                                                          | 10.9         | —            |
| Realtek       | ALC892                   | 0x100302, layout 1, 2, 3, 4, 5, 7, 12, 15, 16, 17, 18, 20, 22, 28, 31, 90, 92, 97, 99, 100                                       | 10.9         | —            |
| Realtek       | ALC898/ALC899            | 0x100003, layout 1, 2, 3, 5, 7, 11, 13, 65, 66, 98, 99, 101                                                                      | 10.9         | —            |
| Realtek       | ALC1150                  | 0x100001, layout 1, 2, 3, 5, 7, 11, 99                                                                                           | 10.8         | —            |
| Realtek       | ALC1220                  | 0x100003, layout 1, 2, 3, 5, 7, 11, 13, 15, 16, 21, 27, 28, 29, 30, 34, 99                                                       | 10.11        | —            |
| Realtek       | ALCS1200A                | layout 1, 2, 3, 11, 49, 50, 51                                                                                                   | 10.8         | —            |
| Realtek       | ALCS1220A                | layout 1, 2, 3, 5, 7, 11, 20, 21                                                                                                 | 10.11        | —            |
| SigmaTel      | STAC9200                 | 0x102201, layout 11                                                                                                              | 10.8         | —            |
| SigmaTel      | STAC9872AK               | 0x100201, layout 12                                                                                                              | 10.8         | —            |
| VIA           | VT1705                   | 0x100000, layout 21                                                                                                              | 10.9         | —            |
| VIA           | VT1802                   | 0x100000, layout 3, 33, 65                                                                                                       | 10.9         | —            |
| VIA           | VT2020/VT2021            | 0x100100, layout 5, 7, 9, 13                                                                                                         | 10.9         | —            |
| AMD           | Radeon 290/290X          |                                                                                                                                  | 10.11        | —            |
| AMD           | Radeon R9 Fury/R9 Fury X |                                                                                                                                  | 10.11        | —            |
| AMD           | Vega-M                   |                                                                                                                                  | 10.11        | —            |
| AMDZEN        | Controller 0x1457        |                                                                                                                                  |              | —            |
| AMDZEN        | Controller 0x1487        |                                                                                                                                  |              | —            |
| AMDZEN        | Controller 0x15E3        |                                                                                                                                  |              | —            |
| Intel         | HD4600                   |                                                                                                                                  | 10.9         | —            |
| Intel         | Atom Z36xxx/Z37xxx       |                                                                                                                                  | 10.9         | —            |
| Intel         | Z97 controller           |                                                                                                                                  | 10.9         | —            |
| Intel         | X99 controller 0x8D20    |                                                                                                                                  | 10.9         | —            |
| Intel         | X99 controller 0x8D21    |                                                                                                                                  | 10.9         | —            |
| Intel         | WhiskeyLake              |                                                                                                                                  | 10.12        | —            |
| Intel         | 200 Series Mobile        |                                                                                                                                  | 10.12        | —            |
| Intel         | 200 Series               |                                                                                                                                  | 10.12        | —            |
| Intel         | 300 Series               |                                                                                                                                  | 10.12        | —            |
| Nvidia        | GK208                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GM200                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GM204                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GM206                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GP102                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GP104                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GP106                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GP107                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GP108                    |                                                                                                                                  | 10.13.4      | —            |
| Nvidia        | GTX860M                  |                                                                                                                                  | 10.13        | —            |

### 其它硬件

指纹识别、Windows Hello人脸识别、英特尔智能声音技术将无法工作。

## SMBIOS列表

|       型号      |                 描述                 |    发布日期   |  最低macOS版本   | 最高macOS版本 |           备注           |
|-----------------|--------------------------------------|---------------|------------------|---------------|--------------------------|
| **MacBook Pro** |                                      |               |                  |               |                          |
|                 | MacBook Pro 13寸 2020年 M1           | 2020年11月    | 11.0.1           | 至今          | Apple M1芯片             |
|                 | MacBook Pro 13寸 2020年初 4端口      | 2020年05月    | 10.15.4          | 至今          |                          |
|                 | MacBook Pro 13寸 2020年初 2端口      | 2020年05月    | 10.15.4          | 至今          |                          |
|                 | MacBook Pro 16寸 2019年末            | 2019年11月    | 10.15.2          | 至今          |                          |
|                 | MacBook Pro 13寸 2019年中期 2端口    | 2019年7月     | 10.14.6          | 至今          |                          |
|                 | MacBook Pro 15寸 2019年中期          | 2019年5月     | 10.14.6          | 至今          |                          |
|                 | MacBook Pro 13寸 2019年中期 4端口    | 2019年5月     | 10.14.6          | 至今          |                          |
|                 | MacBook Pro 15寸 有触控条 2018年中期 | 2018年6月     | 10.13.6          | 至今          | 最低要求 10.13.6 17G2208 |
|                 | MacBook Pro 13寸 有触控条 2018年中期 | 2018年6月     | 10.13.6          | 至今          | 最低要求 10.13.6 17G2208 |
|                 | MacBook Pro 15寸 有触控条 2017年     | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | MacBook Pro 13寸 有触控条 2017年     | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | MacBook Pro 13寸 无触控条 2017年     | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | MacBook Pro 15寸 2016年末            | 2016年11月    | 10.12.6          | 至今          |                          |
|                 | MacBook Pro 13寸 2016年末 有触控条   | 2016年11月    | 10.12.6          | 至今          |                          |
|                 | MacBook Pro 13寸 2016年末 无触控条   | 2016年10月    | 10.12.6          | 至今          |                          |
|                 | MacBook Pro 15寸 2015年中            | 2015年5月     | 10.10.5          | 至今          |                          |
|                 | MacBook Pro 13寸 2015年初            | 2015年3月     | 10.10.5          | 至今          |                          |
|                 | MacBook Pro 13/15寸 2014年中         | 2014年7月     | 10.9.5           | 至今          |                          |
|                 | MacBook Pro 13/15寸 2013年末         | 2013年10月    | 10.9.5           | 至今          |                          |
|                 | MacBook Pro 13/15寸 2013年初         | 2013年2月     | 10.8.5           | 至今          |                          |
|                 | MacBook Pro 13寸 Retina 2012年末     | 2012年10月    | 10.8.5           | 10.15.7       |                          |
|                 | MacBook Pro 13/15寸 2012年中         | 2012年6月     | 10.7.5           | 10.15.7       |                          |
|                 | MacBook Pro 13/15/17寸 2011年末      | 2011年10月    | 10.7.5           | 10.13.6       |                          |
|                 | MacBook Pro 13/15/17寸 2011年初      | 2011年2月     | 10.6.6           | 10.13.6       |                          |
|                 | MacBook Pro 13寸 2010年中            | 2010年4月     | 10.7.5           | 10.13.6       | 出厂附送的10.6.3也支持   |
|                 | MacBook Pro 15/17寸 2010年中         | 2010年4月     | 10.6.3           | 10.13.6       |                          |
|                 | MacBook Pro 13/15/17寸 2009年中      | 2009年6月     | 10.5.7           | 10.11.6       |                          |
|                 | MacBook Pro 17寸 2009年初            | 2009年1月     | 10.5.6           | 10.11.6       |                          |
|                 | MacBook Pro 15/17寸 2008年初/末      | 2008年10月    | 10.5.6           | 10.11.6       |                          |
|                 | MacBook Pro 15/17寸 2.4/2.2 GHz      | 2007年6月     | 10.4.10          | 10.7.5        |                          |
|                 | MacBook Pro 15/17寸 Core 2 Duo       | 2006年10月    | 10.4.10          | 10.7.5        |                          |
|                 | MacBook Pro 15/17寸 镜面             | 2006年2/4月   | 10.4.10          | 10.7.5        |                          |
| **MacBook Air** |                                      |               |                  |               |                          |
|                 | MacBook Air 13寸 2020年 M1           | 2020年11月    | 11.0.1           | 至今          | Apple M1芯片             |
|                 | MacBook Air 13寸 2020年初            | 2020年03月    | 10.15.3          | 至今          |                          |
|                 | MacBook Air 13寸 2019年中期          | 2019年7月9日  | 10.14.6          | 至今          |                          |
|                 | MacBook Air 13寸 2018年              | 2018年10月    | 10.14.6          | 至今          |                          |
|                 | MacBook Air 13寸 2017年              | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | MacBook Air 11/13寸 2015年初         | 2015年3月     | 10.10.5          | 至今          |                          |
|                 | MacBook Air 11/13寸 2014年初         | 2014年4月     | 10.9.5           | 至今          |                          |
|                 | MacBook Air 11/13寸 2013年中         | 2013年6月     | 10.8.5           | 至今          |                          |
|                 | MacBook Air 11/13寸 2012年中         | 2012年6月     | 10.7.5           | 10.15.7       |                          |
|                 | MacBook Air 11/13寸 2011年中         | 2011年7月     | 10.7.5           | 10.13.6       |                          |
|                 | MacBook Air 11/13寸 2010年末         | 2010年10月    | 10.6.4           | 10.13.6       |                          |
|                 | MacBook Air 13寸 2009年中            | 2009年6月     | 10.5.6           | 10.11.6       |                          |
|                 | MacBook Air 13寸 2008年末            | 2008年11月    | 10.5.6           | 10.11.6       |                          |
|                 | MacBook Air 13寸 2008年初            | 2008年11月    | 10.5.6           | 10.7.5        |                          |
| **MacBook**     |                                      |               |                  |               |                          |
|                 | MacBook 12寸 2017年                  | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | MacBook 12寸 2016初                  | 2016年4月     | 10.11.6          | 至今          |                          |
|                 | MacBook 12寸 2015初                  | 2015年4月     | 10.10.5          | 至今          |                          |
|                 | MacBook 13寸 2010中                  | 2010年5月     | 10.6.3           | 10.13.6       |                          |
|                 | MacBook 13寸 2009末                  | 2009年10月    | 10.6.3           | 10.13.6       |                          |
|                 | MacBook 13寸 2009初/中               | 2009年1月     | 10.5.6           | 10.11.6       |                          |
|                 | MacBook 13寸 2008末铝合金外壳        | 2008年10月    | 10.5.6           | 10.11.6       |                          |
|                 | MacBook 13寸 2008末 (非铝合金外壳)   | 2008年10月    | 10.5.6           | 10.7.5        | 10.7.5最低要2G内存       |
|                 | MacBook 13寸 2008初                  | 2008年2月     | 10.5.6           | 10.7.5        | 10.7.5最低要2G内存       |
|                 | MacBook 13寸 2007中/末               | 2007年5/10月  | 10.5.6           | 10.7.5        | 10.6.x最低要1G内存       |
|                 | MacBook 13寸 2006年末                | 2006年11月    | 10.4.8           | 10.7.5        | 10.7.5要求2G或以上的内存 |
|                 | MacBook 13寸 2006年初                | 2006年5月     | 10.4.8           | 10.7.5        | 10.6.x要求1G或以上的内存 |
| **iMac**        |                                      |               |                  |               |                          |
|                 | iMac 27寸 5K 2020年                  | 2020年8月     | 10.15.6(19G2005) | 至今          | T2芯片                   |
|                 | iMac 21.5寸 4K 2019年                | 2020年8月     | 10.14.6          | 至今          | 对比2019年款只更新了硬盘 |
|                 | iMac 27寸 5K 2019年                  | 2019年3月     | 10.14.6          | 至今          |                          |
|                 | iMac 21.5寸 4K 2019年                | 2019年3月     | 10.14.6          | 至今          |                          |
|                 | iMac Pro 27寸 5K 2017年              | 2017年12月    | 10.13.6          | 至今          |                          |
|                 | iMac 27寸 5K 2017年                  | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | iMac 21.5寸 4K 2017年                | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | iMac 21.5寸 普通屏 2017年            | 2017年6月     | 10.12.6          | 至今          |                          |
|                 | iMac 21.5/27寸 2015年末              | 2015年10月    | 10.11.6          | 至今          |                          |
|                 | iMac 27寸 5K 2015年中                | 2015年5月     | 10.10.5          | 至今          |                          |
|                 | iMac 27寸 5K 2014年末                | 2014年10月    | 10.10.5          | 至今          |                          |
|                 | iMac 21.5寸 2014年中                 | 2014年6月     | 10.9.5           | 至今          |                          |
|                 | iMac 21.5/27寸 2013年末              | 2013年9月     | 10.8.5           | 10.15.7       |                          |
|                 | iMac 21.5/27寸 2012年末              | 2012年11/12月 | 10.8.5           | 10.15.7       |                          |
|                 | iMac 21.5寸 2011年末                 | 2011年8月     | 10.7.5           | 10.13.6       |                          |
|                 | iMac 21.5/27寸 2011年中              | 2011年5月     | 10.6.6           | 10.13.6       | 仅支持随机附送的10.6.6   |
|                 | iMac 27寸 2010年中                   | 2010年7月     | 10.6.3           | 10.13.6       |                          |
|                 | iMac 21.5寸 2010年中                 | 2010年7月     | 10.6.3           | 10.13.6       |                          |
|                 | iMac 21.5/27寸 2009年末              | 2009年10/11月 | 10.6.3           | 10.13.6       |                          |
|                 | iMac 20寸 2009年中                   | 2009年4月     | 10.5.6           | 10.11.6       |                          |
|                 | iMac 20/24寸 2009年初                | 2009年3月     | 10.5.6           | 10.11.6       |                          |
|                 | iMac 20/24寸 2008年初                | 2008年4月     | 10.5.6           | 10.11.6       |                          |
|                 | iMac 20/24寸 2007年中                | 2007年8月     | 10.4.10          | 10.11.6       |                          |
|                 | iMac 17/20/24寸 2006年末             | 2006年9月     | 10.4.7           | 10.7.5        |                          |
|                 | iMac 17 2006年初/中                  | 2006年1/7月   | 10.4.6           | 10.7.5        |                          |
| **Mac Mini**    |                                      |               |                  |               |                          |
|                 | Mac Mini 2020年 M1                   | 2020年11月    | 11.0.1           | 至今          | Apple M1芯片             |
|                 | Mac Mini 2018年末                    | 2020年03月    | 10.14.6          | 至今          | 只升级了硬盘             |
|                 | Mac Mini 2018年末                    | 2018年10月    | 10.14.6          | 至今          |                          |
|                 | Mac Mini 2014年末                    | 2014年10月    | 10.10.5          | 至今          |                          |
|                 | Mac Mini/Server 2012年末             | 2012年10月    | 10.8.5           | 10.15.7       |                          |
|                 | Mac Mini/Server 2011年中             | 2011年7月     | 10.7.5           | 10.13.6       |                          |
|                 | Mac Mini 2010年中                    | 2010年6月     | 10.6.3           | 10.13.6       |                          |
|                 | Mac Mini 2009年末                    | 2009年10月    | 10.6.3           | 10.11.6       |                          |
|                 | Mac Mini 2009年初                    | 2009年3月     | 10.5.6           | 10.11.6       |                          |
|                 | Mac Mini 2007年中                    | 2007年8月     | 10.4.10          | 10.7.5        |                          |
|                 | Mac Mini 2006年末                    | 2006年9月     | 10.4.7           | 10.7.5        |                          |
|                 | Mac Mini 2006年初                    | 2006年3月     | 10.4.5           | 10.7.5        |                          |
| **Mac Pro**     |                                      |               |                  |               |                          |
|                 | Mac Pro 2019年末                     | 2019年12月    | 10.15.2          | 至今          |                          |
|                 | Mac Pro 2013年末                     | 2013年12月    | 10.9.5           | 至今          |                          |
|                 | Mac Pro 2012年中                     | 2012年6月     | 10.7.5           | 10.14.6       |                          |
|                 | Mac Pro 2010年中                     | 2010年8月     | 10.6.4           | 10.14.6       |                          |
|                 | Mac Pro 2009年初                     | 2009年3月     | 10.5.6           | 10.11.6       |                          |
|                 | Mac Pro 2008年初                     | 2008年1月     | 10.5.6           | 10.11.6       |                          |
|                 | Mac Pro 2006年中                     | 2006年8月     | 10.4.7           | 10.7.5        |                          |
| **Xserve**      |                                      |               |                  |               |                          |
|                 | Xserve 2009年初                      | 2009年4月     | 10.5.6           | 10.11.6       |                          |
|                 | Xserve 2008年初                      | 2008年1月     | 10.5.1           | 10.7.5        |                          |
|                 | Xserve 2006年末                      | 2006年11月    | 10.4.8           | 10.7.5        |                          |

## 重要事件

|    时间    |                                                                                                                                                   事件                                                                                                                                                  |
|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WWDC 2005  | 推出了搭载 Intel 处理器的 DTK（Dev Transition Kit），搭载了兼容 Intel 的 Mac OS X 10.4.1                                                                                                                                                                                                                |
| 2006-01-10 | 发布使用UEFI引导方式的MacBook Pro                                                                                                                                                                                                                                                                       |
| 2006-02-14 | The Guru团队发布首个Patch补丁，通过该补丁修补XNU内核即可解除引导和安装限制，在任何内置SSE-2指令集的Intel处理器上运行Mac OS X 10.4.4（10.4.4-10.4.7可通过修补内核安装，但从10.4.8开始，苹果开始更广泛地使用SSE-3指令集，意味仅仅通过修补XNU 内核已经无法再兼容只支持SSE-2指令集的处理器，如早期的奔腾4） |
| 2007       | BrazilMac发布了对Leopard的通用补丁（基于补丁制作的Mac OS X发行版开始出现，如iATKOS、KALYWAY和iPC）                                                                                                                                                                                                      |

## Rosetta

苹果使用过后的CPU体系结构有摩托罗拉68000系列->PowerPC系列->英特尔酷睿系列->Apple的ARM型处理器系列。Rosetta是苹果在CPU架构过渡时推出的编译器，允许新的平台来模拟以前的平台，以正常运行应用程序。

Rosetta用于从PowerPC到Intel的过渡，可用于10.4.4–10.6.8，不适用于Mac OS 9或更早版本以及10.7或更新版本。Lion安装Rosetta的相关讨论可见以下链接。

```
https://www.insanelymac.com/forum/topic/262890-installing-rosetta-on-lion/
```

Rosetta 2用于从Intel到Apple Silicon的过渡，可用于Big Sur。

# 相关知识

## base64与ASCII

在plist的文本中，data是以base64的格式存储的，而在用Xcode等编辑器打开后，base64将被显示为十六进制ASCII码。以下示例均在终端进行。

```
// base64->ASCII
echo RXh0ZXJuYWw= | python -m base64 -d && echo

// ASCII->base64
echo -n External | base64
```

## Distros

Distributions的另一个名称，指发行版。安装时不要使用macOS发行版。

## OOB

开机即用，无需安装驱动/修补DSDT等。

## Vanilla

指未修改系统盘内容，如LE和SLE的系统。

# 资料

## 论坛和博客

```
https://blog.csdn.net/qq_27346541/article/details/103592866
https://blog.skk.moe/
http://dosdude1.com/
https://blog.daliansky.net/
https://osxlatitude.com/forums/
https://www.tonymacx86.com/forums/
https://www.macos86.it/
https://www.hackintosh-forum.de/
https://www.reddit.com/r/hackintosh/
https://www.insanelymac.com/forum/
https://blog.neroxps.cn/
https://www.hackintosh-montreal.com/
https://www.applelife.ru/
https://www.misonsky.cn/
https://www.bugprogrammer.me/
https://fangf.cc/
https://blog.xjn819.com/
http://bbs.pcbeta.com/
https://www.itpwd.com/
https://www.penghubingzhou.cn/#blog
https://blog.zuiyu1818.cn/
https://change-y.github.io/
https://www.macrumors.com/
https://www.kancloud.cn/chandler/mac_os/480611
https://www.firewolf.science/
https://www.osx86.net/
http://yqp7js.coding-pages.com/
https://xstar-dev.github.io/
https://heipg.cn/
https://www.reddit.com/r/hackintosh/
https://pikeralpha.wordpress.com/
```

## AMD安装黑苹果

```
https://github.com/AMD-OSX/AMD_Vanilla
https://vanilla.amd-osx.com/
https://kb.hackintoshisfun.ml/clover/
https://kb.amd-osx.com/guides/HS/
https://blog.amd-osx.com/
https://dortania.github.io/OpenCore-Install-Guide/macos-limits.html#cpu-support
```

## 硬件选择

```
https://dortania.github.io/GPU-Buyers-Guide/
https://dortania.github.io/Wireless-Buyers-Guide/
https://dortania.github.io/Anti-Hackintosh-Buyers-Guide/
https://4pda.ru/forum/index.php?showtopic=72333
https://wiki.osx86project.org/wiki/index.php/Main_Page
http://www.macbreaker.com/2012/01/is-your-computer-hackintosh-compatible.html
https://www.tonymacx86.com/buyersguide/archive/kaby-lake-200-series/
https://hackintoshmumbai.com/hardware-compatibility-for-mac-osx-mavericks/
https://hackintoshenglish.fandom.com/wiki/CPU_Compatibility
https://blog.daliansky.net/Mojave-Hardware-Support-List.html
```

## 旧版软件下载

```
https://support.apple.com/downloads
http://www.powerpcsoftware.com/
http://www.macos9lives.com/
http://macintoshgarden.org/
http://www.umich.edu/~archive/
https://www.macintoshrepository.org/
http://vintagemacmuseum.com/resources/mac-software/
```

## 其它

```
https://lynx.pink/big-sur-unsupported-macs-tldr/


【黑苹果安装辅助软件】
http://www.ccmacos.cn/#



【可以从mac的磁盘工具中看到磁盘对应的系统版本】

CPU：
Intel Core 2 Duo T5750
2000MHz
指令集：x86 x86-64 MMX SSE SSE2 SSE3 SSSE3

# Convert to GPT
# Due to an odd bug with BOOTICE and DuetPkg, MBR disks will fail to boot
 
根据以下指南制作OC引导盘：
在你的 OpenCore 构建的文件夹中，打开 Utilities/LegacyBoot。你会找到一个名为 BootInstall_ARCH.tool 的文件。这是用来在你需要的驱动器上安装 DuetPkg 的工具。
图片: https://uploader.shimo.im/f/CVpgwecuoIB0eqld.png
现在配合 sudo运行此命令（否则此工具很可能无法使用）：
# 如果你的 CPU 是 32 位的，请将 X64 替换为 IA32
sudo ~/Downloads/OpenCore/Utilities/legacyBoot/BootInstall_X64.tool
图片: https://uploader.shimo.im/f/yEaPFW73ViPdBZiI.png
这将会给你一个可用磁盘的列表，选择你需要的，你将会被提示要写入一个新的主引导记录。按 [y] 以选择“确定”，然后你就完成了。
图片: https://uploader.shimo.im/f/1TQqpi84cdV7qGe6.png
图片: https://uploader.shimo.im/f/oRWO95dbCutiiskH.png
这将会为你提供一个带有 bootia32 或 bootx64 文件的 EFI 分区 

这个不可以用于Clover




X64 Exception Error:
【Goldfish64 pointed out that it was my mistake - I accidentally used the wrong PartitionDxe, I needed PartitionDxeLegacy of course, but dragged in the wrong file. Sorry for the false alarm, and thanks a lot for the bootloader!】
https://github.com/acidanthera/bugtracker/issues/1247

Drivers中的驱动不适合，更换就可以了


启动后键盘无法使用：
1、【不行】
This is due to either a few things
Incompatible keyboard driver:
Disable PollAppleHotKeys and enable KeySupport, then remove OpenUsbKbDxe 
(opens new window)
from your config.plist -> UEFI -> Drivers
If the above doesn't work, reverse: disable KeySupport, then add OpenUsbKbDxe 
(opens new window)
to your config.plist -> UEFI -> Drivers
Missing PS2 keyboard driver(Ignore if using a USB keyboard):
While most firmwares will include it by default, some laptops and older PCs may still need Ps2KeyboardDxe.efi 
(opens new window)
to function correctly. Remember to add this to your config.plist as well

2、【不行】
https://www.reddit.com/r/hackintosh/comments/hdlb6i/open_core_boot_menu_keyboard_not_working/
 
暂时解决方法：设置倒计时


OCB: boot LoadImage failed
1、【不行】
https://www.tonymacx86.com/threads/ocb-boot-loadimage-failed-not-found.297803/
I solved this issue by changing the ScanPolicy parameter :

- when ScanPolicy = 0 -> OC boot failed -> OCB: LoadImage failed - Not Found
- changing ScanPolicy to 0xF0103 (983299) allowed me to boot
(have also needed SetupVirtualMap = yes for not getting stucked on the apple logo after picker)

It is not clear why I have this issue with ScanPolicy = 0 - will try to check if that could not be tied to my W10 dual boot setting (2 separate drives , microsoft bootloader is on a separate drive)






Clover：
查看多方式引导系统，制作传统BIOS的引导
——也可以安装Clover时，设置安装到boot0ss和Blockio，安装到ESP分区（要用GPT）


——DSDT开fix firewire，解决满屏firewire错误

对于无usb3的设备，不要放genericusbxhci
fixusbownership（DSDT不要开fix usb）


-x安全模式，卡在了appleintelpiixpata: secondary PCI IDE channel is disabled
1、【不行】
https://www.reddit.com/r/hackintosh/comments/8ksm52/install_gets_stuck_at_appleintelpiixpata_please/
https://github.com/andyvand/SuperVIAATA






变色龙(Ecoch)：
直接Mac安装就可以，注意gpt需要选择安装到esp分区

提示找不到mach_kernel：

Open your org.chameleon.Boot.plist, find the following lines and erase them, then save the file:<key>Kernel</key><string>mach_kernel</string>
Reboot, if the issue is still not fixed, do the following:
Open up org.chameleon.Boot.plist and add the following, then save the file:<key>Kernel</key><string>/System/Library/Kernels/kernel</string>




10.8及以下的系统有mach_kernel，可以直接通过ecoch启动
10.9及以上，用USB创建命令时是不会有mach_kernel的
可以提取mach_kernel并放到安装盘根目录

提取mach_kernel:
app显示包内容-Contents-SharedSupport-InstallESD.dmg-Packages-BaseSystemBinaries.pkg-mach_kernel


变色龙引导：提示ACPI不支持
Clover引导倒是没有问题


Firewire错误：
FireWire GUID错误消息问题丝毫不影响系统性能，因此我不足以对此进行深入研究。
https://www.insanelymac.com/forum/topic/288829-guide-gigabyte-z77x-ud5h-clover-uefi-installtweak-guide/
自己爬文解决，貌似是bios中关闭了csm导致，因为关闭csm保证是纯uefi启动，所以我一直是关闭的
解决方法是在driver64uefi文件夹中添加如下驱动： 图片: https://uploader.shimo.im/f/cYEOkNuCDrB1Zh9q.png FirewireDriver.efi.zip 

主要问题：
卡在了AppleUSBUHCI问题




禁用某些kexts:
https://www.tonymacx86.com/threads/creating-a-kext-disabler.48254/


clover运行后导致CMOS重置（时间发生重置，需要手动修改为正确的时间才能使用）
打开clover的config.plist的Apple RTC即可（为防止 cmos 重置和启动时出现的有关 AppleRTC 的错误打补丁）


https://www.insanelymac.com/forum/topic/320388-iobluetoothhcicontroller-missing-bluetooth-controller-transport/
卡'[IOBluetoothHCIController]...-- Missing Bluetooth Controller Transport!'：
启动参数加dart=0


卡在灰屏：
灰屏表示FakeSMC未加载
https://www.tonymacx86.com/threads/first-time-hackintosh-stuck-at-grey-screen-after-installation.186100/

显卡驱动问题，删除SLE下的相关kexts：
https://www.reddit.com/r/hackintosh/comments/1rshef/mavericks_install_problem_cant_get_to_the/



制作安装盘的另一种方法：
https://com-chris1111.github.io/clover/
https://github.com/chris1111/CloverBootloader/releases
https://www.insanelymac.com/forum/topic/286092-guide-1st-generation-intel-hd-graphics-qeci/




(1st Gen) Intel HD Graphics Kexts 10.12 L
This download is only for users who have a laptop with a 2010 Intel® Arrandale Processor with Intel® HD Graphics:
 
1st Generation Intel® Core™ Processor with Intel HD Graphics (Arrandale only)
Intel® Celeron® Processor with Intel® HD Graphics (Arrandale only)
Intel® Pentium® Processor with Intel® HD Graphics (Arrandale only)
 
Make sure the Device ID and Vendor ID match with the following:
 
Device ID: 0042 or 0046
Vendor ID: 8086
 
In here you will find my QE/CI and CI only packages for your 1st Generation Intel HD Graphics IGPU for OS X Mountain Lion, OS X Mavericks, OS X Yosemite, OS X El Capitan, macOS Sierra, and macOS High Sierra.


https://www.insanelymac.com/forum/files/file/208-1st-gen-intel-hd-graphics-kexts/

```

```





Big Sur
##### OC-little包

值得注意的：
02-GPIO补丁
19-I2C

要做的操作：
仿冒EC：本机起作用的是EC0
    ->笔记本是不可以仿冒EC的，一定要更名
02-3:ALSD
05-1:X86,PR-PR00
05-2:PNLF
05-3:SBUS
06:DMAC/MCHC/MEM2/IMEI/PMCR
07:PS2Controller有了BrightnessKey.kext用于控制亮度快捷键
12:0D6D,GPRW
18:ASUS专用更名和补丁



GFXO->IGPU是可以不要的
_DSM->XDSM也可以不要

AppleALC要配上CodecCommander才能睡眠后继续有声音
github.com/Sniki/EAPD-Codec-Commander

Clover不需要CtlnaAHCIPort，OC需要



curl提示443的解决方法：
https://github.com/hawtim/blog/issues/10

Switchhosts添加以上写的内容后打开该配置文件，还要打开backup配置文件
要开全局翻墙
弹SSL_ERROR_SYSCCALL时，打开backup又关掉backup配置文件就可以了

不要用Karbiner
不要开启Airdrop有线传输

##### OpenCore Post Install

需要注意的：
修复DRM（暂时不可用
修复电源管理-使用CPUFriend
    ->不要放，放了更慢
睡眠修复
添加GUI和启动提示音


要用NoTouchID，系统速度要快很多（尽管指南不推荐）
https://dortania.github.io/Getting-Started-With-ACPI/




Wifi还没成功

https://www.longzc.cn/index.php/archives/306

// 尝试过，配合下面教程实现，但用OpenCore引导后Wifi不能用


// 其它
https://www.reddit.com/r/hackintosh/comments/f1hpn9/ar9565_wireless_bluetooth/
https://github.com/tj320442/AR9565-DW1707-macOS-10.15-Catalina
https://gitee.com/i320442/AR9565_DW1707/tree/master
```





```
// 旧版kext
https://github.com/khronokernel/Legacy-Kexts


// 问题库
https://github.com/CloverHackyColor/CloverBootloader/issues
http://i.pcbeta.com/home.php?mod=space&uid=233039&do=thread&view=me&type=reply&order=dateline&from=space


// 现代Mac上原始Macintosh Finder的逐像素克隆
https://classicmacfinder.com/







Continuity-Activation-Tool只能用在Broadcom卡
支持10.10/11/12

【Snow Leopard是Mac OS X的唯一现代版本，无需借助真正的Mac，现有的Hackintosh或Mac OS X虚拟机就可以安装在PC上】
https://tonymacx86.blogspot.com/2010/04/iboot-multibeast-install-mac-os-x-on.html
【xMove + MultiBeast：在任何受支持的基于Intel Core 2或Core i的PC上安装OS X 10.7 Lion】
https://tonymacx86.blogspot.com/2011/07/xmove-multibeast-install-os-x-107-lion.html?showComment=1311839903973#c5892967010065962701
如何在Ivy Bridge Hackintosh上安装Mac OS X Snow Leopard（实验性）
http://www.macbreaker.com/2012/10/snow-leopard-ivy-bridge-hackintosh.html

// ACPI规范
https://uefi.org/specifications
https://uefi.org/sites/default/files/resources/ACPI_5.pdf
https://uefi.org/sites/default/files/resources/ACPI_4.pdf

// ACPI编译错误
http://imacos.top/2019/08/23/1709/


// 镜像和资料下载
【可以通过这个获取10.10-12】
https://github.com/crazybirdy/MBR-Manual-Method
http://macintoshgarden.org/apps/mac-osx-mac-os-10-ppc
https://dortania.github.io/OpenCore-Install-Guide/installer-guide/mac-install.html#downloading-macos-legacy-os
https://www.reddit.com/r/hackintosh/comments/j0d6t0/one_box_every_x86_install_hp_dc_7900/



// USB
http://bbs.pcbeta.com/viewthread-1646768-1-1.html
http://bbs.pcbeta.com/viewthread-1651615-1-1.html
https://www.tonymacx86.com/threads/guide-10-11-usb-changes-and-solutions.173616/

// MBR
【MBR patch-OSinstall for 10.6-10.11】
https://www.osx86.net/files/file/1208-osinstallmbrosinstallmpkg-106x/


// Olarila
https://www.insanelymac.com/forum/topic/323052-guide-el-capitan-sierra-high-sierra-mojave-catalina-on-intel-5-6-7-8-9-chipset-series-nehalem-sandybridge-ivybridge-haswell-broadwell/
https://www.olarila.com/topic/6278-new-vanilla-olarila-images/

// Calculating your Bus Ratio
https://www.insanelymac.com/forum/topic/240542-guide-getting-your-busratio/

// 配置文件检查
https://opencore.slowgeek.com/

// Clover引导问题
http://vlambda.com/wz_7ilcImwxVbO.html
https://hackintosh.kirainmoe.com/an-zhuang-zhong/an-zhuang-guo-cheng-zhong-de-yi-nan-jie-da#an-zhuang-wan-cheng-hou-zhong-qi-fa-sheng-nei-he-panic-lie-chu-yi-dui-kext-bing-ti-shi-please-go-to-httppanicapplecom
https://blog.csdn.net/JoeBlackzqq/article/details/29359827
http://bbs.pcbeta.com/viewthread-1596471-1-1.html

// kexts介绍与选择
https://macx.top/1972.html
https://zhuanlan.zhihu.com/p/94680998
http://blog.sina.com.cn/s/blog_4ddc30040102yzho.html


// 教程
https://dortania.github.io/OpenCore-Install-Guide/
https://dortania.github.io/OpenCore-Post-Install/
https://dortania.github.io/Getting-Started-With-ACPI/
https://hackintosh-multiboot.gitbook.io/hackintosh-multiboot/
https://midi1996.github.io/hackintosh-internet-install-gitbook/
https://oc.skk.moe/
https://kirainmoe.com/blog/post/opencore-migration-experience/
https://gist.github.com/ViKingIX/1ce8945df966dfce91d30cff652a5968
http://www.contrib.andrew.cmu.edu/~somlo/OSXKVM/OLD/index-20131109.html
https://github.com/Mother-FKR/RazerBlade15-Base-Model-Hackintosh_macOS_Big_Sur
https://www.insanelymac.com/forum/topic/280756-guide-the-all-in-one-guide-to-vanilla-os-x-including-chameleon-dsdt-for-beginners-updated-for-yosemite/
https://wiki.osx86project.org/wiki/index.php/Installation_Guides
https://www.tonymacx86.com/threads/im-new-to-everything-where-do-i-start.104542/
【为OS X Yosemite创建Penboot】https://www.insanelymac.com/forum/topic/301987-criar-penboot-para-os-x-yosemite/


// 超频：
https://zhuanlan.zhihu.com/p/49183461
https://www.tonymacx86.com/threads/skylake-hwp-enable.214915/


// 旧版

https://github.com/khronokernel/trashOS
https://www.insanelymac.com/forum/topic/298027-guide-aio-guides-for-hackintosh/

硬盘安装：【用安装盘制作安装USB的方法是可以直接搬到硬盘上的！
分一块区域做安装盘，将镜像恢复过去就可以启动了！！！！！
可以摆脱USB，也就是USB3！！！！！】

【OS X中的Busratio = xx标志仅适用于无法正确启动的多核Core i系列处理器】
https://www.insanelymac.com/forum/topic/240542-guide-getting-your-busratio/





// kexts
https://github.com/corpnewt/Lilu-and-Friends
https://github.com/corpnewt/KextExtractor
https://github.com/khronokernel/Legacy-Kexts
【Disabler.EFINVRAM.zip】
https://www.insanelymac.com/forum/topic/322389-cant-boot-to-snow-leopard-using-clover/
【IOATAFamily.kext】
https://www.phpfans.net/ask/MTAzNzYzMg.html
http://bbs.pcbeta.com/viewthread.php?tid=595342&from=favorites
【AppleACPIPS2NUB.kext】
http://mac.8miu.com/thread-791955-1-1.html
https://www.insanelymac.com/forum/topic/114578-appleacpips2nub-for-leopard-only/

// OC配置文件比较
https://www.scootersoftware.com/
https://github.com/corpnewt/OCConfigCompare

// DSDT Editor
http://www.macbreaker.com/2012/03/make-dsdt-with-dsdt-editor.html

// iasl编译器
https://bitbucket.org/RehabMan/acpica/downloads/

// DSDT
https://www.insanelymac.com/forum/topic/223205-dsdt-editor-and-patcher/
https://blog.csdn.net/jiangwei0512/article/details/70990031



// SMBIOS ID表
https://heipg.cn/tutorial/smbios-id-and-details.html
https://heipg.cn/drivers/virtualsmc-1-1-4.html



// 资源
主机名：repo1.macintoshgarden.org
用户名：macgarden
密码：publicdl

// USB Port Limit Patches
https://hackintosher.com/forums/thread/list-of-hackintosh-usb-port-limit-patches-10-15-updated.467/


// 鼠标键盘解锁的界面（原来这个界面是让我连接蓝牙鼠标和键盘？ ）
https://www.reddit.com/r/hackintosh/comments/3v81hb/el_capitan_install_demanding_bluetooth/

// 内核分析
https://objective-see.com/blog/blog_0x27.html
https://tinylab.gitbooks.io/lad-book/content/zh-cn/kernel/core/exception.html

// 系统安装包下载
https://www.newlearner.site/2019/07/22/full-size-macos.html
https://mac.osystem.club/47.html
https://www.dualbootpc.com/software/system/macOS/?cid=official-gixxerpc.com

// iboot
https://tonymacx86.blogspot.com/2010/04/iboot-multibeast-install-mac-os-x-on.html
https://www.tonymacx86.com/resources/iboot-3-3-0.38/
https://www.tonymacx86.com/threads/simplest-mac-os-x-installation-guide.60255/
https://howtohackintosh.wordpress.com/guides/ibootmultibeastinstallmacosxonanyintelbased-pc/
```

acpi6转acpi5/4:

```

ACPI：

原：

    Scope (_SB.PCI0)
    {
        Device (I2C1)
        {
            Name (LINK, "\\_SB.PCI0.I2C1")
            Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current
            {
                Return (GETD (SB11))
            }

            Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0
            {
                LPD0 (SB11)
            }

            Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3
            {
                LPD3 (SB11)
            }

            If (LNotEqual (SMD1, 0x02))
            {
                Name (_HID, "INT3443")  // _HID: Hardware ID
                Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision
                {
                    Return (LHRV (SB11))
                }

                Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings
                {
                    Return (LCRS (SMD1, SB01, SIR1))
                }

                Method (_STA, 0, NotSerialized)  // _STA: Status
                {
                    Return (LSTA (SMD1))
                }
            }

            If (LEqual (SMD1, 0x02))
            {
                Name (_ADR, 0x00150001)  // _ADR: Address
                Method (_DSM, 4, Serialized)  // _DSM: Device-Specific Method
                {
                    If (PCIC (Arg0))
                    {
                        Return (PCID (Arg0, Arg1, Arg2, Arg3))
                    }

                    Return (Buffer (One)
                    {
                         0x00                                           
                    })
                }
            }
        }
    }

acpi 6：无问题
acpi 4：
21694, 4096, syntax error, unexpected PARSEOP_IF
21715, 4057, Name already exists in scope (_ADR)
21730, 4096, syntax error, unexpected '}', expecting $end

修改为：

    Scope (_SB.PCI0)
    {
        Device (I2C1)
        {
            Name (LINK, "\\_SB.PCI0.I2C1")
            Method (_PSC, 0, NotSerialized)  // _PSC: Power State Current
            {
                Return (GETD (SB11))
            }

            Method (_PS0, 0, NotSerialized)  // _PS0: Power State 0
            {
                LPD0 (SB11)
            }

            Method (_PS3, 0, NotSerialized)  // _PS3: Power State 3
            {
                LPD3 (SB11)
            }


        }
    }



            If (LNotEqual (SMD1, 0x02))
            {
Scope (_SB.PCI0.I2C1)
    {
                Name (_HID, "INT3443")  // _HID: Hardware ID
                Method (_HRV, 0, NotSerialized)  // _HRV: Hardware Revision
                {
                    Return (LHRV (SB11))
                }

                Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings
                {
                    Return (LCRS (SMD1, SB01, SIR1))
                }

                Method (_STA, 0, NotSerialized)  // _STA: Status
                {
                    Return (LSTA (SMD1))
                }
            }
}

            If (LEqual (SMD1, 0x02))
            {
Scope (_SB.PCI0.I2C1)
    {
                Name (_ADR, 0x00150001)  // _ADR: Address
                Method (_DSM, 4, Serialized)  // _DSM: Device-Specific Method
                {
                    If (PCIC (Arg0))
                    {
                        Return (PCID (Arg0, Arg1, Arg2, Arg3))
                    }

                    Return (Buffer (One)
                    {
                         0x00                                           
                    })
                }
            }
}


原：
            Name (SBFB, ResourceTemplate ()
            {
                I2cSerialBusV2 (0x0020, ControllerInitiated, 0x00061A80,
                    AddressingMode7Bit, "\\_SB.PCI0.I2C0",
                    0x00, ResourceConsumer, _Y24, Exclusive,
                    )
            })

错误：
22479, 4096, syntax error, unexpected PARSEOP_NAMESEG

更正：
直接删掉(可能是acpi 4 不支持i2c)



原：
            Name (SBFI, ResourceTemplate ()
            {
                Interrupt (ResourceConsumer, Level, ActiveLow,  ,, _Y2B)
                {
                    0x00000000,
                }
            })
acpi 5:

更正为
            Name (SBFI, ResourceTemplate ()
            {
                Interrupt (ResourceConsumer, Level, ActiveLow, Exclusive, ,, _Y2B)
                {
                    0x00000000,
                }
            })

原：
            Name (SBFG, ResourceTemplate ()
            {
                GpioInt (Level, ActiveLow,  PullDefault, 0x0000,
                    "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
                    )
                    {   // Pin list
                        0x0000
                    }
            })
acpi 5:

更正为
            Name (SBFG, ResourceTemplate ()
            {
                GpioInt (Level, ActiveLow, Exclusive, PullDefault, 0x0000,
                    "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
                    )
                    {   // Pin list
                        0x0000
                    }
            })

原:
                Name (BBUF, ResourceTemplate ()
                {
                    SpiSerialBus (0x0000, PolarityLow, FourWireMode, 0x08,
                        ControllerInitiated, 0x00989680, ClockPolarityLow,
                        ClockPhaseFirst, "\\_SB.PCI0.SPI1",
                        0x00, ResourceConsumer, _Y2C, )
                    GpioIo ( Exclusive, PullDefault, 0x0000, 0x0000, IoRestrictionOutputOnly,
                        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
                        )
                        {   // Pin list
                            0x0008
                        }
                })
```

## 说明

```
Adobe 从 2019 年开始大部分应用都高度依赖基于 Intel 特殊数学函数库 —— Intel Math Kernel Library（intel-mkl），以及其它一些 Intel 特殊指令集用于硬件加速（涉及到的有 MXMCore、FastCore、CameraRAW 等）。因此即使在搭载了同为 X86 的 AMD 处理器上安装黑苹果，使用 Photoshop 的某些功能也会导致闪退甚至 Kernel Panic；同理，AMD 黑苹果无法运行 MatLab，或者即使能够运行、运算速度也非常缓慢，也是由于缺乏 intel-mkl 导致的。


ioreg -l -p IODeviceTree | grep firmware-abi
通过以上命令查看EFI版本（EFI32/EFI64）


使用RAM，对于Windows通常是相同的逻辑：确保CPU的内存控制器可以支持您要运行的速度。macOS似乎比Windows对内存更敏感，因此您可能会出现随机的锁定/内核混乱，并且添加的内存越多，您就越需要降低频率来简化内存控制器。通常，在i7 8700k上可以正常运行32GB 3000MHz，但是出于稳定性方面的考虑，i7 6700k可能必须降至2666MHz

运行lipo -archs以了解您的kext支持哪些体系结构（记住要在二进制文件本身而不是.kext捆绑软件上运行）


如果你在使用 AMD 安装的黑苹果，那么你多半注释掉了 XNU 内核不少对 Intel 特有指令集的调用（不论是反编译 XNU 内核或是通过 Clover / OpenCore 对相关 kext 进行了 Patch），意味着 VMX 是肯定不支持的。
如果不支持 VMX，就只能安装 开源拖拉机 VirtualBox 了。

【旧版mac将kext cache放到extentions.mkext加快加载，在Lion及以后被弃用，在变色龙要设置UseKernelCache=Yes】

xmove

USB安装盘的/System/Library/CoreServices/PlatformSupport.plist有支持列表


```

# 引导器

## 基本概念

### 更名补丁

一般不建议使用过多的更名补丁，尽可能只添加和Method名称有关的重命名，而且要通过SSDT确保在非Mac下要调用并返回原始函数，即原始DSDT行为不会被改变。所需要的SSDT一般在OC-little包中均可找到。

| 更名补丁                                                                | 作用                                                                               | 替代方法                                                                                                                   |
| ------------------------------------------------------------            | ------------------------------------------------------------                       |                                                                                                                            |
| change EHC1/EHC2 to EH01/EH02                                           | 避免与内置USB注入器冲突                                                            | 六代（Skylake）及以上的机器已经没有EHC控制器了，建议用SSDT-EHCx_OFF关闭EHC控制器、并把重命名删除，六代以下机器保留该重命名 |
| change XHC1 to XHC                                                      | 避免与内置USB注入器冲突                                                            |                                                                                                                            |
| change XHCI to XHC                                                      | 避免与内置USB注入器冲突                                                            |                                                                                                                            |
| change SAT0/SAT1 to SATA                                                | 实现潜在的SATA兼容性                                                               | 实质上完全没用                                                                                                             |
| change _OSI to XOSI                                                     | 配合SSDT-XOSI.dsl启用系统操作补丁                                                  |   除非某些硬件设备只能在Windows下工作（I2C触摸板只能在Windows下使用，或ThinkPad对 FreeBSD的特殊优化），否则完全没有必要使用，而且大部分情况下直接定制SSDT也可以解除某些硬件的操作系统限制                                                                                                                        |
| change OSID to XSID                                                     | 配合SSDT-XOSI.dsl启用系统操作补丁                                                  |   除非某些硬件设备只能在Windows下工作（I2C触摸板只能在Windows下使用，或ThinkPad对 FreeBSD的特殊优化），否则完全没有必要使用，而且大部分情况下直接定制SSDT也可以解除某些硬件的操作系统限制                                                                                                                        |
| change APSS to APXX                                                     | 可能导致AppleIntelCPUPowerManagement出现紧急情况，如果ACPI中不存在APSS，则无需启用 |                                                                                                                            |
| change _DSM to XDSM                                                     | 对于VoodooI2C可能是必需的                                                          |        遍历SSDT补丁，若没有依赖`_DSM`，则应该删除（这个重命名涉及范围太大、太过于危险）                                                                                                                    |
| change LPC to LPCB                                                      | 为macOS修补低引脚数总线                                                            |                                                                                                                            |
| change _REG to XREG in EC0                                              | 对于电池状态可能是必需的                                                           |                                                                                                                            |
| ALS: change Method(RALS,0,S) XALS                                       | 对于环境光传感器可能是必需的                                                       |                                                                                                                            |
| Fix 300-series RTC Bug(Find A00A935354415301, Replace A00A910AFF0BFFFF) | 修复300系主板的RTC问题                                                             |                                                                                                                            |
| change HECI/HEC1/MEI to IMEI   | | WhateverGreen能够处理这个问题    |
| change IDER to MEID   | | WhateverGreen能够处理这个问题    |
| change GFX0 to IGPU  |  | WhateverGreen能够处理这个问题    |
| change PEG0/PEGP to GFX0  |  | WhateverGreens能够处理这个问题    |
| change SL01 to PEGP   | | WhateverGreen能够处理这个问题    |
| change EC0/H_EC/ECDV/PGEC to EC    |     |  对于台式机可使用仿冒EC补丁（随意重命名EC控制器可能会对硬件造成伤害）    |
| change HDAS/CAVS/AZAL to HDEF    |     | AppleALC能够处理这个问题     |
| change STAS to Noop    | 同时启用两个时钟设备（其中Mac下仅有RTC起作用），无法在BIOS中禁用AWAC时使用（Mac不支持新的时钟设备AWAC，因此需要使用传统的 RTC，在DSDT中有一个STAS变量使AWAC和RTC互锁，避免两个时钟设备同时启用，注意若该重命名在Windows下生效，则Windows下将会暴露两个时间设备，这对系统有害且违反ACPI规范）    | 用SSDT-AWAC替代     |
| change PXSX to ANS1    |  修复NVMe SSD的电源管理   | 用NVMeFix.kext      |
| change PXSX to ANS2    |  修复NVMe SSD的电源管理   | 用NVMeFix.kext     |
| change LPC0 to LPCB    | 添加SMBUS支持    | SBUS的SSDT注入补丁和MCHC设备补丁     |
| change PC00 to PCIO    |     | 实质上完全没用     |
| change FPU to MATH    |     | 实质上完全没用     |
| change TMR to TIMR    |     | 实质上完全没用     |
| change GBE1 to ETH0    |     | 实质上完全没用     |
| change PIC to IPIC    |     | 实质上完全没用     |

### 驱动

#### 内存管理驱动

固件会将内存分成小块，分配给计算机中的各种设备以及操作系统内核。Windows可以很好的适应这种机制，并会主动将NT内核映射到内存中。而Mac不仅需要更大的内存区块，非Mac设备的内置硬件设备数量也比Mac设备要更多，所以黑苹果需要在EFI中添加专门的驱动为Mac内核预留内存。 

内核被分配到`0x100000+X*0x200000`，其中X通过启动参数`slide=X`传递，称为slide值。slide=0代表隐式关闭，在安全模式下将无法启动系统。slide=0x1-0x7F代表内核被分配到0x100000+0x200000至0x100000+0xFE00000。对于Sandy Bridge或Ivy Bridge架构，slide=0x80-0xFF代表内核被分配到0x100000+0x20200000至0x100000+0x30000000，对于其它架构则为0x100000+0x10000000至0x100000+0x1FE00000。

若启动Mac时出现`ERROR!!! Load prelinked kernel with status 0x8000000000000009`或卡一行+号，则需要修复内存分配。

各内存管理驱动如下，按照发行顺序从早到晚排序。

|              名称              |                                                       对于Clover                                                      |              对于OpenCore             |                                                                                          备注                                                                                         |
|--------------------------------|-----------------------------------------------------------------------------------------------------------------------|---------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| OsxLowMemFixDrv                | 精简版的OsxAptioFixDrv，用于修复UEFI固件上的低位内存问题，两个不能同时使用（针对Insyde H2O UEFI的笔记本，一般不使用） | 不兼容（FwRuntimeServices和OpenCore） | 自Clover r608版本后不再维护                                                                                                                                                           |
| OsxAptioFixDrv/OsxAptioFix2Drv | 修复AMIAptioEFI内存映射（一般只用OsxAptioFixDrv）                                                                     | 不兼容（FwRuntimeServices和OpenCore） | Clover r4368版本之前内置的内存分配驱动，不支持 NVRAM，其中OsxAptioFix2Drv是OsxAptioFixDrv 的简化的版本，去掉了内置内存分配算法，因此不能用在旧版本的Mac或者老硬件，但可以提供休眠支持 |
| OsxAptioFix3Drv                | 修复AMIAptioEFI内存映射                                                                                               | 不兼容（FwRuntimeServices和OpenCore） | Clover r4369版本之后至今内置的内存分配驱动，提供了对NVRAM的支持，现在仍由Clover团队维护                                                                                               |
| OSXAptioFix2Drv-Free2000       | 内存驱动，用于修复UEFI固件上的内存问题，只适用于一些特定的硬件、特定的设备、特定的内存大小                            | 不兼容（FwRuntimeServices和OpenCore） | 作者已经声明会损坏硬件</br>https://www.reddit.com/r/hackintosh/comments/cfjyla/i_unleashed_a_plague_upon_you_guys_and_i_am_sorry/                                                     |
| AptioMemoryFix                 | NVRAM和内存驱动，用于修复UEFI固件上的内存问题（6代及以上电脑推荐使用）                                                | 不兼容（已集成为FwRuntimeServices）   | Acidanthera团队开发，相比OsxAptioFix3Drv更好，AptioMemoryFix、AptioInputFix、CleanNvram合并发布为AptioFixPkg                                                                          |
|  OpenRuntime                              |    通过OcQuirks使用，参见本章Clover部分                                                                                                                   |                                       |     OpenCore最新的内存管理系统，使用该驱动以替代以上所有驱动                                                                                                                                                                                  |

对于OpenCore，使用最新的OpenRuntime即可。对于Clover，引导较新系统时应当使用OcQuirks以使用OpenRuntime。

在Clover上引导旧版系统时，可使用旧版驱动，其中应当按照AptioMemoryFix->OsxAptioFix3Drv->OsxAptioFix2Drv->OsxAptioFixDrv的顺序修复，每次只用一个，各驱动不能共用。前三个驱动尝试不使用启动参数`slide=#`，若不行则使用该参数，而最后一个驱动必须使用启动参数`slide=0`。

其中#的值需要通过计算。记录启动时出现的错误信息，例子如下。取pages前面的数字，此处为0x116F6。

```
Error allocating 0x0x116F6 pages at 0x00000000093eb000 alloc type 2
```

进入UEFI Shell，输入以下命令。

```
memmap -b
```

在第十行左右找到符合要求的数据，其中Type为Available，Pages的值不小于刚才记录的值即0x116F6，Start的值大于10000000。使用`Start/200000+1`计算出slide值，忽略小数点后数字，计算结果为十六进制，转换为十进制即可。注意，BIOS更新后可能需要重新计算该值。

#### 其它驱动

各驱动的作用和适用范围如下。

|                   名称                   |                                                                                                   对于Clover                                                                                                  |                                                                                                                        对于OpenCore                                                                                                                       |
|------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| NTFS                                     | NTFS文件系统驱动程序（一般不使用，此模块与一些主板的UEFI不兼容）                                                                                                                                              | 同Clover                                                                                                                                                                                                                                                  |
| AppleEfiSignTool                         | 验证AppleEFI二进制文件的开源工具（一般不使用）                                                                                                                                                                |                                                                                                                                                                                                                                                           |
| AppleImageLoader                         | 保护AppleEfiFat二进制驱动程序，将AppleEFI二进制文件安全加载到内存中（一般不使用）                                                                                                                             |                                                                                                                                                                                                                                                           |
| AppleEvent                               |                                                                                                                                                                                                               | 不兼容（已集成）                                                                                                                                                                                                                                          |
| AppleImageCodec                          | 为Clover启动FileVault 2解码PNG和BMP                                                                                                                                                                           | 不兼容（已集成）                                                                                                                                                                                                                                          |
| AppleKeyMapAggregator                    |                                                                                                                                                                                                               | 不兼容（已集成）                                                                                                                                                                                                                                          |
| AppleUISupport                           | 实现了FileVault支持，同时包含一些主板的哈希服务修复和unicode排序规则，替换了AppleKeyMapAggregator、AppleEvent、AppleUiTheme、FirmwareVolume、AppleImageCodec（一般不使用）                                    | 不兼容（已集成）                                                                                                                                                                                                                                          |
| SMCHelper                                | UEFI层面的SMC驱动，VirtualSmc.efi的替代品，与FakeSMC配合（不能与VirtualSMC.kext配合使用）                                                                                                                     | 不兼容                                                                                                                                                                                                                                                    |
| HashServiceFix                           | 修复UEFI BIOS中的哈希支持                                                                                                                                                                                     | 不兼容（已集成且提供了这个Quirk）                                                                                                                                                                                                                         |
| FirmwareVolume                           | 为启动FileVault 2创建FirmwareVolume光标                                                                                                                                                                       | 不兼容（已集成）                                                                                                                                                                                                                                          |
| EnhancedFatDxe                           | 无法直接从引导器调用，如果在引导过程中写入EFI分区出现问题，则需要将此驱动用UEFITool刷入固件中（除非EFI分区格式为FAT16且在开机过程中可能会往EFI分区写入文件时考虑使用）                                        | 同Clover                                                                                                                                                                                                                                                  |
| EnglishDxe                               | 在UEFI Shell中支持Unicode Collation协议                                                                                                                                                                       | 不兼容（已集成且提供了这个Quirk）                                                                                                                                                                                                                         |
| CsmVideoDxe                              | 用于Clover GUI的显卡驱动，允许使用更多分辨率，基于UEFI BIOS中的CSM兼容模块，并将启用所需的CSM（6代以前核显开CSM使用）                                                                                         | 不兼容                                                                                                                                                                                                                                                    |
| AudioDxe                                 | 启动时播放声音的HDA驱动                                                                                                                                                                                       | 在UEFI环境播放音频的驱动                                                                                                                                                                                                                                  |
| AppleUITheme                             | 为Clover支持FileVault 2启动UI主题的驱动                                                                                                                                                                       | 不兼容（已集成）                                                                                                                                                                                                                                          |
| AppleKeyFeeder                           | 为Clover支持FileVault 2内PS/2键盘输入的驱动                                                                                                                                                                   | 不兼容（已集成）                                                                                                                                                                                                                                          |
| AppleKeyAggregator                       | 为Clover支持FileVault 2启动UI的驱动                                                                                                                                                                           | 不兼容（已集成）                                                                                                                                                                                                                                          |
| APFS/ApfsDriverLoader                    | 从此容器加载已嵌入APFS容器中的apfs.efi驱动程序                                                                                                                                                                | 不兼容（OpenCore 0.5.8始已集成）                                                                                                                                                                                                                          |
| Ps2KeyboardDxe                           | 为三代以前机型准备的PS/2键盘驱动                                                                                                                                                                              |                                                                                                                                                                                                                                                           |
| PS2MouseDxe/PS2MouseAbsolute/UsbMouseDxe | 使鼠标/触摸板在CloverGUI界面工作（已存在于所有UEFI固件，一般不使用，三代以前机型才考虑使用）                                                                                                                  | 同Clover                                                                                                                                                                                                                                                  |
| Usb*/UHCI/EHCI/XHCI                      | 解决依赖性关系不满足导致的内建驱动工作不正常的情况的一组驱动（一般不使用）                                                                                                                                    |                                                                                                                                                                                                                                                           |
| OsxFatBinaryDrv                          | 允许macOS 10.9以下版本加载FAT模块（如boot.efi）                                                                                                                                                               | 不兼容（FwRuntimeServices和OpenCore）                                                                                                                                                                                                                     |
| DataHubDxe                               | macOS要求强制启动的协议（一般选用，不会引起冲突）                                                                                                                                                             | 不兼容（已集成且提供了这个Quirk）                                                                                                                                                                                                                         |
| PartitionDxe/PartitionDxeLegacy          | 支持非常规分区图的驱动，用于加载旧版Mac（早于10.9）分区DMG映像文件的驱动（混合GPT/MBR或Apple分区图等，四代以前机型用PartitionDxeLegacy）                                                                      | 兼容性未知                                                                                                                                                                                                                                                |
| EmuVariableUefi                          | 对某些UEFI启动无法调用NVRAM的机器提供的NVRAM模拟（部分Skylake架构的机器需要，如Phoenix UEFI、DELL Vostro、ThinkPad，仅在必要时使用）                                                                          | 不兼容（替代品为VariableRuntimeDxe）                                                                                                                                                                                                                      |
| FSInject                                 | 加载第三方kexts                                                                                                                                                                                               | 不兼容（已集成更先进的方法）                                                                                                                                                                                                                              |
| VBoxExt4                                 | EXT4文件系统驱动，用于启动LinuxEFI系统                                                                                                                                                                        | 同Clover                                                                                                                                                                                                                                                  |
| VBoxExt3                                 | EXT2/3文件系统驱动，用于启动LinuxEFI系统                                                                                                                                                                      |                                                                                                                                                                                                                                                           |
| AptioInputFix/AppleGenericInput          | 解决了某些固件上的鼠标输入问题（AppleUsbKbDxe的等效驱动），添加了对AppleKeyMapAggregator协议支持的用户输入驱动，为FileVault 2 GUI输入支持提供AMIAPTIO专有鼠标和键盘协议（通常修改的UsbKbDxe更好，一般不使用） | 不兼容（已集成）                                                                                                                                                                                                                                          |
| AppleDxeImageVerificationLib             | 为EFI二进制文件提供Apple的加密签名算法（一般不使用）                                                                                                                                                          |                                                                                                                                                                                                                                                           |
| ExFatDxe/ExFatDxeLegacy                  | 除非EFI/某个系统分区是ExFAT格式，否则不需要保留（在四代以前机型上用ExFatDxeLegacy）                                                                                                                           | 同Clover                                                                                                                                                                                                                                                  |
| HfsPlus/HfsPlusLegacy/VBoxHfs            | HFS+文件系统驱动程序，留其一即可（一般推荐用HfsPlus，四代以前机型用HfsPlusLegacy，VBoxHfs性能较差）                                                                                                           | 同Clover                                                                                                                                                                                                                                                  |
| UsbKbDxe                                 |                                                                                                                                                                                                               | 当内置驱动程序不适用于固件时，用于Apple Hotkeys和FileVault支持，已被取代为OpenUsbKbDxe                                                                                                                                                                    |
| AppleUsbKbDxe/OpenUsbKbDxe               |                                                                                                                                                                                                               | 给使用模拟UEFI的老主板在OpenCore界面正常输入用，添加了对AppleKeyMapAggregator协议支持的USB键盘驱动，是AppleGenericInput的等效驱动（仅在运行DuetPkg的旧系统上使用，勿在Ivy Bridge即三代酷睿及以上的主板使用，现代机型应使用OpenCore中KeySupport这一Quirk） |
| NvmExpressDxe                            | 四代（Haswell）以前机型使用的NVMe硬盘加载驱动，支持SSD连接到NVM Express总线，若安装了NVMe SSD则需要使用                                                                                                       | 同Clover                                                                                                                                                                                                                                                  |
| XhciDxe                                  | HCI USB控制器支持驱动程序，为二代（Sandy Bridge）以前的主板提供USB3支持（主要是Intel控制器）                                                                                                                  | 同Clover                                                                                                                                                                                                                                                  |
| HiiDatabase                              | 为四代以前的设备提供UEFI界面字体渲染支持，UEFI Shell中文字渲染异常时使用，Ivy Bridge（3代酷睿）或更老代主板上适用                                                                                             | 同Clover                                                                                                                                                                                                                                                  |
| VirtualSmc                               |                                                                                                                                                                                                               | 已被替代为AppleSmcIO这一Quirk                                                                                                                                                                                                                             |
| CrScreenshotDxe                          |                                                                                                                                                                                                               | 增加OpenCore UI内截屏功能，快捷键为左Ctrl+左Alt+F12                                                                                                                                                                                                       |
| OpenCanopy                               |                                                                                                                                                                                                               | 加载第三方主题                                                                                                                                                                                                                                            |
| FwRuntimeServices                        | 不兼容                                                                                                                                                                                                        | 通过支持只读/只写NVRAM变量提高OpenCore和Lilu的安全性，已被OpenRuntime替代                                                                                                                                                                                 |
| MemoryAllocation                         |                                                                                                                                                                                                               | 为Z390/X99等主板预留第一组512MB内存，帮助引导工具注入内核以及内核缓存至第一组512MB内存，需要配合FwRuntimeServices和引导标识符slide=1（若要使用hibernation功能请勿使用）                                                                                   |
| UsbMouseDxe                              |                                                                                                                                                                                                               | USB鼠标驱动程序（仅在运行DuetPkg的旧系统上使用）                                                                                                                                                                                                          |
| VBoxExt2                                 | EXT2文件系统驱动，用于启动LinuxEFI系统                                                                                                                                                                        | 同Clover                                                                                                                                                                                                                                                  |
| VBoxIso9600                              | ISO9600文件系统驱动                                                                                                                                                                                           | 同Clover                                                                                                                                                                                                                                                  |
| GrubUDF                                  | 加载UDF文件系统                                                                                                                                                                                               | 同Clover                                                                                                                                                                                                                                                  |
| GrubNTFS                                 | 加载NTFS文件系统                                                                                                                                                                                              | 同Clover                                                                                                                                                                                                                                                  |
| GrubISO9660                              | 加载ISO9660文件系统                                                                                                                                                                                           | 同Clover                                                                                                                                                                                                                                                  |
| GrubEXFAT                                | 加载NTFS文件系统                                                                                                                                                                                              | 同Clover                                                                                                                                                                                                                                                  |
| TbtForcePower                            |                                                                                                                                                                                                               | 启用ThunderBolt热插拔                                                                                                                                                                                                                                     |
| VariableRuntimeDxe                       |                                                                                                                                                                                                               | EDK II 的NVRAM驱动，OpenCore中用于模拟NVRAM，需要配合FwRuntimeServices(.efi)和DisableVariableWrite(Quirk)                                                                                                                                                 |
| BootChimeDxe                             |                                                                                                                                                                                                               | 不兼容（已集成）                                                                                                                                                                                                                                          |

### 启动参数

Core Dump指当程序运行的过程中异常终止或崩溃，操作系统将程序当时的内存状态记录下来，保存在文件中。

|              参数             |                                                                                                                   含义                                                                                                                  |
|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **内核与Lilu**                |                                                                                                                                                                                                                                         |
| -v                            | 啰嗦模式（跑代码模式，用于排错）                                                                                                                                                                                                        |
| -x                            | 安全模式（忽略所有非必要的kext文件和引导设置，特别适用于黑苹果）                                                                                                                                                                        |
| -s                            | 单用户模式（命令行模式）                                                                                                                                                                                                                |
| f                             | 旧版安全模式                                                                                                                                                                                                                            |
| -f                            | 启动时强制重建内核扩展（kext）缓存（在Lion中kext cache被取代为kernel cache，因此该标志理论上不再起作用）                                                                                                                                |
| -b                            | 不执行/etc/rc.boot                                                                                                                                                                                                                      |
| -l                            | 日志中输出内存泄漏相关记录                                                                                                                                                                                                              |
| -legacy                       | 启动到32位内核                                                                                                                                                                                                                          |
| -liluoff                      | 跳过Lilu.kext                                                                                                                                                                                                                           |
| -no-zp                        | 区域推迟                                                                                                                                                                                                                                |
| -no_compat_check              | 关闭兼容性检查                                                                                                                                                                                                                          |
| MountEFI=yes/diskX            | 挂载所有/某个EFI分区                                                                                                                                                                                                                    |
| config=A                      | 用/Library/Preferences/SystemConfiguration/A.plist代替com.apple.Boot.plist                                                                                                                                                              |
| LogLineCount=0                | 设置日志文件最大行数（0为无限制）                                                                                                                                                                                                       |
| LogLocation=PATH              | 日志文件保存路径                                                                                                                                                                                                                        |
| LogEveryBoot=yes/no           | 每次启动保存日志文件                                                                                                                                                                                                                    |
| dart=0                        | 关闭64位硬件上的系统PCI地址映射器（DART），修复因开启VT-d导致系统启动错误（DART在拥有2GB以上物理内存的机器上是必需的，但在所有机器上无论内存大小，默认情况下都会启用DART）                                                              |
| darkwake=no/0/1/2/3/4/8/10    | 禁止系统休眠/设定休眠模式为固定数值                                                                                                                                                                                                     |
| kext-dev-mode=1               | 启用第三方驱动（不要在El Capitan及以上系统使用）                                                                                                                                                                                        |
| rootless=0                    | rootless模式（不要在El Capitan及以上系统使用）                                                                                                                                                                                          |
| arch=i386                     | 以32位内核模式启动                                                                                                                                                                                                                      |
| arch=x86_64                   | 以64位内核模式启动                                                                                                                                                                                                                      |
| -legacy                       | 强制启动到32位用户区                                                                                                                                                                                                                    |
| -force64                      | 强制启动到64位用户区（AMD CPU通常需要32位内核与64位用户区）                                                                                                                                                                             |
| npci=0x2000                   | 在旧设备上禁用 kIOPCIConfiguratorPFM64，解决独立显卡PCIconfiguration begin卡住不动的问题                                                                                                                                                |
| npci=0x3000                   | 解决独立显卡PCIconfiguration begin卡住不动                                                                                                                                                                                              |
| Kernel=mach_kernel            | 从系统内核启动                                                                                                                                                                                                                          |
| rd=disk0s1                    | 强制指定启动分区                                                                                                                                                                                                                        |
| rp                            | 根目录位置                                                                                                                                                                                                                              |
| trace                         | Kernel Trace缓冲区大小                                                                                                                                                                                                                  |
| iog=0x0                       | 强制Mac在笔记本上不使用Clamshell模式，当外接了显示器和键盘，合盖后笔记本不会睡眠，但内置显示器将会关闭                                                                                                                                  |
| serverperfmode=1              | 在macOS Server中开启性能模式                                                                                                                                                                                                            |
| `_panicd_ip=11.4.5.14`        | 设置一个Kernel Panic收集服务器的IP地址，日志将会通过UDP协议发送给这个IP的1069端口                                                                                                                                                       |
| panicd_port                   | 修改日志发送端口（默认为1069）                                                                                                                                                                                                          |
| debug=0x1                     | DB_HALT，在引导时暂停，直到外部调试串口已经连接并被识别                                                                                                                                                                                 |
| debug=0x2                     | DB_PRT，将内核的printf()函数输出的信息打印到 Console.app                                                                                                                                                                                |
| debug=0x4                     | DB_NMI，启用内核调试功能，包括生成非屏蔽中断（NMI），在Power Mac上只需简单地按下电源键就能产生NMI。在笔记本电脑上在按下电源键时必须按住命令键，如果按住电源键超过五秒钟，系统将关闭电源，在系统偏好设置中更改启动盘时，DB_NMI位将被清除 |
| debug=0x8                     | DB_KPRT，将kprintf()产生的内核调试输出发送到远程输出设备，通常是一个调试串口（如果有的话），注意kprintf()的输出是同步的                                                                                                                 |
| debug=0x10                    | DB_KDB，使用KDB代替GDB作为默认的内核调试器。与GDB不同，KDB必须被显式编译到内核中，此外基于KDB的调试需要原生的串口硬件（而不是基于USB的串口适配器）                                                                                      |
| debug=0x20                    | SB_SLOG，启用将杂项诊断记录到系统日志中，设置了这个位后load_shared_file()内核函数会记录额外的信息                                                                                                                                       |
| debug=0x40                    | DB_ARP，允许跨局域网调试内核                                                                                                                                                                                                            |
| debug=0x80                    | DB_KDP_BP_DIS，已经被弃用，用于支持旧版的GDB                                                                                                                                                                                            |
| debug=0x100                   | DB_LOG_PI_SCRN，禁用五国而把Kernel Panic的相关数据直接打印在屏幕上，还可用于Core Dump                                                                                                                                                   |
| debug=0x200                   | DB_KDP_GETC_ENA，在 Kernel Panic 后启用快捷键（c继续，r重启，k进入KDB）                                                                                                                                                                 |
| debug=0x400                   | DB_KERN_DUMP_ON_PANIC，当Kernel Panic时触发一次Core Dump                                                                                                                                                                                |
| debug=0x800                   | DB_KERN_DUMP_ON_NMI，当产生NMI时触发一次Core Dump                                                                                                                                                                                       |
| debug=0x1000                  | DB_DBG_POST_CORE，等待调试器连接（如果使用GDB）或在NMI触发的内核转储后等待调试器（如果使用 KDB），如果没有设置DB_DBG_POST_CORE，内核在Core Dump后继续运行                                                                               |
| debug=0x2000                  | 只生成并发送Kernel Panic Log，不生成完整的Core Dump                                                                                                                                                                                     |
| keepsyms=1                    | 保留KLD/Address-Symbol翻译，配合debug=0x100使用，使操作系统在内核崩溃时打印符号                                                                                                                                                         |
| artsize                       | 指定要用于地址解析表（ART）的页数                                                                                                                                                                                                       |
| BootCacheOverride=1           | BootCache驱动程序被加载，但从网络启动时不会运行，设置BootCacheOverride=1可以覆盖此行为                                                                                                                                                  |
| diag                          | 启用内核的内置诊断接口及其特定功能                                                                                                                                                                                                      |
| io                            | I/O Kit驱动调试位,设置为 0x00200000（即 kIOLogSynchronous）时会使IOLog()函数同步执行                                                                                                                                                    |
| novmx=1                       | 禁用AltiVec                                                                                                                                                                                                                             |
| pcata=0                       | 禁用板载PC ATA驱动器                                                                                                                                                                                                                    |
| `_router_ip=11.4.5.14`        | 使用跨局域网内核调试时指定网关IP                                                                                                                                                                                                        |
| serial=1                      | 启用串口调试                                                                                                                                                                                                                            |
| smbios=1                      | 在SMBIOS驱动中启用详细的日志信息，仅限于32位机器                                                                                                                                                                                        |
| vmdx/pmdx                     | 内核启动时在内存中创建一个分区，参数格式为base.size，其中base是对齐的内存地址，size是内存页面大小的倍数。vmdx指虚拟内存、pmdx指物理内存，创建成功后将会被分别挂载在dev/mdx和dev/emdx下                                                  |
| srv=1                         | 在X Servers或macOS Server系统中使用这一参数时会修改内核的电源和网络参数，提升作为服务器的性能                                                                                                                                           |
| nvram_paniclog                | 将Kernel Panic日志写入NVRAM                                                                                                                                                                                                             |
| **内存**                      |                                                                                                                                                                                                                                         |
| maxmem=#                      | 将可寻址内存限制为#MB                                                                                                                                                                                                                   |
| slide=#                       | 手动设置KASLR slide值为#                                                                                                                                                                                                                |
| fill                          | 指定一个整数值，启动时用这个整数填充所有内存                                                                                                                                                                                            |
| **CPU，ACPI与电源**           |                                                                                                                                                                                                                                         |
| -xcpm                         | 在Ivy Bridge系统里强制xcpm使用系统内核以实现CPU原生电源管理                                                                                                                                                                             |
| cpus=#                        | 启用#个CPU核心（cpus=1为使用单核模式）                                                                                                                                                                                                  |
| -nossse3bit                   | 启用AMD CPU的SSSE3仿真                                                                                                                                                                                                                                       |
| acpi                          | 启用AppleACPIPlatform调试                                                                                                                                                                                                               |
| acpi=off                      | 关闭电源管理                                                                                                                                                                                                                            |
| acpi_level                    | ACPI调试等级                                                                                                                                                                                                                            |
| idlehalt=1                    | 无视所有空闲进程，使CPU进入低功率模式                                                                                                                                                                                                   |
| platform=X86PC                | 强制禁用ACPI电源管理                                                                                                                                                                                                                    |
| platform=ACPI                 | 强制启用ACPI电源管理                                                                                                                                                                                                                    |
| fn=1                          | 关闭强制休眠                                                                                                                                                                                                                            |
| fn=2                          | 开启强制休眠                                                                                                                                                                                                                            |
| `_fpu`                        | 禁用x86上的FPU功能，`_fpu=387`将禁用FXSR/SSE/SSE2，`_fpu=se`将禁用SSE2                                                                                                                                                                  |
| hfile                         | 休眠文件的名称（这一参数也会修改sysctl中的kern.hibernatefile变量）                                                                                                                                                                      |
| pmsx=1                        | 在10.4.3上启用实验性电源管理（PMS）                                                                                                                                                                                                     |
| busratio=#                    | 规定CPU总线比率为20                                                                                                                                                                                                                     |
| **显卡与Whatevergreen**       |                                                                                                                                                                                                                                         |
| nv_disable=1                  | 禁止加载Nvidia独显驱动                                                                                                                                                                                                                  |
| nvda_drv=1                    | 让系统安装Nvidia官方WebDriver显卡驱动（10.12+失效，对于Clover在配置文件勾选System Parameters-NvidiaWeb，对于OpenCore在配置文件填写NVRAM->Add->7C436110-AB2A-4BBB-A880-FE41995C9F82->nvda_drv: <31>）                                    |
| nvda_drv_vrl=1                | Sierra和High Sierra中用于取代nvda_drv=1                                                                                                                                                                                                 |
| -raddvi                       | 为290X/370等修复DVI connector-type                                                                                                                                                                                                      |
| -amd_no_dgpu_accel            | 关闭AMD显卡硬件加速（默认）                                                                                                                                                                                                             |
| -radvesa                      | 强制GPU进入VESA模式（无GPU加速），有助于进行故障排除，苹果内置标志的版本是-amd_no_dgpu_accel                                                                                                                                            |
| shiki-id=Mac-7BA5B2D9E42DDD94 | 使用iMacPro1,1交换boardID                                                                                                                                                                                                               |
| shikigva=1                    | 让iGPU处理硬件解码，在同时使用iGPU与dGPU时需要                                                                                                                                                                                          |
| shikigva=4                    | 在新于Haswell的架构上支持硬件加速的视频解码                                                                                                                                                                                             |
| shikigva=40                   | 使用iMac14,2交换boardID，允许Polaris，Vega和Navi GPU处理所有类型的渲染，对于希望使用iGPU、不需要Nvidia GPU的SMBIOS有效                                                                                                                  |
| radpg=15                      | 修复HD 7730/7750/7770、R7 250、R7 250X的初始化                                                                                                                                                                                          |
| agdpmod=vit9696               | 禁用board ID检查，完成引导后屏幕变黑时可能需要                                                                                                                                                                                          |
| agdpmod=pikera                | 重命名board-id为board-ix以有效地禁用board ID检查                                                                                                                                                                                        |
| -wegnoegpu                    | 禁用除iGPU以外的所有GPU                                                                                                                                                                                                                 |
| -igfxnohdmi                   | 禁用DisplayPort到HDMI音频转换                                                                                                                                                                                                           |
| -cdfon                        | 执行启用HDMI 2.0支持所需的众多补丁                                                                                                                                                                                                      |
| -igfxvesa                     | 强制GPU进入VESA模式（无GPU加速），有助于进行故障排除                                                                                                                                                                                    |
| igfxonln=1                    | 强制所有显示联机，对于解决Coffee and Comet Lake 10.15.4+中的屏幕唤醒问题很有用                                                                                                                                                          |
| igfxfw=2                      | 支持为iGPU加载Apple的GUC固件，需要第9代芯片组或更高版本（例如Z390）                                                                                                                                                                     |
| PCIRootUID=0                  | 内核将在内部主板或CPU GFX寻找视频硬件                                                                                                                                                                                                   |
| PCIRootUID=1                  | 内核将在外部/PCIe插槽寻找视频硬件                                                                                                                                                                                                       |
| **USB**                       |                                                                                                                                                                                                                                         |
| -uia_exclude_hs               | 从USB3.0端口中禁用HS端口（将无法在这些端口上使用USB2.0设备，使用USB鼠标/键盘切勿使用）                                                                                                                                                  |
| -gux_defer_usb2               | 修复使用GenericUSBXHCI.kext导致的睡眠问题（仅在EHC控制器存在时可用，i7系列适用）                                                                                                                                                        |
| -gux_no_idle                  | 终止英特尔芯片上的一些空闲模式（idle-mode）功能（i7系列适用）                                                                                                                                                                           |
| -gux_nosleep                  | 强迫睡眠使用shutdown/reset方法                                                                                                                                                                                                          |
| -gux_nomsi                    | 强迫使用中断（interrupt）而不是msi                                                                                                                                                                                                      |
| **声卡与AppleALC**            |                                                                                                                                                                                                                                         |
| -alcoff                       | 跳过AppleALC.kext                                                                                                                                                                                                                       |

### 工具

部分工具作用如下。

| 工具名称           | 原因/用途                                           |
| -------------- | ----------------------------------------------- |
| BootKicker     | 调用Mac内置的引导界面，用于白苹果安装OpenCore，黑苹果无法使用，可直接删除      |
| CleanNvram     | NVRAM清理                                         |
| GopStop        | 停止显卡GOP（排错时使用）                                  |
| HdaCodecDump   | 导出声卡Codec，可用于定制声卡                               |
| VerifyMsrE2    | 用于检查主板上CFG锁的状态                                  |

### 系统启动标志位

即BooterConfig，具体含义如下。

| Bit位 |                             含义                            |
|-------|-------------------------------------------------------------|
|     0 | RebootOnPanic，遇到内核崩溃自动重启                         |
|     1 | HiDPI，在启动过程中使用HiDPI模式显示                        |
|     2 | Black，在启动过程中不显示进度条                             |
|     3 | CSRActiveConfig，将读取当前生效的SIP控制标志位              |
|     4 | CSRConfigMode，仅用于Recovery/安装环境，将允许对SIP进行配置 |
|     5 | CSRBoot，仅用于Recovery/安装环境，SIP将完全禁用             |
|     6 | BlackBg，在启动过程中使用黑色背景                           |
|     7 | LoginUI，在启动过程中使用登陆界面作为背景                   |
|     8 | InstallUI                                                   |

### kext补丁

#### 修复外置硬盘识别为内置硬盘

`RXh0ZXJuYWw=`指External，`SW50ZXJuYWw=`指Internal。

```
Name: AppleAHCIPort
Find: 45787465 726E616C
Replace: 496E7465 726E616C
```

#### 允许使用MacPro4,1或MacPro5,1的SMBIOS时不带ECC内存引导

```
Name: AppleTyMCEDriver
Find: 720A004D 61635072 6F342C31 004D6163 50726F35 2C310058
Replace: 720A0000 00000000 00000000 00000000 00000000 00000058
```

### kernel补丁

#### 去除Lilu内核崩溃时的kexts输出

根据MatchOS的版本号选用更名补丁。

```
Comment: Disable panic kext logging on 10.15.4 Release kernel
Find: 008a0284c074
Replace: 008a0284c0eb
MatchOS: 10.14.4,10.14.5

Comment: Disable panic kext logging on 10.13 Release kernel
Find: 8A0284C07444
Replace: 8A0284C0EB44
MatchOS: 10.13

Comment: Disable panic kext logging on 10.14-10.14.3  Release kernel
Find: 8A0284C07442
Replace: 8A0284C0EB42 
MatchOS: 10.14-10.14.3

Comment: Disable panic kext logging on 10.14.4  Release kernel
Find: 008A0284C074
Replace: 008A0284C0EB 
MatchOS: 10.14.4
```

### NVRAM

#### 重置

在Clover和OpenCore之间切换时，建议重置NVRAM。

##### 通过Clover

删除Clover的drivers64UEFI目录下的EmuVariableUefi.efi，重启进入Clover引导项选择界面，按F11或Fn+F11，直到设备自动重启。

##### 通过OpenCore

在OpenCore引导界面按空格显示隐藏条目，选择Reset NVRAM。此法将会丢失BIOS中的自定引导项。

##### 通过终端

在终端输入以下命令即可。

```
sudo nvram -c
```

#### 判断工作状态

删除引导工具内的VariableRuntimeDxe.efi、EmuVariableRuntimeDxe.efi和EmuVariableUefi.efi，删除NVRAM导出脚本LogoutHook和RC Script，删除EFI分区根目录下的nvram.plist，重启后输入以下命令。

```
sudo nvram myvar=test
```

再次重启后在终端输入以下命令，如果终端成功输出了test，则说明主板在Mac下NVRAM正常工作，反之为不正常。

```
nvram -p | grep -i myvar
```


### SIP配置

SIP是Mac的安全保护机制，包括文件系统保护、运行时保护和内核扩展签名保护。

#### 基本概念

##### csr-active-config

启动时控制SIP的参数。

| BiT位 | 含义                                                         |
| ----- | ------------------------------------------------------------ |
| 0     | [kext]允许加载不受信任的kext（与kext-dev-mode=1等效）        |
| 1     | [fs]解锁文件系统限制                                         |
| 2     | [debug]允许task_for_pid()调用                                |
| 3     | [N/A]允许内核调试 （官方的csrutil工具无法设置此位）          |
| 4     | [internal]Apple内部保留位（csrutil默认会设置此位，实际不会起作用。设置与否均可） |
| 5     | [dtrace]解锁dtrace限制                                       |
| 6     | [nvram]解锁NVRAM限制                                         |
| 7     | [N/A]允许设备配置，用于Recovery/安装环境                     |

#### 修改

SIP可以防止将未签名的程序包注入内核，并可以防止应用程序覆盖NVRAM。通过Clover注入kext时不要求SIP禁用。

##### 通过csrutil

在正常系统环境下，csrutil只能查询SIP状态，故需进入恢复模式更改。白苹果在启动时按command+R进入，黑苹果在Clover的引导菜单进入。按照需求输入以下命令即可。

```
// 查询状态
csrutil status

// 完全启用
csrutil enable
// 或csrutil clear

// 开关各项技术
csrutil enable [--without kext|fs|debug|dtrace|nvram] [--no-internal]

// 禁用
csrutil disable
// 或csrutil enable --without kext --without fs --without debug --without dtrace --without nvram
```

##### 通过引导器

通过修改引导器中的CsrActiveConfig，可修改SIP状态。使用0x67或0x3E7以禁用，两者参数比较如下表。

| 参数  | 有效值                         |
| ----- | ------------------------------ |
| 0x67  | CSR_ALLOW_UNRESTRICTED_NVRAM   |
|       | CSR_ALLOW_TASK_FOR_PID         |
|       | CSR_ALLOW_UNRESTRICTED_FS      |
|       | CSR_ALLOW_UNTRUSTED_KEXTS      |
| 0x3E7 | CSR_ALLOW_UNAPPROVED_KEXTS     |
|       | CSR_ALLOW_ANY_RECOVERY_OS      |
|       | CSR_ALLOW_DEVICE_CONFIGURATION |
|       | CSR_ALLOW_UNRESTRICTED_NVRAM   |
|       | CSR_ALLOW_UNRESTRICTED_DTRACE  |
|       | CSR_ALLOW_UNTRUSTED_KEXTS      |

##### 通过写入NVRAM

打开终端并输入以下命令即可。

```
sudo nvram 7C436110-AB2A-4BBB-A880-FE41995C9F82:csr-active-config=%13%00%00%00
```

### EFI分区说明

#### APPLE文件夹

该文件夹用于更新实际Mac上的固件，无实际作用。

## 通用操作

### 填充PCI列表

#### 通过Hackintool

打开Hackintool，选择PCI，点击右下角的导出按钮，即可得到PCI列表。插入Clover配置文件的Devices-Arbitrary即可。

#### 通过Clover

以Clover为例，打开Clover Configurator，点击Boot.log-Generate log-Save boot.log to desktop，在桌面生成bootlog.txt文件。

打开Hackintool，记住要添加的设备的设备ID，在bootlog.txt中搜索此ID，并记录同一行下形如xx:xx.xx的字符串，称为pciaddr。如现有设备NVME SSD SM961，其设备ID为0xA804，pciaddr为04:00.00。

打开config.plist，点击Devices-Arbitrary，点击PciAddr栏左下角的+号以新建条目。其中PciAddr填写刚才查询的值，Comment可记录下该设备的类型。双击此条目，并点击Value Type右下角的+号，添加两个条目，内容如下。

| Key            | Value                                    | Value Type |
| -------------- | ---------------------------------------- | ---------- |
| AAPL,slot-name | 端口位置，可任意填写，如Slot-1           | STRING     |
| model          | 设备名称，可任意填写，最好与源设备名一致 | STRING     |

完成后保存并重启即可。注意，显卡信息无法添加到PCI列表中，而声卡PCI属性的注入会导致layout-ID的覆盖，从而使声卡不工作。故若需注入声卡属性，需在config.plist下设置Devices-Audio-inject为No，在Boot-Arguments下添加`alcid=[layout-id]`。

### 禁用USB2控制器

USB2的控制器在DSDT一般命名为EHC1/EHC2。可用以下SSDT禁用EHC1和EHC2。

```
/*
 * USB compatibility table for disable phantoms EHC1, EHC2.
 *
 * Attention!
 * Only for 7,8,9-series chipsets and 10.11 and newer!
 *
 * To disable EHC1 and EHC2 - set an option "XHCI Mode" to "Enabled" in yours BIOS.
 * If the "XHCI Mode" option is not available in yours BIOS or works incorrectly, then use this ACPI table.
 * Disabling through BIOS is preferable whenever possible.
 *
 * WARN: for some motherboards you need to use either "EH1D = One" or "EH2D = One" but not both!
 * This is because for some motherboards, device (EHC1 or EHC2) is used by macOS. Check the IOReg.
 */
DefinitionBlock ("", "SSDT", 2, "ACDT", "EHCx_OFF", 0x00001000)
{
    Scope (\)
    {
        OperationRegion (RCRG, SystemMemory, 0xFED1F418, One)
        Field (RCRG, DWordAcc, Lock, Preserve)
        {
                ,   13, 
            EH2D,   1, 
                ,   1, 
            EH1D,   1
        }

        Method (_INI, 0, NotSerialized)  // _INI: Initialize
        {
            // In most cases this patch does benefit all operating systems,
            // yet on select pre-Windows 10 it may cause issues.
            // Remove If (_OSI ("Darwin")) in case you have none.
            If (_OSI ("Darwin")) {
                EH1D = One  // Disable EHC1
                EH2D = One  // Disable EHC2
            }
        }
    }
}
```


## Clover

Clover支持从10.5开始的Mac。

### 部分说明

#### kexts注入

流程为修补SIP开启->修补程序以启用XNU僵尸代码->修补带有kext注入的race condition->注入kext->恢复SIP状态。

在此过程中，Clover调用了自10.7以来从未使用过的XNU的僵尸代码。

### 组件

#### 内核

CLOVERX64.efi为Clover的内核。

##### 提取

下载Clover的pkg安装包后，在Windows下可用7z打开，一路双击直到看到Clover相关文件即可。在Mac下则可用Suspicious Package。

##### 更新

用新的CLOVERX64.efi覆盖EFI分区中旧的EFI/CLOVER/CLOVERX64.efi即可。

#### ACPI

ACPI/hotpatch是SSDT库，需应用的DSDT/SSDT要放到ACPI/patched。

##### DSDT搜索顺序

顺序如下。若希望每个操作系统使用不同的DSDT，则将相应的DSDT放到各自系统分区的根目录即可。

```
->[所引导的系统分区]/DSDT.aml
->[Clover所在分区]/EFI/CLOVER/OEM/[机器主板名称]/ACPI/patched/DSDT.aml
->[Clover所在分区]/EFI/CLOVER/ACPI/patched/DSDT.aml
->BIOS
```

##### 重命名规律

Clover对ACPI的更名只对原有的ACPI表和ACPI/patched的DSDT起作用，而不对ACPI/patched的SSDT起作用。故若使用Clover的ACPI更名，则SSDT引用的变量需采用新名称而非旧名称。

### 引导界面

#### 快捷键

若设置了跳过引导界面，在启动时点击空格即可重新唤出。

| 快捷键 | 含义                                      |
| ------ | ----------------------------------------- |
| F1     | 帮助                                      |
| F2     | 保存启动日志preboot.log到EFI/CLOVER/misc/ |
| F3     | 显示被隐藏的入口                          |
| F4     | 提取DSDT到EFI/CLOVER/ACPI/origin/         |
| F5     | 提取修正过的DSDT到EFI/CLOVER/ACPI/origin/ |
| F6     | 提取显卡ROM的VideoBios到EFI/CLOVER/misc/  |
| F10    | 截屏到EFI/CLOVER/misc/                    |
| F11    | 重置NVRAM                                 |
| 空格   | 制定菜单项的详细信息                      |
| A      | 关于Clover                                |
| O      | Clover选项                                |
| U      | 退出                                      |

#### Options

##### ACPI patching

| 选项                  | 说明                                                           |
| ------------------- | ------------------------------------------------------------ |
| Tables dropping     | 等同于Clover Configurator中ACPI选项卡的Drop Tables                   |
| `Drop OEM _DSM`     | 丢弃_DSM                                                       |
| DSDT fix mask       | DSDT修复遮盖，等同于Clover Configurator中ACPI选项卡的各种Fix选项              |
| Custom DSDT patches | 自定义的ACPI重命名                                                  |

##### System Parameters

| 选项               | 说明               |
| ------------------ | ------------------ |
| Booter Cfg Command | 自定义的ACPI重命名 |

### 目录层级

#### Kexts

Kexts/10.x下的驱动，只有在Clover引导使用boot with injected kexts时才会加载。

Clover不能加载已经在SLE里的kexts。

#### Driver

r4986以后，Clover会先从EFI/CLOVER/drivers/UEFI加载驱动，若无则从EFI/CLOVER/drivers64UEFI加载。

#### OEM

OEM目录下可存储包含特定机型的配置文件，如EFI/CLOVER/OEM/Inspiron1525/config.plist或EFI/CLOVER/OEM/H61M-S1/UEFI/config.plist外加自定义DSDT.aml。其中有UEFI目录的为UEFI启动的配置文件。

OEM目录下的子目录名称是根据SMBIOS得到的。在Clover启动界面按F2保存日志文件preboot.log，在日志里搜索Cloverrevision，即可得知本机SMBIOS。

#### 最简结构

推荐最简文件结构如下。

```
├── ACPI
├── CLOVERX64.efi
├── config.plist
├── drivers
│   └── UEFI
│       ├── ApfsDriverLoader.efi
│       ├── AudioDxe.efi
│       ├── DataHubDxe.efi
│       ├── FSInject.efi
│       ├── HFSPlus.efi
│       ├── OpenRuntime.efi
│       └── VirtualSmc.efi
└── kexts
    └── Other
        ├── Lilu.kext
        ├── VirtualSMC.kext
        └── WhateverGreen.kext
```

### 基本配置

#### 隐藏启动界面

确保系统正常运作后，打开Clover的config.plist，进行下列操作。

|         选项        |                                               操作                                              |
|---------------------|-------------------------------------------------------------------------------------------------|
| 启动参数            | 取消-v                                                                                          |
| Hide Volume         | 添加Preboot和Recovery                                                                           |
| Timeout             | 0以跳过倒计时（-1为停止倒计时）                                                                   |
| Default Boot Volume | Mac系统盘名称或GUID号或设备路径，如HD(1,GPT,57272A5A-7EFE-4404-9CDA-C33761D0DB3C,0x800,0xFF000) |

找到Mac系统盘下的Library/Preferences/SystemConfiguration/com.apple.Boot.plist，复制到桌面后用文本编辑器打开，删除里面的`-v`参数，保存后拷贝回原来的位置以替换原始文件。重启，系统启动过程中将不会进入Clover界面和啰嗦模式。

若Driver文件夹中APFS驱动使用的不是ApfsDriverLoader.efi，则下载该驱动并用该驱动替换apfs.efi。重启，系统启动过程中将不会出现log代码。

#### 主题配置

将下载好的主题文件夹以主题本身名字命名，并复制到EFI/CLOVER/themes下，在Gui-Theme下填写主题名称即可。

### 配置文件详解

以下不建议的配置默认折叠。

#### ACPI

##### DSDT

<details>
<summary></summary>

|             选项             |                                                                                                    说明                                                                                                    |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ResetAddress                 | 修复重启，默认为0x64（通过PS2控制器重新启动），0x0CF9为通过PCI导轨重新启动，0x0为使用默认的FACP值（可在Clover启动界面按F2后打开日志文件查找Address得到本值，如0000000000000CF9即为0xCF9）                  |
| ResetValue                   | 修复重启，默认为0xFE（通过PS2控制器重新启动），0x06为通过PCI导轨重新启动，0x0为使用默认的FACP值（可在Clover启动界面按F2后打开日志文件查找Value to cause reset得到本值，如06即为0x06）                      |
| DsdtName                     | dsdt.aml的名称                                                                                                                                                                                             |
| AddMCHC                      | 在DSDT中添加Device ID=0X0044的设备，该项启用了IMEI修复程序才会起作用（匹配Intel Clarkdale平台，有些芯片需要这个装置来解决PCI的电源管理问题，一般不启用）                                                                                  |
| AddIMEI                      | 用于intelHDxxx集成显卡，解决完美注入（需要开启fakeid-IMEI）                                                                                                                                                |
| AddPNLF                      | 添加PNLF设置代码，实现系统良好睡眠/唤醒                                                                                                                                                                    |
| AddHDMI                      | 修复HDMI音频输出                                                                                                                                                                                           |
| FixDarwin                    | 使macOS系统（Darwin）被标识为Windows                                                                                                                                                                       |
| FixDisplay                   | 修复显卡代码（增加GFX0以及HDMI音频设置HADU）                                                                                                                                                               |
| FakeLPC                      | 仿冒LPC以加载AppleLPC.kext（Intel and NForce 芯片建议勾选，特别是ICH7/ICH9等老芯片组）                                                                                                                     |
| **->**                       | **以下四条修复IRQ，消除可能导致触摸板和音频设备无法正常工作的任何潜在IRQ冲突**                                                                                                                             |
| FixIPIC                      | 从decice IPIC移除中断语句(IRQ(2))，有利于某些笔记本电源按钮的工作                                                                                                                                          |
| FixRTC                       | 从RTC装置中删除IRQ(0)，作用与patch里的防RTC重置类似                                                                                                                                                        |
| FixTMR                       | 从TMR装置中删除IRQ(8)，适用于较早的dos设备                                                                                                                                                                 |
| FixHPET                      | 添加IRQ(0,8,11)代码，加载原生电源管理（10.9+无需勾选）                                                                                                                                                     |
| **<-**                       |                                                                                                                                                                                                            |
| FixIDE                       | 修复在10.6时五国出现的AppleIntelPIIXATA错误（一般不启用）                                                                                                                                                  |
| FixSBUS                      | 增加SMBusControlle到设备树种，可修复因缺失SBUS控制而在系统log中出现的警告                                                                                                                                  |
| FixDisplay                   | 此补丁将影响所有视频卡，包括嵌入式英特尔GFX                                                                                                                                                                |
| FixIntelGfx                  | 开启对IntelGFX显卡的新补丁设置（需配合imei）                                                                                                                                                               |
| FixWAK                       | 消除警告                                                                                                                                                                                                   |
| FixADP1                      | 将设备AC0重命名为ADP1，效果与直接用ACPI更名等效                                                                                                                                                            |
| FixS3D                       | 修正_S3Dmethods函数，解决睡眠/唤醒问题                                                                                                                                                                     |
| FixACST                      | 重命名ACST，常用于华硕主板以避免冲突（ACST项对于华硕是AC适配器状态，对于苹果是CPU闲置休眠状态的功能）                                                                                                      |
| FixRegions                   | 修正BIOS中的浮动区域（每次BIOS设置更改时OperatingRegions的地址会被更改的区域）                                                                                                                             |
| FixHeaders                   | MACH重启修复，使用不会带来冲突                                                                                                                                                                             |
| FixHDA                       | 修复声卡代码（修正AZAL为HDEF/HDAU，且增加layout -id和pinconfig/MaximumBootBeepVolume属性）                                                                                                                 |
| FixLAN                       | 修复网卡代码（注入网卡属性，修改网卡为内建）                                                                                                                                                               |
| FixAirport                   | 修复无线网卡代码（为支持Airport的无线网卡注入属性，以开启Airport功能）                                                                                                                                     |
| Fixshutdown                  | 修复关机断电代码（主要是添加_PTS函数，判断寄存器arg0值是否为5并防止设置SLP_SMI_EN=1，华硕主板建议勾选），等效于应用\_PTS到ZPTS补丁并使用FixShutdown-USB-SSDT.dsl                                           |
| FixUSB                       | 修复USB代码（包含EHCI代码，注入USB属性，帮助内建USB，是完成睡眠的关键）                                                                                                                                    |
| FixFirewire                  | 修复1394火线代码（在火线控制装置中增加fwhub属性，一般不启用）                                                                                                                                              |
| FixSATA                      | 内建磁盘，修复SATA代码（用ICH6的ID匹配，可修复硬盘图标显示为橙黄色问题）                                                                                                                                   |
| PatchAPIC                    | 修复MADT表                                                                                                                                                                                                 |
| HaltEnabler                  | 在OSX系统启动时设置SLP_SMI_EN=0，断电重启补丁，与OpenHaltRestart.kext作用相同                                                                                                                              |
| UseSystemIO                  | 在生成的_CST表中对`Register (FFixedHW, `与`Register (SystemIO,`进行选择                                                                                                                                    |
| SlpSmiAtWake                 | 在_WAK方法添加SLP_SMI_EN=0，可能有助于解决UEFI引导时的睡眠和关机问题                                                                                                                                       |
| SuspendOverride              | 将睡眠模式扩展为状态3、4、5                                                                                                                                                                                |
| ReuseFFFF                    | 将诸如Name (_ADR, 0xFFFF)的设备转换为(ADR，0)并重新用于注入（如FakeID）                                                                                                                                    |
| Rtc8Allowed                  | 设置RTC长度为8字节                                                                                                                                                                                         |
| Debug                        | 打开后会在EFI/CLOVER/ACPI/origin看到未修补的DSDT-or.aml、经过第一次修补尝试后的DSDT-pa0.aml、经过第二次修补尝试后的DSDT-pa1.aml，一直生成，直至系统能够启动为止                                            |
</details>

##### SSDT

<details>
<summary></summary>

|        选项        |                                                                                                    说明                                                                                                    |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DeleteUnuse        | 从DSDT中删除无用设备                                                                                                                                                                                       |
| Double First State | CPU功耗相关（Ivy Bridge专用）                                                                                                                                                                              |
| Drop OEM           | 获取内建SSDT表单，删除与OEM CPU相关的SSDT以避免在为处理器生成包含P State和C State的SSDT时发生冲突，使用自定义DSDT则默认值为false，使用BIOS.aml则默认值为true（对于Sandy Bridge及较旧硬件使用，非必须勿用） |
| Generate CStates   | 开启C-State功能，可以修复启动时ACPI_SMC_PlatformPlugin错误                                                                                                                                                 |
| Generate PStates   | 开启P-State功能                                                                                                                                                                                            |
| Plugin Type        | 值为0时用ACPI_SMC_PlatformPlugin，为1时用X86PlatformPlugin（Ivy Bridge专用）                                                                                                                               |
| PLimit Dict        | 限制CPU频率，0为不开启，1为降低一级，2为降低两级                                                                                                                                                           |
| UnderVolt Step     | 限制CPU功率，只针对core 2，对i系列CPU无效，0为不开启，设为2可能死机                                                                                                                                        |
| Min Multiplier     | 最小变频数                                                                                                                                                                                                 |
| Max Multiplier     | 最大变频数                                                                                                                                                                                                 |
| smartUPS           | 若打开，在系统概述的电源项中UPS已安装显示为是（只起修饰作用）                                                                                                                                              |
| PatchAPIC          | 在SSDT中添加CPUS=1，解决ACPI表单中NMI丢失时macOS启动可能五国的问题                                                                                                                                         |
| EnableC2/C4/C6/C7  | 在SSDT中添加_CST函数以启用C2/C4/C6/C7休眠                                                                                                                                                                  |
| CpuPm/Cpu0Ist    | 与CPU电源管理有关                                                                                                                                                                                          |
| DMAR               | 防止Vt-d出现问题，修复10.8.2中的AppleACPIPlatform.kext启动问题                                                                                                                                             |
| MATS               | 此表可能包含无法打印的字符以导致内核崩溃，打开该选项可修复ACPI_SMC_PlatformPlugin错误                                                                                                                      |
| BGRT               | 删除BIOS内置的启动图片                                                                                                                                                                                     |
| HPET / MCFG        | 获取MCFG表单                                                                                                                                                                                               |
</details>

##### RenameDevices

以将_SB.PCI0.RP02.PSXS修改为_SB.PCI0.RP02.ARPT为例。

|             选项             |                                                                                                    说明                                                                                                    |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Find Device                  | _SB.PCI0.RP02.PSXS                                                                                                                                                                                         |
| Rename Device                | ARPT                                                                                                                                                                                                       |

##### DropTables

通过签名和/或表标识符删除OEM ACPI表。Signature、TableID和Length都可以在原SSDT表头找到，注意Length需转换为十进制。

##### ResetAddress/ResetValue

默认值分别为0x64和0xFE。若重启不断电，则根据ACPI表中FACP.aml的值更改，其中ResetAddress对应Address，ResetValue对应Value to cause reset，无需转换进制。

##### C3功能

开启C3功能需要C3Latency的值小于1000（0x3e8），可在FACP.aml搜索C3 Latency得到。若大于1000，则在Clover中将C3Latency设为0x3E7，对于支持Turbo技术的CPU可设置为0xFA。

#### BOOT

|          选项          |                                                                                  说明                                                                                 |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DefaultVolume          | 指定默认启动项，可以为卷名（Macintosh）、分区UUID（ABCDEFGH-ZXCV-ASDF-QWER-ASDFGHJKLPOIU）或设备路径（HD(1,GPT,ABCDEFGH-ZXCV-ASDF-QWER-ASDFGHJKLPOIU,0xAAA,0xBBBBB)） |
| DefaultLoader          | 指定加载器路径（如BOOTX64.efi）                                                                                                                                       |
| XMPDetection           | 当检测到XMP内存时读取最佳预设参数或禁止检测XMP内存                                                                                                                    |
| Debug                  | 生成调试输出/EFI/CLOVER/misc/debug.log（大大增加加载时间）                                                                                                            |
| IgnoreNVRAMBoot        | 忽略启动磁盘面板的设置并允许始终启动到同一操作系统                                                                                                                    |
| Secure                 | 在启用安全启动时使用Clover（需要签署Clover的二进制文件并加载证书）                                                                                                    |
| Legacy                 | 加载旧版本Windows/Linux                                                                                                                                               |
| LegacyBiosDefaultEntry | 指定以Legacy模式启动的硬盘（在Legacy选项选中后才会显示）                                                                                                              |
| Timeout                | 0为直接跳过引导界面，-1为停止倒计时                                                                                                                                   |
| RtcHibernateAware      | 在从休眠状态唤醒时启用RTC内存擦除，等同于启用AppleRTC补丁并使用HibernationFixup.kext（至少在Ivy Bridge和更高版本上使用，非必要请勿使用）                              |
| SignatureFixup         | 为True时签名值来自休眠映像，为False时签名值为零，内核将其复制到映像中                                                                                                 |

#### Boot Graphics

|   选项   |           说明          |
|----------|-------------------------|
| UI Scale | 高分辨率显示器可设置为2 |

#### CPU

<details>
<summary></summary>

|             选项             |                                                                                                    说明                                                                                                    |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Frequency MHz                | CPU频率（如3300-3.3GHz，建议不要使用）                                                                                                                                                                     |
| BusSpeed kHz                 | 主频（如133330，代表133MHz）                                                                                                                                                                                    |
| Type                         | CPU类型（如0x0901，代表i3）                                                                                                                                                                     |
| QPI                          | CPU的总线速度（如5000-i3 2120，装饰作用）                                                                                                                                                  |
| C2/C4/C6                     | 启用CPU的Turbo功能                                                                                                                                                                                         |
| Type                         | CPU类型（修饰功能）                                                                                                                                                                                        |
| Latency                      | 进入C3状态时发出的C3进入等待时间，最大为0x3E8（1000），0x3E9表示SpeedStep未打开，笔记本用户可用0x00FA以启用电源管理                                                                                        |
</details>

#### Devices

<details>
<summary></summary>

|             选项             |                                                                                                   说明                                                                                                   |
|------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ResetHDA                     | 音频控制器初始化，在冷启动后无法正常工作、但重启或唤醒后仍可以工作时使用，等效于使用CodecCommander.kext                                                                                                  |
| AFGLowPowerState             | 消除空闲模式后音频输出上的刺耳声音，等效于DeviceProperties-Add-PCIRoot...-AFGLowPowerState-<01000000>                                                                                                    |
| USB/ixOwnership              | 使USB注入保持启用状态而仅关闭所有权修复，解决卡Enabling Legacy Matching问题（也可在BIOS启用XHCI Hand Off解决）                                                                                           |
| USB/AddClockID               | 启用良好的深度睡眠（无法通过键盘或鼠标输入/退出），需要配合USBInjection启用，等效于DeviceProperties-Add-PCIRoot...-AAPL,clock-id                                                                         |
| USB/HighCurrent              | 为iPad充电等提供更多电源                                                                                                                                                                                 |
| UseIntelHDMI                 | 如果为TRUE，hda-gfx=onboard-1将被注入到GFX0和HDEF设备中，另外如果存在ATI或Nvidia HDMI设备，它们将被分配给onboard-2；如果为FALSE，则ATI或Nvidia设备以及HDAU设备（如果存在）将在onboard-1上                |
| NoDefaultProperties          | 影响DSDT修复程序，并强制它们生成空的_DSM，仅适用于显示、声音、LAN和WiFi                                                                                                                                  |
| IntelMaxValue                | 需开启SetIntelBacklight和SetIntelMaxBacklight，建议Sandy/IvyBridge用1808，Haswell/Broadwell用2776，Skylake/Kabylake用1295                                                                                |
</details>

#### Gui

<details>
<summary></summary>

|     选项     |                                                                                                   说明                                                                                                   |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ConsoleMode  | 将控制台驱动程序切换到请求的控制台模式，供shell、boot.efi、dumpueficalls等使用，0（默认）为禁用，Min/Max为最低/最高模式，分别适合慢速/快速控制台，输入数字为选择特定模式，在boot.log中可查，非必要不打开 |
| Mouse/Mirror | 单轴负移动速度                                                                                                                                                                                           |
| ShowOptimus  | 在某些BIOS中启用或禁用Optimus的情况下为其供电                                                                                                                                                            |
| KbdPrevLang  | 修复旧macOS使用英语以外的语言时弹出窗口中使用混合语言的问题，会导致启动Recovery HD时始终保持英语（仅在使用AptioMemoryFix/OsxAptioFixV3且无EmuVariableUefi时可用）                                        |
| PlayAsync    | 同步声音播放                                                                                                                                                                                             |
</details>

#### Graphics

Clover检测到Intel iGPU时，如果config.plist中不存在Graphics部分，则会自动启用Intel显卡注入。

<details>
<summary></summary>

|             选项             |                                                                               说明                                                                               |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| VRAM                         | 设置显存（单位为MB）                                                                                                                                             |
| Load VBios                   | 从EFI/CLOVER/OEM/[model]/ROM或EFI/CLOVER/ROM/[vendor]_[device].rom加载视频BIOS（用于不带任何外部文件的移动Radeon卡，或向仅包含UEFI视频BIOS的卡提供旧版视频BIOS） |
| DualLink                     | 设为0可解决某些机型显示四分之一屏幕问题                                                                                                                          |
| Patch VBios                  | 获得最高监视器分辨率支持（若分辨率不满足需求，可安装驱动CsmVideoDxe.efi）                                                                                        |
| HorizontalSyncPulseWidth     | 注入32可解决某些机型出现八个苹果的问题                                                                                                                           |
| VideoPorts                   | 显卡上的端口数量（包括TVO和/或HDMI）                                                                                                                             |
| FBName                       | 选择帧缓冲区名称                                                                                                                                                 |
| NVCAP                        | 注入NVCAP（仅对Nvidia视频卡有效）                                                                                                                                |
| display-cfg                  | 显卡CFG（仅对Nvidia视频卡有效）                                                                                                                                  |
| RadeonDeInit                 | 取消初始化Radeon卡（解决AMD Radeon HD6xxx及更高版本在睡眠后无法唤醒的问题）                                                                                      |
</details>

#### Kernel and Kexts Patches

<details>
<summary></summary>

|            选项           |                                       说明                                       |
|---------------------------|----------------------------------------------------------------------------------|
| KernelCpu                 | 消除某些与旧系统中不受支持的CPU（例如Yonah，Atom或Haswell）相关的内核混乱        |
| AppleRTC                  | 修复RTC问题，确保重启后不会重置BIOS                                              |
| KernelLapic               | HP笔记本电脑存在Lapic问题，可以通过使用boot参数`cpus=1`或使用此选项来解决        |
| KernelHaswellE            | 阻止Haswell-E兼容性检查                                                          |
| ATI Connectors Controller | 修改AMD视频卡控制器从而驱动AMD卡                                                 |
| KernelPM                  | 阻止写入MSR 0xe2（适用于10.8.5和10.9内核），防止在使用XCPM时在启动时引起内核恐慌 |
| AppleIntelCPUPM           | 与KernelPM相同，但是使用AppleIntelCPUPowerManagement时                           |
| KernelXCPM                | 适用于IvyBridge CPU的XCPM补丁                                                    |
| InfoPlistPatch            | 修补kext的Info.plist                                                             |
</details>

#### Rt variables

|        选项       |                                   说明                                   |
|-------------------|--------------------------------------------------------------------------|
| BooterConfig      | 一般为0x28                                                               |
| CsrActiveConfig   | 0x0-启用SIP，0x3-部分禁用SIP（允许加载未签名的kexts），0x3E7-完全禁用SIP |
| ROM / UseMacAddr0 | 将板载MAC地址作为ROM                                                     |

#### SMBIOS

|          选项         |                                    说明                                    |
|-----------------------|----------------------------------------------------------------------------|
| Trust                 | 优先考虑在SMBIOS或SPD中找到的内存描述符值（Mac中的内存描述不正确时需禁用） |
| Slots AAPL injections | 填充PCI列表（一般不使用此法）                                              |

#### System Paramaters

|      选项      |                                                            说明                                                            |
|----------------|----------------------------------------------------------------------------------------------------------------------------|
| BacklightLevel | 监控亮度水平，最大值为0xFFFF（全背光），最小值为0x0（无），默认值为0x0501（只有部分系统会受到此参数的影响，台式机可忽略）  |
| InjectSystemID | 设置为YES时注入设备树ID（IODeviceTree:/efi/platform/system-id），NO时注入运行时变量（IODeviceTree:/options/platform-uuid） |
| InjectKexts    | 是否从EFI/CLOVER/kexts/10.xx中注入kexts                                                                                    |

### 配置文件简化

#### 自动生成

在终端输入以下命令自动生成config.plist，位置默认在个人文件夹目录。

```
/usr/local/bin/clover-genconfig >config.plist
```

#### 手动修改

|           选项          |                                  操作                                 |
|-------------------------|-----------------------------------------------------------------------|
| ACPI                    | 禁用所有更名补丁                                                      |
| Gui                     | Scan处只勾选Entries和Tool以在引导界面出现UEFI Shell和Boot Options菜单 |
| Kernel and Kext Patches | 禁用四个选项卡中所有的自带项                                          |
| System Parameters       |  删除BacklightLevel                                                                    |
### OcQuirks

Clover 5120移植了OpenCore的OpenRuntime.efi以替代较旧的内存管理驱动，Big Sur需要使用该方法驱动。需更新Clover Configurator至5.16及以上以适配新增的OcQuirks选项。

下载链接如下。

```
https://github.com/ReddestDream/OcQuirks
```

移除UEFI目录中的内存管理驱动，包括AptioMemoryFix、OsxAptioFix3Drv、OsxAptioFix2Drv、OsxAptioFixDrv、OsxLowMemFixDrv、OsxAptioFix2Drv-free2000。

将OcQuirks.efi、OpenRuntime.efi和OcQuirks.plist放到Clover的Drivers文件夹中，重启即可。若未找到OcQuirks，则采用以下默认值。

| Quirk                         | 默认值 | 说明                                                         |
| ----------------------------- | ------ | ------------------------------------------------------------ |
| AvoidRuntimeDefrag            | True   | 开启后会修复UEFI的运行服务，例如日期、时间、NVRAM、电源控制等 |
| DevirtualiseMmio              | False  | 开启后会减少Stolen内存占用空间，扩大Slide=N值的范围, 适用于大多数主板 |
| DisableSingleUser             | False  | 开启后会禁止Cmd+S和-s的使用，使设备更加接近于T2白苹果    |
| DisableVariableWrite          | False  | 开启后会禁止NVRAM写入，在Z390/HM370等没有原生macOS支持NVRAM的主板上需要开启 |
| DiscardHibernateMap           | False  | 开启后会重用原始休眠内存映射，仅某些旧硬件需要               |
| EnableSafeModeSlide           | True   | 开启后会允许在安全模式下使用Slide值                          |
| EnableWriteUnprotector        | True   | 开启后会在执行期间删除CR0寄存器中的写入保护                  |
| ForceExitBootServices         | True   | 开启后会确保ExitBootServices即使在MemoryMap发生更改时也能调用成功（除非有必要，否则请勿使用） |
| MmioWhitelist                 | Array  | 设计为用plist dict值填充，描述使用DevirtualiseMmio的Quirk时对特定固件功能至关重要的地址 |
| ProtectMemoryRegions          | False  | 开启后会用于修复人为制造和睡眠唤醒的问题（AvoidRuntimeDefrag已经修复了这个问题，所以尽可能避免使用这个Quirk） |
| ProtectSecureBoot             | False  | 避免操作系统对UEFI安全启动变量（db/dbx/PX/KEK）进行写入（主要用于避免Insyde主板和MacPro 5,1的NVRAM问题） |
| ProtectUefiServices           | False  | 保护UEFI服务不被固件覆盖                                     |
| ProvideConsoleGopEnable       | True   | 控制台句柄缺少图形输出协议时需要                    |
| ProtectCsmRegion              | False  |                                                              |
| ProvideCustomSlide            | True   | 如果Slide值存在冲突，此选项将强制macOS使用一个伪随机值（只有在遇到OnlyN/256slidevaluesareusable!时需要） |
| RebuildAppleMemoryMap         | True   | 生成与macOS兼容的内存映射                                    |
| SetupVirtualMap               | True   | 开启后会将SetVirtualAddresses调用修复为虚拟地址              |
| SignalAppleOS                 | False  | 通过OS Info将macOS加载的信息报告给其它操作系统，用于在Windows中为MacBook启用iGPU |
| SyncRuntimePermissions        | True   | 同步运行时环境的内存权限                                     |
| ShrinkMemoryMap               | False  |                                                              |
| QuirksProvideConsoleGopEnable | True   |                                                              |

### 相关资源

#### 配置文件在线编辑

```
https://cloudclovereditor.altervista.org/cce/index.php
```

#### 

## OpenCore

OpenCore是取代Clover的新引导程序，从0.6.2版本起支持从10.4开始的操作系统，可使Mac拥有更快的启动速度。

OpenCore与Clover一个很重要的不同在于，每个SSDT和kext都需要在config.plist中指定启动顺序。因此每次对ACPI和Kexts文件夹进行变动时，都需要修改config.plist。

在OpenCore主界面，点击空格以显示全部驱动器。

### 部分说明

#### kexts注入

流程为使现有的预链接内核和kexts做好注入准备->使用新的kexts在EFI环境中重建缓存->添加此新缓存。

操作系统不可知的预链接内核格式自10.6（v2）以来一直保持不变，且所涉及的修补少，因此该方法稳定性高。OpenCore还支持预链接内核（v1，10.4/10.5），无缓存，支持Mkext和KernelCollections，因此支持所有Intel版本的Mac。

不能从OpenCore注入IO80211Family，否则将导致内核panic。

#### SMBIOS与ACPI

默认情况下，OpenCore将假定对所有操作系统注入ACPI和SMBIOS信息。CustomSMIOSGuid和设置为 Custom的CustomSMBIOSMode这两个quirk在未来可能会无法使用，所以我们只推荐在其他操作系统中出现某些软件损坏的情况下使用此选项。

#### DEBUG和RELEASE

DEBUG版本可以极大地帮助调试启动问题，但是会增加一些明显的启动时间延迟。RELEASE版本引导时间短，但是在OpenCore中没有提供有用的调试信息，这使得故障排除更加困难。

### 从Clover转移

#### 搭建引导

将下载的OpenCore压缩包解压，打开后将EFI文件夹复制到EFI分区下。

VBoxHfs和AudioDxe已和OpenCorePkg打包在一起，因此已经无需再额外下载AppleSupportPkg（同时该项目已经存档），只需下载OpenCorePkg和OcBinaryData即可。

复制Docs下的Sample.plist到EFI/OC，并更名为config.plist。若模拟2011年即以前的Mac机型，则复制SampleFull.plist。按照需求，将OpenCorePkg、OcBinaryData中的驱动放入Drivers文件夹，将OcBinaryData中Resources内的文件放入Resources文件夹。

开始时配置应尽量简单，建议初始配置如下。务必保证所有kexts均为最新版。完成文件放置后，根据配置文件详解部分，以Clover的config.plist为基础，配置OpenCore的config.plist。

```
├── ACPI
├── Resources
│   └── OcBinaryData
├── Drivers
│   ├── AudioDxe.efi
│   ├── HfsPlus.efi
│   ├── OpenCanopy.efi
│   └── OpenRuntime.efi
├── Kexts
│   ├── Lilu.kext
│   ├── VirtualSMC.kext
│   └── WhateverGreen.kext
├── Tools
│   ├── ChipTune.efi
│   ├── ...
│   └── VerifyMsrE2.efi
├── OpenCore.efi
└── config.plist
```

#### kexts转移

OpenCore支持Clover下使用的大部分kexts，但有部分kexts已经被集成，具体如下。

|          名称          |                    备注                   |
|------------------------|-------------------------------------------|
| NullCPUPowerManagement | 整合到Kernel-Emulate-DummyPowerManagement |
| BT4LEContinuityFixup   | 整合到Kernel-Quirks-ExtendBTFeatureFlags  |

#### 消除冲突

打开终端并输入以下命令。

```
// 删除Clover设置面板
sudo rm -rf /Library/PreferencePanes/Clover.prefPane

// 删除ESP分区下的NVRAM.plist
rm -rf /Volumes/（你的 ESP 分区）/NVRAM.plist

// 删除RC脚本
rm -rf "/etc/rc.clover.lib"
rm -rf "/etc/rc.boot.d/10.save_and_rotate_boot_log.local"
rm -rf "/etc/rc.boot.d/20.mount_ESP.local"
rm -rf "/etc/rc.boot.d/70.disable_sleep_proxy_client.local.disabled"
rm -rf "/etc/rc.boot.d/80.save_NVRAM_plist.local"
rm -rf "/etc/rc.shutdown.local"
rm -rf "/etc/rc.boot.d"
rm -rf "/etc/rc.shutdown.d"

// 删除Clover新开发的NVRAM守护程序CloverDaemonNew
launchctl unload '/Library/LaunchDaemons/com.slice.CloverDaemonNew.plist'
rm -rf '/Library/LaunchDaemons/com.slice.CloverDaemonNew.plist'
rm -rf '/Library/Application Support/Clover/CloverDaemonNew'
rm -rf '/Library/Application Support/Clover/CloverLogOut'
rm -rf '/Library/Application Support/Clover/CloverWrapper.sh'

// 获取logoutHook路径
sudo defaults read com.apple.loginwindow LogoutHook

// 删除LogoutHook.command
sudo rm -rf $(sudo defaults read com.apple.loginwindow LogoutHook)

// 清空LogoutHook的触发设置
sudo defaults delete com.apple.loginwindow LogoutHook
```

完成后可重启并重置一次NVRAM，然后通过OpenCore引导，查看是否成功。

若成功，则可复制Clover的kext到Kexts文件夹，并继续以下操作完善。若由于SSDT/DSDT而无法进入系统，即应当通过以下操作修复。

#### 修改SSDT/DSDT

由于OpenCore中的SSDT、DSDT、SMBIOS等将会对所有操作系统生效，因此需要修改SSDT和DSDT以使其只对Mac生效。具体方法为在代码生效部分加上以下框架。

```
If (_OSI ("Darwin"))
{
    // 原本的代码
}   
```

若不是自己编写的SSDT，可直接用OC-little包中的SSDT替换。

修改后的文件在各引导器通用。为验证效果，将修改过的SSDT和DSDT放回Clover中，重启后在终端输入以下命令。如果日志中不存在ACPI Error，则修改成功，可将文件复制到OpenCore的ACPI文件夹。

```
log show --last boot | grep -Ei "ACPI"
```

#### 摆脱ACPI Quirks

OpenCore没有Clover众多的ACPI Quirks，需要通过相关SSDT实现，列表如下。

| ACPI Quirks            | 取代方法                                                                                      |
| ---------------------  | ----------------------------------------------------------------------------------------- |
| FixIPIC                | OC-little声卡IRQ补丁中的SSDT-IPIC                                                               |
| FixSBUS                | OC-little注入设备中的SBUS_SMBU补丁                                                                |
| FixShutdown            | OC-little的PTSWAK综合补丁，需要添加其中的EXT1插件补丁                                                      |
| FixDisplay             | 使用WhateverGreen和定制缓冲帧补丁                                                                   |
| AddMCHC                | OC-little添加缺失的设备中的SSDT-MCHC                                                               |
| FixHDA                 | AppleALC能够处理这个问题                                                                          |
| FixHPET/FixRTC/FixTIMR | OC-little声卡IRQ补丁中的SSDT-HPET_RTC_TIMR-fix                                                  |
| FixSATA                | 开启OpenCore中名为ExternalDiskIcons的Quirk，也可使用innie.kext                                       |
| FixADP1                | 见下方说明                                                                                     |
| FixRTC                 | OC-little的声卡IRQ补丁                                                                         |
| FixTIMR                | OC-little的声卡IRQ补丁                                                                         |
| AddPNLF                | OC-little注入设备中的PNLF注入方法                                                                   |
| AddIMEI                | 使用WhateverGreen                                                                           |
| FixIntelGfx            | 使用WhateverGreen                                                                           |
| AddHDMI                | 使用WhateverGreen                                                                           |
| DisableASPM            | 在设备属性（DeviceProperties）中分别添加相关设备的PCI总线位置并注入属性pci-aspm-default \| DATA \| <00>                                             |
| PluginType             | OC-little注入X86中的SSDT-PLUG补丁                                                               |
| Generate P/C States    | 六代以前CPU才需要设置，可用ssdtPRGen.sh生成对应的 SSDT                                                     |
| 降压和超频                  | 使用sVoltageShift                                                                           |
| AFGLowPowerState | 在设备属性（DeviceProperties）中注入属性AFGLowPowerState \| DATA \| <01000000> |
| ResetHDA | 安装JackFix以及配套的守护进程 |

对于FixADP1，可直接执行重命名change AC0_ to ADP1。根据原始DSDT中对AC0_设备的定义，可能还需要用SSDT为ADP1设备注入Name (_PRW, Package (0x02) {0x1C,0x03})，SSDT代码如下。

```
DefinitionBlock ("", "SSDT", 2, "SUKA", "FixADP1", 0x00001000)
{
External (_SB_.ADP1, DeviceObj)
External (_SB_.AC0_, DeviceObj)
If (_OSI ("Darwin"))
{
    Scope (\_SB)
    {
        Device (ADP1)
        {
            Name (_ADR, Zero)
            Name (_PRW, Package (0x02) {
                0x1C,
                0x03
            })
            Method (_STA, 0, NotSerialized)
            {
                Return (0x0F)
            }
        }
    }
  }
} 
```

也可不进行重命名，直接使用以下SSDT。注意该SSDT已注入Name (_PRW, Package (0x02) {0x1C,0x03})。

```
DefinitionBlock ("", "SSDT", 2, "SUKA", "FixADP1", 0x00001000)
{
External (_SB_.ADP1, DeviceObj)
External (_SB_.AC0_, DeviceObj)
If (_OSI ("Darwin"))
{
    Scope (\_SB)
    {
        Scope (AC0_)
        {
            Method (_STA, 0, NotSerialized)
            {
                Return (Zero)
            }
        }

        Device (ADP1)
        {
            Name (_ADR, Zero)
            Name (_PRW, Package (0x02) {
                0x1C,
                0x03
            })
            Method (_STA, 0, NotSerialized)
            {
                Return (0x0F)
            }
        }
    }
  }
} 
```

### 引导更新

下载新的引导包后，覆盖EFI分区中的EFI/BOOT/BOOTx64.efi，EFI/OC/OpenCore.efi，EFI/OC/Drivers/OpenRuntime即可。

### 配置文件生成

可通过Opencore Gen-X自动生成，链接如下。

```
https://github.com/Pavo-IM/OC-Gen-X
```

### 配置文件详解

用Xcode或ProperTree打开config.plist，也可使用OpenCore Configurator。根据以下内容进行配置。

#### ACPI

##### Add

此处需添加EFI/OC/ACPI下的DSDT/SSDT路径。以添加电池热补丁SSDT-BAT0.aml为例，格式如下。

|  选项   |     设置      |      说明      |
| ------- | ------------- | -------------- |
| Comment |    Battery    | 注释（可不填） |
| Enabled |     True      |   启用/禁用    |
|  Path   | SSDT-BAT0.aml | DSDT/SSDT路径  |

注意应把DSDT放到最前面，而SSDT的顺序一般可以随意。

##### Delete

禁用某个ACPI表，常用于禁用DAMR来关闭VT-d，一般无需修改。

##### Patch

对DSDT（SSDT）的内容进行查找和替换，相当于Clover里的改名补丁。如EC0->EC补丁，书写格式如下。

|      选项      |       设置       |           说明          |
|----------------|------------------|-------------------------|
| Comment        | change EC0 to EC | 注释（可不填）          |
| Count          | 0                | 执行次数（0代表不限制） |
| Enabled        | True             | 启用/禁用               |
| Find           | 4543305F         | 寻找的十六进制内容      |
| Limit          | 0                |                         |
| Mask           | /                |                         |
| OemTableId     | /                |                         |
| Replace        | 45435F5F         | 替换为的十六进制内容    |
| ReplaceMask    | /                |                         |
| Skip           | 0                | 跳过前N个，0表示不跳过  |
| TableLength    | 0                |                         |
| TableSignature | /                |                         |

通过Count和Skip的应用，可以达成Clover下Tgtbridge的效果。具体而言，若想将DSDT中的某一特定字段重命名，则可在Skip下填写在该字段之前有多少个同名字段，在Count下填写该改名规则需执行几次。如现需将DSDT中的第54和55个_PRW改为XPRW，则Skip填53，Count填2。

对于华擎、华硕、微星主板，可能会遇到RTC问题而无法进入系统。此时可应用以下补丁。

|      选项      |        设置       |
|----------------|-------------------|
| Comment        | RTC fix           |
| Count          | 0                 |
| Enabled        | True              |
| Find           | A00A9353 54415301 |
| Limit          | 0                 |
| Mask           | /                 |
| OemTableId     | /                 |
| Replace        | A00A910A FF0BFFFF |
| ReplaceMask    | /                 |
| Skip           | 0                 |
| TableLength    | 0                 |
| TableSignature | /                 |

##### Quirks

|       选项       | 设置 |                             说明                             |
| ---------------- | ---- | ------------------------------------------------------------ |
| FadtEnableReset  |  NO  |   在旧硬件上修复重启和关机（如果遇到关机变重启可尝试打开）   |
| NormalizeHeaders |  NO  |        清除ACPI头字段（macOS 10.13/某些主板需要打开）        |
|  RebaseRegions   | YES  | 尝试试探性地重新定位ACPI内存区域，使用自定义DSDT则必须开启（换硬件、升级BIOS等对硬件的操作会对ACPI表产生影响） |
|    ResetHwSig    |  NO  | 休眠相关（重启后因无法维持硬件签名而导致从休眠中唤醒的硬件需要开启，台式机不需要） |
| ResetLogoStatus  |  NO  |   无法在有BGRT表的系统上显示OEM Windows标志的硬件需要开启    |

#### Booter

##### MmioWhitelist

默认的第一项是为Haswell芯片提供的内存寻址修复，第二项是ACPI、PCI device同时释放到内存时发生0x1000内存地址被占用而卡在PCI Configration的问题修复。一般无需修改。

##### Quirks

|          选项          | 内容 |                             说明                             |
| ---------------------- | ---- | ------------------------------------------------------------ |
|   AvoidRuntimeDefrag   | YES  |       修复UEFI的运行服务（日期/时间/NVRAM/电源控制等）       |
|    DevirtualiseMmio    |  NO  | 减少Stolen内存占用空间，扩大Slide=N值的范围（若要添加slide=1以使用连续性的内存注入方式则关闭） |
|   DisableSingleUser    |  NO  |            禁用单用户模式， 更接近基于T2的计算机             |
|  DisableVariableWrite  | YES  |   在没有原生macOS支持NVRAM的主板上需要开启以禁止NVRAM写入    |
|  DiscardHibernateMap   |  NO  |       开启后会重用原始休眠内存映射（仅某些旧硬件需要）       |
|  EnableSafeModeSlide   | YES  |                 允许在安全模式下使用Slide值                  |
| EnableWriteUnprotector | YES  | 在执行期间删除CR0寄存器中的写入保护，保证NVRAM能正常写入而不受到UEFI内的一些服务的影响 |
| ForceExitBootServices  |  NO  | 开启后会确保ExitBootServices即使在MemoryMap发生更改时也能调用成功，让非常老旧的主板也能使用内存寻址（非必要勿使用） |
|  ProtectMemoryRegions  |  NO  |                   与AvoidRuntimeDefrag类似                   |
|   ProtectSecureBoot    | YES  |                    保护UEFI安全启动被写入                    |
|  ProtectUefiServices   | YES  |              解决Z390系列主板卡开机卡++++的问题              |
|    ProtectCsmRegion    |  NO  | 开启后会用于修复人为制造和睡眠唤醒的问题（AvoidRuntimeDefrag已经修复了这个问题，故避免使用） |
|   ProvideCustomSlide   | YES  | 如果Slide值存在冲突，此选项将强制macOS使用一个伪随机值（遇到Only N/256 slide values are usable!时需要） |
|    ProvideMaxSlide     | YES  |                启用KASLR则选择YES，否则选择NO                |
| RebuildAppleMemoryMap  |  NO  | 重新生成内存地图来匹配苹果系统，遇到内存问题导致无法开机时可尝试使用（与EnableWriteUnprotector存在冲突关系，若开启此项则需关闭另一项，同时此项需要与SyncRuntimePermissions搭配使用） |
|    SetupVirtualMap     | YES  |               建立虚拟内存并对物理内存进行映射               |
|    ShrinkMemoryMap     |  NO  |     有巨大且不兼容内存映射的主板需要开启（非必要勿使用）     |
|     SignalAppleOS      |  NO  | 通过OS Info将macOS加载的信息报告给其它操作系统，用于在Windows中MacBook 启用iGPU |
| SyncRuntimePermissions |  NO  | 修正硬件在注入内存时无法注入权限的问题。一般此类问题存在2018年后的主板 |


#### DeviceProperties

##### Add

此处内容可以用Hackintool生成后直接复制，注意设备路径的修改。主要路径如下。

|            路径            |        用途       |
|----------------------------|-------------------|
| PciRoot(0x0)/Pci(0x1f,0x3) | 注入音频Layout ID |
| PciRoot(0x0)/Pci(0x2,0x0)  | 注入缓冲帧补丁    |

##### Delete

删除/屏蔽设备属性，一般无需修改。

#### Kernel

##### Add

此处需要填写kexts的具体内容，OpenCore会按照顺序执行，故需确保Lilu.Kext始终在第一位。其他优先级高的为Lilu的插件，如VirtualSMC、AppleALC、WhateverGreen等。

若不知道kexts的加载顺序或加载内容，可在Clover Configuration中选择boot.log选项卡，并点击Generate log生成启动日志，在日志中搜索对应kext即可。

|      选项      |         内容        |                                                                               说明                                                                              |
|----------------|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| BundlePath     | Lilu.kext           | kext的名称                                                                                                                                                      |
| Comment        |                     | 注释（可不填）                                                                                                                                                  |
| Enabled        | YES                 | 启用/禁用                                                                                                                                                       |
| ExecutablePath | Contents/MacOS/Lilu | 隐藏在kext中的实际可执行文件的路径，可通过右键单击并选择`显示包内容` 查看，通常为 `Contents/MacOS/[kext]`），没有可执行文件的空壳kexts则留空（如USBPorts.kext） |
| MaxKernel      |                     | 支持的最大系统版本（`19`为10.15，`18`为10.14），一般留空                                                                                                        |
| MinKernel      |                     | 支持的最小系统版本                                                                                                                                              |
| PlistPath      | Contents/Info.plist | 隐藏在kext中的Info.plist路径                                                                                                                                    |

当Plugins内有kexts时，需一并加载，格式如下。

|      选项      |              内容              |
|----------------|--------------------------------|
| BundlePath     | A.kext/Contents/PlugIns/B.kext |
| ExecutablePath | Contents/MacOS/B               |
| PlistPath      | Contents/Info.plist            |

此处需注意VoodooPS2Controller与VoodooI2C的注入。注入顺序如下，注意需放到kexts加载的最后。

```
VoodooPS2Controller.kext
VoodooPS2Controller.kext/Contents/PlugIns/VoodooInput.kext
VoodooPS2Controller.kext/Contents/PlugIns/VoodooPS2Keyboard.kext
VoodooPS2Controller.kext/Contents/PlugIns/VoodooPS2Mouse.kext
VoodooPS2Controller.kext/Contents/PlugIns/VoodooPS2Trackpad.kext
VoodooI2C.kext/Contents/PlugIns/VoodooGPIO.kext
VoodooI2C.kext/Contents/PlugIns/VoodooI2CServices.kext
VoodooI2C.kext/Contents/PlugIns/VoodooInput.kext // 需禁用该项，防止与VoodooPS2Controller中的VoodooInput冲突
VoodooI2C.kext
VoodooI2CHID.kext
```

##### Emulate

仿冒不支持的CPU（如奔腾、赛扬），一般无需使用。

|    选项   |                       内容                      |                                                  说明                                                  |
|-----------|-------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| CpuidMask | FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF | 化为二进制，某位为1代表该位数值需用CpuidData的对应数值替换，否则不需要（需要仿冒时一般设置为全FF即可） |
| CpuidData | C3 06 03 00 00 00 00 00 00 00 00 00 00 00 00    | CPU的被仿冒位（填写时需要使用小端规则，即该示例对应的CPU ID为0x0306C3）                                |

仿冒示例如下。

|    选项   |                       内容                      |
|-----------|-------------------------------------------------|
|           | **Haswell-E(0x0306F2) to Haswell(0x0306C3)**        |
| CpuidMask | FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 |
| CpuidData | C3 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00 |
|           | **Broadwell-E (0x0406F1) to Broadwell (0x0306D4)**  |
| CpuidMask | FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 |
| CpuidData | D4 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00 |

##### Block

屏蔽系统里的kext，在Identifier中输入kext的捆绑包标识符即可，一般为`com.apple.driver.[kext]`，可在关于本机-系统报告…-功能扩展中查到。部分kext的捆绑包标识符如下。

|             名称            |                 捆绑包标识符                 |                           备注                           |
|-----------------------------|----------------------------------------------|----------------------------------------------------------|
| AppleIntelLpssI2C           | com.apple.driver.AppleIntelLpssI2C           |                                                          |
| AppleIntelLpssI2CController | com.apple.driver.AppleIntelLpssI2CController |                                                          |
| AppleRTC                    | com.apple.driver.AppleRTC                    | 禁用RTC关机校验（Base为__ZN8AppleRTC14updateChecksumEv） |

##### Patch

用于添加系统内核补丁、Kext 补丁、AMD CPU补丁等，等同于Clover的KextToPatch和KernelToPatch。默认的第一、二项用于修复Apple RTC，若华硕主板出现RTC错误而无法开机，可以尝试打开这两个中的其中一个（一次只用一个）以修复华硕主板重启丢失BIOS设置以及需要按F1跳过安全模式的问题。

##### Quirks

|           选项          | 内容 |                                                                                    说明                                                                                   |
|-------------------------|------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AppleCpuPmCfgLock       | NO   | 若设备的CFG-Lock开启则设置为YES（尽可能用Grub关闭BIOS的CFG-Lock以避免开启，与Clover的AppleIntelCPUPM对应）                                                                |
| AppleXcpmCfgLock        | NO   | 若设备的CFG-Lock开启则设置为YES（与Clover的KernelPM对应）                                                                                                                 |
| AppleXcpmExtraMsrs      | NO   | 主要在没有原生电源管理的CPU上启用，禁用奔腾和某些Xeon等不受支持的CPU所需的多个MSR访问（Haswell-E、Broadwell-E、Skylake-X需开启，与Clover的KernelXCPM对应）                |
| AppleXcpmForceBoost     | NO   | 强制拉高睿频，建议在长期高负载的专业设备上使用，至强系列的处理器开启这个选项会受益                                                                                        |
| CustomSMBIOSGuid        | NO   | 对UpdateSMBIOSMode自定义模式执行GUID修补，用于戴尔笔记本电脑（等同于Clover的DellSMBIOSPatch）                                                                             |
| DisbaleIOMapper         | NO   | 需要绕过VT-d且BIOS中无法禁用时使用                                                                                                                                        |
| DisableRtcChecksum      | NO   | 越过两条RTC检查0x58及0x59（一般卡RTC应当先使用RTCMemoryFixup.kext而非开启该项）                                                                                         |
| DummyPowerManagement    | NO   | 禁用AppleIntelCpuPowerManagement原生电源管理，用于更好的替代NullCpuPowerManagement.kext                                                                                   |
| ExternalDiskIcons       | NO   | 硬盘图标补丁（macOS将内部硬盘视为外接硬盘时使用，对于Z87及以下版本的NVMe，只需通过DeviceProperties添加内置属性）                                                          |
| IncreasePciBarSize      | NO   | 将IOPCIFamily中32位PCI Bar的大小从1GB增加到4GB（在BIOS中启用Above4GDecoding是一种更加干净和安全的方法，某些X99板可能需要开启，这些主板通常会在IOPCIFamily上遇到内核崩溃） |
| LapicKernelPanic        | NO   | 禁用由AP核心lapic中断造成的内核崩溃，通常用于惠普电脑（等同于Clover的Kernel LAPIC）                                                                                       |
| PanicNoKextDump         | YES  | 在发生内核崩溃时阻止输出Kext列表                                                                                                                                          |
| PowerTimeoutKernelPanic | YES  | 修复macOS Catalina中由于设备电源状态变化超时而导致的内核崩溃                                                                                                              |
| ThirdPartyTrim          | NO   | 为SSD启用TRIM指令（NVMe SSD会自动被macOS加载，SATA SSD可以在终端执行sudo trimforce enable开启）                                                                          |
| XhciPortLimit           | NO   | 解除十五端口限制补丁（不建议依赖，建议定制USB）                                                                                                                           |

#### Misc

##### BlessOverride

|       选项       |               内容               |                             说明                             |
| ---------------- | -------------------------------- | ------------------------------------------------------------ |
| Item 0（String） | \EFI\Microsoft\Boot\bootmgfw.efi | 用于覆盖Windows的bootmgfw.efi的位置，以便识别Windows引导项，OpenCore和Windows的引导文件在同一硬盘的同一ESP分区下时使用 |

##### Boot

|        选项        |      内容     |                                                                    说明                                                                   |
|--------------------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ConsoleBehaviourOs | ForceGraphics | 修复OC引导界面                                                                                                                            |
| ConsoleBehaviourUi | ForceText     | 修复OC引导界面                                                                                                                            |
| HibernateMode      | None          | 与系统内的休眠模式配合，引导进系统会还原休眠前的状态，会影响SSD寿命（None-关闭休眠支持，Auto-自动检测RTC和NVRAM模式，RTC-RTC模式）        |
| HideAuxiliary      | YES           | 默认隐藏以下引导项，按空格键显示全部：macOS恢复、在自定义引导项时定义为Auxiliary的引导项、在 Tools中添加的工具（如Clean NVRAM）           |
| HideSelf           | NO            | 在OpenCore的启动选择中隐藏自身EFI分区的启动项                                                                                             |
| ConsoleAttributes  | 0             | 给引导选择界面添加特效，填入字体颜色和背景颜色的值的16进制之和                                                                            |
| PickerAttributes   | 0             | 0x0004-简化主题图标下的文字，0x0008-使用老式的图标                                                                                        |
| PickerAudioAssist  | NO            | 朗读屏幕上选择项的内容                                                                                                                    |
| PollAppleHotKeys   | NO            | 允许在引导过程中使用苹果原生快捷键（需要与Quirk中KeySupport=Yes或UsbKbDxe.efi结合使用, 具体体验取决于主板固件，可能会导致选择分区时卡住） |
| Resolution         | 1920x1080     | 修复OC引导界面                                                                                                                            |
| ShowPicker         | YES           | 显示OpenCore的UI，用于查看可用引导项                                                                                                      |
| TakeoffDelay       | 0             | 在启动前延迟n毫秒，提升键盘快捷键识别的正确率（n 的有效范围为5000-10000，32bit以内的正整数）                                              |
| Timeout            | 0             | 设置引导项等待时间（0为关闭倒计时，相当于Clover的-1），设置为NO可以跳过倒计时                                           |
| PickerMode         | Builtin       | 使用OpenCore的默认GUI（External-使用其它GUI，Apple-使用原生GUI，黑苹果不支持）                                                            |

ConsoleAttributes的颜色代码含义如下。

| 颜色代码     | 指代颜色 |
| ------------ | -------- |
| **字体颜色** |          |
| 0x00         | 黑       |
| 0x01         | 蓝       |
| 0x02         | 绿       |
| 0x03         | 青       |
| 0x04         | 红       |
| 0x05         | 品红     |
| 0x06         | 棕       |
| 0x07         | 浅灰     |
| 0x08         | 深灰     |
| 0x09         | 浅蓝     |
| 0x0A         | 浅绿     |
| 0x0B         | 浅青     |
| 0x0C         | 浅红     |
| 0x0D         | 浅品红   |
| 0x0E         | 黄       |
| 0x0F         | 白       |
| **背景颜色** |          |
| 0x00         | 黑       |
| 0x10         | 蓝       |
| 0x20         | 绿       |
| 0x30         | 青       |
| 0x40         | 红       |
| 0x50         | 品红     |
| 0x60         | 棕       |
| 0x70         | 浅灰     |

#### Debug

一般无需修改。若需开启Debug功能，建议使用DEBUG或NOOPT版本。

|       选项      |    内容    |                                                              说明                                                             |
|-----------------|------------|-------------------------------------------------------------------------------------------------------------------------------|
| DisableWatchDog | NO         | 若macOS在启动时卡在某些地方，可设置为YES以排除错误干扰                                                                        |
| DisplayDelay    | 0          |                                                                                                                               |
| DisplayLevel    | 2147483714 | 0为隐藏所有Debug信息，2147483714为在屏幕上显示所有Debug信息                                                               |
| Target          | 19         | 0为关闭日志记录，3为允许屏幕输出日志，19为允许屏幕输出UEFI变量日志，65为在ESP分区根目录生成日志文件但屏幕上不显示日志 |

DisplayLevel的内容含义如下。

|    内容    |                 说明                 |
|------------|--------------------------------------|
| 0x00000001 | DEBUG_INIT                           |
| 0x00000002 | DEBUG，NOOPT和RELEASE中的DEBUG_WARN  |
| 0x00000004 | DEBUG_LOAD                           |
| 0x00000008 | DEBUG_FS                             |
| 0x00000010 | DEBUG_POOL                           |
| 0x00000020 | DEBUG_PAGE                           |
| 0x00000040 | DEBUG，NOOPT中的DEBUG_INFO           |
| 0x00000080 | DEBUG_DISPATCH                       |
| 0x00000100 | DEBUG_VARIABLE                       |
| 0x00000400 | DEBUG_BM                             |
| 0x00001000 | DEBUG_BLKIO                          |
| 0x00004000 | DEBUG_NET                            |
| 0x00010000 | DEBUG_UNDI                           |
| 0x00020000 | DEBUG_LOADFILE                       |
| 0x00080000 | DEBUG_EVENT                          |
| 0x00100000 | DEBUG_GCD                            |
| 0x00200000 | DEBUG_CACHE                          |
| 0x00400000 | 在自定义版本中的DEBUG_VERBOSE        |
| 0x80000000 | DEBUG，NOOPT和RELEASE中的DEBUG_ERROR |

一般开启0x00000002、0x00000040和0x80000000。0x00000002+0x00000040+0x80000000=0x80000042，转换为十进制为2147483714，填入此值即可。

Target的内容含义如下。

| 内容 |             说明             |
|------|------------------------------|
| 0x01 | 启用日志记录                 |
| 0x02 | 启用屏幕调试                 |
| 0x04 | 启用日志记录到数据中心       |
| 0x08 | 启用串行端口日志记录         |
| 0x10 | 启用UEFI变量日志记录         |
| 0x20 | 启用非易失性UEFI变量日志记录 |
| 0x40 | 启用记录到文件               |

一般开启0x01、0x02、0x10和0x40。0x01+0x02+0x10+0x40=0x53，转换为十进制为83，填入此值即可。

#### Security

|         选项        |    内容    |                                                                                  说明                                                                                  |
|---------------------|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AllowNvramReset     | YES        | 允许在引导选择界面和快捷键Cmd+Opt+P+R按下时重置NVRAM                                                                                                                   |
| AllowSetDefault     | YES        | 允许使用Ctrl+Enter和Ctrl+数字锁定默认启动项                                                                                                                            |
| AuthRestart         | NO         | 允许重启FileVault2分区时无需再次输密码                                                                                                                                 |
| BootProtect         | Bootstrap  | 保证opencore.efi的永久性，以免遭到其他操作系统对开机顺位的破坏（需保证RequestBootVarRouting开启）                                                                      |
| ExposeSensitiveData | 3          | 用NVRAM则必须填3（2-原生NVRAM，11-在3的基础上添加主板OEM信息，HWMonitorSMC2和NVMeFix需要主板OEM信息才能正常工作）                                                      |
| Vault               | Optional   | OpenCore自身的加密和安全保护（Optional-不强制要求vault.plist和 vault.sig文件存在，Basic-强制要求 vault.plist存在，Secure-强制要求 vault.sig签名文件和vault.plist存在） |
| HaltLevel           | 2147483648 |                                                                                                                                                                        |
| RequireSignature    | NO         | 黑苹果的Vault加密方式                                                                                                                                                  |
| RequireVault        | NO         | 是否开启黑苹果加密                                                                                                                                                     |
| ScanPolicy          | 0          | 0表示允许扫描所有可用的硬盘                                                                                                                                            |

对于ScanPolicy值，设为0可允许所有存在的源都启动，但通过简单的计算，可得到更大范围的灵活性与安全性。

计算ScanPolicy值时只需将所有十六进制值相加即可，全部累加后需要将此十六进制值添加到ScanPolicy（首先需要将其转换为十进制值，粘贴时Xcode会自动将其转换）。

| 位置                | 名称                          |
| ------------------- | ----------------------------- |
| 0x00000001 (bit 0)  | OC_SCAN_FILE_SYSTEM_LOCK      |
| 0x00000002 (bit 1)  | OC_SCAN_DEVICE_LOCK           |
| 0x00000100 (bit 8)  | OC_SCAN_ALLOW_FS_APFS         |
| 0x00000200 (bit 9)  | OC_SCAN_ALLOW_FS_HFS          |
| 0x00000400 (bit 10) | OC_SCAN_ALLOW_FS_ESP          |
| 0x00010000 (bit 16) | OC_SCAN_ALLOW_DEVICE_SATA     |
| 0x00020000 (bit 17) | OC_SCAN_ALLOW_DEVICE_SASEX    |
| 0x00040000 (bit 18) | OC_SCAN_ALLOW_DEVICE_SCSI     |
| 0x00080000 (bit 19) | OC_SCAN_ALLOW_DEVICE_NVME     |
| 0x00100000 (bit 20) | OC_SCAN_ALLOW_DEVICE_ATAPI    |
| 0x00200000 (bit 21) | OC_SCAN_ALLOW_DEVICE_USB      |
| 0x00400000 (bit 22) | OC_SCAN_ALLOW_DEVICE_FIREWIRE |
| 0x00800000 (bit 23) | OC_SCAN_ALLOW_DEVICE_SDCARD   |

默认值为0xF0103，十进制为983299，是以下各项的组合。

```
OC_SCAN_FILE_SYSTEM_LOCK 
OC_SCAN_DEVICE_LOCK
OC_SCAN_ALLOW_FS_APFS
OC_SCAN_ALLOW_DEVICE_SATA 
OC_SCAN_ALLOW_DEVICE_SASEX 
OC_SCAN_ALLOW_DEVICE_SCSI 
OC_SCAN_ALLOW_DEVICE_NVME
```

建议添加OC_SCAN_ALLOW_DEVICE_USB，变为0x00200000，转换为十进制为3080451。

#### Tools

用于运行OC调试工具，例如验证CFG锁（VerifyMsrE2.efi）。

|   选项    |      内容       |            说明            |
| --------- | --------------- | -------------------------- |
| Arguments |        /        |                            |
|   Name    |   VerifyMsrE2   | OpenCore启动项中显示的名称 |
|  Comment  | Verify CFG Lock |       注释（可不填）       |
|  Enabled  |       YES       |         启用/禁用          |
|   Path    | VerifyMsrE2.efi |   Tools文件夹下的文件名    |

可在此处添加bootx64.efi以引导UEFI Shell（刷BIOS）、添加shellx64.efi以引导Grub Shell（改BIOS条目）等。

#### Entires

指定OpenCore无法自动找到的无规律引导路径。

| 选项      | 内容                                                         | 说明                                                         |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Arguments | /                                                            |                                                              |
| Auxiliary | NO                                                           | 隐藏引导项                                                   |
| Name      | CustomOS                                                     | OpenCore启动项中显示的名称                                   |
| Comment   | Not signed for security reasons                              | 注释（可不填）                                               |
| Enabled   | YES                                                          | 启用/禁用                                                    |
| Path      | PciRoot(0x0)/Pci(0x1,0x1)/Pci(0x0,0x0)/NVMe(0x1,11-22-33-44-55-66-77-88)/HD(1,GPT,00000000-0000-0000-0000-000000000000,0x800,0x64000)/EFI/BOOT/BOOTX64.EFI | 引导磁盘的PCI路径，可以通过 OpenCoreShell 的map命令或在Clover引导项找到 |

#### NVRAM

##### Add

###### 4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14

表示Booter Path。

|          选项          |   内容   |                                                               说明                                                               |
|------------------------|----------|----------------------------------------------------------------------------------------------------------------------------------|
| UIScale                | 01       | OpenCore UI和引导第一阶段缩放（01为正常大小，等效于Clover中BooterConfig的0x28，02为HIDPI，等效于Clover中BooterConfig的0x2A） |
| DefaultBackgroundColor | 00000000 | 控制第一阶段苹果标志后面的背景颜色，格式为16进制颜色RGBA（黑色为00000000，灰色为BFBFBF00）                                       |
| EFILoginHiDPI          | /        |                                                                                                                                  |
| flagstate              | /        |                                                                                                                                  |
| UIScale                | /        |                                                                                                                                  |

###### 7C436110-AB2A-4BBB-A880-FE41995C9F82

表示SIP。

|        选项       |                      内容                     |                                                                                                                             说明                                                                                                                            |
|-------------------|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| boot-args         | -v debug=0x100 nv_disable=1 slide=1 vsmcgen=1 | 引导参数（vsmcgen=1为MacOS 11专用，用于暴露SMC部件）                                                                                                                                                                                                        |
| bootercfg         | log=0                                         | 自行添加，关闭开机时的代码                                                                                                                                                                                                                                  |
| csr-active-config | E7030000                                      | SIP 设置（00000000-SIP完全开启，等效于CsrActiveConfig的0x0，30000000-允许未签名的Kext加载并允许写入受保护的文件系统路径，等效于CsrActiveConfig的0x3，67000000-SIP基本关闭，等效于CsrActiveConfig的0x6，E7030000-SIP完全关闭，等效于CsrActiveConfig的0x3E7） |
| nvda_drv          | 删除                                          | 设为31时启用NVIDIA WebDrivers，无N卡应删除此项                                                                                                                                                                                                              |
| prev-lang:kbd     | 7A682D48616E733A323532                        | 将默认语言设置为简体中文（留空为英文）                                                                                                                                                                                                                      |
| SystemAudioVolume | 0x46                                          | 0x80为静音                                                                                                                                                                                                                                                  |

##### Block

强制重写NVRAM变量，由于Add不会覆盖NVRAM中已经存在的值，boot-args需要利用此项来刷新。

##### LegacyEnable

允许从NVRAM.plist中读取NVRAM变量。没有原生NVRAM的设备或macOS下硬件NVRAM工作不正常的设备设置为YES，工作正常的设备设置为NO。

##### LegecyOverwrite

允许nvram.plist中的变量覆盖现有NVRAM的变量，一般选择NO。

##### LegacySchema

用于分配NVRAM变量，与LegacyEnable配合使用。打开7C436110-AB2A-4BBB-A880-FE41995C9F82这一栏，添加以下两个item。

| 名称    | 类型   | 内容                 |
| ------- | ------ | -------------------- |
| item 11 | String | efi-boot-device      |
| item 12 | String | efi-boot-device-data |

##### WriteFlash

在某些系统运行时不能将易失性变量转换为非易失性变量的UEFI固件上可开启此项。一般选择NO。

#### PlatformInfo

|        选项        |                 内容                 |                                              说明                                             |
|--------------------|--------------------------------------|-----------------------------------------------------------------------------------------------|
| Auto               | YES                                  | 自动注入机型信息                                                                              |
| MLB                | C029314044N0000CB                    | MLB（从Clover复制）                                                                           |
| ROM                | 3631A456E9C3                         | ROM（从Clover复制）                                                                           |
| AdviseWindows      | YES                                  | 允许重启到ESP分区不是磁盘中第一个分区的磁盘中的Windows                                        |
| SpoofVendor        | YES                                  | 仿冒制造商为Acidanthera以避免冲突                                                             |
| SystemProductName  | MacBookPro15,3                       | 系统型号（从Clover复制）                                                                      |
| SystemSerialNumber | C02Z5TZ6LVCG                         | 系统序列号（从Clover复制）                                                                    |
| SystemUUID         | 0CC4E03F-2998-4685-A433-B5ACAB56E9C3 | 硬件UUID（从Clover复制）                                                                      |
| UpdateDataHub      | YES                                  | 更新DataHub                                                                                   |
| UpdateNVRAM        | YES                                  | 更新NVRAM                                                                                     |
| UpdateSMBIOS       | YES                                  | 更新SMBIOS（Dell笔记本可能需要改为Custom，相当于Clover的DellSMBIOSPatch的一部分）             |
| UpdateSMBIOSMode   | Create                               | 用新分配的EfiReservedMemoryType替换原有的表（戴尔笔记本需要使用Custom并开启CustomSMBIOSGuid） |

对于SystemUUID，一般应使用主板UUID，以免破坏Windows的激活环境。

主板的UUID可以在BIOS中查看，如果BIOS中看不到，可以通过传统方式启动Windows（不能是OC引导），在命令行中查看。打开cmd，输入以下命令即可。

```
wmic
csproduct list full
```

#### UEFI

##### ConnectDrivers

强制加载.efi驱动程序，更改为NO将自动连接UEFI驱动程序以获得更快的启动速度。但并非所有驱动程序都可以自行连接，某些文件系统驱动程序可能无法加载，因此此处填YES。

##### Drivers

添加efi驱动的名称。

##### Audio

这里的声卡设置只与 UEFI 环境相关，不影响系统内音频。如果要让Duang和VoiceOver等其它音频功能工作，需要将OCBinaryData中的语音资源包放置于EFI分区的EFI/OC/Resources/Audio下，同时AudioDxe需要安装在Driver文件夹中。

| 选项            | 内容                | 说明                                                         |
| --------------- | ------------------- | ------------------------------------------------------------ |
| AudioSupport    | YES                 | 启用音频支持（不支持DP类的数字音频）                         |
| AudioDevice     | PciRoot(0x0)/Pci... | 声卡设备的PCI地址                                            |
| AudioCodec      | 0                   | 声卡的Codec地址，可以在IORegistryExplorer的HDEF-IOHDACodecDevice-IOHDACodecAddress中获得（一般是0x0） |
| AudioOut        |                     | 指定的输出设备，从0到声卡总输出数每个都试一遍，声卡的总输出数可以在Debug 版本的OpenCore日志中获得（n Outputs） |
| MinimumVolume   |                     | 输出最小音量，有效值为0-100（如果VolumeAmplifier公式计算出的最小音量小于这里给出的值，Duang就不会被播放） |
| PlayChime       | YES                 | 播放Duang                                                    |
| VolumeAmplifier | 1000                | 音量在原有基础上放的百分比，有效范围0-1000                   |

##### Input

|        选项        | 内容  |                             说明                             |
| ------------------ | ----- | ------------------------------------------------------------ |
| KeyForgetThreshold |   5   |          按住按键后每个键之间的时间间隔（单位毫秒）          |
|  KeyMergeTheshold  |   2   |             按住按键被重置的时间间隔（单位毫秒）             |
|     KeySupport     |  YES  |     开启OC的内置键盘支持（若引导界面无法选择分区则禁用）     |
|   KeySupportMode   | Auto  | 键值转换协议模式（V1-UEFI旧版输入协议，V2-UEFI新输入协议，AMI-APTIO输入协议） |
|      KeySwap       |  NO   |                    交换Command和Option键                     |
|   PointerSupport   |  NO   |          修复UEFI选择器协议（华硕z87/z97需要开启）           |
| PointerSupportMode |   /   |            指定OEM协议，当前仅支持Z87和Z97 ASUS板            |
|  TimerResolution   | 60000 | 固件时钟刷新的频率（单位100纳秒），普通电脑填50000，华硕主板填60000 |

##### Output

| 选项                    | 内容            | 说明                                                         |
| ----------------------- | --------------- | ------------------------------------------------------------ |
| TextRenderer            | BuiltinGraphics | 文字渲染模式（BuiltinGraphics-使用OpenCore内置文字渲染的图形模式，并同时启用OpenCore自带的控制台管理，支持HIDPI和全屏范围显示，SystemGraphics-使用主板固件自带文字渲染的图形模式，并同时启用OpenCore自带的控制台管理，SystemText-使用主板固件自带文字渲染的文字模式，并同时启用OpenCore自带的控制台管理，SystemGeneric-使用主板固件自带文字渲染的文字模式和自带的控制台管理） |
| ConsoleMode             | /               | TextRenderer使用Builtin时此项设置不生效                      |
| Resolution              | Max             | Max将会尝试开启最大分辨率，也可填写`宽x高@Bpp`（如3840x2160@32），其中Bpp为显示位深，留空将不会改变UEFIe的默认分辨率（在固件没有GOP时该选项失效） |
| ClearScreenOnModeSwitch | NO              | 切换到文本模式之前用黑色填充整个屏幕（从图形模式切换到文本模式时，某些固件仅清除屏幕的一部分，导致屏幕上残留之前绘制的图片，此情况可打开该选项） |
| DirectGopRendering      | NO              | 直接使用OpenCore内置的GOP渲染控制台，主要用于提升或修复MacPro5,1的渲染问题（除非开启后能明显感觉到有改进，否则不要开启） |
| IgnoreTextInGraphics    | NO              | 修复不用-v开机时日志覆盖苹果标志输出的问题                   |
| ReplaceTabWithSpace     | NO              | 某些设备在UEFI Shell中编辑文件使用Tab键出问题时启用（只作用于TextRenderer: System...的文字渲染） |
| ProvideConsoleGop       | YES             | 选择启动项之后不出现啰嗦模式跑码时启用，开启此选项能最大可能保证OpenCore UI和苹果标志以正确分辨率显示（macOS引导加载程序需要GOP，即图形输出协议，存在于控制台句柄上，大部分的笔记本都不提供GOP，台式机的独立显卡可以单独刷入GOP） |
| ReconnectOnResChange    | NO              | 有些固件在GOP分辨率改变后要求重新连接控制器才能输出文本，开启这个选项会导致UEFI Shell中启动OpenCore时直接黑屏，尽量避免开启 |
| SanitiseClearScreen     | YES             | 修复OpenCore在高分屏中以1024x768显示的问题（要同时开启带有OpenCore自带的控制台管理的TextRenderer并将ConsoleMode的内容留空） |
| DirectGopRendering      | NO              | 使用内置显卡直接渲染开机画面                                 |
| UgaPassThrough          | NO              | 通过UGA代替无法使用GOP的主板，一般带UEFI的主板以及显卡请选择NO |

##### Protocols

|           选项          | 内容 |                                                             说明                                                             |
|-------------------------|------|------------------------------------------------------------------------------------------------------------------------------|
| AppleAudio              | YES  | 安装Apple Audio协议以在OpenCore中使用 VoiceOver，目前该协议支持在macOS 10.13及以上播放音频，老系统使用的AppleHDA协议暂未支持 |
| AppleBootPolicy         | NO   | 确保虚拟机/旧白苹果上兼容APFS                                                                                                |
| AppleDebugLog           | NO   | 重新安装苹果错误日志界面                                                                                                     |
| AppleEvent              | NO   | 虚拟机并具有Vault（文件保险箱）的Mac需要开启                                                                                 |
| AppleFramebufferInfo    | NO   | 虚拟机专用                                                                                                                   |
| AppleImageConversion    | NO   | 重建Apple图标（重新安装Apple Image Conservation协议）                                                                        |
| AppleKeyMap             | NO   | 重建苹果功能键（重新安装Apple Key Map协议）                                                                                  |
| AppleRtcRam             | NO   | 重装AppleRTC协议                                                                                                             |
| AppleSmcIO              | YES  | 重新安装Apple SMC I/O协议（VirtualSmc.efi已经被替代为此选项）                                                                |
| AppleUserInterfaceTheme | NO   | 重新安装Apple User Interface Theme协议                                                                                       |
| ConsoleControl          | YES  | 用内置版本替换控制台控制协议                                                                                                 |
| DataHub                 | NO   | 重新安装Data Hub协议                                                                                                         |
| DeviceProperties        | NO   | 确保在VM/旧白苹果上完全兼容                                                                                                  |
| FirmwareVolume          | NO   | 修复Filevault的UI问题，提高FileVault的兼容性                                                                                 |
| HashServices            | NO   | 修复运行FileVault时鼠标光标大小不正确的问题                                                                                  |
| OSInfo                  | NO   | 为主板或者其它程序接收来自macOS引导工具的消息                                                                                |
| UnicodeCollation        | NO   | 修复主板UEFI Shell的兼容性（通常用于IvyBridge或更旧的设备）                                                                  |

##### Quirks

|          选项          | 内容 |                             说明                             |
| ---------------------- | ---- | ------------------------------------------------------------ |
|  DeduplicateBootOrder  |  NO  | 当RequestBootVarRouting选项开启时，一些其他的操作系统可能在某些主板（如华硕）中会找不到自己的引导而重新创建，最终导致黑果在没有清理NVRAM的情况下无法进入系统时，出现该情况则可开启 |
| ExitBootServicesDelay  |  0   | 主板退出时间（单位微秒），新主板填0，旧主板（如Z87pro）填3000000-5000000 |
| IgnoreInvalidFlexRatio | YES  |          BIOS中无法禁用MSR_FLEX_RATIO(0x194)时开启           |
|  ReleaseUsbOwnership   |  NO  | 从固件驱动程序中释放USB控制器所属权，相当于Clover的FixOwnership（大部分主板都有自动释放USB所有权的功能） |
| RequestBootVarFallback |  NO  | 一些固件会主动扫描系统启动盘的位置而阻止OC扫描，遇到此问题时可开启 |
| RequestBootVarRouting  | YES  | 从EFI_GLOBAL_VARIABLE_GUID中为OC_VENDOR_VARIABLE_GUID请求redirectBoot前缀变量，启用此项以便能够在与macOS引导项设计上不兼容的固件中可靠地使用启动磁盘设置 |
|     TscSyncTimeout     |  0   | 帮助X99/X299主板开启全核同步功能（但睡眠唤醒后失效，故应优先使用TSCAdjustReset.kext来做全核同步） |
|    UnblockFsConnect    | YES  |      惠普笔记本在OpenCore引导界面没有引导项时设置为YES       |

##### APFS

| 选项             | 内容 | 说明                                                         |
| ---------------- | ---- | ------------------------------------------------------------ |
| EnableJumpstart  | YES  | 从APFS容器中加载内置APFS驱动（确保在Scanpolicy中放开APFS格式） |
| GlobalConnect    | NO   | 一些主板需要选择YES才能完全加载APFS（如HP笔记本）            |
| HideVerbose      | YES  | 隐藏啰嗦模式                                                 |
| JumpstartHotPlug | YES  | 加载APFS格式的热插设备                                       |
| MinDate          | 0    | 加载最低发行的APFS格式（想加载旧的发行日期的APFS格式硬盘则填-1） |
| MinVersion       | 0    | 加载最低版本的APFS格式（0代表从high sierra开始加载，-1代表所有版本） |

##### ReservedMemory

用于保留内存。一些硬件会在把硬件EFI写进内存过程中占用必要的UEFI运行空间，所以可以通过此项预留内存保证UEFI的运行。一般情况下无需处理。

### 组件

#### 内核

在添加引导项时，OpenCore必须从EFI/BOOT/BOOTx64.efi启动而不是从EFI/OC/OpenCore.efi启动。


### 基本配置

#### 内存分配

有以下两种关于内存的设置。

##### KASLR内存注入

KASLR是更加高效的内存注入方式。

DevirtualiseMmio选择yes，ProtectUefiServices选择yes，删除boot-args里面的slide=1，删除Drivers文件夹下的Memoryallocations.efi。

##### 连续性内存注入

DevirtualiseMmio选择yes，ProtectUefiServices选择no，保留boot-args里面的slide=1，保留Drivers文件夹下的Memoryallocations.efi。

#### 修复引导界面显示

在config.plist中修改以下配置。

|       路径      |         选项         |                  设置                 |
|-----------------|----------------------|---------------------------------------|
| UEFI->Protocols | ConsoleControl       | YES                                   |
| UEFI->Quirks    | ProvideConsoleGop    | YES                                   |
|                 | IgnoreTextInGraphics | YES                                   |
|                 | SanitiseClearScreen  | YES                                   |
| Misc->Boot      | ConsoleMode          | 留空（有时可设置为Max）               |
|                 | Resolution           | 显示器的正常分辨率（如4k为3840x2160） |
| **4代及以下**   |                      |                                       |
|                 | ConsoleBehaviourOs   | Graphics                              |
|                 | ConsoleBehaviourUi   | ForceText                             |
| **5代+**        |                      |                                       |
|                 | ConsoleBehaviourOs   | ForceGraphics                         |
|                 | ConsoleBehaviourUi   |   ForceText（有时可设置为Graphics/Text）                                    |


### 常见问题

```
https://dortania.github.io/OpenCore-Install-Guide/troubleshooting/extended/opencore-issues.html#stuck-on-a-black-screen-before-picker
```

#### 卡在[EB|#LOG:EXITBS:START]

未关闭BIOS的CFG锁导致。

在OpenCore配置文件中设置Kernel-Quirks-AppleCpuPmCfgLock，Kernel-Quirks-AppleXcpmCfgLock和UEFI-Quirks-IgnoreInvalidFlexRatio为Yes。

#### BIOS重设或重启/关机后发送到安全模式

AppleRTC的问题。

在OpenCore配置文件中设置Kernel-Quirks-DisableRtcChecksum为Yes。如果仍然有问题，则需要使用RTCMemoryFixup.kext并排除范围。

#### 使用OpenCore引导启动Windows出现蓝屏

在OpenCore配置文件中设置Booter-Quirks-SyncRuntimePermissions。




```
https://www.cmlnt.com/?p=239
```


## Chameleon

Chameleon只支持传统BIOS，不支持UEFI。Enoch和Chimera都属于Chameleon的分支。

```
来自 tonymacx86 的 MacMan 开发了 变色龙的一个分支 Chimera：
https://tonymacx86.blogspot.com/2011/04/chimera-unified-chameleon-bootloader.html

[教程] Win版变色龙安装到EFI方法
http://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1072629
【Chameleon_2.4svn_r2908】
https://cloud.189.cn/t/jymqYvaeYryi
```

### 专用启动参数

|         参数        |                     含义                     |
|---------------------|----------------------------------------------|
| -F                  | 忽略org.Chameleon.boot.plist中额外的启动标志 |
| UseKernelCache=Yes  | 使用内核缓存安装kexts                        |
| GraphicsEnabler=Yes | 打开Graphics Enabler功能                     |
| IGPEnabler=Yes      | 打开IGP启动器，帮助Mac在集显下更好的使用     |
|                     |                                              |



# ACPI

ACPI表是一组硬件描述表，包括SSDT/DSDT等。DSDT描述计算机设备信息，是这些硬件表中最重要的一个，系统根据DSDT驱动相应的硬件。SSDT也称为热补丁，可以在不更改DSDT源文件的情况下完成对DSDT的修复，并实现相应功能。

因此，对DSDT的修补可以直接通过修改DSDT文件本身，也可以通过SSDT避免替代整个DSDT所带来的其它问题。用SSDT修补DSDT的基本思路是，SSDT中提供某设备经修补的函数，启动时引导器将会把SSDT中的内容注入到DSDT中。在SSDT的函数注入DSDT时，为防止DSDT中部出现相同的函数导致冲突，一般需要对DSDT中的原函数进行重命名。

Windows 98是第一个支持ACPI的操作系统，Windows Vista以后的Windows则要求电脑必须支持ACPI。Linux不需要ACPI也可以运行，但是在现代设备上禁用ACPI将会导致绝大部分硬件无法运行。Android中也内置了一个精简的ACPI。

Mac从PowerPC架构迁移到Intel架构后开始采用ACPI。但iOS并没有ACPI，而是完全使用自己的私有架构iBoot。搭载M1的Mac一样不存在ACPI，使用IBoot作为Bootloader。因此搭载M1的Mac上是几乎没有可能运行Windows的。

## 重命名法则

重命名法则通常写在引导器的配置文件中，在启动时引导器自动完成该工作。一般而言ACPI重命名为四个字符，对应16进制的ASCII码为八位。SSDT的应用常常要配合ACPI的更名，但更名不只适用于SSDT。

注意，更新BIOS有可能造成重命名失效。

### 获取ASCII码

打开Hackintool并切换到计算器选项卡，在ASCII码一栏输入原来的字段名，在16进制值一栏会显示对应的八个数字。

也可打开终端，利用以下命令得到ASCII码十六进制数。

```
// 获取BIFA的ASCII码十六进制数
echo -n BIFA | xxd
```

### 更名补丁

常见十六进制码含义如下。Noop一般用于补足字节数量。

| 十六进制码 |     源码     |
|------------|--------------|
| 00         | {            |
| A0         | If           |
| A4 0A 0F   | Return(0x0F) |
| A3         | Noop         |

#### 无限定条件

若需要将DSDT中所有的变量AAAA都替换为BBBB，则在config.plist中添加以下更名补丁即可。

```
Comment: change AAAA to BBBB
Find: 41414141 // AAAA的ASCII码十六进制数
Replace: 42424242 // BBBB的ASCII码十六进制数
```

#### 有限定条件

若只需将DSDT中某一个地方的变量AAAA替换为BBBB，则需要划定替换范围。

##### 通过增加ASCII码位数

用Hex Friend打开DSDT文件，将搜索模式改为Text，搜索要替换的字段名。定位到要替换的字段位置后，选中该字段并将光标向后拉，直至选中约22个十六进制数。复制该值并搜索，查看该DSDT中该内容是否只出现了一次。若是，则将本内容填入Find中，而Replace填写替换了前8位十六进制数后的内容。

该方法相当于为替换增加了冗余信息，利用该冗余信息定位到需要修改的位置，示例如下。

```
// 带有14位冗余信息（12345678 901234）用于定位
Comment: change AAAA to BBBB
Find: 41414141 12345678 901234
Replace: 42424242 12345678 901234
```

##### 通过TgtBridge

Clover可通过Tgtbridge限定字段的查找范围。定义Tgtbridge后，Clover只会在Tgtbridge值对应的设备中进行字段修改。

以将DSDT中设备CCCC内的变量AAAA替换为BBBB为例，更名补丁如下。

```
Comment: change AAAA to BBBB in CCCC
Find: 41414141
Replace: 41414141
Tgtbridge: 43434343
```

## 提取ACPI表

### 通过Clover

此方法所提取的ACPI最纯净，推荐使用。

在Clover引导界面按F4即可，所有ACPI表将被提取到EFI/Clover/ACPI/origin目录下。

### 通过MaciASL

Mac下打开MaciASL，默认打开本机DSDT。

### 通过UefiTableExtract

该工具从UEFI BIOS固件中提取ACPI表。

打开以下链接并下载压缩包，解压后运行install.command，再运行UefiTableExtract即可。

```
https://github.com/Saman-VDR/uefiTableExtract
```

若遇到诸如`Namespace lookup failure, AE_ALREADY_EXISTS`的错误，可尝试以下命令进行修复。

```
cd AML
mv SSDT-trouble.aml SSDT-trouble.bin && iasl -d SSDT-trouble.bin
iasl -da DSDT.aml SSDT*.aml
```

### 通过acpidump.efi

通过以下链接下载工具，并复制到Clover或OpenCore的Tools文件夹中。对于OpenCore，还需在config.plist的Misc-Tools下添加该工具的相关条目。

```
https://www.acpica.org/downloads/uefi-support
```

在Clover或OpenCore的引导界面上将会显示该工具，调用后会生成DSDT.dat，修改后缀名为DSDT.aml即可。若无法打开此工具，则可在引导界面进入EFI Shell，输入以下命令以手动运行。

```
fs0: // 替代为自己的EFI分区标识
ls
cd EFI\OC\Tools // 或EFI\Clover\Tools
acpidump.efi -b -n DSDT -z
```

## 编译与反编译

ACPI表主要有两种形式，dsl为未编译过的源码，aml为编译过的应用文件。dat扩展名与aml完全相同。

尽管可以直接用MaciASL打开aml文件，但这样的操作实际上是对单个文件进行反汇编。由于DSDT和SSDT间可能存在复杂的应用关系，独立反汇编将可能导致错误，因此建议先将aml反编译为dsl文件。

以下所有操作均需ACPI表的编译器iasl，可通过以下链接下载。

```
https://bitbucket.org/RehabMan/acpica/downloads/
```

### 编译

```
iasl -l DSDT.dsl
```

### 反编译

将iasl和要反汇编的文件放到同一个文件夹，然后进入终端，切换到该目录并输入以下命令。

```
sudo cp iasl /usr/bin
// 对于较旧的ACPI表需要加-da参数，较新的ACPI表（Skylake及更高）则不用加
iasl [-da] -dl DSDT.aml SSDT*.aml
```

## SSDT示例

仅为示例，SSDT应当根据自己硬件的实际情况进行编写。

<details>
<summary></summary>

|        名称       |                                                                                         解释                                                                                         |
|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SSDT-Config       | SSDT控制入口文件                                                                                                                                                                     |
| SSDT-LPC          | 正确识别LPC总线到系统                                                                                                                                                                |
| SSDT-SMBUS        | 正确识别SMBus到系统                                                                                                                                                                  |
| SSDT-DMAC         | 将DMA控制器公开给系统                                                                                                                                                                |
| SSDT-MCHC         | 将内存控制器暴露在系统中                                                                                                                                                             |
| SSDT-IGPU         | 将属性添加到集成显卡设备，可以实现HDMI音频以及正确显示                                                                                                                               |
| SSDT-Disable_DGPU | 在启动时关闭独立显卡，因为Mac OS无法使用它                                                                                                                                           |
| SSDT-ALS0         | 添加假环境光传感器以在重新启动之间保存背光信息                                                                                                                                       |
| SSDT-BRT6         | 将键盘的ACPI管理亮度键映射到VoodooPS2Controller.kext的PS2代码                                                                                                                        |
| SSDT-Dell_FN      | 将键盘的ACPI管理亮度键映射到VoodooPS2Controller.kext的PS2代码 （部分DELL机型）                                                                                                       |
| SSDT-PNLF         | 显示器亮度控制，为IntelBacklight.kext或AppleBacklight.kext + AppleBacklightInjector.kext添加PNLF设备                                                                                 |
| SSDT-HDAU         | 自动注入HDAU属性（适用于Haswell和Broadwell平台）                                                                                                                                     |
| SSDT-HDEF         | 自动注入HDEF属性（声卡layoutid注入点）                                                                                                                                               |
| SSDT-GPRW         | 通过挂接GPRW或UPRW来解决即时唤醒                                                                                                                                                     |
| SSDT-LANC_PRW     | 通过挂接GPRW来解决即时唤醒                                                                                                                                                           |
| SSDT-UPRW         | 通过挂接GPRW或UPRW来解决即时唤醒                                                                                                                                                     |
| SSDT-IMEI         | 添加IMEI（6系列HD4000，7系HD3000）                                                                                                                                                   |
| SSDT-PTSWAK       | 在睡眠之前对离散GPU进行驱动，并在唤醒后将其关闭，以确保系统能够跟踪它                                                                                                                |
| SSDT-Debug        | 用于ACPIDebug，该文件是通过将「添加DSDT调试方法」应用于空SSDT创建的，使用「添加SSDT调试外部声明」从其他方式访问这些方法hotpatch SSDT甚至打补丁的OEM ACPI文件                         |
| SSDT-ESEL         | 关闭ESEL，在DSDT里原生ESEL被重命名为ESEX                                                                                                                                             |
| SSDT-XWAK         | 关闭XWAK，在DSDT里原生的XWAK被重命名为ZWAK                                                                                                                                           |
| SSDT-PluginType1  | 在_PR.CPU0上插入plugin-type=1，可能是所有支持XCPM的SMBIOS只需要这种插件类型的注入                                                                                                    |
| SSDT-SATA         | 修复某些不支持的SATA设备                                                                                                                                                             |
| SSDT-XHC          | 自动注入XHC属性                                                                                                                                                                      |
| SSDT-XOSI         | 操作系统补丁                                                                                                                                                                         |
| SSDT-AWAC         | 修复 300 系列主板（B360/B365/H310/H370/Z390等）系列主板的RTC设备问题，部分微星的主板/清华同方九代模具需要应用这个补丁，否则会卡住而无法进入系统，建议八代 CoffeeLake以上的用户都添加 |
| SSDT-EC-USBX      | 添加了一个仿冒的EC设备并完善了USB的供电，若主板的 EmbeddedController原生ACPI命名就是EC则不需要该补丁                                                                                 |
| SSDT-PMC          | 与NVRAM相关                                                                                                                                                                          |
| SSDT-PLUG         | 启用原生电源管理，Skylake六代以上的机型在Clover中可以直接勾选注入插件类型，自动注入`plugin-type=1`参数实现同等效果                                                                   |
</details>

## SSDT制作

### 基础知识

#### 外部引用

由于SSDT仅为DSDT的一部分，在该SSDT中的变量可能并不在这段代码中定义，在编译时则会出现`对象不存在`错误。因此需要添加外部引用，声明该变量在DSDT中已被定义过。

外部引用通过以下语句完成，它应当填到DefinitionBlock的下面。

```
External ([字段名（包含路径）], [字段对象])
```

在DSDT中搜索需要添加的外部字段，一般所得到的第一个结果即为其字段定义，字段定义与字段对象的对应关系如下表。编译不报错时，添加外部引用完成。

添加外部引用的示例可参照电池修补过程。

|                         字段定义                         |    字段对象    |   含义   |                        示例                       |
|----------------------------------------------------------|----------------|----------|---------------------------------------------------|
| Name (GZXB, 0)                                           | IntObj         | 整数     | External (GZXB, IntObj)                           |
| Field (...){..., OSYS,16, ...}                           | FieldUnitObj   | 字段单元 | External (OSYS, FieldUnitObj)                     |
| Mutex (BATM, 0x07)                                       | MutexObj       | 互斥体   | `External (_SB.PCI0.LPCB.H_EC.BATM, MutexObj)`    |
| Name (BPKH, Package (0x07){......})                      | PkgObj         | 包       | `External (_SB.PCI0.LPCB.H_EC.BAT1.BPKH, PkgObj)` |
| Device (TPD0)                                            | DeviceObj      | 设备     | `External (_SB.PCI0.I2C1.TPD0, DeviceObj)`        |
| Method (_STA, 0, NotSerialized)                          | MethodObj      | 函数     | `External (_SB.PCI0.I2C1.TPD0._STA, MethodObj)`   |
| OperationRegion (GNVS, SystemMemory, 0x7A4E7000, 0x0866) | OpRegionObj    | 操作区   | External (GNVS, OpRegionObj)                      |
| Event (XXXX)                                             | EventObj       | 事件     | External (XXXX, EventObj)                         |
| ThermalZone (THRM)                                       | ThermalZoneObj | 温控区   | External (THRM, ThermalZoneObj)                   |
| CreateField (AAAA, Zero, BBBB)                             | BuffFieldObj   | 缓冲区   | `External (_SB.PCI0._CRS.BBBB, BuffFieldObj)`     |
| Name (BPKH, Buffer (0x07){......})                       | BuffObj        | 缓冲     | External (BPKH, BuffObj)                          |
| /                                                        | UnknownObj     | 未知     | External (_SB.EROR, UnknownObj)                   |
| `Name (MSTR,"ASL")`                                        | StrObj         | 字符串   | External (_PR.MSTR, StrObj)                       |
| PowerResource (USBC, 0, 0)                               | PowerResObj    | 电源资源 | External (_SB.PCI0.XDCI, PowerResObj             |
| Processor (PR00, 0x01, 0x00001810, 0x06)                 | ProcessorObj   | 处理器   | External (_SB.PR00, ProcessorObj)                 |
| /                                                        | DDBHandleObj   |          |                                                   |

#### 偏移量

以下代码中GNVS可以替换为任意名称，因为`0x100, Zero`指向该地址的范围，偏移量地址已经被确定。而OOXX可以用0x1E代替，因为首先要保证的是字段的偏移量正确，故OOXX与OOX1互换，其数据也会跟着变化。

偏移量以字节为单位，一字节等于8位，故OOX1的偏移量为0x1E+1=0x20。

```
Name (OOXX, Zero)
OperationRegion (GNVS, SystemMemory, 0x100, Zero)
    Field (GNVS,AnyAcc, Lock, Preserve)
    {
        Offset(0x1E),
        OOXX,   16, // 0x1E
        OOX1,   8, // 0x20
        ......
    }
```

#### 开关设备

每个设备的_STA方法用于控制设备开关，返回非零为开，返回零为关。因此通过修改_STA的返回值，可以禁用或启用该设备。

##### 预置变量法

在SSDT中对某些变量预先赋值，使某个设备的_STA按照需求返回零或非零。

###### 一般情况

被修正的变量可能存在于多个地方，对它修正后，在达到我们预期效果的同时，有可能影响到到其他部件。因此应当尽量修正该设备独有的变量。

预置变量法的示例可参照I2C触控板修补过程。

###### 特殊情况

被修正的变量可能来自硬件信息，只能读取不能写入。这种情况下需要二进制更名和SSDT补丁共同完成。示例原文如下。

```
// IM01为只读
// 实际情况IM01不等于0x02，If内的代码无法被执行
OperationRegion (PNVA, SystemMemory, PNVB, PNVL)
Field (PNVA, AnyAcc, Lock, Preserve)
{
    ...
    IM01,   8,
    ...
}
...
If ((IM01 == 0x02))
{
    ...
}
```

为修改IM01，需要将IM01重命名，然后直接通过操作系统而非IM01作为判断条件。假设重命名为XM01，则重命名如下。

```
Comment: change IM01 to IM01
Find: 49 4D 30 31 08
Replace: 58 4D 30 31 08
```

补丁如下。该补丁表示如果操作系统不是Mac，则将IM01恢复为原值。

```
Name (IM01, 0x02)
If (_OSI ("Darwin"))
{
    ...
}
Else
{
      IM01 = XM01 /* 同原始ACPI变量的路径 */
}
```

对于仅包含返回设备状态的使能位和根据条件判断返回的使能位的_STA方法，可以直接将该方法引用为IntObj并赋值。示例如下。

```
// 示例一
Method (_STA, 0, NotSerialized)
{
    If ((XXXX == Zero))
    {
        Return (Zero)
    }
    Return (0x0F)
}

// 示例二
Method (_STA, 0, NotSerialized)
{
    Return (0x0F)
}

// 示例三
Name (_STA, 0x0F)
```

补丁如下。该方法有效的原因是_STA方法在操作系统OSPM模块对设备状态评估和初始化的优先级高于`_INI`、`_ADR`、`_HID`，且_STA的返回值本身也是整数Integer。

```
External (_SB_.PCI0.XXXX._STA, IntObj)

\_SB.PCI0.XXXX._STA = Zero
```

不可使用该方法的示例如下。原因是_STA方法中还有其它操作，直接让_STA返回会使这些操作失效。

```
// 示例一
Method (_STA, 0, NotSerialized)
{
    ECTP (Zero)
    If (XXXX == One)
    {
        Return (0x0F)
    {
    
    Return (Zero)
}

// 示例二
Method (_STA, 0, NotSerialized)
{
    ^^^GFX0.CLKF = 0x03
    Return (Zero)
}
```

#### 基本框架

打开MaciASL，新建文件并将本机DSDT中的DefinitionBlock头复制到文件中。然后将里面的DSDT改为SSDT，即可得到适用于本机的SSDT框架。保存时文件名应当以`SSDT-`开头。

所有SSDT补丁均需满足该基本框架的需求。以下示例的DefinitionBlock头应当根据本机的具体内容替换。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    
}
```

### 电池修补

请基于在修改DSDT后设备能够正常显示电量的前提下制作此热补丁。

电池热补丁的基本原理是，新建一个OperationRegion块，在这个新块里动态注入所有的拆分字节数据，同时对原有的未拆分字节保留空位，从而在保证位移量正确的情况下正确注入并引用新的数据。

#### 确认修改位置

打开IORegistryExplorer，查找`BAT`，记录电池设备名称，本机为`SB.PCI0.LPCB.EC0.BAT0`。对修补DSDT的补丁进行分析，内容如下。

```
// 字段拆分
into device label EC0 code_regex B0C3,\s+16, replace_matched begin C3HG,8,C3HF,8, end;
into device label EC0 code_regex B0SN,\s+16, replace_matched begin BSVN,8,BSVM,8, end;
into device label EC0 code_regex B1SN,\s+16 replace_matched begin SBUY,8,SBUP,8 end;

// 替换调用方法
into method label _BIX code_regex \(B0C3, replaceall_matched begin (B1B2(C3HG,C3HF), end;
into method label BIFA code_regex \(B0SN, replaceall_matched begin (B1B2(BSVN,BSVM), end;
into method label BIFA code_regex \(B1SN, replaceall_matched begin (B1B2(SBUY,SBUP), end;

// 数据处理方法
into method label B1B2 remove_entry;
into definitionblock code_regex . insert
begin
Method (B1B2, 2, NotSerialized)\n
{\n
Return(Or(Arg0, ShiftLeft(Arg1, 8)))\n
}\n
end;
```

可以得出，实际修改的字节数据如下。

```
B0C3->B1B2（C3HG,C3HF）
B0SN->B1B2（BSVN,BSVM）
B1SN->B1B2（SBUY,SBUP）
```

故需要拆解的字节有B0C3、B0SN、B1SN，需要添加的额外方法（Method）为B1B2。比对原DSDT和已修改好的DSDT，查找调用到这些变化过的字段的Method位置，以及需要添加的Method出现位置。本机调用到B0C3、B0SN、B1SN的Method为BIFA和_BIX，需添加的额外方法B1B2在原DSDT中不存在，在修改过的DSDT中位于根目录。至此所有需要修改的地方已完全确定。

#### 数据插入

打开MaciASL，新建一个SSDT框架，如下。

```
// xxxx用说找到的电池设备名（此处为BAT0）替换
DefinitionBlock ("", "SSDT", 2, "hack", "xxxx", 0x00000000)
{

}
```

打开原DSDT并搜索EmbeddedControl，复制整个OperationRegion到这个热补丁内。注意要把整个OperationRegion复制过来，即从OperationRegion行始，到第一个`}`止。

然后把调用到变化字段的Method和所有额外添加的Method复制到OperationRegion后。对于本机而言，需复制OperationRegion段、Method (BIFA)、Method (_BIX)、Method (B1B2)，故完成后代码结构应如下所示。注意，在同一个设备下的Method需放到一起。

```
OperationRegion (ECOR, EmbeddedControl, Zero, 0xFF)
Field (ECOR, ByteAcc, Lock, Preserve)
{
    Offset (0x04), 
    ......
}

Method (BIFA, 0, NotSerialized)
{
        ......
}

Method (_BIX, 0, NotSerialized)
{
        ......
}

Method (B1B2, 2, NotSerialized)
{
    Return (Or (Arg0, ShiftLeft (Arg1, 0x08)))
}
```

#### 添加位置代码

在代码块前需添加它们的位置代码，以使BIOS修补时有迹可循。在代码块的前后分别用以下代码框住即可，注意xxxx为位置，需要用绝对路径。

```
Scope (xxxxx)
{

}
```

以本机为例，本机的OperationRegion和BIFA方法均在`_SB.PCI0.LPCB.EC0`下，而`_BIX`方法位于`_SB.PCI0.LPCB.EC0`的BAT0设备下。因此将OperationRegion和BIFA用`Scope (_SB.PCI0.LPCB.EC0)`框住，而`_BIX`方法则用`Scope (_SB.PCI0.LPCB.EC0.BAT0)`框住，如下。注意，B1B2和B1B4方法放置于根目录，故无需位置代码。

```
DefinitionBlock ("", "SSDT", 2, "hack", "BAT0", 0x00000000)
{

    // OperationRegion和BIFA
    Scope (_SB.PCI0.LPCB.EC0)
    {
        OperationRegion (ECOR, EmbeddedControl, Zero, 0xFF)
        Field (ECOR, ByteAcc, Lock, Preserve)
        {
            ......
        }

        Method (BIFA, 0, NotSerialized)
        {
            ......
        }
    }

    // _BIX
    Scope (_SB.PCI0.LPCB.EC0.BAT0)
    {
        Method (_BIX, 0, NotSerialized)
        {
            ......
        }
    }

    // B1B2
    Method (B1B2, 2, NotSerialized)
    {
        Return (Or (Arg0, ShiftLeft (Arg1, 0x08)))
    }
}
```

#### 添加外部引用

完成以上步骤后进行编译，并根据相应错误添加外部引用。

首先添加设备引用。以上面代码为例，设备`_SB.PCI0.LPCB.EC0`与`_SB.PCI0.LPCB.EC0.BAT0`被引用，故需用以下语句进行声明。

```
// xxxx是设备地址
External (xxxx, DeviceObj)
```

该部分语句需添加到DefinitionBlock的下面，故代码如下，其中`DeviceObj`表示这是一个ACPI设备。再次编译，有关设备的报错均已消失。

```
DefinitionBlock ("", "SSDT", 2, "hack", "BAT0", 0x00000000)
{
    External (_SB.PCI0.LPCB.EC0, DeviceObj)
    External (_SB.PCI0.LPCB.EC0.BAT0, DeviceObj)    // 可以不写这行
    Scope (_SB.PCI0.LPCB.EC0)
    {
        ......
```

然后根据报错，继续在DSDT里搜索其他的报错代码。如对于BIXT，它是BAT0设备下的一个字段，在DSDT查询到的第一个结果是`Name (BIXT`，因此用以下代码进行外部引用。

```
External (_SB.PCI0.LPCB.EC0.BAT0.BIXT, IntObj)
```

对于其余变量方法同理，字段定义与字段对象的对应关系见前面所列出的表格。

#### 字节处理

首先需要把OperationRegion和Field里的字段重命名。以本机为例，由ECOR重命名为ECAG，如下。

```
OperationRegion (ECAG, EmbeddedControl, Zero, 0xFF)
Field (ECAG, ByteAcc, Lock, Preserve)
```

然后要使字段有正确的偏移量，可把Field里所有不拆分的字节数据段名字去掉，只保留空位，如`ACST,  1`，清空变量名后变为`,  1,`。示例如下。

```
Offset (0x93),
TH00,   8,
TH01,   8,
TH10,   8,
TH11,   8,
Offset (0xBE),
,   16,
,   16,
,   16,
XC30,   8,
XC31,   8,
```

或可采用以下注释的形式。

```
Offset (0x93),
TH00,   8,
TH01,   8,
TH10,   8,
TH11,   8,
Offset (0xBE),
/*B0TM*/,   16,
/*B0C1*/,   16,
/*B0C2*/,   16,
XC30,   8,
XC31,   8,
```

或可手动计算偏移量，如下。

```
Offset (0x93),
TH00,   8,
TH01,   8,
TH10,   8,
TH11,   8,
Offset (0xC4), // 原本为0xBE，加上三个16字节的偏移量后变为0xC4
XC30,   8,
XC31,   8,
```

修改完成后，将之前的电量补丁Patch使其生效，然后编译并保存。

#### 添加更名补丁

将热补丁中从原始DSDT复制过来的Method名全部进行修改，如热补丁中有从DSDT复制过来的代码`Method (BIFA, 0, NotSerialized)`，则BIFA需要更名。此处以更名为BIGA为例，打开config.plist，添加以下更名规则即可。

```
Comment: change BIFA to BIGA
Find: 42494641
Replace: 42494741
```

若所需要更改的方法名位于电池设备（即BAT0）内，则在Tgtbridge栏还应加入该电池设备名的16进制数，如下。

```
Comment: change _BIX to XBIX in BAT0
Find: 5F424958
Replace: 58424958
Tgtbridge: 42415430
```

但如果添加Tgtbridge后电池补丁反而失效，则将Tgtbridge值删除。

#### 完成修补

将上述SSDT保存为aml文件，放到引导器的ACPI部分即可。

### I2C触控板修补

该SSDT不涉及任何的ACPI更名。

#### 修补准备

按照与修改DSDT时相同的方法，确定设备路径和APIC Pin，并放置VoodooI2C驱动。

#### 禁用原设备

##### 通过预置变量法

本方法在本机上通过Clover引导时可行，通过OpenCore引导时不起作用。

用Macisal打开本机DSDT，查找触控板设备名称，此处为ETPD。观察其_STA方法，该方法用于控制设备的开启与关闭，返回0x0F时为开启，返回Zero时为关闭。示例如下。

```
Method (_STA, 0, NotSerialized)  // _STA: Status
{
    If (((TPIF != One) || (DSYN && One)))
    {
        Return (Zero)
    }

    Return (0x0F)
}
```

通过简单的代码知识，可知若TPIF不等于1或DSYN不等于0，则会返回Zero，从而禁用该设备。

在DSDT中搜索TPIF，发现该变量仅在此处被引用。同理搜索DSYN，发现该变量有在其它地方被引用。因此选择改变TPIF而非DSYN的值，以避免对其它设备的影响。此处将TPIF设为0即可。

在DSDT中搜索TPIF，其定义示例如下。

```
Scope (_SB)
{
    OperationRegion (ASIO, SystemMemory, ASIB, 0x09)
    Field (ASIO, AnyAcc, NoLock, Preserve)
    {
        ASIS,   32, 
        TPIF,   8, 
        TPDI,   8, 
        TPLP,   8, 
        TPLI,   8, 
        TPHI,   8
    }
}
```

可见TPIF是一个FieldUnitObj，因此可得如下补丁示例。由于TPIF在`Scope (_SB)`内，而_SB即为根目录，因此补丁中可用`\`表示。

注意，上述过程仅为示例，用于阐述预置变量法的基本流程。具体的变量类型和数值设置需要根据不同的DSDT做出相应的调整。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    External (TPIF, FieldUnitObj)
    
    Scope (\)
    {
        If (_OSI ("Darwin"))
        {
            TPIF = Zero
        }
    }
}
```

##### 通过_STA修改法

新建一个SSDT框架，如下。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    
}
```

在其中添加Scope作用域，路径为原触控板设备的路径，此处为ETPD。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    Scope (_SB.PCI0.I2C1.ETPD)
    {

    }
}
```

把以下_STA方法复制到Scope作用域中。

```
Method (_STA, 0, NotSerialized)
{
    If (_OSI ("Darwin"))
    {
        Return (Zero)
    }
    Else
    {
        Return (XSTA())
    }
}
```

根据添加外部引用的相关办法，添加对ETPD和XSTA的相关引用。其中XSTA为ETPD的原_STA方法，后面会通过更名的方式将其改为XSTA，因此上述注入的新_STA方法意为在系统不为Mac时，调用XSTA即原_STA方法。

完整补丁如下。

```
DefinitionBlock ("", "SSDT", 2, "DELL", "CBX3", 0x01072009)
{
    External (_SB.PCI0.I2C0.ETPD,DeviceObj)
    External (_SB.PCI0.I2C0.ETPD.XSTA,MethodObj)
  
    Scope (_SB.PCI0.I2C0.TPD0)
    {
        Method (_STA, 0, NotSerialized)  // _STA: Status
        {
            If (_OSI ("Darwin"))
            {
                Return (Zero)
            }
            Else
            {
                Return (XSTA())
            }
        }
    }
}
```

在config.plist中添加以下重命名补丁，示例如下。

```
Comment：change _STA to XSTA
Find：5F535441 00A01390 929354
Replace：58535441 00A01390 929354
```

#### 启用GPIO

DSDT搜索`Device (GPI0`，观察其_STA方法，示例如下。

```
Method (_STA, 0, NotSerialized)
{
    If ((SBRG == Zero))
    {
        Return (Zero)
    }

    If ((GPEN == Zero))
    {
        Return (Zero)
    }

    Return (0x0F)
}
```

同样使用预置变量法。观察以上代码，可知启用GPI0需要SBRG和GPEN都不等于0。搜索SBRG，发现该变量被多处引用。同理搜索GPEN，发现该变量仅本处被引用。考虑到SBRG可能本来就不为0，因此尝试只设定GPEN。

在DSDT中搜索SBRG和GPEN，其定义示例如下。

```
// 这里就是根目录，没有Scope()

    OperationRegion (PNVA, SystemMemory, PNVB, PNVL)
    Field (PNVA, AnyAcc, Lock, Preserve)
    {
        ...
        SBRG,   32, 
        ...
        GPEN,   8, 
        ...
    }
```

可见GPEN是一个FieldUnitObj，因此可得如下补丁示例。

```
// GPI0 enable
DefinitionBlock("", "SSDT", 2, "OCLT", "GPI0", 0)
{
    External(GPEN, FieldUnitObj)
    
    Scope (\)
    {
        If (_OSI ("Darwin"))
        {
            GPEN = 1
        }
    }
}
//EOF
```

#### 新建热补丁

新建一个SSDT框架，如下。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    
}
```

用MaciASL打开系统的DSDT，搜索触控板名称，本机为ETPD，路径为_SB.PCI0.I2C1.ETPD。在新建的SSDT中，首先添加Scope域，注意小括号内为除触控板名称外的路径。然后将触控板名称对应的整个Device复制进去，此处为`Device (ETPD)`。完成后形式如下。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    Scope (_SB.PCI0.I2C1)
    {
        Device (ETPD)
        {
            ...
        }
    }
}
```

此处也可以写成如下形式。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    Device (_SB.PCI0.I2C1.ETPD)
    {
        ...
    }
}
```

将该SSDT中的ETPD进行改名，此处改为TPXX，该名称应当在DSDT中未出现过。然后替换`_STA`部分为以下代码。

```
Method (_STA, 0, NotSerialized)
{
    If (_OSI ("Darwin"))
    {
        Return (0x0F)
    }
    Else
    {
        Return (Zero)
    }
}
```

在禁用原设备中，若使用的是预置变量法，则在该SSDT中搜索上述用到的变量，此处为TPIF。若有类似`If(TPIF...)`的语句，则修改为`If(one)`。

在该SSDT中搜索OSYS。若有，则注释以下内容。

```
If (LLess (OSYS, 0x07DC))
{
    SRXO (GPDI, One)
}
```

#### 移除APIC中断控制器

在该SSDT中搜索_CRS方法。

```
Method (_CRS, 0, Serialized)
{
    Name (SBFI, ResourceTemplate ()
    {
        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,
            AddressingMode7Bit, "\\_SB.PCI0.I2C1",
            0x00, ResourceConsumer, , Exclusive,
            )
        Interrupt (ResourceConsumer, Level, ActiveLow, Exclusive, ,, )
        {
            0x0000006D,
        }
    })
    Return (SBFI)
}
```

若代码类似如上，则将`Name (SBFI`改为`Name (SBFB`，并删除整个Interrupt()函数，修改后变为如下。

```
Method (_CRS, 0, Serialized)
{
    Name (SBFB, ResourceTemplate ()
    {
        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,
            AddressingMode7Bit, "\\_SB.PCI0.I2C1",
            0x00, ResourceConsumer, , Exclusive,
            )
    })
    Return (SBFI)
}
```

在该SSDT中定位到_CRS方法，确保所有返回语句都改成以下内容。

```
// 若该SSDT中没有I2CM，选择该语句
Return (ConcatenateResTemplate (SBFB, SBFG))

// 若该SSDT中有I2CM，选择该语句
Return (ConcatenateResTemplate (I2CM (I2CX, BADR, SPED), SBFG))
```

示例如下。

```
Method (_CRS, 0, Serialized)
{
    Name (SBFB, ResourceTemplate ()
    {
        I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,
            AddressingMode7Bit, "\\_SB.PCI0.I2C1",
            0x00, ResourceConsumer, , Exclusive,
            )
    })
    Return (ConcatenateResTemplate (SBFB, SBFG))
}
```


#### GPIO固定

##### 代码修补

在该SSDT中寻找类似如下的代码。

```
Name (SBFG, ResourceTemplate ()
{
    GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,
        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
        )
        {   // Pin list
            0x0000
        }
})
```

若有该代码，则系统会自动注入GPIO Pin，可跳过GPIO Pin的计算与填入。若没有，则需要将该段代码复制到TPXX的根目录，示例如下。

```
Device (TPXX){
    Name (SBFG, ResourceTemplate ()
    {
        GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,
        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
        )
        {   // Pin list
            0x0000
        }
    })
}
```

##### 计算GPIO Pin

将上面得到的APIC Pin化为十进制，此处为6D，化成十进制为109。带入以下公式计算，计算完成后将答案重新化为十六进制，所得即为GPIO Pin的值。

###### Skylake平台

本机适用，所得为85=0x55。

```
If APICPIN > 47 And APICPIN <= 79 Then     
    GPIOPIN = APICPIN - 24   
    GPIOPIN2 = APICPIN + 72  
ElseIf APICPIN > 79 And APICPIN <= 119 Then
    GPIOPIN = APICPIN - 24
End If
```

###### CoffeeLake-H平台

```
If APICPIN > 47 And APICPIN <= 71 Then   
    GPIOPIN = APICPIN - 16   
    GPIOPIN2 = APICPIN + 240 
    If APICPIN > 47 And APICPIN <= 59 Then GPIOPIN3 = APICPIN + 304  
ElseIf APICPIN > 71 And APICPIN <= 95 Then 
    GPIOPIN = APICPIN - 8    
    GPIOPIN3 = APICPIN + 152
    GPIOPIN2 = APICPIN + 120 
ElseIf APICPIN > 95 And APICPIN <= 119 Then 
    GPIOPIN = APICPIN        
    If APICPIN > 108 And APICPIN <= 115 Then GPIOPIN2 = APICPIN + 20 
 End If
```

###### CoffeeLake-LF/Whiskylake平台

```
If APICPIN > 47 And APICPIN <= 71 Then      
    GPIOPIN = APICPIN - 16   
    GPIOPIN2 = APICPIN + 80  
ElseIf APICPIN > 71 And APICPIN <= 95 Then  
    GPIOPIN2 = APICPIN + 184 
    GPIOPIN = APICPIN + 88   
ElseIf APICPIN > 95 And APICPIN <= 119 Then 
    GPIOPIN = APICPIN        
    If APICPIN > 108 And APICPIN <= 115 Then GPIOPIN2 = APICPIN - 44 
End If
```

###### 其它方法

<details>
<summary></summary>

打开Hackintool，在PCI选项卡下可以查看触控板类型，包括SunrisePoint、CannonPoint(Lake)[Coffee Lake(-R)]和CannonPoint(Lake)[Whiskylake]。

打开下面相应平台的第一个链接，查找设备的十六进制APIC Pin值，并记录左侧标签值（只需记录GPP_XYY_IRQ中的XYY部分），若有多个标签值，需全部记录。再打开第二个链接，搜索上面所记录的XYY，记下右侧的数值（十进制），此即为触控板的硬件引脚号。

```
// SunrisePoint[Kaby Lake(-R)]
https://github.com/coreboot/coreboot/blob/master/src/soc/intel/skylake/include/soc/gpio_defs.h#L43
https://github.com/coreboot/coreboot/blob/master/src/soc/intel/skylake/include/soc/gpio_soc_defs.h#L37

// CannonPoint(Lake)[Coffee Lake-R]
https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_defs_cnp_h.h#L42
https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_soc_defs_cnp_h.h#L40

// CannonPoint(Lake)[Whiskylake]
https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_defs.h#L42
https://github.com/coreboot/coreboot/blob/master/src/soc/intel/cannonlake/include/soc/gpio_soc_defs.h#L45
```

对于SunrisePoint，硬件引脚号即为GPIO引脚号。

对于CannonPoint(Lake)[Coffee Lake(-R)]或CannonPoint(Lake)[Whiskylake]，前面步骤与上面相同，但得到的硬件引脚号并不是GPIO引脚号，因此还需要进行转换。打开下面转换公式链接，搜索前面记录的GPP_X，得到格式如`CHIPSET_GPP(数字, 基数, 终止, GPIO基数)`的内容。用所记下的十进制硬件引脚号减去`基数`，再加上`GPIO基数`，就是最后的十进制的GPIO引脚号。注意，`X_NO_GPIO`表示此引脚号无效。

```
// CannonPoint(Lake)[Coffee Lake-R]
https://github.com/coolstar/VoodooGPIO/blob/master/VoodooGPIO/CannonLake-LP/VoodooGPIOCannonLakeLP.hpp#L366

// CannonPoint(Lake)[Whiskylake]
https://github.com/coolstar/VoodooGPIO/blob/master/VoodooGPIO/CannonLake-H/VoodooGPIOCannonLakeH.hpp#L414
```

得到十进制的GPIO引脚后，需将数字转换为十六进制。
</details>

##### 填入GPIO Pin

在某些极端状况下，只能尝试比较常见的GPIO Pin。如SunrisePoint平台可尝试0x17、0x1b、0x34和0x55。

计算完成后把GPIO Pin填入到SBFG的Pin list，示例如下。

```
Name (SBFG, ResourceTemplate ()
{
    GpioInt (Level, ActiveLow, ExclusiveAndWake, PullDefault, 0x0000,
        "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
        )
        {   // Pin list
            0x55
        }
})
```

#### 添加外部引用

点击编译并根据报错添加外部引用，过程可参照电池修补部分。

#### 完成修补

至此触控板热补丁已完成，将上述生成的所有SSDT都另存为aml，放到引导器的ACPI部分。重启后打开IORegistryExplorer，查找触控板名称（ETPD），若无此设备则禁用成功。查找新建的触控板设备（TPXX），若有此设备则触控板已处于中断模式。

## SSDT加载顺序

当SSDT的对象为机器的ACPI时，各SSDT之间没有顺序要求。当SSDT的对象为在另一个新的SSDT定义的设备时，将此SSDT放到定义该设备的SSDT之后加载。

## ASL语法

ASL是ACPI所使用的语法。注意不支持非ASCII字符注释（中文注释）。

### iASL补丁

单行注释用`#`，每个补丁用`;`分隔。补丁的语法如下。

```
(into|into_all) (All|DefinitionBlock|Scope|Method|Device|Processor|ThermalZone) [(label|name_adr|name_hid|code_regex|code_regex_not|parent_label|parent_type|parent_adr|parent_hid) <selector>...] (insert|set_label|replace_matched|replaceall_matched|remove_matched|removeall_matched|remove_entry|replace_content|store_%8|store_%9) begin <argument> end;
```

其中不同类型的函数如下。

```
// DOM
extent into,into_all
scope definitionblock,scope,method,device,processor,thermalzone,all
predicate label,name_adr,name_hid,parent_label,parent_type,parent_adr,parent_hid
action insert,set_label,remove_entry,replace_content

// REGEX
extent into,into_all
predicate code_regex,code_regex_not
action replace_matched,replaceall_matched,remove_matched,removeall_matched,store_%8,store_%9

// No Arguments
remove_entry,remove_matched,removeall_matched,store_%8,store_%9
```

### 变量

#### 命名

变量命名不超过四个字符，且不能以数字开头。

所有ACPI标识符都是四个字符，短名称用下划线填充。如XHC在AML二进制中表示为`XHC_`，EC为`EC__`，EC0为`EC0_`，MEI为`MEI_`。

#### 类型

变量类型包括Integer、String、Event（事件）、Buffer（数组）、Package、Buffer Field等。定义变量时不需要显式声明其类型。

##### Integer

整数。定义示例如下。

```
Name(TEST, 0)
```

##### String

字符串。定义示例如下。

```
Name(MSTR, "ASL")
```

##### Package

对象集合。定义示例如下。

```
Name (_PRW, Package (0x02)
{
    0x0D,
    0x03
})
```

##### Buffer Field

Buffer Field的种类如下。

| 创建语句         | 大小     |
| ---------------- | -------- |
| CreateBitField   | 1-Bit    |
| CreateByteField  | 8-Bit    |
| CreateWordField  | 16-Bit   |
| CreateDWordField | 32-Bit   |
| CreateQWordField | 64-Bit   |
| CreateField      | 任意大小 |

定义示例如下。

```
CreateBitField (AAAA, Zero, CCCC)
CreateByteField (DDDD, 0x01, EEEE)
CreateWordField (FFFF, 0x05, GGGG)
CreateDWordField (HHHH, 0x06, IIII)
CreateQWordField (JJJJ, 0x14, KKKK)
CreateField (LLLL, Local0, 0x38, MMMM)
```

#### 赋值

```
// 传统ASL
Store(Local0, Local1)

// ASL+
Local0 = Local1
```

### 作用域

Scope形成作用域，概念类似于数学中的集合{}。

#### 引用

符号`\`引用根作用域，`^`（父运算符）引用上级作用域，一个`^`运算符将当前作用域上移一位。

在同一目录下引用其它字段只需写相对路径，在另一设备下引用则需写绝对路径。比如对于PWBW路径`\_SB.PCI0.LPCB.PWBW`，在`_SB.PCI0.LPCB`下只需通过`PWBW`引用，在外部则要通过`\_SB.PCI0.LPCB.PWBW`引用。

#### 根作用域

有且仅有一个根作用域，因此DSDT均为如下框架。

```
DefinitionBlock ("xxxx", "DSDT", 0x02, "xxxx", "xxxx", xxxx){
    ...
}
```

xxxx参数依次表示输出文件名、OEMID、表ID、OEM版本。第三个参数根据第二个参数指定，DSDT一定是0x02。其他参数可以自由修改。

#### 其它作用域

根作用域下有`_GPE`，`_PR`，`_SB`，`_SI`，`_TZ`五个作用域，Device(xxxx)也可看做是一个作用域。不同属性的设备放在对应的作用域下。

##### _GPE

ACPI的事件处理。

```
Scope (_GPE)
{
    Method (_L0D, 0, NotSerialized)
    {
        ...
    }
    ...
}
```

##### _PR

处理器相关信息。不同的CPU所在的域会不同，常见的有`_PR`，`_SB`，`SCK0`等。

```
Scope (_PR)
{
    Processor (CPU0, 0x00, 0x00000410, 0x06)
    {
        ...
    }
    ...
}
```

##### _SB

所有的设备和总线。

```
Scope (_SB)
{
    Device (PCI0)
    {
        ...
    }
    ...
}
```

##### _SI

系统指示灯。

##### _TZ

热区，用于读取某些温度。

### 函数

函数最多可以传递八个参数，在函数里用Arg0-Arg7表示，不可以自定义。函数最多可以用八个局部变量，用Local0-Local7表示，无需定义，但需要初始化即必须要有一次赋值操作才能使用。

用Method定义函数。函数可以定义在Device下或者Scope下，但是不能脱离Scope定义单独的函数。参数个数如果不定义默认为零。

#### 单一变量函数

```
// 定义TEST函数
Method (TEST)
{
    ...
}
```

#### 有两个输出参数的函数

使用局部变量Local0-Local7。

```
// 定义有两个输入参数的MADD函数
Method (MADD, 2)
{
    // 传统ASL
    Store(Arg0, Local0)
    Store(Arg1, Local1)
    Add(Local0, Local1, Local0)

    // ASL+
    Local0 = Arg0
    Local1 = Arg1
    Local0 += Local1
}
```

#### 带返回值的函数

```
// 实现自定义加法
Method (MADD, 2)
{
    Local0 = Arg0
    Local1 = Arg1
    Local0 += Local1

    Return (Local0)
}
```

调用方法如下。

```
// 传统ASL
Store(MADD(1,2), Local0)

// ASL+
Local0 = 1 + 2
```

#### 可序列化函数

当函数声明为Serialized时，内存中仅能存在一个实例。一般应用在函数中创建一个对象。

```
Method(TEST, Serialized)
{
    Name(MSTR,"I will success")
}
```

如果声明TEST函数如上，则运行以下代码时，若先执行Dev1的TEST，Dev2的TEST将等待Dev1中的TEST函数执行完毕后再执行。

```
Device (Dev1)
{
    TEST()
}
Device (Dev2)
    TEST()
}
```

若声明为NotSerialized，则在其中一个Dev调用TEST的时候，另一个将调用失败，因无法同时创建同一字符串MSTR。

#### 运算函数

传统ASL中没有运算符。在ASL+中引入了与C语言等同的`+-*/=`、`<<`、`>>`和逻辑判断`==`、`!=`等。

##### 算术运算函数

| ASL+   | 传统 ASL   | 中文含义   | 举例                                                         |
| ------ | ---------- | ---------- | ------------------------------------------------------------ |
| +      | Add        | 整数相加   | Local0 = 1 + 2<br/>Add (1, 2, Local0)                        |
| -      | Subtract   | 整数减法   | Local0 = 2 - 1<br/>Subtract (2, 1, Local0)                  |
| *      | Multiply   | 整数相乘   | Local0 = 1 * 2<br/>Multiply (1, 2, Local0)                   |
| /      | Divide     | 整数除法   | Local0 = 10 / 9<br/>Divide (10, 9, Local1(余数), Local0(结果)) |
| %      | Mod        | 整数求余   | Local0 = 10 % 9<br/>Mod (10, 9, Local0)                      |
| <<     | ShiftLeft  | 左移       | Local0 = 1 << 20<br/>ShiftLeft (1, 20, Local0)               |
| >>     | ShiftRight | 右移       | Local0 = 0x10000 >> 4<br/>ShiftRight (0x10000, 4, Local0)    |
| --     | Decrement  | 整数自减 1 | Local0--<br/>Decrement (Local0)                              |
| ++     | Increment  | 整数自增 1 | Local0++<br/>Increment (Local0)                              |
| &      | And        | 整数于     | Local0 = 0x11 & 0x22<br/>And (0x11, 0x22, Local0)            |
| &#124; | Or         | 或         | Local0 = 0x01 \| 0x02<br/>Or (0x01, 0x02, Local0)            |
| ~      | Not        | 取反       | Local0 = ~(0x00)<br/>Not (0x00,Local0)                       |
| 无     | Nor        | 异或       | Nor (0x11, 0x22, Local0)                                     |

##### 逻辑运算函数

| ASL+   | 传统 ASL      | 中文含义     | 举例                                                         |
| ------ | ------------- | ------------ | ------------------------------------------------------------ |
| &&     | LAnd          | 逻辑与       | If (BOL1 && BOL2)<br/>If (LAnd(BOL1, BOL2))                  |
| !      | LNot          | 逻辑反       | Local0 = !0<br/>Store (LNot(0), Local0)                      |
| &#124; | LOr           | 逻辑或       | Local0 = (0 \| 1)<br/>Store (LOR(0, 1), Local0)              |
| <      | LLess         | 逻辑小于     | Local0 = (1 < 2)<br/>Store (LLess(1, 2), Local0)             |
| <=     | LLessEqual    | 逻辑小于等于 | Local0 = (1 <= 2)<br/>Store (LLessEqual(1, 2), Local0)       |
| >      | LGreater      | 逻辑大于     | Local0 = (1 > 2)<br/>Store (LGreater(1, 2), Local0)         |
| >=     | LGreaterEqual | 逻辑大于等于 | Local0 = (1 >= 2)<br/>Store (LGreaterEqual(1, 2), Local0)   |
| ==     | LEqual        | 逻辑相等     | Local0 = (Local0 == Local1)<br/>If (LEqual(Local0, Local1)) |
| !=     | LNotEqual     | 逻辑不等于   | Local0 = (0 != 1)<br/>Store (LNotEqual(0, 1), Local0)       |

#### 延迟函数

|  名称 |    含义    |      语法      | 参数 |                                      描述                                     |
|-------|------------|----------------|------|-------------------------------------------------------------------------------|
| Sleep | 延迟       | Sleep(Source1) | 整数 | 执行被延迟至少所需的毫秒数（长期）                                            |
| Stall | 短时间停止 | Stall(Source1) | 整数 | 执行被延迟至少所需的微秒数（短期，超过100微秒的延迟必须使用Sleep而不是Stall） |

### 系统保留方法

以`_`字符开头的函数和变量均为系统保留方法。

#### _OSI

全称为Operating System Interfaces，即操作系统接口。当系统加载时，_OSI会接收到一个参数，不同的系统接收的参数不同，ACPI执行的指令就不同，具体如下表。

|       操作系统      |     字符串     |
|---------------------|----------------|
| macOS               | "Darwin"       |
| Linux/基于Linux内核 | "Linux"        |
| FreeBSD             | "FreeBSD"      |
| Windows             | "Windows 20XX" |

采用操作系统补丁的作用在于修改其返回参数，或修改其参数对应的行为，从而解锁系统对某些部件的限制，通常情况下不推荐使用。示例如下。

```
// 需要解锁限制的部件
If ((_OSI ("Windows 2009") || _OSI ("Windows 2013")))
{
        OperationRegion (PCF0, SystemMemory, 0xF0100000, 0x0200)
        Field (PCF0, ByteAcc, NoLock, Preserve)
        {
                HVD0,   32, 
                Offset (0x160), 
                TPR0,   8
        }
        ...
}
```

ACPI还定义了OSYS，对应关系如下。

|     标签值     | OSYS值 |  对应系统  |
|----------------|--------|------------|
| Windows 2009   | 0x07D9 | Win7       |
| Windows 2012   | 0x07DC | Win8       |
| Windows 2013   | 0x07DD | Win8.1     |
| Windows 2015   | 0x07DF | Win10      |
| Windows 2016   | 0x07E0 | Win10 1607 |
| Windows 2017   | 0x07E1 | Win10 1703 |
| Windows 2017.2 | 0x07E1 | Win10 1709 |
| Windows 2018   | 0x07E2 | Win10 1803 |
| Windows 2018.2 | 0x07E2 | Win10 1809 |
| Windows 2019   | 0x???? | Win10 1903 |

Win8以上才支持I2C设备。当加载macOS时，_OSI接受的参数不会被ACPI识别，OSYS被赋予了默认值。这个默认值通常小于Win8要求的值，显然I2C无法工作，故VoodooI2C通常需要采用操作系统补丁来驱动触控板。

#### _STA

全称为Status，即状态。用于描述设备的状态，与PowerResource的_STA不同（PowerResource的_STA只有两个返回值One和Zero）。

ACPI表中的每个设备在初始化之前，都会先执行_STA函数检测这个设备的状态，若设备存在才初始化。若没有显式定义_STA函数，默认认为这个设备存在且能正常工作。描述设备的状态主要靠_STA的返回值，它的返回值有32位，目前只有末5位有定义，如下表。是则置该位为1，否则置为0。

| Bit位 |              含义              |
|-------|--------------------------------|
|     0 | 设备是否存在                   |
|     1 | 设备是否被启用且可以解码其资源 |
|     2 | 设备是否在UI中显示             |
|     3 | 设备是否正常工作               |
|     4 | 设备是否存在电池               |

若一个设备没有电池、可以正常工作并在系统中显示，则它的_STA返回值为二进制的01111，换成十六进制为0x0F。若一个设备不存在，返回值为00000，即十六进制下的0x00，或写成Zero。

0x0B表示设备处于半开状态，不允许解码其中的资源。0x1F只会在笔记本的电池设备中出现，多出的那个Bit用于通知电池控制设备（Control Method Battery Device，PNP0C0A）存在电池。

#### _CRS

全称为Current Resource Settings，即当前资源设置。_CRS函数返回一个Buffer，在触摸设备中会返回触摸设备所需的GPIO Pin/APIC Pin等。通过调整其值，可以控制设备的中断模式。

### 外部修补方法

#### _CST

与CPU的C2/C4/C6/C7休眠有关。

#### _PCT

有#关SpeedStep功能。

#### _PPC

控制CPU频率范围。

#### _PSS

一组包含可能的CPU states数组，与PLimitDict/UnderVoltStep/Turbo有关。

### 流程控制

以下均以ASL+举例。

#### If-ElseIf-Else

```
If (_OSI ("Darwin"))
{
    OSYS = 0x2710
}
ElseIf (_OSI ("Linux"))
{
    OSYS = 0x03E8
}
Else
{
    OSYS = 0x07D0
}
```

#### Switch-Case-Default-BreakPoint

BreakPoint相当于断点，意为退出当前Switch。

```
Switch(Arg2)
{
    Case(1)
    {
        If(Arg1 == 1）
        {
            Return (1)
        }
        BreakPoint
    }
    Case(2)
    {
        ......
        Return (2)
    }
    Default
    {
        BreakPoint
    }
}
```

#### While

```
Local0 = 10
While (Local0 >= 0x00)
{
    Local0--
    Stall (32)
}
```

#### For

```
for (local0 = 0, local0 < 8, local0++)
{
    ...
}
```

#### 存在性判断

CondRefOf可以用来判断所有类型Object的存在与否。

```
Method (SSCN, 0, NotSerialized)
{
    If (_OSI ("Darwin"))
    {
        ...
    }
    ElseIf (CondRefOf (\_SB.PCI0.I2C0.XSCN))
    {
        If (USTP)
        {
            Return (\_SB.PCI0.I2C0.XSCN ())
        }
    }

    Return (Zero)
}
```

### 编译错误与警告

#### (from opcode)

编译完成后在文件内的某些行会有此该提示，一般位于以下位置，表明名称已在作用域中，其外部声明是多余/不必要的。可直接注释掉此行。

```
External (DTS1, FieldUnitObj)    // (from opcode)
```

#### only 0 was resolved (2 unresolved)

在编译完成后，文件内可能会有以下注释，主要含义为方法名称未定义。由于某些方法在Windows而不在ACPI表被定义，因此该警告可忽略。

```
/* There were 2 external control methods found during 
* disassembly, but only 0 was resolved (2 unresolved)
...
*/
```

#### illegal open scope on external object from within dsdt

CondRefOf函数导致，该函数用于确认该项存在。删除整个CondRefOf块即可。

### 错误示例

#### 例一

##### 错误代码

```
Method (ADBG, 1, Serialized)
{
    If (CondRefOf (MDBG))
    {
        Return (MDBG)
        Arg0
    }
     Return (Zero)
} 
```

##### 修正后代码

```
Method (ADBG, 1, Serialized)
{
    If (CondRefOf (MDBG))
    {
        Return (MDBG (Arg0))
    }
     Return (Zero)
} 
```




## ACPIDebug

ACPIDebug可用于高级人员排错，也可记录部分按键轨迹。

### 驱动

ACPIDebug.kext下载链接如下。

```
https://bitbucket.org/RehabMan/os-x-acpi-debug/downloads/
```

下载后放入SLE中，用Kext Utility修复权限。

然后需要对DSDT进行修改。用MaciASL打开DSDT，点击Patch，在`_OS-X-ACPI-Debug`类别下打`Add DSDT Debug Methods`和`Instrument EC Queries`这两个补丁，退出并保存即可。

也可通过SSDT实现。放置以下SSDT即可。

SSDT-RMDT.aml如下。

```
// for use with ACPIDebug
// This file was created by applying "Add DSDT Debug Methods" to an empty SSDT
//
// Use "Add SSDT Debug Extern Declarations" to access these methods from other
// hotpatch SSDTs or even patched OEM ACPI files.
//
DefinitionBlock("", "SSDT", 2, "OCLT", "RMDT", 0)
{
    If (_OSI ("Darwin"))
    {
        Device (RMDT)
        {
            Name (_HID, "RMD0000")  // _HID: Hardware ID
            Name (RING, Package (0x0100){})
            Mutex (RTMX, 0x00)
            Name (HEAD, Zero)
            Name (TAIL, Zero)
            Method (PUSH, 1, NotSerialized)
            {
                Acquire (RTMX, 0xFFFF)
                Local0 = (HEAD + One)
                If ((Local0 >= SizeOf (RING)))
                {
                    Local0 = Zero
                }

                If ((Local0 != TAIL))
                {
                    RING [HEAD] = Arg0
                    HEAD = Local0
                }

                Release (RTMX)
                Notify (RMDT, 0x80) // Status Change
            }

            Method (FTCH, 0, NotSerialized)
            {
                Acquire (RTMX, 0xFFFF)
                Local0 = Zero
                If ((HEAD != TAIL))
                {
                    Local0 = DerefOf (RING [TAIL])
                    TAIL++
                    If ((TAIL >= SizeOf (RING)))
                    {
                        TAIL = Zero
                    }
                }

                Release (RTMX)
                Return (Local0)
            }

            Method (COUN, 0, NotSerialized)
            {
                Acquire (RTMX, 0xFFFF)
                Local0 = (HEAD - TAIL) /* \RMDT.TAIL */
                If ((Local0 < Zero))
                {
                    Local0 += SizeOf (RING)
                }

                Release (RTMX)
                Return (Local0)
            }

            Method (P1, 1, NotSerialized)
            {
                PUSH (Arg0)
            }

            Method (P2, 2, NotSerialized)
            {
                Local0 = Package (0x02){}
                Local0 [Zero] = Arg0
                Local0 [One] = Arg1
                PUSH (Local0)
            }

            Method (P3, 3, NotSerialized)
            {
                Local0 = Package (0x03){}
                Local0 [Zero] = Arg0
                Local0 [One] = Arg1
                Local0 [0x02] = Arg2
                PUSH (Local0)
            }

            Method (P4, 4, NotSerialized)
            {
                Local0 = Package (0x04){}
                Local0 [Zero] = Arg0
                Local0 [One] = Arg1
                Local0 [0x02] = Arg2
                Local0 [0x03] = Arg3
                PUSH (Local0)
            }

            Method (P5, 5, NotSerialized)
            {
                Local0 = Package (0x05){}
                Local0 [Zero] = Arg0
                Local0 [One] = Arg1
                Local0 [0x02] = Arg2
                Local0 [0x03] = Arg3
                Local0 [0x04] = Arg4
                PUSH (Local0)
            }

            Method (P6, 6, NotSerialized)
            {
                Local0 = Package (0x06){}
                Local0 [Zero] = Arg0
                Local0 [One] = Arg1
                Local0 [0x02] = Arg2
                Local0 [0x03] = Arg3
                Local0 [0x04] = Arg4
                Local0 [0x05] = Arg5
                PUSH (Local0)
            }

            Method (P7, 7, NotSerialized)
            {
                Local0 = Package (0x07){}
                Local0 [Zero] = Arg0
                Local0 [One] = Arg1
                Local0 [0x02] = Arg2
                Local0 [0x03] = Arg3
                Local0 [0x04] = Arg4
                Local0 [0x05] = Arg5
                Local0 [0x06] = Arg6
                PUSH (Local0)
            }
        }
    }
}
//EOF
```

SSDT-TEST.aml，以Dell为例。注意需要重命名。

```
// In config ACPI, NEVT to XEVT
// Find:     4E 45 56 54 00
// Replace:  58 45 56 54 00
//
DefinitionBlock("", "SSDT", 2, "ACDT", "TEST", 0)
{
    External(XEVT, MethodObj)
    External(RMDT.P1, MethodObj)
    
    Method (NEVT, 0, NotSerialized)
    {
        If (_OSI ("Darwin"))
        {
            \RMDT.P1("AAA001")
        }
        \XEVT()
    }
}
//EOF
```

### 使用

重启后在Launchpad找到控制台，在搜索框输入ACPIDebug，然后按下键盘Fn+F5/F6。若控制台中出现信息，则ACPIDebug驱动成功。

## Maciasl相关

### 版本区别

Rebabman版的Maciasl和原版的区别主要在于部分错误被改为了警告，具体如下。

```
'Illegal method invocation as target operand' (6126->3126)
'Illegal open scope on external object from within DSDT' (6148->3148)
'Min/Max/Length/Gran are all zero, but no resource tag' (6090->3090)
'Invalid combination of Length and Min/Max fixed flags' (6043->3043, one form only)
'Length is larger than Min/Max window' (6049->3049)
'Length is not equal to fixed Min/Max window' (6050->3050)
'Reserved name must be a control method (with zero arguments)' (6103->3103)
'invalid object type for reserved name' (6105->3105)
'Non-hex letters must be upper case' (6136->3136)
'Result is not used, operator has no effect' (6114->3114)
```

# 系统升级

以下均在Mojave的基础上进行。

## 基本知识

一般的小版本更新，如10.15.2升级10.15.3，可以直接在系统内升级。在「系统偏好设置」或「关于本机」中进去系统更新检查。当进度条走完后点击重启，在 Clover 引导界面会出现 Boot macOS install from xxxxx ，方向键选中并按空格，勾选 Verbose(-v) 和 nv_disable=1 后再启动。跑完日志和进度条后会开始升级、自动重启，如果重启后 Clover 中的 Boot macOS install from xxxxx 没有消失则重复上述操作（一般系统更新也需要二次安装）。升级成功后 Clover 引导界面下的 Boot macOS install from xxxxx 会消失。选择 Boot macOS install from xxxxx 进入系统即可。

## Catalina

### 下载

在黑果小兵的部落阁下载即可。

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

### 必要配置

#### 配置EC

EC设备主要为电池管理。由于Catalina中名为AppleACPIEC.kext的插件和USB电源管理依赖于名为EC的ACPI设备，故升级Catalina需要将EC控制器名称改为EC，否则系统启动崩溃。

##### 对于台式机

如果为台式机，可直接禁用EC。

###### 通过阻止AppleACPIEC

以OpenCore为例，在config.pilst中进入Kernel/Block，添加以下内容即可。

| 选项        | 内容                         |
| ----------- | ---------------------------- |
| Enabled     | True                         |
| Indentifier | com.apple.driver.AppleACPIEC |

###### 通过SSDT

可通过脚本自动添加。打开以下链接下载压缩包，解压后运行SSDTTime.command，选择Fake EC并拖拽DSDT文件以自动生成SSDT，放于引导器的ACPI部分即可。

```
https://github.com/corpnewt/SSDTTime
```

也可手动添加。将以下代码复制到MaciASL中，将EC0改为对应的EC名称，另存为SSDT-no-EC.aml，放于引导器的ACPI部分即可。

```
DefinitionBlock ("", "SSDT", 2, "ACDT", "SsdtnoEC", 0x00001000)
{
    External (_SB.PCI0.LPCB, DeviceObj)
    External (_SB.PCI0.LPCB.EC0, DeviceObj)

    Scope (\_SB.PCI0.LPCB.EC0)
    {
        Method (_STA, 0, NotSerialized)  // _STA: Status
        {
            If (_OSI ("Darwin"))
            {
                Return (0)
            }
            Else
            {
                Return (0x0F)
            }
        }
    }
}
```

##### 对于笔记本

由于笔记本有电池，不能禁用EC。

打开系统DSDT，搜索PNP0C09，查看对应的EC名称。若不止一个，则需要判断此EC是否被屏蔽，主要看其_STA方法是否存在Return (Zero)，若存在，则说明此设备被禁用。如本机对应两个EC名称H_EC和EC0，但只有EC0未被屏蔽，则只需对EC0进行改名。

更名补丁示例如下，注意EC0需改成自己对应的EC设备名。

```
Comment: Rename EC0 to EC 
Find: 4543305F 
Replace: 45435F5F
```

#### 更新kexts

将要用到的kexts更新到最新版本。本机在未更新Lilu和Whatevergreen的情况下显卡出现GFX Firmware问题。 

### 系统使用

#### 解锁系统分区

Catalina的系统分区被锁定，无法直接修改系统盘内的文件。进行SLE路径的驱动安装等操作需要解锁。

##### 通过终端

```
sudo su
sudo mount -uw / && killall Finder
```

##### 通过自动执行脚本

打开系统的`自动操作`程序，选择应用程序-运行Shell脚本，修改Shell为/bin/bash并将以下脚本粘贴进去，保存为unlockSystem.app。

```
#! /bin/bash
echo '电脑密码' | sudo -S mount -uw / && killall Finder
```

打开偏好设置-用户与群组，在登录项中将unlockSystem.app添加到启动项并勾选隐藏即可。

##### 通过plist

将以下内容保存为CatalinaAutoMountWritable.plist，并放在系统盘的Library/LaunchDaemons即可。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>KeepAlive</key>
    <false/>
    <key>RunAtLoad</key>
    <true/>
    <key>LaunchOnlyOnce</key>
    <true/>
    <key>Label</key>
    <string>CatalinaAutoMountWritable</string>
    <key>ProgramArguments</key>
    <array>
        <string>/sbin/mount</string>
        <string>-uw</string>
        <string>/</string>
    </array>
</dict>
</plist>
```

#### 解锁Sidebar

部分机型不支持Sidebar，可通过修改机型或在终端输入以下命令解锁。

```
// 绕过SMBIOS限制
defaults write http://com.apple .sidecar.display allowAllDevices -bool YES

// 解锁系统首选项中Sidebar页
defaults write com.apple.sidecar.display hasShownPref -bool true
```

## Big Sur

### 特性

即使关闭SIP，root用户依然无法挂载根目录为读写。这意味着直接修改System文件夹内的文件需要到Recovery模式下的终端修改。

因此，单用户模式下不能再加载launchd服务，也不能通过调用OpenDirectory服务修改root密码和管理员密码。

```
launchctl load /S*/L*/LaunchDaemons/com.apple.opendirectory.plist
```

launchctl在单用户模式加载的服务会自动停止运行，同时屏幕显示service only ran for 5 seconds，无法在单用户模式找回管理员密码。

同时，单用户模式中加载kext的kextload命令也失去了效果，被/usr/bin/kmutil接替，不允许绕过系统安全性设置来加载kext，这意味着root用户不能通过终端加载kext。

同时，AppleIntelInfo.kext已经无法用于获取当前CPU状态。

### 下载

在黑果小兵的部落阁下载即可。

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ Big\ Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

### 必要配置

与Catalina一致。

### 引导器修改

Big Sur需要Clover版本至少为5120，且需要使用OcQuirks作为内存管理驱动。

需要额外添加的启动参数如下。

```
// DW1820A/DW1560/DW1830等博通网卡可能还需要添加brcmfx-aspm
plugin-type=1 vsmcgen=1 -lilubetaall -vsmcbeta
```

安装重启后的第二阶段，如果直接从安装盘启动，会一直循环com.apple.xpc.launchd[1]。这时需要在CLOVER主引导界面按F3，选择Preboot以继续完成安装。

OpenCore基本与Clover一致。

### 系统使用

#### 禁用SIP

对于OpenCore，打开config.plist，进入NVRAM-add-7C436110-AB2A-4BBB-A880-FE41995C9F82，并修改csr-active-config为FF0F0000，然后进入NVRAM-block-7C436110-AB2A-4BBB-A880-FE41995C9F82，添加`csr-active-config`一项。

然后进入系统恢复模式，输入以下命令后重启。

```
csrutil disable
csrutil authenticated-root disable
```

#### 重建kexts缓存

Big Sur重建缓存的命令有所变化，如下。

```
sudo chown -R root:wheel ~/livemount/System/Library/Extensions/
sudo chmod -R 755 ~/livemount/System/Library/Extensions/
sudo kmutil install --volume-root ~/livemount --update-all
sudo kcditto
```

#### 修改系统文件

Big Sur从快照启动，通过`sudo mount -uw /`挂载系统分区时会出现failed with 66的错误。

需要通过挂载系统分区，修改分区内容后新建系统分区快照，并指定启动时使用该快照，达到修改系统文件的目的。

注意，由于此方法会使快照的状态变为broken，所以只适用于OpenCore引导，并设置SecureBootModel为Disabled。若使用Clover引导或未设置SecureBootModel，则会启动到恢复模式。

确保禁用SIP后，打开终端并输入以下命令。

```
mkdir ~/livemount
diskutil list
// 查找系统分区，如disk1s5
sudo mount -o nobrowse -t apfs /dev/disk1s5 ~/livemount
```

前往用户目录，即可看到挂载的系统分区。在该目录下进行系统修改操作。完成后回到终端并输入以下命令，以创建新的快照。

```
sudo bless --folder ~/livemount/System/Library/CoreServices --bootefi --create-snapshot
```

<details>
<summary>其它方法</summary>

确保禁用SIP后，进入恢复模式，打开终端并输入以下命令。

```
diskutil list
// 查找系统分区，如disk1s5
diskutil mount disk1s5
ls -l /Volumes/
// 查找系统分区名称，如Samsung 1（因为挂载了快照，真正的系统分区后面会有一个1）
sudo mount -uw /Volumes/Samsung\ 1
sudo su
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -v /Volumes/Samsung\ 1 -r ""

diskutil apfs listSnapshots disk1s5
// 删除所有快照
diskutil apfs deleteSnapshot disk1s5 -uuid [UUID]
```
</details>

#### 安装kext到SLE

确保禁用SIP后，打开终端并输入以下命令。

```
sudo kcditto
```

记录Volume Group UUID和Preboot disk。然后进入恢复模式，打开终端并输入以下命令。

```
diskutil mount /Volumes/[系统分区名称]
mount -uw /Volumes/[系统分区名称]
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -s "Before" -v /Volumes/[系统分区名称]
cd /Volumes/[系统分区名称]
```

命令执行完成后可通过终端完成文件移动操作。以安装IO80211Family为例，命令如下。

```
cd /Volumes/[系统分区名称]/System/Library/Extension
mv IO80211Family.kext IO80211Family.kext.backup
cp -r /Volumes/[IO80211Family的位置]/IO80211Family.kext .
```

完成后需要重建内核缓存，命令如下。

```
kmutil install --update-all --volume-root /Volumes/[系统分区名称]
```

继续执行以下命令以新建快照。

```
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -s "After" -v /Volumes/[系统分区名称]
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -r "After" -v /Volumes/[系统分区名称]
```

然后需要将更新后的BootKernelExtensions复制到Preboot分区。输入以下命令。

```
diskutil mount /dev/[前面记录的Preboot disk]
cd /Volumes/Preboot
ls
// 确保存在以前面记录的Volume Group UUID为名的文件夹
cp -r [Volume Group UUID] [Volume Group UUID].bak
cd /Volumes/Preboot/[Volume Group UUID]/boot/System/Library/KernelCollections
cp /Volumes/[系统分区名称]/System/Library/KernelCollections/BootKernelExtensions.kc .
cp /Volumes/[系统分区名称]/System/Library/KernelCollections/BootKernelExtensions.kc.elides .
```

完成后重启即可。若失败，则进入恢复模式或引导到USB安装器，打开终端并输入以下命令，重启即可。

```
/System/Library/Filesystems/apfs.fs/Contents/Resources/apfs_systemsnapshot -r "Before" -v /Volumes/[系统分区名称]
cd /Volumes/Preboot
mv [Volume Group UUID] [Volume Group UUID].broken
cp -r [Volume Group UUID].bak [Volume Group UUID]
```

#### 常用命令

##### 重建内核缓存

```
kmutil install --update-all --volume-root /Volumes/[系统分区名称]
```

### 常见问题

#### 启动过程

##### 卡AppleACPICPU/x86Platform plugin

继续等待较长时间即可。在引导器的ACPI部分加入OC-little包X86注入部分的SSDT-PLUG即可修复。

##### 卡disk1s1 is locked

继续等待即可。

##### 卡waiting for root device

有可能是因为没有放VoodooI2C.kext，导致卡在IOUSBDevice。注意放置VoodooI2C.kext后，需要禁用其中的VoodooInput.kext.dYSM和VoodooInput.kext，因为VoodooI2C与VoodooPS2都有VoodooInput，两者会发生冲突。

##### 内核错误

###### Rooting from the live fs of a sealed volume is not allowed on a release build

修改系统快照导致。对于OpenCore，设置SecretBootModel为Disabled即可。对于Clover，由于无法设置SecretBootModel，需要恢复为未修改的快照。

注意，快照没有被破坏时，SecureBootModel可以设为Default。

可打开终端并输入以下命令以判断快照情况。若返回Snapshot Sealed为Yes，则未被修改。若为Broken，则快照被修改，可进入恢复模式，通过时间恢复机器回滚到以前的快照，或重新安装。

```
diskutil apfs list
Volume [disk number(disk1s8)] [UUID(A604D636-3C54-4CAA-9A31-5E1A460DC5C0)]
```

#### 系统运行

##### DRM视频解码黑屏

可尝试添加启动参数`shikigva=80`。

## 旧款主板相关

如果主板或CPU较旧，则只能安装旧版系统。

可先查看CPU支持的指令集，如果CPU不支持SSE4.1指令集，则不能运行10.12及以上的系统。10.11支持SSE3指令集。

### UEFI引导

如果主板为BIOS Legacy模式，可以通过模拟UEFI实现，具体做法可参照有关引导的文章。向EFI分区安装好Clover后即可开始。

#### U盘安装

在Mac系统下下载好后缀为app的安装包拖到`应用程序`文件夹。用磁盘工具格式化U盘，选择GUID分区图，格式化为Mac日志式。然后打开终端并输入以下命令，下以Sierra安装包为例，其中/Volumes/Sierra为U盘的盘符。

```
sudo /Applications/Install\ macOS\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/Sierra --applicationpath /Applications/Install\ macOS\ Sierra.app --nointeraction
```

制作完成后，插入到需要安装的电脑即可引导启动。

#### 硬盘安装

用Diskgenius划分一块10G左右的磁盘作为安装盘，注意分配盘符但不要分区。通过硬盘安装助手，可以把镜像写到硬盘中。

如果镜像为cdr格式，则需要以管理员模式打开硬盘安装助手，选择安装镜像和安装磁盘，只勾选`写入`，点击开始即可。如果不以管理员身份运行，则会出现`not a HFS partition`的错误提示。

完成写入后需要手动设置安装盘的参数。打开Diskgenius，在安装盘分区上右键选择修改参数，修改系统类型为`48465300-0000-11AA-AA11-00306543ECAC`即可。

如果是以app为后缀的安装包，则需要从app包制作cdr镜像。打开终端并输入以下命令即可。

```
// 创建dmg
// -size 8300m是指镜像大小8300MB，这里的8300改为app包大小的基础上增加500MB左右
hdiutil create -o /tmp/Install\ macOS\ Catalina -size 8500m -layout SPUD -fs HFS+J

// 挂载dmg
hdiutil attach /tmp/Install\ macOS\ Catalina.dmg -noverify -mountpoint /Volumes/Install\ macOS\ Catalina

// 将app写入dmg
echo Y | sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/Install\ macOS\ Catalina

// 卸载挂载的dmg
hdiutil detach /Volumes/Install\ macOS\ Catalina

// 将dmg转换为cdr
hdiutil convert /tmp/Install\ macOS\ Catalina.dmg -format UDTO -o ~/Desktop/Install\ macOS\ Catalina

// 删除dmg
rm /tmp/Install\ macOS\ Catalina.dmg
```

### BIOS引导

如果不希望使用模拟UEFI，也可以通过MBR+BIOS的模式。注意，由于​Mac不支持MBR启动，因此需要通过MBR补丁的方式实现，且应当使用Ecoch即变色龙进行引导，通过Clover引导时可能会出现`X64 Exception`的错误。

注意，对于变色龙而言，Extra/Extensions目录相当于Clover的kexts/Other目录。

#### 安装引导器

##### U盘安装

在Mac系统下下载Ecoch的pkg安装包，安装时安装路径选择U盘即可。U盘可为MBR分区表。

##### 硬盘安装

下载Chameleon Install安装器并打开，按照提示完成安装。安装好的镜像文件wowpc.iso位于系统分区根目录，下载最新的wowpc.iso并替换即可。

#### 准备安装介质

下载Catalina MBR HFS Firmware Check Patch，打开dmg文件，进入`Old-macOS-10+11+12`，运行想安装的系统的脚本。注意需要使用一个U盘作为写入盘，并按照提示格式化。

安装盘完成后，需要将Enoch-r2922里的文件拷贝到引导器。对于U盘安装的变色龙而言，直接替换文件即可。而对于硬盘安装，需要编辑iso文件。

### 启动排错

启动时需添加`-v`参数以进入啰嗦模式。

#### 用Clover引导选择完启动项后即黑屏

更换旧版Clover，如r3333。注意，旧版Clover需要在启动项上空格，并选择`Boot with injected kexts`才能载入kexts。

#### 卡AppleEHCI/AppleUHCI

可尝试添加引导参数`USBBusFix=Yes`，若无效用Clover Configurator打开ACPI中的FixHPET和FixIPIC，若无效则改用硬盘模式安装。

#### 显示panic(CPU 1 caller 0xffffff800e7ce6fa):Kernel trap at 0xffffff7f9294d4c6

如果用Clover引导，可勾选FixHPET和FixIPIC。

#### 卡Missing bluetooth controller transport!后禁行

如果用Clover引导，则可勾选FixHPEC，FixIPIC，FixFirewire，FixUSB，DropOEM，并关闭所有USB注入。




# 系统降级

以下均在Mojave的基础上进行。

## High Sierra

### 下载

在黑果小兵的部落阁下载即可。此处使用10.13.6，使用10.13可能会出现`OSInstall.mpkg似乎已缺失或已损坏`的问题。

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

### 必要配置

#### 时间设置

从U盘启动后，安装向导会提示安装包破损，其原因是苹果对安装包的签名已经过期。保持断网，在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 0201010116
```

### 引导器修改

可使用原来的引导，将SMBIOS改为MacBook Pro14,2即可。注意csrconfig应为0x67。

### 驱动修补

无需任何修改。

## Sierra

### 下载

在黑果小兵的部落阁下载即可。此处使用10.12.6，这是Whatevergreen支持的Kaby Lake架构下的最旧版本。

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ macOS\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume
```

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 100123452015
```

### 引导器修改

与High Sierra一致。

### 驱动修补

与High Sierra一致。

## El Capitan

### 下载

```
// 10.11.6
https://sundryfiles.com/1LI3~i
https://sundryfiles.com/31KG~i
https://sundryfiles.com/1LI2~i
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ OS\ X\ El\ Capitan.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ El\ Capitan.app
```

### 引导器修改

使用Clover 3911。

#### 设置FakeCPUID

每个系统都只能在特定架构的CPU下使用，系统会有对应的CPU白名单，在名单内的CPU才能被运行。对于Kaby Lake，El Capitan本身并不支持，因此启动时会出现卡一排+号，或卡AppleIntelCPU的问题。

通过设置FakeCPUID，可以在启动过程中骗过系统，从而顺利完成启动。注意系统启动完成后，通过Hackintool可以看到正确的CPU信息。对于El Capitan，可使用`0406E3`。

若一时未能找到合适的CPUID，可在Clover引导页面进入Options-Binary Patching，勾选Support CPU，然后返回主界面进行引导。由于Clover引导的CPUID未必合适，因此可能会产生问题。

可通过查看安装包中的InstallESD.dmg/BaseSystem.dmg/System/Library/Extensions中含有架构缩写（如SL、KBL等）的kext，以判断该系统适用于哪些架构的CPU。

#### 其它配置

勾选Kernel Pm、AppleRTC、XCPM、IntelCPUPM，csrconfig设置为0x67。

### 驱动修补

#### SATA支持

对于本机，El Capitan无法提供完整的SATA支持，从而导致启动时卡在DSMOS has arrived，且启动后无法识别SATA硬盘的问题。可通过在Clover中放置SATA-unsupported.kext修复。

#### 键盘

不能使用最新版的VoodooPS2Controller，会卡在鼠标键盘解锁的页面。可以使用20161208的RehabMan版VoodooPS2Controller。



### 常见问题

#### 登录时卡无敌风火轮

若已经出现该问题，则可重新进入一次设置向导以临时进入。Clover启动时添加引导参数-s以进入单用户模式，然后运行以下命令即可。

```
sbin/mount -uw
rm /var/db/.AppleSetupDone
```

也可在输入密码后，不要敲Enter键，而是单击输入框右侧的箭头按钮以临时进入系统。

设置自动登录即可从本质上避免此问题。也可打开终端，输入以下命令以解决。

```
su [用户名]
sudo find /private/var/folders | grep com.apple.LaunchServices | grep csstore
/private/var/folders/cd/someLongRandomNameHere/someFolderNumberHere/[上面出现的每一个.csstore文件]
```



## Yosemite

### 下载

10.10.5下载链接如下。

```
http://updates-http.cdn-apple.com/2019/cert/061-41343-20191023-02465f92-3ab5-4c92-bfe2-b725447a070d/InstallMacOSX.dmg

https://sundryfiles.com/2BK5~i
https://sundryfiles.com/2BK3~i
https://sundryfiles.com/2BK2~i
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ OS\ X\ Yosemite.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ Yosemite.app
```

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 100123452015
```












### 引导器修改

Clover使用4096。

#### 设置FakeCPUID

可使用0306D0，以仿冒BroadWell。

#### 其它配置

勾选Kernel Pm、AppleRTC、XCPM、IntelCPUPM，csrconfig设置为0x67。

### 驱动修补

#### USB

需要添加GenericUSBXHCI.kext以修补USB3驱动，且添加引导参数`-gux_nomsi`，否则在通过U盘启动时，由于无法找到启动盘，将卡在Still Waiting for root device。

注意，插入的设备在系统启动后无法热插拔。

### 常见问题

#### 安装时卡one second remaining

原因是缺少TSplicedFont字体。通过以下链接下载字体包，放入USB安装盘的System/Library/Fonts即可。

```
https://www.google.com/get/noto/
```

## Mavericks

### 下载

```
// 10.9.5
http://updates-http.cdn-apple.com/2019/cert/061-41343-20191023-02465f92-3ab5-4c92-bfe2-b725447a070d/InstallMacOSX.dmg

// 10.9
https://sundryfiles.com/2BKy~i
https://sundryfiles.com/3eM
```

### 安装盘制作

若获得的是系统app安装包，则将其移动到应用程序文件夹后，可通过以下命令制作安装盘。注意MyVolume为USB磁盘名称。

```
sudo /Applications/Install\ OS\ X\ Mavericks.app/Contents/Resources/createinstallmedia --volume /Volumes/MyVolume --applicationpath /Applications/Install\ OS\ X\ Mavericks.app --nointeraction
```

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 100123452014
```

### 引导器修改

Clover使用4096。

#### 设置FakeCPUID

可使用0306C0，以仿冒HasWell。

#### 其它配置

同Yosemite。

### 驱动修补

同Yosemite。

## Mountain Lion

### 下载

```
// 速度较慢
https://thepiratebay.org/description.php?id=8922294
https://thepiratebay.org/description.php?id=8604586

// iATKOS
https://thepiratebay.org/description.php?id=7973176

// 10.8.5
https://sundryfiles.com/2BKv~i
https://sundryfiles.com/31KE
https://sundryfiles.com/2BJ7
```

### 安装盘制作

在系统app安装包上右键，点击显示包内容，进入Contents/Shared Support，双击InstallESD.dmg以挂载。打开磁盘工具，选择要设置为安装盘的USB，点击恢复，来源为刚才挂载的镜像Mac OS X Install ESD，等待完成即可。

如果为dmg镜像，也可直接双击挂载该镜像，并用该镜像恢复。

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```
date 020123452013
```










### 引导器修改

同Mavericks。

## Lion

### 下载

尽量使用10.7.5。该版本前的SLE中的IOUSBFamily没有AppleUSBXHCI，因此GenericUSBXHCI无法工作，USB3不受支持。

```
// 10.7.5
https://sundryfiles.com/IO
https://sundryfiles.com/31KT~i
https://sundryfiles.com/2BK0~i
https://sundryfiles.com/2BK1~i
https://www.malavida.com/en/soft/lion/mac/download
https://allmacworld.com/mac-os-x-lion-10-7-5-dmg-free-download/
https://justapplestuff.com/mac-os-x-lion-download/
https://pan.baidu.com/s/1dDEdXa5
https://igetintopc.com/mac-os-x-lion-10-7-5-dmg-free-download/

// 10.7
https://sundryfiles.com/1LI1
https://sundryfiles.com/31KH
https://sundryfiles.com/1LI0~i

// 其它
https://thepiratebay.org/description.php?id=6554150
https://thepiratebay.org/description.php?id=6688033
https://thepiratebay.org/description.php?id=7056418

// 速度较慢
https://thepiratebay.org/description.php?id=6200584
https://thepiratebay.org/description.php?id=6555402
```

### 安装盘制作

同Mountain Lion。

### 引导器修改

Clover使用4096。

#### 设置FakeCPUID

可使用0206F0，以仿冒WestmereFx。

#### 其它配置

勾选Kernel Pm、AppleRTC、XCPM、IntelCPUPM，csrconfig设置为0x67。



### 系统使用

#### 显示隐藏文件

打开终端并输入以下命令即可。

```
defaults write com.apple.finder AppleShowAllFiles TRUE
killall Finder
```

## Snow Leopard

```
------------>>>>>卡在panic(cpu caller 0xffffff801ead78f4): "Unable to find driver for this platform: \"ACPI\".\n"@/Library/Caches/com.apple.xbs/Sources/xnu/xnu-3789.51.2/iokit/Kernel/IOPlatformExpert.cpp:1672
Debugger called: <panic>

【com.apple.driver.AppleACPIPlatform上的KP绝对意味着错误的DSDT.aml
https://sourceforge.net/p/cloverefiboot/tickets/248/】


【！！！！实际上需要由iASL v4.0/5.0重新编译由SSDTTime构建的SSDT。这是由于OS X 10.6和更早的版本不支持ACPI规范的较新版本（acpi 6会卡acpi）
acpi 4：maciasl-偏好设置中可设置iasl 4
主要区别：iasl 6.3可以先使用后定义，iasl 4不行
修改：主要是调整次序和if调换位置

acpi 4没有I2cSerialBus/I2cSerialBusV2函数，I2CSerialBus在acpi 5.0，V2在acpi 6.0
acpi 4只支持smbus（i2c的子集），不支持i2c】


解决方法：
用acpi 5编译:删掉V2和Exclusive,

---------------------

panic卡appleintelcpumanagement：
可以直接删掉SLE下的这个kext
（Nullpowermanagement不行）

---------------------

卡pci configuation begin：
加启动参数cpus=1

【它会打印出16个ACPI线程，编号分别为0-15、0-7和8-15。现在显然我的i7应该只有8个线程（四核，每个核2个线程）。所以我猜OS X某种程度上在我的机器上找到了第二个虚构的CPU。我尝试使用cpus = 1内核参数进行引导，并且确实可以完全引导。】
https://www.tonymacx86.com/threads/stuck-on-pci-configuration-begin-npci-0x2000-not-working.49320/

然后就卡panic：kernel trap了

----------------------------------------->>>>>>>>>更换为OC引导：
data:A0060200 00000000 00000000 00000000
mask:FFFFFFFF 00000000 00000000 00000000

开EnableWriteUnprotector，不能开RebuildAppleMemoryMap

OC引导不用加cpus=1，不卡panic，
直接到still waiting for root device

```

### 下载

```
// 10.6.3
https://sundryfiles.com/1LI6~i
https://sundryfiles.com/3eO
http://shortconnect.com//81
```


```
在 OS X Snow Leopard 中，即使已经内置了 64 位内核，系统也依然默认启动 32 位内核。这个启动参数可以使系统强制使用 64 位内核。如果要使系统总是以 32 位内核启动，请将 x86_64 部分替换为 i386。在某些情况下，第三方 kext 可能只有 32 位或 64 位，需要启动到相应的内核类型才能加载。

// 下载
https://drive.google.com/drive/folders/0B661P9Kp9bPAdUViMVFYRW9KWFE

【下载速度慢】https://macintoshgarden.org/apps/apple-osx-snow-leopard
【下载速度慢】https://lu9-my.sharepoint.com/personal/barneys_5tb_in/_layouts/15/onedrive.aspx?originalPath=aHR0cHM6Ly9sdTktbXkuc2hhcmVwb2ludC5jb20vOnU6L2cvcGVyc29uYWwvYmFybmV5c181dGJfaW4vRVdTcFpSUXRvZ2hPbkVlYkQtQzBGdWdCVkhvbjRSVkxsYTgzcDRqYnc2eU11UT9ydGltZT1nNVd0RFh5aDJFZw&id=%2Fpersonal%2Fbarneys%5F5tb%5Fin%2FDocuments%2FMac%20OS%20Snow%20Leopard
【还可以】https://thepiratebay.org/description.php?id=5068890
【可用】https://thepiratebay.org/description.php?id=6106470
【一般】https://thepiratebay.org/description.php?id=6407331

// DSDT
https://www.insanelymac.com/forum/topic/211705-guide-snow-leopard-with-100-vanilla-sle-comprehensive-dsdt-patching-guide/

// 教程
https://xuelianghan.tumblr.com/post/52456030005/hack-hackintosh-install-mac-os-x-1068-snow
https://blog.csdn.net/Mamong/article/details/6791740
https://newwo767.weebly.com/hackintosh-snow-leopard-dmg-download.html
https://amd-osx.com/forum/viewtopic.php?t=4482
http://www.macbreaker.com/2012/02/how-to-install-mac-os-x-snow-leopard-on.html



这个方法可以在10.7上装10.6！【不能10.12上装】
适用于传统BIOS，安装完以后都没有启动文件
本机是UEFI（不装变色龙了），添加boot启动文件后也不可以引导
本方法会把磁盘变成MBR
将磁盘改为MBR/GPT都不可以引导
【对于UEFI，本方法失败，启动不了还得重做引导】
https://tonymacx86.blogspot.com/2009/11/alternate-guide-1-os-x-snow-leopard.html
【失效文件tonymacx86-snowleopard.zip的链接】
http://www.lookass.ch/?id=4&area=art&art=248


【其它类似教程】
https://tonymacx86.blogspot.com/2009/11/os-x-snow-leopard-install-using-retail.html
https://tonymacx86.blogspot.com/2009/12/install-os-x-snow-leopard-directly-from.html


```

### 安装盘制作

同Mountain Lion。

### 驱动修补

#### USB

由于SLE中的IOUSBFamily没有AppleUSBXHCI，只有AppleUSBEHCI，因此仅支持USB2，不支持USB3。

## Leopard

### 下载

```
// 10.5.6
https://sundryfiles.com/sD
https://www.shortconnect.com/84

// 10.5
https://sundryfiles.com/J2
```


```
// 下载
https://thepiratebay.org/description.php?id=4179024

发行版：
JaS
ftp有

Kalyway
【无下载速度】https://archive.org/details/Kalyway10.5.2DVDIntelAmd
【可用，Kalyway发行版】https://macintoshgarden.org/apps/kalyway-1052-intel-and-amd
https://www.insanelymac.com/forum/topic/77069-kalyway-1051-dvd-release-the-official/

iATKOS(https://www.iatkos.in/)
ftp有

iPC
【iPC OSX86 10.5.6】迅雷可下，点GET THIS TORRENT，要耐心等待资源连接
https://thepiratebay.org/description.php?id=4608978
magnet:?xt=urn:btih:E09F09BE2CF14BC8889DEB22139CA9615D735900

http://ipcosx86.wikidot.com/

iDeneb

Leo4all



// 问题
OsxAptioFixDrv：requested memory exceeds our allocated relocation block
————换成OsxAptioFixDrv2就可以了

卡在panic: Unsupported CPU
————开Intelcpupmkernel

```

### 驱动修补

#### USB

由于SLE中的IOUSBFamily没有AppleUSBXHCI，只有AppleUSBEHCI，因此仅支持USB2，不支持USB3。




## Tiger

```
// 教程
https://www.instructables.com/Installing-HackintoshOSx86-1048-on-your-PC/
https://blog.naver.com/sysyphus/70025314227
https://sunxiunan.com/archives/547
http://www.playcase.com/blog/article.asp?id=55
https://bbs.pku.edu.cn/attach/3a/a6/3aa64081194c48fc/%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95.pdf
http://blog.sina.com.cn/s/blog_3ea30f900100g28u.html
https://www.cnblogs.com/hellocaoyi/p/3593045.html
https://www.instructables.com/Installing-HackintoshOSx86-1048-on-your-PC/
https://github.com/ProgrammingHider/MacOSX-T42

// 下载
原版ISO
https://macbold.com/mac-os-x-10-4-tiger-retail-dvd-dmg-iso-torrent-download/
ftp有

破解版ISO
【无下载速度】https://archive.org/details/mac-os-x-tiger-10-4-8-hackintosh-jas
【无下载速度】https://archive.org/details/mac-os-x-10.4.8-ja-s-amd-intel-sse-2-sse-3-with-ppf-1-ppf-2

【ftp有】JaS.10.4.8.AMD.Intel.SSE2.SSE3.iso
```

### 下载

10.4下载链接如下。

```
https://sundryfiles.com/2BKz~i
https://sundryfiles.com/4px
http://macbold.com/wp-content/uploads/2018/10/Mac-OS-X-Tiger-Retail-DVD-ISO.torrent.zip
```

### 必要配置

#### 时间设置

在安装向导菜单栏点击实用工具-终端，输入以下命令即可。

```

```

### 驱动修补

#### USB

由于SLE中的IOUSBFamily没有AppleUSBXHCI，只有AppleUSBEHCI，因此仅支持USB2，不支持USB3。

# 系统优化

## 华硕笔记本键盘修复

### 按键驱动

利用AsusSMC.kext，可修复华硕笔记本键盘与Fn有关的快捷键不工作的问题。需要Lilu和VirtualSMC，下载链接如下。

```
https://github.com/hieplpvip/AsusSMC
```

将下载好的kext放到Clover的kexts文件夹中，若键盘有睡眠和飞行模式按键则还需运行install_daemon.sh，然后重启。逐个测试按键是否工作，若不工作，可通过SSDT或DSDT进行修补。

### 按键修复

#### 通过DSDT

用MaciASL打开DSDT。添加以下源，然后点击Patch打相应补丁即可。

```
http://raw.github.com/hieplpvip/AsusSMC/master
```

#### 通过SSDT

选取以下所需代码复制到MaciASL中，创建一个SSDT并保存为SSDT-ASUS.aml，放入引导器的ACPI部分，并按照注释在config.plist中添加更名补丁即可。

```
DefinitionBlock ("", "SSDT", 2, "hack", "EC", 0x00000000)
{
    External (_SB.ATKD.IANE, MethodObj)
    External (_SB.ATKP, IntObj)
    External (_SB.PCI0.LPCB.EC, DeviceObj)

    Scope (_SB.PCI0.LPCB.EC)
    {
        // F1
        // change _Q0A to XQ0A
        // Find: 5F513041
        // Replace: 58513041
        Method (_Q0A, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x5E)
            }
        }
            
        // F2
        // change _Q0B to XQ0B
        // Find: 5F513042
        // Replace: 58513042
        Method (_Q0B, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x7D)
            }
        }
        
        // F3
        // change _Q0C to XQ0C
        // Find: 5F513043
        // Replace: 58513043
        Method (_Q0C, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0xC5)
            }
        }
        
        // F4
        // change _Q0D to XQ0D
        // Find: 5F513044
        // Replace: 58513044
        Method (_Q0D, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0xC4)
            }
        }

        // F5
        // change _Q0E to XQ0E
        // Find: 5F513045
        // Replace: 58513045
        Method (_Q0E, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x20)
            }
        }

        // F6
        // change _Q0F to XQ0F
        // Find: 5F513046
        // Replace: 58513046
        Method (_Q0F, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x10)
            }
        }
        
        // F7
        // change _Q10 to XQ10
        // Find: 5F513130
        // Replace: 58513130
        Method (_Q10, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x35)
            }
        }
        
        // F8
        // change _Q10 to XQ10
        // Find: 5F513131
        // Replace: 58513131
        Method (_Q11, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x61)
            }
        }
        
        // F9
        // change _Q12 to XQ12
        // Find: 5F513132
        // Replace: 58513132
        Method (_Q12, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x6B)
            }
        }
        
        // F10
        // change _Q13 to XQ13
        // Find: 5F513133
        // Replace: 58513133
        Method (_Q13, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x32)
            }
        }
        
        // F11
        // change _Q14 to XQ14
        // Find: 5F513134
        // Replace: 58513134
        Method (_Q14, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x31)
            }
        }
        
        // F12
        // change _Q15 to XQ15
        // Find: 5F513135
        // Replace: 58513135
        Method (_Q15, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x30)
            }
        }

        // media left arrow key
        // change _Q6C to XQ6C
        // Find: 5F513643
        // Replace: 58513643
        Method (_Q6C, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x40)
            }
        }
        
        // media right arrow key
        // change _Q6D to XQ6D
        // Find: 5F513644
        // Replace: 58513644
        Method (_Q6D, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x41)
            }
        }

        // media up arrow key
        // change _Q6E to XQ6E
        // Find: 5F513645
        // Replace: 58513645
        Method (_Q6E, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x43)
            }
        }
        
        // media down arrow key
        // change _Q6F to XQ6F
        // Find: 5F513646
        // Replace: 58513646
        Method (_Q6F, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x45)
            }
        }

        // space key
        // change _Q71 to XQ71
        // Find: 5F513731
        // Replace: 58513731
        Method (_Q71, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x5C)
            }
        }

        // V key
        // change _Q72 to XQ72
        // Find: 5F513732
        // Replace: 58513732
        Method (_Q72, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x8A)
            }
        }


        // C key
        // change _Q73 to XQ73
        // Find: 5F513733
        // Replace: 58513733
        Method (_Q73, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x82)
            }
        }

        // ALS toggle A key
        // change _Q6F to XQ6F
        // Find: 5F513646
        // Replace: 58513646
        Method (_Q6F, 0, NotSerialized)
        {
            If (^^^^ATKP)
            {
                ^^^^ATKD.IANE (0x7A)
            }
        }
    }
}
```


## CPU显示未知修复

打开终端并输入以下命令。

```
cd /System/Library/PrivateFrameworks/AppleSystemInfo.framework/Versions/A/Resources/zh_CN.lproj/
cp AppleSystemInfo.strings ~/Desktop
```

打开AppleSystemInfo.strings，将UnknownCPUKind下的内容修改为需要显示的内容，如下。

```
<key>UnknownCPUKind</key>
<string>Intel Core i7-8700K</string>
```

保存后在终端输入以下命令即可。

```
sudo cp ~/Desktop/AppleSystemInfo.strings /System/Library/PrivateFrameworks/AppleSystemInfo.framework/Versions/A/Resources/zh_CN.lproj/
```

# 系统安装与维护
## 修改InstallESD.dmg

InstallESD.dmg位于macOS系统的安装包内，修改其内容（如删除部分kexts）可能会使安装过程更加顺利。

打开磁盘工具，点击菜单栏上的映像-转换，选择要转换的镜像，映像格式选择读/写。打开转换好的dmg，修改完成后再次转换，映像格式选择压缩即可。

## 恢复盘

### FireWolf OS X PE

类似Windows PE，FireWolf OS X PE可视作macPE，可为Mac提供恢复环境。

#### 安装

在Windows下用Etcher刻录到U盘即可。

#### 引导启动

在启动之前需先确保系统完整性保护（SIP）中已允许加载任意Recovery系统，即启用CSR标志位`CSR_ALLOW_ANY_RECOVERY_OS`，修改Clover配置文件中的Rt Variables-CsrActiveConfig为0x3E7即可。

使用引导High Sierra的Clover文件，可以顺利启动该恢复盘。

# 本机文件内容

## DSDT

### 电池

```
    Scope (_SB.PCI0.LPCB.EC0)
    {
        Device (BAT0)
        {
            Name (_HID, EisaId ("PNP0C0A"))  // _HID: Hardware ID
            Name (_UID, Zero)  // _UID: Unique ID
            Name (_PCL, Package (0x01)  // _PCL: Power Consumer List
            {
                PCI0
            })
            Method (_STA, 0, NotSerialized)  // _STA: Status
            {
                If (BATP (Zero))
                {
                    Return (0x1F)
                }
                Else
                {
                    Return (0x0F)
                }
            }

            Name (LOW2, 0x012C)
            Name (PUNT, One)
            Name (LFCC, 0x1770)
            Name (NBIF, Package (0x0D)
            {
                Zero, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                One, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                "", 
                "", 
                "", 
                ""
            })
            Name (PBIF, Package (0x0D)
            {
                One, 
                0x1770, 
                0x1770, 
                One, 
                0x39D0, 
                0x0258, 
                0x012C, 
                0x3C, 
                0x3C, 
                "M3N", 
                " ", 
                "LIon", 
                "ASUSTeK"
            })
            Name (PBST, Package (0x04)
            {
                Zero, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF
            })
            Name (BIXT, Package (0x14)
            {
                Zero, 
                Zero, 
                0x1770, 
                0x1770, 
                One, 
                0x39D0, 
                0x0258, 
                0x012C, 
                Zero, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0x3C, 
                0x3C, 
                "M3N", 
                " ", 
                "LIon", 
                "ASUSTeK"
            })
            Name (NBIX, Package (0x14)
            {
                Zero, 
                Zero, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                One, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                Zero, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                0xFFFFFFFF, 
                "", 
                "", 
                "", 
                ""
            })
            Method (FBIF, 5, NotSerialized)
            {
                Store (Arg0, PUNT)
                Store (Arg1, Local1)
                Store (Arg2, Local2)
                If (LEqual (PUNT, Zero))
                {
                    Multiply (Local1, 0x0A, Local1)
                    Multiply (Local2, 0x0A, Local2)
                }

                Store (Arg0, Index (PBIF, Zero))
                Store (Local1, Index (PBIF, One))
                Store (Local2, Index (PBIF, 0x02))
                Store (Local2, LFCC)
                Store (Arg3, Index (PBIF, 0x03))
                Store (Arg4, Index (PBIF, 0x04))
                Divide (Local1, 0x0A, , Local5)
                Store (Local5, Index (PBIF, 0x05))
                Divide (Local1, 0x64, , Local6)
                Store (Local6, Index (PBIF, 0x06))
                Store (Local6, LOW2)
                Divide (Local1, 0x64, , Local7)
                Store (Local7, Index (PBIF, 0x07))
                Store (Local7, Index (PBIF, 0x08))
            }

            Method (CBIF, 0, NotSerialized)
            {
                If (PUNT)
                {
                    Store (DerefOf (Index (PBIF, 0x04)), Local0)
                    Store (Zero, Index (PBIF, Zero))
                    Multiply (DerefOf (Index (PBIF, One)), Local0, Index (PBIF, One))
                    Multiply (DerefOf (Index (PBIF, 0x02)), Local0, Index (PBIF, 0x02))
                    Multiply (DerefOf (Index (PBIF, 0x05)), Local0, Index (PBIF, 0x05))
                    Multiply (DerefOf (Index (PBIF, 0x06)), Local0, Index (PBIF, 0x06))
                    Multiply (DerefOf (Index (PBIF, 0x07)), Local0, Index (PBIF, 0x07))
                    Multiply (DerefOf (Index (PBIF, 0x08)), Local0, Index (PBIF, 0x08))
                    Divide (DerefOf (Index (PBIF, One)), 0x03E8, , Index (PBIF, One))
                    Divide (DerefOf (Index (PBIF, 0x02)), 0x03E8, , Index (PBIF, 0x02))
                    Divide (DerefOf (Index (PBIF, 0x05)), 0x03E8, , Index (PBIF, 0x05))
                    Divide (DerefOf (Index (PBIF, 0x06)), 0x03E8, , Index (PBIF, 0x06))
                    Divide (DerefOf (Index (PBIF, 0x07)), 0x03E8, , Index (PBIF, 0x07))
                    Divide (DerefOf (Index (PBIF, 0x08)), 0x03E8, , Index (PBIF, 0x08))
                }
            }

            Method (_BIF, 0, NotSerialized)  // _BIF: Battery Information
            {
                If (LNot (BATP (Zero)))
                {
                    Return (NBIF)
                }

                If (LEqual (GBTT (Zero), 0xFF))
                {
                    Return (NBIF)
                }

                BATO ()
                BATS (Zero)
                Store (BIF9 (), Index (PBIF, 0x09))
                Store (BIF0 (), Local0)
                Store (BIF1 (), Local1)
                Store (BIF2 (), Local2)
                Store (BIF3 (), Local3)
                Store (BIF4 (), Local4)
                If (LNotEqual (Local0, Ones))
                {
                    If (LNotEqual (Local1, Ones))
                    {
                        If (LNotEqual (Local2, Ones))
                        {
                            If (LNotEqual (Local3, Ones))
                            {
                                If (LNotEqual (Local4, Ones))
                                {
                                    FBIF (Local0, Local1, Local2, Local3, Local4)
                                    CBIF ()
                                }
                            }
                        }
                    }
                }

                If (LEqual (PUNT, Zero))
                {
                    Multiply (Local2, 0x0A, Local2)
                }

                Store (Local2, LFCC)
                BATR ()
                Return (PBIF)
            }

            Method (FBST, 4, NotSerialized)
            {
                And (Arg1, 0xFFFF, Local1)
                Store (Zero, Local0)
                If (ACAP ())
                {
                    Store (One, Local0)
                }

                If (Local0)
                {
                    If (CHGS (Zero))
                    {
                        Store (0x02, Local0)
                    }
                    Else
                    {
                        Store (One, Local0)
                    }
                }
                Else
                {
                    Store (One, Local0)
                }

                If (BLLO)
                {
                    Store (0x04, Local2)
                    Or (Local0, Local2, Local0)
                }

                Store (0x09, BRAH)
                If (And (EB0S, 0x08))
                {
                    Store (0x04, Local2)
                    Or (Local0, Local2, Local0)
                }

                If (LGreaterEqual (Local1, 0x8000))
                {
                    Subtract (0xFFFF, Local1, Local1)
                }

                Store (Arg2, Local2)
                If (LEqual (PUNT, Zero))
                {
                    Store (0x09, BRAH)
                    Multiply (Local1, B0DV, Local1)
                    Multiply (Local2, 0x0A, Local2)
                }

                And (Local0, 0x02, Local3)
                If (LNot (Local3))
                {
                    Subtract (LFCC, Local2, Local3)
                    Divide (LFCC, 0xC8, Local4, Local5)
                    If (LLess (Local3, Local5))
                    {
                        Store (LFCC, Local2)
                    }
                }
                Else
                {
                    Divide (LFCC, 0xC8, Local4, Local5)
                    Subtract (LFCC, Local5, Local4)
                    If (LGreater (Local2, Local4))
                    {
                        Store (Local4, Local2)
                    }
                }

                If (LNot (ACAP ()))
                {
                    Divide (Local2, MBLF, Local3, Local4)
                    If (LLess (Local1, Local4))
                    {
                        Store (Local4, Local1)
                    }
                }

                Store (Local0, Index (PBST, Zero))
                Store (Local1, Index (PBST, One))
                Store (Local2, Index (PBST, 0x02))
                Store (Arg3, Index (PBST, 0x03))
            }

            Method (CBST, 0, NotSerialized)
            {
                If (PUNT)
                {
                    Store (0x09, BRAH)
                    Store (B0DV, Index (PBST, 0x03))
                    Store (DerefOf (Index (PBST, 0x03)), Local0)
                    Multiply (DerefOf (Index (PBST, One)), Local0, Index (PBST, One))
                    Divide (DerefOf (Index (PBST, One)), 0x03E8, , Index (PBST, One))
                    Multiply (DerefOf (Index (PBST, 0x02)), Local0, Index (PBST, 0x02))
                    Divide (DerefOf (Index (PBST, 0x02)), 0x03E8, , Index (PBST, 0x02))
                }
            }

            Method (_BST, 0, NotSerialized)  // _BST: Battery Status
            {
                Store (Zero, Index (PBST, Zero))
                Store (Ones, Index (PBST, One))
                Store (Ones, Index (PBST, 0x02))
                Store (Ones, Index (PBST, 0x03))
                If (LNot (BATP (Zero)))
                {
                    Store (One, Index (PBST, Zero))
                    Return (PBST)
                }

                If (LEqual (GBTT (Zero), 0xFF))
                {
                    Return (PBST)
                }

                BATO ()
                BATS (Zero)
                Store (BSTS (), Local0)
                Store (BCRT (), Local1)
                Store (BRCP (), Local2)
                Store (BVOT (), Local3)
                If (LNotEqual (Local0, Ones))
                {
                    If (LNotEqual (Local1, Ones))
                    {
                        If (LNotEqual (Local2, Ones))
                        {
                            If (LNotEqual (Local3, Ones))
                            {
                                FBST (Local0, Local1, Local2, Local3)
                                CBST ()
                            }
                        }
                    }
                }

                BATR ()
                Return (PBST)
            }

            Method (_BIX, 0, NotSerialized)  // _BIX: Battery Information Extended
            {
                If (LNot (BATP (Zero)))
                {
                    Return (NBIX)
                }

                If (LEqual (GBTT (Zero), 0xFF))
                {
                    Return (NBIX)
                }

                _BIF ()
                Store (DerefOf (Index (PBIF, Zero)), Index (BIXT, One))
                Store (DerefOf (Index (PBIF, One)), Index (BIXT, 0x02))
                Store (DerefOf (Index (PBIF, 0x02)), Index (BIXT, 0x03))
                Store (DerefOf (Index (PBIF, 0x03)), Index (BIXT, 0x04))
                Store (DerefOf (Index (PBIF, 0x04)), Index (BIXT, 0x05))
                Store (DerefOf (Index (PBIF, 0x05)), Index (BIXT, 0x06))
                Store (DerefOf (Index (PBIF, 0x06)), Index (BIXT, 0x07))
                Store (DerefOf (Index (PBIF, 0x07)), Index (BIXT, 0x0E))
                Store (DerefOf (Index (PBIF, 0x08)), Index (BIXT, 0x0F))
                Store (DerefOf (Index (PBIF, 0x09)), Index (BIXT, 0x10))
                Store (DerefOf (Index (PBIF, 0x0A)), Index (BIXT, 0x11))
                Store (DerefOf (Index (PBIF, 0x0B)), Index (BIXT, 0x12))
                Store (DerefOf (Index (PBIF, 0x0C)), Index (BIXT, 0x13))
                If (LEqual (DerefOf (Index (BIXT, One)), One))
                {
                    Store (Zero, Index (BIXT, One))
                    Store (DerefOf (Index (BIXT, 0x05)), Local0)
                    Multiply (DerefOf (Index (BIXT, 0x02)), Local0, Index (BIXT, 0x02))
                    Multiply (DerefOf (Index (BIXT, 0x03)), Local0, Index (BIXT, 0x03))
                    Multiply (DerefOf (Index (BIXT, 0x06)), Local0, Index (BIXT, 0x06))
                    Multiply (DerefOf (Index (BIXT, 0x07)), Local0, Index (BIXT, 0x07))
                    Multiply (DerefOf (Index (BIXT, 0x0E)), Local0, Index (BIXT, 0x0E))
                    Multiply (DerefOf (Index (BIXT, 0x0F)), Local0, Index (BIXT, 0x0F))
                    Divide (DerefOf (Index (BIXT, 0x02)), 0x03E8, Local0, Index (BIXT, 0x02))
                    Divide (DerefOf (Index (BIXT, 0x03)), 0x03E8, Local0, Index (BIXT, 0x03))
                    Divide (DerefOf (Index (BIXT, 0x06)), 0x03E8, Local0, Index (BIXT, 0x06))
                    Divide (DerefOf (Index (BIXT, 0x07)), 0x03E8, Local0, Index (BIXT, 0x07))
                    Divide (DerefOf (Index (BIXT, 0x0E)), 0x03E8, Local0, Index (BIXT, 0x0E))
                    Divide (DerefOf (Index (BIXT, 0x0F)), 0x03E8, Local0, Index (BIXT, 0x0F))
                }

                Store (B0C3, Index (BIXT, 0x08))
                Store (0x0001869F, Index (BIXT, 0x09))
                Return (BIXT)
            }

            Method (_BTP, 1, NotSerialized)  // _BTP: Battery Trip Point
            {
                ST8E (0x29, 0xFF)
                ST8E (0x2A, 0xFF)
                ST8E (0x28, 0x0F)
                If (LNotEqual (Arg0, Zero))
                {
                    Store (DerefOf (Index (PBIF, 0x04)), Local0)
                    Multiply (Arg0, 0x03E8, Local1)
                    Divide (Local1, Local0, Local2, Local3)
                    If (CHGS (Zero))
                    {
                        If (LNotEqual (Local2, Zero))
                        {
                            Add (Local3, One, Local3)
                        }
                    }

                    ST9E (0x29, 0xFF, And (Local3, 0xFF))
                    ShiftRight (Local3, 0x08, Local2)
                    And (Local2, 0xFF, Local2)
                    ST9E (0x2A, 0xFF, Local2)
                }
            }
        }
    }
```

## SSDT

### 电池

更名如下。

```
Comment: change BIFA to BIGA
Find: 42494641
Replace: 42494741

Comment: change _BIX to XBIX
Find: 5F424958
Replace: 58424958
```

SSDT如下。

```
// 使用Catalina用户则需将EC0更改为EC
DefinitionBlock ("", "SSDT", 2, "hack", "BAT0", 0x00000000)
{
    External (_SB.PCI0.LPCB.EC0, DeviceObj) 
    External (_SB.PCI0.LPCB.EC0.BAT0, DeviceObj)
    External (_SB.PCI0.LPCB.EC0.BAT0._BIF, MethodObj)
    External (_SB.PCI0.LPCB.EC0.BAT0.BIXT, IntObj)
    External (_SB.PCI0.LPCB.EC0.BAT0.NBIX, IntObj)
    External (_SB.PCI0.LPCB.EC0.BAT0.PBIF, IntObj) 
    External (_SB.PCI0.LPCB.EC0.BATP, MethodObj) 
    External (_SB.PCI0.LPCB.EC0.BSLF, IntObj) 
    External (_SB.PCI0.LPCB.EC0.ECAV, MethodObj)
    External (_SB.PCI0.LPCB.EC0.GBTT, MethodObj)

    Scope (_SB.PCI0.LPCB.EC0)
    {
        OperationRegion (ECAG, EmbeddedControl, Zero, 0xFF)
        Field (ECAG, ByteAcc, Lock, Preserve)
        {
            Offset (0x04), 
            Offset (0x05), 
            Offset (0x06), 
            Offset (0x07), 
            Offset (0x08), 
            Offset (0x80), 
            Offset (0x81), 
            Offset (0x82), 
            Offset (0x83), 
            Offset (0x84), 
            Offset (0x85), 
            Offset (0x86), 
            Offset (0x87), 
            Offset (0x88), 
            Offset (0x89), 
            Offset (0x93), 
            Offset (0x95), 
            Offset (0x97), 
            Offset (0x98), 
            Offset (0x9C), 
            Offset (0x9D), 
            Offset (0x9E), 
            Offset (0xA0), 
            Offset (0xA1), 
            Offset (0xA2), 
            Offset (0xA3), 
            Offset (0xA4), 
            Offset (0xA5), 
            Offset (0xA6), 
            Offset (0xA7), 
            Offset (0xA8), 
            Offset (0xB0), 
            Offset (0xB2), 
            Offset (0xB4), 
            Offset (0xB6), 
            Offset (0xB8), 
            Offset (0xBA), 
            Offset (0xBC), 
            Offset (0xBE), 
            Offset (0xC0), 
            Offset (0xC2), 
            Offset (0xC4), 
            C3HG,   8, 
            C3HF,   8, 
            Offset (0xC8), 
            Offset (0xD0), 
            Offset (0xD2), 
            Offset (0xD4), 
            Offset (0xD6), 
            Offset (0xD8), 
            Offset (0xDA), 
            Offset (0xDC), 
            Offset (0xDE), 
            Offset (0xE0), 
            Offset (0xE2), 
            Offset (0xE4), 
            Offset (0xE6), 
            Offset (0xE8), 
            Offset (0xF0), 
            Offset (0xF2), 
            Offset (0xF4), 
            BSVN,   8, 
            BSVM,   8, 
            Offset (0xF8), 
            Offset (0xFA), 
            Offset (0xFC), 
            SBUY,   8, 
            SBUP,   8
        }

        Method (BIFA, 0, NotSerialized)
        {
            If (ECAV ())
            {
                If (BSLF)
                {
                    Store (B1B2 (SBUY, SBUP), Local0)
                }
                Else
                {
                    Store (B1B2 (BSVN, BSVM), Local0)
                }
            }
            Else
            {
                Store (Ones, Local0)
            }

            Return (Local0)
        }
    }

    Scope (_SB.PCI0.LPCB.EC0.BAT0)
    {
        Method (_BIX, 0, NotSerialized)  // _BIX: Battery Information Extended
        {
            If (LNot (BATP (Zero)))
            {
                Return (NBIX)
            }

            If (LEqual (GBTT (Zero), 0xFF))
            {
                Return (NBIX)
            }

            _BIF ()
            Store (DerefOf (Index (PBIF, Zero)), Index (BIXT, One))
            Store (DerefOf (Index (PBIF, One)), Index (BIXT, 0x02))
            Store (DerefOf (Index (PBIF, 0x02)), Index (BIXT, 0x03))
            Store (DerefOf (Index (PBIF, 0x03)), Index (BIXT, 0x04))
            Store (DerefOf (Index (PBIF, 0x04)), Index (BIXT, 0x05))
            Store (DerefOf (Index (PBIF, 0x05)), Index (BIXT, 0x06))
            Store (DerefOf (Index (PBIF, 0x06)), Index (BIXT, 0x07))
            Store (DerefOf (Index (PBIF, 0x07)), Index (BIXT, 0x0E))
            Store (DerefOf (Index (PBIF, 0x08)), Index (BIXT, 0x0F))
            Store (DerefOf (Index (PBIF, 0x09)), Index (BIXT, 0x10))
            Store (DerefOf (Index (PBIF, 0x0A)), Index (BIXT, 0x11))
            Store (DerefOf (Index (PBIF, 0x0B)), Index (BIXT, 0x12))
            Store (DerefOf (Index (PBIF, 0x0C)), Index (BIXT, 0x13))
            If (LEqual (DerefOf (Index (BIXT, One)), One))
            {
                Store (Zero, Index (BIXT, One))
                Store (DerefOf (Index (BIXT, 0x05)), Local0)
                Multiply (DerefOf (Index (BIXT, 0x02)), Local0, Index (BIXT, 0x02))
                Multiply (DerefOf (Index (BIXT, 0x03)), Local0, Index (BIXT, 0x03))
                Multiply (DerefOf (Index (BIXT, 0x06)), Local0, Index (BIXT, 0x06))
                Multiply (DerefOf (Index (BIXT, 0x07)), Local0, Index (BIXT, 0x07))
                Multiply (DerefOf (Index (BIXT, 0x0E)), Local0, Index (BIXT, 0x0E))
                Multiply (DerefOf (Index (BIXT, 0x0F)), Local0, Index (BIXT, 0x0F))
                Divide (DerefOf (Index (BIXT, 0x02)), 0x03E8, Local0, Index (BIXT, 0x02))
                Divide (DerefOf (Index (BIXT, 0x03)), 0x03E8, Local0, Index (BIXT, 0x03))
                Divide (DerefOf (Index (BIXT, 0x06)), 0x03E8, Local0, Index (BIXT, 0x06))
                Divide (DerefOf (Index (BIXT, 0x07)), 0x03E8, Local0, Index (BIXT, 0x07))
                Divide (DerefOf (Index (BIXT, 0x0E)), 0x03E8, Local0, Index (BIXT, 0x0E))
                Divide (DerefOf (Index (BIXT, 0x0F)), 0x03E8, Local0, Index (BIXT, 0x0F))
            }

            Store (B1B2 (C3HG, C3HF), Index (BIXT, 0x08))
            Store (0x0001869F, Index (BIXT, 0x09))
            Return (BIXT)
        }
    }

    Method (B1B2, 2, NotSerialized)
    {
        Return (Or (Arg0, ShiftLeft (Arg1, 0x08)))
    }
}
```

### I2C触控板

SSDT如下。

```
DefinitionBlock ("", "SSDT", 2, "_ASUS_", "Notebook", 0x01072009)
{
    External(TPDI, FieldUnitObj)
    External(TPHI, FieldUnitObj)
    External (_SB.PCI0.I2C1,DeviceObj)
    
    
    Scope (_SB.PCI0.I2C1)
    {
        Device (TPXX)
        {
            Name (SBFG, ResourceTemplate ()
               {
                    GpioInt (Level, ActiveLow, Exclusive, PullUp, 0x0000,
                            "\\_SB.PCI0.GPI0", 0x00, ResourceConsumer, ,
                            )
                            {   // Pin list
                                0x55
                            }
               })
            
            Name (_ADR, One)  // _ADR: Address
            Name (ETPH, Package (0x16)
            {
                "ELAN1200", 
                "ELAN1201", 
                "ELAN1203", 
                "ELAN1200", 
                "ELAN1201", 
                "ELAN1300", 
                "ELAN1301", 
                "ELAN1300", 
                "ELAN1301", 
                "ELAN1000", 
                "ELAN1200", 
                "ELAN1200", 
                "ELAN1200", 
                "ELAN1200", 
                "ELAN1200", 
                "ELAN1203", 
                "ELAN1203", 
                "ELAN1201", 
                "ELAN1300", 
                "ELAN1300", 
                "ELAN1200", 
                "ELAN1300"
            })
            Name (FTPH, Package (0x05)
            {
                "FTE1001", 
                "FTE1200", 
                "FTE1200", 
                "FTE1300", 
                "FTE1300"
            })
            Method (_HID, 0, NotSerialized)  // _HID: Hardware ID
            {
                If ((TPDI & 0x04))
                {
                    Return (DerefOf (ETPH [TPHI]))
                }

                If ((TPDI & 0x10))
                {
                    Return (DerefOf (FTPH [TPHI]))
                }

                Return ("ELAN1010")
            }

            Name (_CID, "PNP0C50" /* HID Protocol Device (I2C bus) */)  // _CID: Compatible ID
            Name (_UID, One)  // _UID: Unique ID
            Name (_S0W, 0x03)  // _S0W: S0 Device Wake State
            Method (_DSM, 4, NotSerialized)  // _DSM: Device-Specific Method
            {
                If ((Arg0 == ToUUID ("3cdff6f7-4267-4555-ad05-b30a3d8938de") /* HID I2C Device */))
                {
                    If ((Arg2 == Zero))
                    {
                        If ((Arg1 == One))
                        {
                            Return (Buffer (One)
                            {
                                 0x03                                             // .
                            })
                        }
                        Else
                        {
                            Return (Buffer (One)
                            {
                                 0x00                                             // .
                            })
                        }
                    }

                    If ((Arg2 == One))
                    {
                        Return (One)
                    }
                }
                Else
                {
                    Return (Buffer (One)
                    {
                         0x00                                             // .
                    })
                }
            }

            Method (_STA, 0, NotSerialized)  // _STA: Status
            {
                        If (_OSI ("Darwin"))
        {
            Return (0x0F)
        }
        Else
        {
            Return (Zero)
        }
            }

            Method (_CRS, 0, Serialized)  // _CRS: Current Resource Settings
            {
                Name (SBFB, ResourceTemplate ()
                {
                    I2cSerialBusV2 (0x0015, ControllerInitiated, 0x00061A80,
                        AddressingMode7Bit, "\\_SB.PCI0.I2C1",
                        0x00, ResourceConsumer, , Exclusive,
                        )
                })
                Return (ConcatenateResTemplate (SBFB, SBFG))
            }
        }
    }
}
```

## Clover结构

### Mojave/Catalina

```
├── ACPI
│   └── patched
│       ├── SSDT-ALS0.aml
│       ├── SSDT-ARTC.aml
│       ├── SSDT-ASUS.aml
│       ├── SSDT-BAT0.aml
│       ├── SSDT-Config.aml
│       ├── SSDT-DGPU.aml
│       ├── SSDT-DMAC.aml
│       ├── SSDT-GPRW.aml
│       ├── SSDT-MCHC.aml
│       ├── SSDT-MEM2.aml
│       ├── SSDT-PNLF.aml
│       ├── SSDT-UIAC.aml
│       └── SSDT-XCPM.aml
├── CLOVERX64.efi
├── config.plist
├── drivers
│   └── UEFI
│       ├── ApfsDriverLoader.efi
│       ├── AudioDxe.efi
│       ├── DataHubDxe.efi
│       ├── FSInject.efi
│       ├── HFSPlus.efi
│       ├── OpenRuntime.efi
│       └── VirtualSmc.efi
└── kexts
    └── Other
        ├── AppleALC.kext
        ├── AsusSMC.kext
        ├── CPUFriend.kext
        ├── CPUFriendDataProvider.kext
        ├── CodecCommander.kext
        ├── Lilu.kext
        ├── LiluFriend.kext
        ├── NoTouchID.kext
        ├── RealtekRTL8111.kext
        ├── SMCBatteryManager.kext
        ├── SMCLightSensor.kext
        ├── SMCProcessor.kext
        ├── SMCSuperIO.kext
        ├── USBInjectAll.kext
        ├── VirtualSMC.kext
        ├── VoodooI2C.kext
        ├── VoodooI2CHID.kext
        ├── VoodooPS2Controller.kext
        └── WhateverGreen.kext
```

### Big Sur

```
├── ACPI
│   └── patched
│       ├── SSDT-GPRW.aml
│       └── SSDT-PLUG.aml
├── CLOVERX64.efi
├── config.plist
├── drivers
│   └── UEFI
│       ├── ApfsDriverLoader.efi
│       ├── AudioDxe.efi
│       ├── DataHubDxe.efi
│       ├── FSInject.efi
│       ├── HFSPlus.efi
│       ├── OpenRuntime.efi
│       └── VirtualSmc.efi
└── kexts
    └── Other
        ├── Lilu.kext
        ├── SMCBatteryManager.kext
        ├── SMCLightSensor.kext
        ├── SMCProcessor.kext
        ├── SMCSuperIO.kext
        ├── USBInjectAll.kext
        ├── VirtualSMC.kext
        ├── VoodooI2C.kext
        ├── VoodooI2CHID.kext
        ├── VoodooPS2Controller.kext
        └── WhateverGreen.kext
```

## OpenCore结构

### Catalina

```
├── ACPI
│   ├── SSDT-ALSD.aml
│   ├── SSDT-ARTC.aml
│   ├── SSDT-ASUS.aml
│   ├── SSDT-BAT0.aml
│   ├── SSDT-Config.aml
│   ├── SSDT-DGPU.aml
│   ├── SSDT-DMAC.aml
│   ├── SSDT-EC.aml
│   ├── SSDT-GPRW.aml
│   ├── SSDT-MCHC.aml
│   ├── SSDT-MEM2.aml
│   ├── SSDT-PLUG.aml
│   ├── SSDT-PMCR.aml
│   ├── SSDT-PNLF.aml
│   ├── SSDT-SBUS.aml
│   ├── SSDT-UIAC.aml
│   └── SSDT-XCPM.aml
├── Drivers
│   ├── ApfsDriverLoader.efi
│   ├── AudioDxe.efi
│   ├── HfsPlus.efi
│   ├── OpenCanopy.efi
│   ├── OpenRuntime.efi
│   └── OpenUsbKbDxe.efi
├── Kexts
│   ├── AppleALC.kext
│   ├── AsusSMC.kext
│   ├── CodecCommander.kext
│   ├── Lilu.kext
│   ├── LiluFriend.kext
│   ├── NoTouchID.kext
│   ├── RealtekRTL8111.kext
│   ├── SMCBatteryManager.kext
│   ├── SMCLightSensor.kext
│   ├── SMCProcessor.kext
│   ├── SMCSuperIO.kext
│   ├── USBInjectAll.kext
│   ├── VirtualSMC.kext
│   ├── VoodooPS2Controller.kext
│   └── WhateverGreen.kext
├── OpenCore.efi
└── config.plist
```

### Big Sur

```
├── ACPI
│   ├── SSDT-GPRW.aml
│   └── SSDT-PLUG.aml
├── Drivers
│   ├── ApfsDriverLoader.efi
│   ├── AudioDxe.efi
│   ├── HfsPlus.efi
│   ├── OpenCanopy.efi
│   ├── OpenRuntime.efi
│   └── OpenUsbKbDxe.efi
├── Kexts
│   ├── Lilu.kext
│   ├── SMCBatteryManager.kext
│   ├── SMCLightSensor.kext
│   ├── SMCProcessor.kext
│   ├── SMCSuperIO.kext
│   ├── USBMap.kext
│   ├── CtlnaAHCIPort.kext
│   ├── VirtualSMC.kext
│   ├── VoodooI2C.kext
│   ├── VoodooI2CHID.kext
│   ├── VoodooPS2Controller.kext
│   └── WhateverGreen.kext
├── OpenCore.efi
└── config.plist
```

# 相关下载

```
BIOS 无法开启AHCI 及 AMD 补丁( 最好别装，除非必要 )
　　 AppleIntelPIIXATA.kext 　　　Intel免AHCI专用kext
　　 AppleATIATA.kext 　　　　　AMD芯片组专用kext(2009.12.30)
　　 AppleATIPATA.kext 　　　　 AMD芯片组专用kext
　　 AppleNForceATA.kext 　　　NForce芯片组专用kext
　　 AppleVIAATA.kext 　　　　　VIA芯片组专用kext
　　 JMicronATA.kext 　　　　　 JMicron芯片组专用kext

AppleATIATA.kext 　　　　　AMD芯片组专用kext(2010.8.28) (另一版本，勿与附件 IOATAFamily.kext 共用)
　　 AppleVIAATA.kext.for.sis.SATA 　　SIS芯片组专用kext

NullCPUPowerManagement.kext 　　　　　　　　　　　　　　　　 禁用电源管理功能，解决HPET错误
　　 OpenHaltRestart.kext 或 EvOreboot.kext (2选1,不可共用)　　　　　　解决重启/关机时遇到无法断电问题
　　 ElliottForceLegacyRTC.kext 或 LegacyAppleRTC.kext (2选1,不可共用)　　防止主板BIOS的CMOS重置错误
　　 PlatformUUID.kext 　　　　　　　　　　　　解决Unable to determine UUID for host. Error : 35的问题


笔记本 最好安装 ElliottForceLegacyRTC.kext 或 LegacyAppleRTC.kext (2选1,不可共用)
　　　　　　　 以免BIOS被毁了，无法开机



```

## 旧版用的USB驱动

```
AppleUSBXHCI继承自IOUSBControllerV3，该文件存在于OS 10.6.8的IOUSBFamily中


【USB3 Mutliplex补丁，有助于加载AppleUSBXHCI.kext（原生USB3.0驱动），于是就不需要安装第三方的GenericUSBXCHI.kext了。这个补丁是基于Mieze的发现而制作的。 】
【AppleUSBXHCI】
https://www.insanelymac.com/forum/files/file/150-patched-appleusbxhci/?changelog=133
【mXHCD.kext】https://github.com/chris1111/USB-3.0-NEC
【Lacie kext——PXHCD】
https://www.osx86.net/files/file/2971-usb-30-lacie-kext-patched-by-modbin/
https://cl.ly/5d7458679f9c749c0d09

https://www.osx86.net/files/file/1086-pxhcdkext/page/2/
https://www.osx86.net/files/file/3719-pxhcdkext-iopcifamilykext/
http://www.mediafire.com/file/6c3kby1se62lkib/PXHCD_patched.zip/file
https://www.insanelymac.com/forum/topic/236209-lacie-usb-30-drivers-are-here-for-os-x/
https://www.root86.com/files/file/527-usb-30-kext-f%C3%BCr-snow-leopard/
【CalDigitUSB3】
https://archive.caldigit.com/KB/index.asp?KBID=108&viewlocale=1
【GenericUSBXHCI的DSDT替代】
——其实可以通过原dsdt和patch后的dsdt，尝试通过修改DSDT的方式完成这个kext的功能
【GenericUSBXHCI的深层实现】https://www.insanelymac.com/forum/topic/287901-how-to-get-intel-7-series-usb-30-fully-working-step-by-step-guide/
【但DSDT加载的前提似乎是要有原生的AppleUSBXHCI？是否可以从10.7.5复制一份？】
https://github.com/RehabMan/Intel-NUC-DSDT-Patch
https://www.tonymacx86.com/threads/a-beginners-guide-to-creating-a-custom-usb-ssdt.272505/
https://bitbucket.org/philippetev/hp-probook-installer/wiki/Home
```

## GenericUSBXHCI.kext

适用于10.7.5-10.10。

```
https://sourceforge.net/projects/genericusbxhci/files/
https://bitbucket.org/RehabMan/os-x-generic-usb3/downloads/
```

## RehabMan/hack-tools

包含AppleBacklightInjector、EFICheckDisabler、ProBookAtheros、SATA-unsupported、XHCI-unsupported。

```
https://github.com/RehabMan/hack-tools/tree/master/kexts
```

## IntelMausi.kext

```
https://github.com/acidanthera/IntelMausi
```

## NVMeFix.kext

```
https://github.com/acidanthera/NVMeFix
```

## JackFix.kext

支持ResetHDA和3.5mm耳机接口类型切换。

```
https://github.com/fewtarius/jackfix
```

## ssdtPRGen.sh

```
https://github.com/Piker-Alpha/ssdtPRGen.sh
```

## OpenCore

### OpenCorePkg

```
https://github.com/acidanthera/OpenCorePkg/releases
```

### AppleSupportPkg

```
https://github.com/acidanthera/AppleSupportPkg/releases
```

### OcBinaryData

```
https://github.com/acidanthera/OcBinaryData
```

### SSDT-EHCx_OFF.dsl

```
https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/SSDT-EHCx_OFF.ds
```

### OpenCore Configurator

```
https://mackie100projects.altervista.org/download-opencore-configurator/
```


## kexts

### 常用kexts包

```
// Opencore的kext包
https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Kexts.md

// Goldfish64的kext包
https://onedrive.live.com/?authkey=%21APjCyRpzoAKp4xs&id=FE4038DA929BFB23%21455036&cid=FE4038DA929BFB23

// 自动编译Lilu的kext包
https://github.com/corpnewt/Lilu-and-Friends

// Lilu官方kext包
https://github.com/acidanthera/Lilu/blob/master/KnownPlugins.md

// Acidanthera的kext包
https://github.com/acidanthera/bugtracker
```

### 旧版系统kexts

```
https://olarila.com/files/?dir=Kexts
```

### NVMeFix

```
https://github.com/acidanthera/NVMeFix
```

### ACPIDebug

```
https://bitbucket.org/RehabMan/os-x-acpi-debug/downloads/
```

### NullCPUPowerManagement

AMD CPU无法使用英特尔的电源管理，因此我们需要取消它。

```
https://github.com/Goldfish64/SerialMouse/releases
```

### WebCamera

相机驱动。

```
https://i.applelife.ru/2019/03/448848_WebCamera.kext.zip
```

### AnyiSightCam

在系统报告中添加相机信息。

```
https://github.com/tuiuVN/EFI_Clover/tree/13a94765f8c3f4a5c7138b2fcc1b9e8d091c65e8/K46CA/EFI/CLOVER/kexts/Other
```

### AnyCardReader

在系统报告中添加读卡器信息（需更改为自己的ID）。

```
https://github.com/holoto/ec-471g/tree/master/EFI/EFI/CLOVER/kexts/10.11
```

### AnyiSightCam

在系统报告中添加相机信息。

```
https://github.com/tuiuVN/EFI_Clover/tree/13a94765f8c3f4a5c7138b2fcc1b9e8d091c65e8/K46CA/EFI/CLOVER/kexts/Other
```

### DebugEnhancer

啰嗦模式下可输出更多内容。

```
https://github.com/acidanthera/DebugEnhancer
```

### VoodooHDA

AMD平台音频驱动（AMD平台不能用AppleALC）。

```
https://github.com/chris1111/VoodooHDA-2.9.2-Clover-V14/releases
```

### XLNCUSBFix

修复AMD FX系统的USB控制器。

```
https://cdn.discordapp.com/attachments/566705665616117760/566728101292408877/XLNCUSBFix.kext.zip
```

### IOElectrify

为Intel Thunderbolt硬件提供始终开启的电源。

```
https://github.com/the-darkvoid/macOS-IOElectrify/releases
```

### AppleMCEReporterDisabler

在Catalina平台上AppleMCEReporter将导致AMD CPU和双插槽系统上的内核崩溃，故需此kext以禁用。

```
https://github.com/acidanthera/bugtracker/files/3703498/AppleMCEReporterDisabler.kext.zip
https://github.com/khronokernel/DisableMCEReporter-
```

###  VoodooTSCSync

校正华硕HEDT/Server主板上的TSC。

```
https://bitbucket.org/RehabMan/VoodooTSCSync/downloads/
```

### VoodooInput

提供Magic Trackpad 2仿真。

```
https://github.com/acidanthera/VoodooInput/releases
```

### LiluFriend

确保Lilu及其插件被加载。

```
https://github.com/PMheart/LiluFriend
```

### VoodooSDHCMod

读卡器驱动。

```
https://github.com/lvs1974/VoodooSDHCMod/releases
```

### Sinetek-rtsx

读卡器驱动。

```
https://github.com/tsingui/Sinetek-rtsx-1
```

### SerialMouse

串行鼠标驱动，在系统启动前需先将鼠标接入电脑。

```
https://github.com/Goldfish64/SerialMouse/releases
```

### NightShiftUnlocker

为较旧机型解锁夜视模式。

```
https://github.com/0xFireWolf/NightShiftUnlocker/releases
```

### RTCMemoryFixup

解决部分Z370 B360新BIOS的RTC中STA函数导致卡Apfs NVME的问题。

```
https://github.com/acidanthera/RTCMemoryFixup
```

### HibernationFixup

解决某些机器3&25模式下的休眠问题。

```
https://github.com/acidanthera/HibernationFixup
```

### SystemProfilerMemoryFixup

在MacBookAir和MacBookPro10，x平台上显示内存选项卡。

```
https://github.com/Goldfish64/SystemProfilerMemoryFixup
```

### DiskArbitrationFixup

禁用`此计算机无法读取您插入的磁盘`消息。

```
https://github.com/Goldfish64/DiskArbitrationFixup
```

### AHCI_3rdParty_eSATA/SATA

第三方eSATA/SATA驱动，连接到这些接口的设备将会识别为内置磁盘。

```
// AHCI_3rdParty_eSATA
https://github.com/NTT123/Hackintosh-HP-Z420-MacOS-High-Sierra-10.13-10.14/tree/master/CLOVER/kexts/10.12

// AHCI_3rdParty_SATA
https://github.com/forumi0721/osx_clover/tree/master/OEM/Z77%20Extreme4/kexts/10.11
```

### AHCI_Intel_Generic_SATA

英特尔SATA驱动。

```
https://github.com/NTT123/Hackintosh-HP-Z420-MacOS-High-Sierra-10.13-10.14/tree/master/CLOVER/kexts/10.12
```

## Catalina MBR HFS Firmware Check Patch

```
https://www.insanelymac.com/forum/files/file/985-catalina-mbr-hfs-firmware-check-patch/
```

## FixShutdown-USB-SSDT.dsl

```
https://github.com/khronokernel/Opencore-Vanilla-Desktop-Guide/blob/master/extra-files/FixShutdown-USB-SSDT.dsl
```

## ProperTree

```
https://codeload.github.com/corpnewt/ProperTree/zip/master
```

## FireWolf OS X PE

```
https://pe.firewolf.app/manual/downloads/thankyou.html
```

## HWMonitorSMC2

```
https://github.com/CloverHackyColor/HWMonitorSMC2
```

## 驱动

### HFSPlus

```
https://github.com/STLVNUB/CloverGrower/tree/master/Files/HFSPlus/x64
```

### AppleSupportPkg

包括ApfsDriverLoader、FwRuntimeServices、VBoxHfs、VerifyMsrE2。

```
https://github.com/acidanthera/AppleSupportPkg
```

### CrScreenshotDxe

```
https://github.com/LongSoft/CrScreenshotDxe
```

### OpenCore UEFI Drivers（包括XhciDxe、MemoryAllocation、VariableRuntimeDxe和NvmExpressDxe）

```
https://github.com/williambj1/OpenCore-Factory/releases/tag/OpenCore-UEFI-Drivers
```

### Acidanthera UEFI Development Kit（驱动库）

```
https://github.com/acidanthera/audk
```

# 参考教程

## 黑苹果制作虚拟机CDR镜像

```
https://blog.csdn.net/qq_41855420/article/details/102750055
```

## OpenCore引导教程

```
https://blog.daliansky.net/OpenCore-BootLoader.html
https://blog.daliansky.net/From-Clover-To-OpenCore.html
https://blog.skk.moe/post/from-clover-to-opencore/
https://blog.xjn819.com/?p=543
https://khronokernel-2.gitbook.io/opencore-vanilla-desktop-guide/
https://dortania.github.io/OpenCore-Desktop-Guide/
https://kirainmoe.com/blog/post/opencore-migration-experience/#13-%e4%bf%ae%e6%94%b9-configplist
```

## 【持续更新】OpenCore引导-v各种卡及OC引导常见问题解决方案速查表合集

```
https://imacos.top/2020/03/28/0154/
```

## macOS 10.13安装中常见的问题及解决方法

```
https://blog.daliansky.net/macOS-10.13-installation-of-common-problems-and-solutions.html
```

## OpenCore 引导迁移折腾记录

```
https://kirainmoe.com/blog/post/opencore-migration-experience/
```

## 热补丁制作教程

```
https://www.penghubingzhou.cn/2019/05/02/Battery%20Hotpatch%20Make/
https://xstar-dev.github.io/hackintosh_advanced/Guide_For_Battery_Hotpatch.html
http://yqp7js.coding-pages.com/2020/05/16/%E8%BF%9B%E9%98%B6%EF%BC%9A%E7%94%B5%E6%B1%A0%E7%83%AD%E8%A1%A5%E4%B8%81%EF%BC%88Battery-Hotpatch%EF%BC%89%E4%B9%8B%E8%B7%AF/
```

## Acidanthera故障排除

```
https://github.com/acidanthera/bugtracker
```

## AsusSMC使用教程

```
https://github.com/hieplpvip/AsusSMC/wiki/Installation-Instruction
```

## macOS Catalina 10.15安装中常见的问题及解决方法

```
https://blog.daliansky.net/Common-problems-and-solutions-in-macOS-Catalina-10.15-installation.html
```

## FIREWOLF OS X PE 9 使用手册

```
https://pe.firewolf.app/manual/chapter3/launcherfirstview.html
```

## Clover的用法

```
https://www.misonsky.cn/28.html
```

## Booting the OS X installer on LAPTOPS with Clover

```
https://www.tonymacx86.com/threads/guide-booting-the-os-x-installer-on-laptops-with-clover.148093/
```

## MaciASL / Wiki / Patching Syntax Grammar

```
https://sourceforge.net/p/maciasl/wiki/Patching%20Syntax%20Grammar/
```

## Patching LAPTOP DSDT/SSDTs

```
https://www.tonymacx86.com/threads/guide-patching-laptop-dsdt-ssdts.152573/
```

## Using Clover to hotpatch ACPI

```
https://www.tonymacx86.com/threads/guide-using-clover-to-hotpatch-acpi.200137/
```

## Clover EFI Bootloader v5.1 r5127 四叶草黑苹果引导程序

```
https://heipg.cn/clover/clover-efi-bootloader-v5-1-r5127.html
```

## -V进mac不滚代码直接卡++加号或者加号下几行代码Error allocating 0x11c8d pages at......卡住解决方案

```
https://imacos.top/2019/08/12/1033/
```

## CatalinaAutoMountWritable.plist

```
https://forums.macrumors.com/attachments/catalinaautomountwritable-plist-zip.847064/
```

## 用热补丁修理你的触摸板

```
https://blog.gzxiaobai.cn/2020/05/17/%E7%94%A8%E7%83%AD%E8%A1%A5%E4%B8%81%E4%BF%AE%E7%90%86%E4%BD%A0%E7%9A%84%E8%A7%A6%E6%91%B8%E6%9D%BF%EF%BC%88TouchPad-Hotpatch%EF%BC%89/
http://yqp7js.coding-pages.com/2020/05/17/%E7%94%A8%E7%83%AD%E8%A1%A5%E4%B8%81%E4%BF%AE%E7%90%86%E4%BD%A0%E7%9A%84%E8%A7%A6%E6%91%B8%E6%9D%BF%EF%BC%88TouchPad-Hotpatch%EF%BC%89/
```

## Hotpatch热补丁之路2:常见的种类与外部引用

```
http://bbs.pcbeta.com/viewthread-1866928-1-1.html
```


## Fix for El Capitan stuck at login

```
https://discussions.apple.com/thread/7376445?tstart=0
```

## Macbook Pro stuck after I enter my password

```
https://apple.stackexchange.com/questions/305097/macbook-pro-stuck-after-i-enter-my-password
```

## AptioMemoryFix

```
https://www.insanelymac.com/forum/topic/331381-aptiomemoryfix/?tab=comments#comment-2564269
```

## Turn on performance mode for macOS Server

```
https://support.apple.com/en-gb/HT202528
```

## macOS启动参数列表

```
https://blog.skk.moe/post/macos-boot-args/
```

## Dortania's OpenCore Install Guide

```
https://dortania.github.io/OpenCore-Install-Guide/
https://thrrip.github.io/OpenCore-Install-Guide/
```

## MP3,1 (& others?) SSE 4.2 emulation (to enable AMD Metal driver)

```
https://forums.macrumors.com/threads/mp3-1-others-sse-4-2-emulation-to-enable-amd-metal-driver.2206682/
```

## Clover Kexts and Firmware driver conversion(.kext, .efi)

```
https://github.com/dortania/OpenCore-Install-Guide/blob/master/clover-conversion/clover-efi.md
```

## macOS BigSur 11.0安装中常见的问题及解决方法

```
https://blog.daliansky.net/Common-problems-and-solutions-in-macOS-BigSur-11.0-installation.html
```

## Release Date – Gixxer PC

```
https://www.dualbootpc.com/guide/release-date/
```

## TSplicedFont failed creating descriptor for El Capitan

```
https://apple.stackexchange.com/questions/304552/tsplicedfont-failed-creating-descriptor-for-el-capitan
```

## Acer V5-572G On Yosemite

```
https://www.jianshu.com/p/30ff92784076
```

## How to make a bootable Mountain Lion install drive

```
https://www.macworld.com/article/1167857/how-to-make-a-bootable-mountain-lion-install-drive.html
```

## Who can help me compile the DSDT, Thanks!

```
https://www.tonymacx86.com/threads/solved-who-can-help-me-compile-the-dsdt-thanks.189972/
```

## HACKINTOSH BOOT FLAGS

```
https://www.fitzweekly.com/2016/04/hackintosh-boot-flags.html
```

## macOS系统下载

```
https://www.applex.net/pages/macos/
```

## A full history of macOS (OS X) release dates and rates

```
https://robservatory.com/a-full-history-of-macos-os-x-release-dates-and-rates/
```

## Show Hidden Files OS X 10.7 Lion

```
https://apple.stackexchange.com/questions/18662/show-hidden-files-os-x-10-7-lion
```

## Is Intel's 8th gen Compatible with OS X 10.9, 10.10, 10.11, 10.12?

```
https://www.tonymacx86.com/threads/is-intels-8th-gen-compatible-with-os-x-10-9-10-10-10-11-10-12.253152/
```

## How to create a bootable OS X Snow Leopard USB drive?

```
https://apple.stackexchange.com/questions/400472/how-to-create-a-bootable-os-x-snow-leopard-usb-drive
```

## Download MacOS X 10.4 - 10.15 original - All versions

```
https://applehint.com/t/download-macos-x-10-4-10-15-original-all-versions/376
```

## Common boot options for Chimera, Chameleon, Unibeast, Niresh, and more

```
http://www.macbreaker.com/2012/01/list-of-common-hackintosh-boot-flags_29.html
```

## 关于黑苹果升级macOS11（bigsur）的建议与观点

```
https://zhuanlan.zhihu.com/p/158770898
```

## 卡在com.apple.xpc.launchd[1]这里了，一直循环，求大神指导一下

```
http://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1876638
```

## SecureBootModel conflicts with Big Sur beta 10

```
https://github.com/acidanthera/bugtracker/issues/1235
```

## macOS 11.0 Big Sur Public Beta 10 - boot, kernel panic

```
https://www.tonymacx86.com/threads/solved-macos-11-0-big-sur-public-beta-10-boot-kernel-panic.305007/
```

## Slide值获取及计算

```
https://blog.daliansky.net/Slide-value-acquisition-and-calculation.html
```

## macOS 11 Big Sur on Unsupported Macs Thread

```
https://forums.macrumors.com/threads/macos-11-big-sur-on-unsupported-macs-thread.2242172/page-28?post=28603788#post-28603788
https://forums.macrumors.com/threads/macos-11-big-sur-on-unsupported-macs-thread.2242172/page-29?post=28604333#post-28604333
```

## Install macOS Big Sur on a Newly Unsupported Mac With WI-FI Working: My iMac Late-2012

```
https://blog.juliensatti.com/install-macos-big-sur-mac-obsolete/
```

## Making WiFi work on Big Sur unsupported Macs with “failed with 66” error

```
https://andv.medium.com/making-wifi-on-big-sur-unsupported-macs-with-failed-with-66-error-36c98e3f7965
```
